(window.webpackJsonp=window.webpackJsonp||[]).push([[24],{zCbf:function(t,e,n){"use strict";n.r(e),n.d(e,"default",(function(){return K})),n.d(e,"renderToDOM",(function(){return Q}));var r=n("rePB"),a=n("o0o1"),i=n.n(a),o=(n("wcNg"),n("HaE+")),u=n("JX7q"),s=n("dI71"),l=n("q1tI"),c=n.n(l),d=n("i8i4"),f=n("UP1k"),p=n("rta6"),h=n("yYqN"),b=n("Wium"),m=n("BENj"),y=n("NZ3H"),v=n("lese"),S=n("2Daz");function g(t,e){var n;if("undefined"==typeof Symbol||null==t[Symbol.iterator]){if(Array.isArray(t)||(n=function(t,e){if(!t)return;if("string"==typeof t)return w(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);"Object"===n&&t.constructor&&(n=t.constructor.name);if("Map"===n||"Set"===n)return Array.from(t);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return w(t,e)}(t))||e&&t&&"number"==typeof t.length){n&&(t=n);var r=0;return function(){return r>=t.length?{done:!0}:{done:!1,value:t[r++]}}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}return(n=t[Symbol.iterator]()).next.bind(n)}function w(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}function O(t,e){return j.apply(this,arguments)}function j(){return(j=Object(o.a)(i.a.mark((function t(e,n){var r,a,o;return i.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(a=n.attributeName,o=n.attributeType,a){t.next=3;break}return t.abrupt("return",{});case 3:return t.abrupt("return",((r={})[a]=o?_(o,e):null,r));case 4:case"end":return t.stop()}}),t)})))).apply(this,arguments)}function _(t,e){switch(t){case S.h:return function(t){for(var e,n=new Uint32Array(t,0,4)[0],r=new Uint32Array(t,8,n),a=[],i=8+4*n,o=g(r);!(e=o()).done;){var u=e.value,s=new TextDecoder("utf-8"),l=new Uint8Array(t,i,u);a.push(s.decode(l)),i+=u}return a}(e);case S.f:return x(e);case S.a:return function(t){return new Float64Array(t,8)}(e);default:return x(e)}}function x(t){return new Uint32Array(t,4)}var k=n("24Wh"),P=n("/Xah");function A(t){return Promise.allSettled?Promise.allSettled(t):Promise.all(t.map(C))}function C(t){return t.then((function(t){return{status:"fulfilled",value:t}}),(function(t){return{status:"rejected",reason:t}}))}var T="undefined"!=typeof __VERSION__?__VERSION__:"latest",I={name:"I3S Attribute",id:"i3s-attribute",module:"i3s",version:T,mimeTypes:["application/binary"],parse:function(t,e){return E.apply(this,arguments)},extensions:["bin"],options:{},binary:!0};function E(){return(E=Object(o.a)(i.a.mark((function t(e,n){return i.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return e=O(e,n),t.abrupt("return",e);case 2:case"end":return t.stop()}}),t)})))).apply(this,arguments)}function M(t,e,n){return U.apply(this,arguments)}function U(){return(U=Object(o.a)(i.a.mark((function t(e,n,r){var a,o,u,s,l,c,d,f,p,h;return i.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(void 0===r&&(r={}),a=W(e),o=a.attributeStorageInfo,u=a.attributeUrls,o&&u&&n){t.next=4;break}return t.abrupt("return",null);case 4:for(s=[],l=[],c=0;c<o.length;c++)d=Object(P.c)(u[c],r.token),f=o[c].name,p=D(o[c]),h=Object(k.a)(d,I,{attributeName:f,attributeType:p}),l.push(h);return t.prev=7,t.next=10,A(l);case 10:s=t.sent,t.next=15;break;case 13:t.prev=13,t.t0=t.catch(7);case 15:if(s.length){t.next=17;break}return t.abrupt("return",null);case 17:return t.abrupt("return",F(s,o,n));case 18:case"end":return t.stop()}}),t,null,[[7,13]])})))).apply(this,arguments)}function W(t){return{attributeStorageInfo:t&&t.tileset&&t.tileset.tileset&&t.tileset.tileset.attributeStorageInfo,attributeUrls:t&&t.header&&t.header.attributeUrls}}function D(t){return t.hasOwnProperty("objectIds")?"Oid32":t.hasOwnProperty("attributeValues")?t.attributeValues.valueType:""}function F(t,e,n){var r=t.find((function(t){return t.value.OBJECTID}));if(!r)return null;var a=r.value.OBJECTID.indexOf(n);return a<0?null:function(t,e,n){for(var r={},a=0;a<n.length;a++){var i=n[a].name,o=L(t,a,i);r[i]=N(o,e)}return r}(t,a,e)}function L(t,e,n){var r=t[e];return"rejected"===r.status?null:r.value[n]}function N(t,e){return t&&t[e]?t[e].toString().replace(/\u0000/g,"").trim():""}var z=n("J4mz"),B=n("rlSs"),J=n("lf6B"),V=n("b1et"),R=n("RUzw"),q=n("IP2g"),H=n("wHSu"),Z=n("tuoA");function X(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,r)}return n}function G(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?X(Object(n),!0).forEach((function(e){Object(r.a)(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):X(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}var Y={longitude:-120,latitude:34,height:600,width:800,pitch:45,maxPitch:60,bearing:0,minZoom:2,maxZoom:30,zoom:14.5},$={wordBreak:"break-word",position:"absolute",padding:12,zIndex:"10000",maxWidth:300,background:"#000",color:"#fff"},K=function(t){function e(e){var n;return(n=t.call(this,e)||this)._tilesetStatsWidget=null,n.state={url:null,token:null,name:B.b,viewState:Y,selectedMapStyle:Z.c,selectedFeatureAttributes:null,selectedFeatureIndex:-1,isAttributesLoading:!1},n._onSelectTileset=n._onSelectTileset.bind(Object(u.a)(n)),n.handleClosePanel=n.handleClosePanel.bind(Object(u.a)(n)),n}Object(s.a)(e,t);var n=e.prototype;return n.componentDidMount=function(){var t;this._memWidget=new z.a(p.a.get("Memory Usage"),{framesPerUpdate:1,formatters:{"GPU Memory":"memory","Buffer Memory":"memory","Renderbuffer Memory":"memory","Texture Memory":"memory"},container:this._statsWidgetContainer}),this._tilesetStatsWidget=new z.a(null,{container:this._statsWidgetContainer});var e=Object(R.a)();t=e?{url:e}:B.a[B.b],this._onSelectTileset(t)},n._onSelectTileset=function(){var t=Object(o.a)(i.a.mark((function t(e){var n,r,a,o,u,s;return i.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=Object(R.b)(e.url,e),r=n.tilesetUrl,a=n.token,o=n.name,u=n.metadataUrl,this.setState({tilesetUrl:r,name:o,token:a}),t.next=5,fetch(u).then((function(t){return t.json()}));case 5:s=t.sent,this.setState({metadata:s,selectedFeatureAttributes:null});case 7:case"end":return t.stop()}}),t,this)})));return function(e){return t.apply(this,arguments)}}(),n._updateStatWidgets=function(){this._memWidget.update(),this._tilesetStatsWidget.update()},n._onTilesetLoad=function(t){var e=t.zoom,n=t.cartographicCenter,r=n[0],a=n[1],i=G(G({},this.state.viewState),{},{zoom:e+2.5,longitude:r,latitude:a});this.setState({tileset:t,viewState:G(G({},i),{},{transitionDuration:4e3,transitionInterpolator:new b.a})}),this._tilesetStatsWidget.setStats(t.stats)},n._onViewStateChange=function(t){var e=t.viewState;this.setState({viewState:e})},n._onSelectMapStyle=function(t){var e=t.selectedMapStyle;this.setState({selectedMapStyle:e})},n._renderLayers=function(){var t=this,e=this.state,n=e.tilesetUrl,r=e.token,a=e.selectedFeatureIndex,i={throttleRequests:!0};return r&&(i.token=r),[new y.a({data:n,loader:v.a,onTilesetLoad:this._onTilesetLoad.bind(this),onTileLoad:function(){return t._updateStatWidgets()},onTileUnload:function(){return t._updateStatWidgets()},pickable:!0,loadOptions:i,highlightedObjectIndex:a})]},n.handleClick=function(){var t=Object(o.a)(i.a.mark((function t(e){var n,r,a;return i.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(e.object&&!(e.index<0)&&e.layer){t.next=3;break}return this.handleClosePanel(),t.abrupt("return");case 3:return n=this.state.token,r={},n&&(r.token=n),this.setState({isAttributesLoading:!0}),t.next=9,M(e.object,e.index,r);case 9:a=t.sent,this.setState({isAttributesLoading:!1}),this.setState({selectedFeatureAttributes:a,selectedFeatureIndex:e.index});case 12:case"end":return t.stop()}}),t,this)})));return function(e){return t.apply(this,arguments)}}(),n._renderStats=function(){var t=this;return c.a.createElement("div",{style:$,ref:function(e){return t._statsWidgetContainer=e}})},n._renderControlPanel=function(){var t=this.state,e=t.name,n=t.tileset,r=t.token,a=t.metadata,i=t.selectedMapStyle;return c.a.createElement(J.a,{tileset:n,name:e,metadata:a,token:r,onExampleChange:this._onSelectTileset,onMapStyleChange:this._onSelectMapStyle.bind(this),selectedMapStyle:i})},n.getTooltip=function(){if(this.state.isAttributesLoading){var t=document.createElement("div");return Object(d.render)(c.a.createElement(q.a,{icon:H.c}),t),{html:t.innerHTML}}return null},n.handleClosePanel=function(){this.setState({selectedFeatureAttributes:null,selectedFeatureIndex:-1})},n.renderAttributesPanel=function(){var t=this.state.selectedFeatureAttributes,e=t.NAME||t.OBJECTID;return c.a.createElement(V.a,{title:e,handleClosePanel:this.handleClosePanel,attributesObject:t})},n.render=function(){var t=this,e=this._renderLayers(),n=this.state,r=n.viewState,a=n.selectedMapStyle,i=n.selectedFeatureAttributes;return c.a.createElement("div",{style:{position:"relative",height:"100%"}},this._renderStats(),i?this.renderAttributesPanel():this._renderControlPanel(),c.a.createElement(h.a,{layers:e,viewState:r,onViewStateChange:this._onViewStateChange.bind(this),controller:{type:m.a,maxPitch:85},onAfterRender:function(){return t._updateStatWidgets()},getTooltip:function(e){return t.getTooltip(e)},onClick:function(e){return t.handleClick(e)}},c.a.createElement(f.a,{mapStyle:a,preventStyleDiffing:!0})))},e}(l.PureComponent);function Q(t){Object(d.render)(c.a.createElement(K,null),t)}}}]);