<!-- Forked from @jwasilgeo's https://codepen.io/jwasilgeo/pen/XWZRKoj CodePen under MIT license -->
<!doctype html>
<style>
  body {
    margin: 0;
    width: 100vw;
    height: 100vh;
    overflow: hidden;
  }
  
  .deck-tooltip {
    font-size: 0.8em;
    font-family: Helvetica, Arial, sans-serif;
  }  
</style>
<body>
</body>
<script src="https://unpkg.com/@loaders.gl/core@3.3.0-alpha.10/dist/dist.min.js"></script>
<script src="https://unpkg.com/@loaders.gl/wms@3.3.0-alpha.10/dist/dist.min.js"></script>
<script src="https://unpkg.com/deck.gl@8.8.1/dist.min.js"></script>
<script>
/*
 * https://deck.gl/docs/api-reference/geo-layers/tile-layer
 */
 const { DeckGL, TileLayer, BitmapLayer } = deck;

const layer = new TileLayer({
  id: "TileLayer",
  /* props from TileLayer class */

  // extent: null,
  // getTileData: null,
  // maxCacheByteSize: null,
  // maxCacheSize: null,
  // maxRequests: 6,
  maxZoom: 19,
  minZoom: 0,
  // onTileError: null,
  // onTileLoad: null,
  // onTileUnload: null,
  // onViewportLoad: null,
  // refinementStrategy: 'best-available',
  renderSubLayers: (props) => {
    const {
      bbox: { west, south, east, north }
    } = props.tile;

    console.log(props);

    const bounds = [west, south, east, north];
    // const {width, height} = props.data;
    const width = 256;
    const height = 256;

    const url = `https://ows.terrestris.de/osm/service?width=${width}&height=${height}&bbox=${bounds[0]},${bounds[1]},${bounds[2]},${bounds[3]}&srs=EPSG:4326&format=image%2Fpng&request=GetMap&service=WMS&styles=&transparent=TRUE&version=1.1.1&layers=OSM-WMS`;

    const subLayer = new BitmapLayer({
      id: url,
      bounds: [west, south, east, north],
      // TODO: change in the URL `srs=EPSG:4326` to `srs=EPSG:900913` once we can change the TileLayer bounds from lat/lon to web mercator coordinates
      image: url,
      opacity: 0.5
    });

    return subLayer;
  },
  // tileSize: 512,
  // zRange: null,
  // zoomOffset: 0,

  /* props inherited from Layer class */

  // autoHighlight: false,
  // coordinateOrigin: [0, 0, 0],
  // coordinateSystem: COORDINATE_SYSTEM.LNGLAT,
  // highlightColor: [0, 0, 128, 128],
  // modelMatrix: null,
  // opacity: 1,
  pickable: true
  // visible: true,
  // wrapLongitude: false,
});

new DeckGL({
  mapStyle: "https://basemaps.cartocdn.com/gl/positron-gl-style/style.json",
  initialViewState: {
    longitude: -85.75,
    latitude: 37.75,
    zoom: 6,
    maxZoom: 20,
    pitch: 0,
    bearing: 0
  },
  controller: true,
  layers: [
    layer
  ]
});
</script>
