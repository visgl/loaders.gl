(window.webpackJsonp=window.webpackJsonp||[]).push([[3],{239:function(t,e,i){"use strict";var n=i(298),r=new(i(259).a)({id:"deck"}).enable();if(n.a.deck&&"7.0.2"!==n.a.deck.VERSION)throw new Error("deck.gl - multiple versions detected: ".concat(n.a.deck.VERSION," vs ").concat("7.0.2"));n.a.deck||(r.log(0,"deck.gl ".concat("7.0.2"," - ").concat("set deck.log.priority=1 (or higher) to trace attribute updates"))(),n.a.deck=n.a.deck||{VERSION:"7.0.2",version:"7.0.2",log:r}),console.table||(console.table=function(){});var a=i(203),o={LNG_LAT:1,LNGLAT_AUTO_OFFSET:4,METER_OFFSETS:2,LNGLAT_OFFSETS:3,IDENTITY:0},s=Object.keys(o).map(function(t){return"const float COORDINATE_SYSTEM_".concat(t," = ").concat(o[t],".;")}).join(""),c="".concat(s,"\n\nuniform float project_uCoordinateSystem;\nuniform float project_uScale;\nuniform bool project_uWrapLongitude;\nuniform float project_uAntimeridian;\nuniform vec3 project_uCommonUnitsPerMeter;\nuniform vec3 project_uCommonUnitsPerWorldUnit;\nuniform vec3 project_uCommonUnitsPerWorldUnit2;\nuniform vec4 project_uCenter;\nuniform mat4 project_uModelMatrix;\nuniform mat4 project_uViewProjectionMatrix;\nuniform vec2 project_uViewportSize;\nuniform float project_uDevicePixelRatio;\nuniform float project_uFocalDistance;\nuniform vec3 project_uCameraPosition;\nuniform vec2 project_uCoordinateOrigin;\n\nconst float TILE_SIZE = 512.0;\nconst float PI = 3.1415926536;\nconst float WORLD_SCALE = TILE_SIZE / (PI * 2.0);\nconst vec2 ZERO_64_XY_LOW = vec2(0.0, 0.0);\nfloat project_size(float meters) {\n  return meters * project_uCommonUnitsPerMeter.z;\n}\n\nvec2 project_size(vec2 meters) {\n  return meters * project_uCommonUnitsPerMeter.xy;\n}\n\nvec3 project_size(vec3 meters) {\n  return meters * project_uCommonUnitsPerMeter;\n}\n\nvec4 project_size(vec4 meters) {\n  return vec4(meters.xyz * project_uCommonUnitsPerMeter, meters.w);\n}\nvec3 project_normal(vec3 vector) {\n  if (project_uCoordinateSystem == COORDINATE_SYSTEM_LNG_LAT ||\n    project_uCoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSETS ||\n    project_uCoordinateSystem == COORDINATE_SYSTEM_LNGLAT_AUTO_OFFSET) {\n    return normalize(vector * project_uCommonUnitsPerWorldUnit);\n  }\n  vec4 normal_modelspace = project_uModelMatrix * vec4(vector, 0.0);\n  return normalize(normal_modelspace.xyz * project_uCommonUnitsPerMeter);\n}\n\nvec4 project_offset_(vec4 offset) {\n  float dy = offset.y;\n  if (project_uCoordinateSystem == COORDINATE_SYSTEM_LNGLAT_AUTO_OFFSET) {\n    dy = clamp(dy, -1., 1.);\n  }\n  vec3 commonUnitsPerWorldUnit = project_uCommonUnitsPerWorldUnit + project_uCommonUnitsPerWorldUnit2 * dy;\n  return vec4(offset.xyz * commonUnitsPerWorldUnit, offset.w);\n}\nvec2 project_mercator_(vec2 lnglat) {\n  float x = lnglat.x;\n  if (project_uWrapLongitude) {\n    x = mod(x - project_uAntimeridian, 360.0) + project_uAntimeridian;\n  }\n  return vec2(\n    radians(x) + PI,\n    PI - log(tan_fp32(PI * 0.25 + radians(lnglat.y) * 0.5))\n  );\n}\nvec4 project_position(vec4 position, vec2 position64xyLow) {\n  if (project_uCoordinateSystem == COORDINATE_SYSTEM_LNG_LAT) {\n    return project_uModelMatrix * vec4(\n      project_mercator_(position.xy) * WORLD_SCALE * project_uScale,\n      project_size(position.z),\n      position.w\n    );\n  }\n\n  if (project_uCoordinateSystem == COORDINATE_SYSTEM_LNGLAT_AUTO_OFFSET) {\n    float X = position.x - project_uCoordinateOrigin.x;\n    float Y = position.y - project_uCoordinateOrigin.y;\n    return project_offset_(vec4(X + position64xyLow.x, Y + position64xyLow.y, position.z, position.w));\n  }\n\n  if (project_uCoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSETS) {\n    return project_offset_(position);\n  }\n  vec4 position_modelspace = project_uModelMatrix * position;\n  return project_offset_(position_modelspace);\n}\n\nvec4 project_position(vec4 position) {\n  return project_position(position, ZERO_64_XY_LOW);\n}\n\nvec3 project_position(vec3 position, vec2 position64xyLow) {\n  vec4 projected_position = project_position(vec4(position, 1.0), position64xyLow);\n  return projected_position.xyz;\n}\n\nvec3 project_position(vec3 position) {\n  vec4 projected_position = project_position(vec4(position, 1.0), ZERO_64_XY_LOW);\n  return projected_position.xyz;\n}\n\nvec2 project_position(vec2 position) {\n  vec4 projected_position = project_position(vec4(position, 0.0, 1.0), ZERO_64_XY_LOW);\n  return projected_position.xy;\n}\nvec4 project_common_position_to_clipspace(vec4 position) {\n  if (project_uCoordinateSystem == COORDINATE_SYSTEM_METER_OFFSETS ||\n    project_uCoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSETS) {\n    position.w *= project_uCommonUnitsPerMeter.z;\n  }\n  return project_uViewProjectionMatrix * position + project_uCenter;\n}\nvec2 project_pixel_size_to_clipspace(vec2 pixels) {\n  vec2 offset = pixels / project_uViewportSize * project_uDevicePixelRatio * 2.0;\n  return offset * project_uFocalDistance;\n}\n\nfloat project_size_to_pixel(float meters) {\n  return project_size(meters);\n}\nfloat project_pixel_size(float pixels) {\n  return pixels;\n}\nvec2 project_pixel_size(vec2 pixels) {\n  return pixels;\n}\nfloat project_scale(float meters) {\n  return project_size(meters);\n}\nvec2 project_scale(vec2 meters) {\n  return project_size(meters);\n}\nvec3 project_scale(vec3 meters) {\n  return project_size(meters);\n}\nvec4 project_scale(vec4 meters) {\n  return project_size(meters);\n}\nvec4 project_to_clipspace(vec4 position) {\n  return project_common_position_to_clipspace(position);\n}\nvec4 project_pixel_to_clipspace(vec2 pixels) {\n  return vec4(project_pixel_size_to_clipspace(pixels), 0.0, 0.0);\n}\n"),u=i(235),l=i(237),h={LNGLAT:1,LNGLAT_DEPRECATED:5,METER_OFFSETS:2,METERS:2,LNGLAT_OFFSETS:3,IDENTITY:0},p={click:{handler:"onClick"},panstart:{handler:"onDragStart"},panmove:{handler:"onDrag"},panend:{handler:"onDragEnd"}};function d(t,e){if(t===e)return!0;if(Array.isArray(t)){var i=t.length;if(!e||e.length!==i)return!1;for(var n=0;n<i;n++)if(t[n]!==e[n])return!1;return!0}return!1}function v(t){var e,i={};return function(n){for(var r in n)if(!d(n[r],i[r])){e=t(n),i=n;break}return e}}function f(t,e){if(!t)throw new Error(e||"deck.gl: assertion failed.")}var g=[0,0,0,0],y=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,0],m=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],b=[0,0,0],w=[0,0,0],_=12,k=v(function(t){var e=t.viewport,i=t.devicePixelRatio,n=t.coordinateSystem,r=t.coordinateOrigin,a=t.wrapLongitude,s=e.zoom,c=function(t){var e,i=t.viewport,n=t.coordinateSystem,r=t.coordinateOrigin,a=t.coordinateZoom,s=i.viewMatrixUncentered,c=i.viewMatrix,p=i.projectionMatrix,d=i.viewProjectionMatrix,v=i.cameraPosition,f=function(t){switch(t){case h.LNGLAT:case h.LNGLAT_EXPERIMENTAL:default:return o.LNGLAT_AUTO_OFFSET;case h.LNGLAT_DEPRECATED:return o.LNG_LAT;case h.METER_OFFSETS:case h.METERS:return o.METER_OFFSETS;case h.LNGLAT_OFFSETS:return o.LNGLAT_OFFSETS;case h.IDENTITY:return o.IDENTITY}}(n),m=r;if(f===o.LNGLAT_AUTO_OFFSET)if(a<_)f=o.LNG_LAT;else{var b=Math.fround(i.longitude),w=Math.fround(i.latitude);m=[b,w]}switch(f){case o.IDENTITY:case o.LNG_LAT:e=g;break;case o.LNGLAT_OFFSETS:case o.METER_OFFSETS:case o.LNGLAT_AUTO_OFFSET:var k=i.projectFlat(m,Math.pow(2,a));v=[v[0]-k[0],v[1]-k[1],v[2]],e=l.o([],[k[0],k[1],0,1],d),c=s||c,d=u.g([],p,c),d=u.g([],d,y);break;default:throw new Error("Unknown projection mode")}return{viewMatrix:c,viewProjectionMatrix:d,projectionCenter:e,cameraPos:v,shaderCoordinateSystem:f,shaderCoordinateOrigin:m}}({coordinateSystem:n,coordinateOrigin:r,coordinateZoom:s,viewport:e}),p=c.projectionCenter,d=c.viewProjectionMatrix,v=c.cameraPos,m=c.shaderCoordinateSystem,w=c.shaderCoordinateOrigin;f(d,"Viewport missing modelViewProjectionMatrix");var k=e.getDistanceScales(),j=[e.width*i,e.height*i],P={project_uCoordinateSystem:m,project_uCenter:p,project_uWrapLongitude:a,project_uAntimeridian:(e.longitude||0)-180,project_uViewportSize:j,project_uDevicePixelRatio:i,project_uFocalDistance:e.focalDistance||1,project_uCommonUnitsPerMeter:k.pixelsPerMeter,project_uCommonUnitsPerWorldUnit:k.pixelsPerMeter,project_uCommonUnitsPerWorldUnit2:b,project_uScale:e.scale,project_uViewProjectionMatrix:d,project_uCameraPosition:v},O=e.getDistanceScales(w);switch(m){case o.METER_OFFSETS:P.project_uCommonUnitsPerWorldUnit=O.pixelsPerMeter,P.project_uCommonUnitsPerWorldUnit2=O.pixelsPerMeter2;break;case o.LNGLAT_AUTO_OFFSET:P.project_uCoordinateOrigin=w;case o.LNG_LAT:case o.LNGLAT_OFFSETS:P.project_uCommonUnitsPerWorldUnit=O.pixelsPerDegree,P.project_uCommonUnitsPerWorldUnit2=O.pixelsPerDegree2}return P});function j(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=t.viewport,i=t.devicePixelRatio,n=void 0===i?1:i,a=t.modelMatrix,o=void 0===a?null:a,s=t.coordinateSystem,c=void 0===s?h.LNGLAT:s,u=t.coordinateOrigin,l=void 0===u?w:u,p=t.wrapLongitude,d=void 0!==p&&p,v=t.projectionMode,g=t.positionOrigin;return f(e),void 0!==v&&r.removed("projectionMode","coordinateSystem")(),void 0!==g&&r.removed("positionOrigin","coordinateOrigin")(),Object.assign({project_uModelMatrix:o||m},k({viewport:e,devicePixelRatio:n,coordinateSystem:c,coordinateOrigin:l,wrapLongitude:d}))}var P={};var O={name:"project",dependencies:[a.u],vs:c,getUniforms:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:P;return t.viewport?j(t):{}},deprecations:[{type:"function",old:"project_scale",new:"project_size"},{type:"function",old:"project_to_clipspace",new:"project_common_position_to_clipspace"},{type:"function",old:"project_pixel_to_clipspace",new:"project_pixel_size_to_clipspace"}]},S={name:"project32",dependencies:[O],vs:"\nvec4 project_position_to_clipspace(\n  vec3 position, vec2 position64xyLow, vec3 offset, out vec4 commonPosition\n) {\n  vec3 projectedPosition = project_position(position, position64xyLow);\n  commonPosition = vec4(projectedPosition + offset, 1.0);\n  return project_common_position_to_clipspace(commonPosition);\n}\n\nvec4 project_position_to_clipspace(\n  vec3 position, vec2 position64xyLow, vec3 offset\n) {\n  vec4 commonPosition;\n  return project_position_to_clipspace(position, position64xyLow, offset, commonPosition);\n}\n"},x=a.v.fp64ify,M=a.v.fp64ifyMatrix4,E={name:"project64",dependencies:[O,a.v],vs:"\nconst vec2 WORLD_SCALE_FP64 = vec2(81.4873275756836, 0.0000032873668232014097);\n\nuniform vec2 project64_uScale;\nuniform vec2 project_uViewProjectionMatrixFP64[16];\nvoid mercatorProject_fp64(vec4 lnglat_fp64, out vec2 out_val[2]) {\n\n#if defined(NVIDIA_FP64_WORKAROUND)\n  out_val[0] = sum_fp64(radians_fp64(lnglat_fp64.xy), PI_FP64 * ONE);\n#else\n  out_val[0] = sum_fp64(radians_fp64(lnglat_fp64.xy), PI_FP64);\n#endif\n  out_val[1] = sub_fp64(PI_FP64,\n    log_fp64(tan_fp64(sum_fp64(PI_4_FP64, radians_fp64(lnglat_fp64.zw) / 2.0))));\n  return;\n}\n\nvoid project_position_fp64(vec4 position_fp64, out vec2 out_val[2]) {\n  vec2 pos_fp64[2];\n  mercatorProject_fp64(position_fp64, pos_fp64);\n  vec2 x_fp64 = mul_fp64(pos_fp64[0], project64_uScale);\n  vec2 y_fp64 = mul_fp64(pos_fp64[1], project64_uScale);\n  out_val[0] = mul_fp64(x_fp64, WORLD_SCALE_FP64);\n  out_val[1] = mul_fp64(y_fp64, WORLD_SCALE_FP64);\n\n  return;\n}\n\nvoid project_position_fp64(vec2 position, vec2 position64xyLow, out vec2 out_val[2]) {\n  vec4 position64xy = vec4(\n    position.x, position64xyLow.x,\n    position.y, position64xyLow.y);\n\n  project_position_fp64(position64xy, out_val);\n}\n\nvec4 project_common_position_to_clipspace_fp64(vec2 vertex_pos_modelspace[4]) {\n  vec2 vertex_pos_clipspace[4];\n  mat4_vec4_mul_fp64(project_uViewProjectionMatrixFP64, vertex_pos_modelspace,\n    vertex_pos_clipspace);\n  return vec4(\n    vertex_pos_clipspace[0].x,\n    vertex_pos_clipspace[1].x,\n    vertex_pos_clipspace[2].x,\n    vertex_pos_clipspace[3].x\n    );\n}\n\nvec4 project_position_to_clipspace(\n  vec3 position, vec2 position64xyLow, vec3 offset, out vec4 commonPosition\n) {\n  vec2 offset64[4];\n  vec4_fp64(vec4(offset, 0.0), offset64);\n\n  float z = project_size(position.z);\n  vec2 projectedPosition64xy[2];\n  project_position_fp64(position.xy, position64xyLow, projectedPosition64xy);\n\n  vec2 commonPosition64[4];\n  commonPosition64[0] = sum_fp64(offset64[0], projectedPosition64xy[0]);\n  commonPosition64[1] = sum_fp64(offset64[1], projectedPosition64xy[1]);\n  commonPosition64[2] = sum_fp64(offset64[2], vec2(z, 0.0));\n  commonPosition64[3] = vec2(1.0, 0.0);\n\n  commonPosition = vec4(projectedPosition64xy[0].x, projectedPosition64xy[1].x, z, 1.0);\n\n  return project_common_position_to_clipspace_fp64(commonPosition64);\n}\n\nvec4 project_position_to_clipspace(\n  vec3 position, vec2 position64xyLow, vec3 offset\n) {\n  vec4 commonPosition;\n  return project_position_to_clipspace(\n    position, position64xyLow, offset, commonPosition\n  );\n}\nvec4 project_to_clipspace_fp64(vec2 vertex_pos_modelspace[4]) {\n  return project_common_position_to_clipspace_fp64(vertex_pos_modelspace);\n}\n",getUniforms:function(){arguments.length>0&&void 0!==arguments[0]&&arguments[0];var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},e=t.project_uViewProjectionMatrix,i=t.project_uScale;if(e&&i)return T({project_uViewProjectionMatrix:e,project_uScale:i});return{}},deprecations:[{type:"function",old:"project_to_clipspace_fp64",new:"project_common_position_to_clipspace_fp64"}]},T=v(function(t){var e=t.project_uViewProjectionMatrix,i=t.project_uScale,n=M(e),r=x(i);return{project_uViewProjectionMatrixFP64:n,project64_uViewProjectionMatrix:n,project64_uScale:r}});Object(a.G)([a.u,a.v,O,S,E,a.w,a.D,a.E]),Object(a.H)([O]);var C=i(198),L=i(199),A=i(201),I=i(200),R=i(202),F=function(t){function e(){return Object(C.a)(this,e),Object(A.a)(this,Object(I.a)(e).apply(this,arguments))}return Object(R.a)(e,t),Object(L.a)(e,[{key:"getProjectedLight",value:function(){return this}}]),e}(a.d),z=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};Object(C.a)(this,t);var i=e.id,n=void 0===i?"effect":i;this.id=n,this.props={},Object.assign(this.props,e)}return Object(L.a)(t,[{key:"prepare",value:function(){}},{key:"getParameters",value:function(){}}]),t}(),D={color:[255,255,255],intensity:1},N=[{color:[255,255,255],intensity:1,direction:[-1,-3,-1]},{color:[255,255,255],intensity:.9,direction:[1,8,-2.5]}],V=function(t){function e(t){var i;for(var n in Object(C.a)(this,e),(i=Object(A.a)(this,Object(I.a)(e).call(this,t))).ambientLight=null,i.directionalLights=[],i.pointLights=[],t){var r=t[n];switch(r.type){case"ambient":i.ambientLight=r;break;case"directional":i.directionalLights.push(r);break;case"point":i.pointLights.push(r)}}return i.applyDefaultLights(),i}return Object(R.a)(e,t),Object(L.a)(e,[{key:"getParameters",value:function(t){var e=this.ambientLight,i=this.getProjectedPointLights(t);return{lightSources:{ambientLight:e,directionalLights:this.getProjectedDirectionalLights(t),pointLights:i}}}},{key:"applyDefaultLights",value:function(){var t=this.ambientLight,e=this.pointLights,i=this.directionalLights;t||0!==e.length||0!==i.length||(this.ambientLight=new a.a(D),this.directionalLights.push(new F(N[0])),this.directionalLights.push(new F(N[1])))}},{key:"getProjectedPointLights",value:function(t){for(var e=[],i=0;i<this.pointLights.length;i++){var n=this.pointLights[i];e.push(n.getProjectedLight({layer:t}))}return e}},{key:"getProjectedDirectionalLights",value:function(t){for(var e=[],i=0;i<this.directionalLights.length;i++){var n=this.directionalLights[i];e.push(n.getProjectedLight({layer:t}))}return e}}]),e}(z),U=i(206),B=i(233);function Z(t,e){var i=l.o([],e,t);return l.l(i,i,1/i[3]),i}function G(t,e){var i=t%e;return i<0?e+i:i}var X=i(236);function W(t,e){if(!t)throw new Error(e||"viewport-mercator-project: assertion failed.")}var Y=Math.PI,q=Y/4,H=Y/180,K=180/Y,J=512,Q=4003e4,$=1.5;function tt(t){return Math.pow(2,t)}function et(t){return Math.log2(t)}function it(t,e){var i=Object(U.a)(t,2),n=i[0],r=i[1];W(Number.isFinite(n)&&Number.isFinite(e)),W(Number.isFinite(r)&&r>=-90&&r<=90,"invalid latitude");var a=r*H;return[(e*=J)*(n*H+Y)/(2*Y),e*(Y-Math.log(Math.tan(q+.5*a)))/(2*Y)]}function nt(t,e){var i=Object(U.a)(t,2),n=i[0],r=i[1],a=n/(e*=J)*(2*Y)-Y,o=2*(Math.atan(Math.exp(Y-r/e*(2*Y)))-q);return[a*K,o*K]}function rt(t){var e=t.latitude,i=t.longitude,n=t.zoom,r=t.scale,a=t.highPrecision,o=void 0!==a&&a;r=void 0!==r?r:tt(n),W(Number.isFinite(e)&&Number.isFinite(i)&&Number.isFinite(r));var s={},c=J*r,u=Math.cos(e*H),l=c/360,h=l/u,p=c/Q/u;if(s.pixelsPerMeter=[p,-p,p],s.metersPerPixel=[1/p,-1/p,1/p],s.pixelsPerDegree=[l,-h,p],s.degreesPerPixel=[1/l,-1/h,1/p],o){var d=H*Math.tan(e*H)/u,v=l*d/2,f=c/Q*d,g=f/h*p;s.pixelsPerDegree2=[0,-v,f],s.pixelsPerMeter2=[g,0,g]}return s}function at(t,e){var i=Object(U.a)(t,3),n=i[0],r=i[1],a=i[2],o=Object(U.a)(e,3),s=o[0],c=o[1],u=o[2],l=rt({longitude:n,latitude:r,scale:1,highPrecision:!0}),h=l.pixelsPerMeter,p=l.pixelsPerMeter2,d=it(t,1);d[0]+=s*(h[0]+p[0]*c),d[1]+=c*(h[1]+p[1]*c);var v=nt(d,1),f=(a||0)+(u||0);return Number.isFinite(a)||Number.isFinite(u)?[v[0],v[1],f]:v}function ot(t){var e=t.height,i=t.pitch,n=t.bearing,r=t.altitude,a=t.center,o=void 0===a?null:a,s=t.flipY,c=void 0!==s&&s,l=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1];return u.o(l,l,[0,0,-r]),u.n(l,l,[1,1,1/e]),u.k(l,l,-i*H),u.m(l,l,n*H),c&&u.n(l,l,[1,-1,1]),o&&u.o(l,l,B.h([],o)),l}function st(t){var e=t.width,i=t.height,n=t.altitude,r=void 0===n?$:n,a=t.pitch,o=void 0===a?0:a,s=t.nearZMultiplier,c=void 0===s?1:s,u=t.farZMultiplier,l=void 0===u?1:u,h=o*H,p=Math.atan(.5/r),d=Math.sin(p)*r/Math.sin(Math.PI/2-h-p),v=Math.cos(Math.PI/2-h)*d+r;return{fov:2*Math.atan(i/2/r),aspect:e/i,focalDistance:r,near:c,far:v*l}}function ct(t,e){var i=Object(U.a)(t,3),n=i[0],r=i[1],a=i[2],o=void 0===a?0:a;return W(Number.isFinite(n)&&Number.isFinite(r)&&Number.isFinite(o)),Z(e,[n,r,o,1])}function ut(t,e){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,n=Object(U.a)(t,3),r=n[0],a=n[1],o=n[2];if(W(Number.isFinite(r)&&Number.isFinite(a),"invalid pixel coordinate"),Number.isFinite(o))return Z(e,[r,a,o,1]);var s=Z(e,[r,a,0,1]),c=Z(e,[r,a,1,1]),u=s[2],l=c[2],h=u===l?0:((i||0)-u)/(l-u);return X.d([],s,c,h)}function lt(t,e){var i=arguments.length>2&&void 0!==arguments[2]&&arguments[2],n=Object(U.a)(t,3),r=n[0],a=n[1],o=n[2],s=void 0===o?0:o,c=e.projectFlat(t),u=Object(U.a)(c,2);return[u[0],u[1],s*(i?rt({longitude:r,latitude:a,scale:e.scale}):e.getDistanceScales()).pixelsPerMeter[2]]}function ht(t,e){var i=e.viewport,n=e.modelMatrix,r=e.coordinateSystem,a=e.coordinateOrigin,o=e.offsetMode,s=Object(U.a)(t,3),c=s[0],u=s[1],p=s[2];if(n){var d=l.o([],[c,u,p,1],n),v=Object(U.a)(d,3);c=v[0],u=v[1],p=v[2]}switch(r){case h.LNGLAT:case h.LNGLAT_DEPRECATED:return lt([c,u,p],i,o);case h.LNGLAT_OFFSETS:return lt([c+a[0],u+a[1],p+(a[2]||0)],i,o);case h.METER_OFFSETS:return lt(at(a,[c,u,p]),i,o);case h.IDENTITY:default:return i.projectPosition([c,u,p])}}function pt(t,e){var i=function(t){var e=Object.assign({},t),i=t.viewport,n=t.coordinateSystem,r=t.coordinateOrigin,a=t.fromCoordinateSystem,o=t.fromCoordinateOrigin;return void 0===a&&(e.fromCoordinateSystem=n),void 0===o&&(e.fromCoordinateOrigin=r),n===h.LNGLAT&&i.zoom>=_&&(e.coordinateSystem=h.LNGLAT_OFFSETS,e.coordinateOrigin=[Math.fround(i.longitude),Math.fround(i.latitude)]),e}(e),n=i.viewport,r=i.coordinateSystem,a=i.coordinateOrigin,o=i.modelMatrix,s=i.fromCoordinateSystem,c=i.fromCoordinateOrigin;switch(r){case h.LNGLAT_OFFSETS:case h.METER_OFFSETS:var u=ht(t,{viewport:n,modelMatrix:o,coordinateSystem:s,coordinateOrigin:c,offsetMode:!0}),l=lt(a,n,!0);return B.m(u,u,l),u;case h.LNGLAT:case h.LNGLAT_DEPRECATED:case h.IDENTITY:default:return ht(t,{viewport:n,modelMatrix:o,coordinateSystem:s,coordinateOrigin:c,offsetMode:!1})}}var dt=[],vt=[];function ft(t){var e=dt,i={index:-1,data:t,target:[]};return t?"function"==typeof t[Symbol.iterator]?e=t:t.length>0&&(vt.length=t.length,e=vt):e=dt,{iterable:e,objectInfo:i}}var gt=i(211),yt=function(){function t(e){var i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};Object(C.a)(this,t);var n=i.id,r=void 0===n?Object(a.L)("attribute"):n,o=i.type,s=i.isIndexed,c=void 0!==s&&s;this.gl=e,this.id=r,this.isIndexed=c,this.target=c?34963:34962,this.type=o,c&&!o&&(this.type=e&&Object(a.x)(e,a.e.ELEMENT_INDEX_UINT32)?5125:5123),this.value=null,this.externalBuffer=null,this.buffer=null,this.userData={},this.update(i),Object.seal(this),this._validateAttributeDefinition()}return Object(L.a)(t,[{key:"delete",value:function(){this.buffer&&(this.buffer.delete(),this.buffer=null)}},{key:"update",value:function(t){var e=t.value,i=t.buffer,n=t.constant,r=void 0===n?this.constant||!1:n;if(this.constant=r,i)this.externalBuffer=i,this.constant=!1,this.type=t.type||i.accessor.type,void 0!==i.accessor.divisor&&(this.divisor=i.accessor.divisor),void 0!==t.divisor&&(this.divisor=t.divisor);else if(e&&(this.externalBuffer=null,this.value=e,!r&&this.gl)){var o=Object(gt.a)({},t,{id:this.id,target:this.target,accessor:{type:this.type}});Number.isFinite(o.divisor)&&(o.accessor.divisor=o.divisor),delete o.divisor,Number.isFinite(o.size)&&(o.accessor.size=o.size),delete o.size,this.buffer=this.buffer||new a.c(this.gl,o),this.buffer.setData({data:e}),this.type=this.buffer.accessor.type}this._setAccessor(t)}},{key:"getBuffer",value:function(){return this.constant?null:this.externalBuffer||this.buffer}},{key:"getValue",value:function(){if(this.constant)return this.value;var t=this.externalBuffer||this.buffer;return t?[t,this]:null}},{key:"_setAccessor",value:function(t){var e=t.size,i=void 0===e?this.size:e,n=t.offset,r=void 0===n?this.offset||0:n,o=t.stride,s=void 0===o?this.stride||0:o,c=t.normalized,u=void 0===c?this.normalized||!1:c,l=t.integer,h=void 0===l?this.integer||!1:l,p=t.divisor,d=void 0===p?this.divisor||0:p,v=t.instanced,f=t.isInstanced;this.size=i,this.offset=r,this.stride=s,this.normalized=u,this.integer=h,this.divisor=d,void 0!==f&&(a.A.deprecated("Attribute.isInstanced")(),this.divisor=f?1:0),void 0!==v&&(a.A.deprecated("Attribute.instanced")(),this.divisor=v?1:0)}},{key:"_validateAttributeDefinition",value:function(){}}]),t}(),mt={isExternalBuffer:!1,needsUpdate:!0,needsRedraw:!1,allocedInstances:-1},bt=function(t){function e(t){var i,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};Object(C.a)(this,e),i=Object(A.a)(this,Object(I.a)(e).call(this,t,n));var r=n.transition,a=void 0!==r&&r,o=n.noAlloc,s=void 0!==o&&o,c=n.update,u=void 0===c?null:c,l=n.accessor,h=void 0===l?null:l,p=n.bufferLayout,d=void 0===p?null:p,v=n.defaultValue,f=void 0===v?[0,0,0,0]:v;return f=Array.isArray(f)?f:[f],Object.assign(i.userData,mt,n,{transition:a,noAlloc:s,update:u,accessor:h,defaultValue:f,bufferLayout:d}),Object.seal(i.userData),i._validateAttributeUpdaters(),i}return Object(R.a)(e,t),Object(L.a)(e,[{key:"needsUpdate",value:function(){return this.userData.needsUpdate}},{key:"needsRedraw",value:function(){var t=(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{}).clearChangedFlags,e=void 0!==t&&t,i=this.userData.needsRedraw;return this.userData.needsRedraw=this.userData.needsRedraw&&!e,i}},{key:"getInstanceCount",value:function(){return null!==this.value?this.value.length/this.size:0}},{key:"getUpdateTriggers",value:function(){var t=this.userData.accessor;return[this.id].concat(t||[])}},{key:"getAccessor",value:function(){return this.userData.accessor}},{key:"supportsTransition",value:function(){return this.userData.transition}},{key:"getTransitionSetting",value:function(t){var e=this.userData,i=e.transition,n=e.accessor;if(!i)return null;var r=Array.isArray(n)?t[n.find(function(e){return t[e]})]:t[n];return Number.isFinite(r)&&(r={duration:r}),r&&r.duration>0?Object.assign({},i,r):null}},{key:"setNeedsUpdate",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.id;this.userData.needsUpdate=this.userData.needsUpdate||t}},{key:"setNeedsRedraw",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.id;this.userData.needsRedraw=this.userData.needsRedraw||t}},{key:"allocate",value:function(t){var e=this.userData;if(e.isExternalBuffer||e.noAlloc)return!1;var i=this.getInstanceCount();if((0===i||i<t)&&(e.update||e.accessor)){f(Number.isFinite(t));var n=Math.max(t,1),r=wt(this.type||5126);return this.constant=!1,this.value=new r(this.size*n),e.needsUpdate=!0,e.allocedInstances=n,!0}return!1}},{key:"updateBuffer",value:function(t){var e=t.numInstances,i=t.data,n=t.props,r=t.context;if(!this.needsUpdate())return!1;var a=this.userData,o=a.update,s=a.accessor,c=!0;return o?(o.call(r,this,{data:i,props:n,numInstances:e}),this.update({value:this.value,constant:this.constant}),this._checkAttributeArray()):s?(this._updateBufferViaStandardAccessor(i,n),this._checkAttributeArray()):c=!1,a.needsUpdate=!1,a.needsRedraw=!0,c}},{key:"setGenericValue",value:function(t){var e=this.userData;if(void 0===t||"function"==typeof t)return e.isExternalBuffer=!1,!1;t=this._normalizeValue(t);var i=!this.constant||!this._areValuesEqual(t,this.value);return i&&this.update({constant:!0,value:t}),e.needsRedraw=e.needsUpdate||i,e.needsUpdate=!1,e.isExternalBuffer=!0,!0}},{key:"setExternalBuffer",value:function(t,e){var i=this.userData;if(t){if(i.isExternalBuffer=!0,i.needsUpdate=!1,t instanceof a.c)this.externalBuffer!==t&&(this.update({constant:!1,buffer:t}),i.needsRedraw=!0);else if(this.value!==t){if(!ArrayBuffer.isView(t))throw new Error("Attribute prop must be typed array");if(i.auto&&t.length<=e*this.size)throw new Error("Attribute prop array must match length and size");var n=wt(this.type||5126);t instanceof n?this.update({constant:!1,value:t}):(r.warn("Attribute prop ".concat(this.id," is casted to ").concat(n.name))(),this.update({constant:!1,value:new n(t)})),this.value=t,i.needsRedraw=!0}return!0}return i.isExternalBuffer=!1,!1}},{key:"_normalizeValue",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,n=this.userData.defaultValue;if(!Array.isArray(t)&&!ArrayBuffer.isView(t))return e[i]=Number.isFinite(t)?t:n[0],e;switch(this.size){case 4:e[i+3]=Number.isFinite(t[3])?t[3]:n[3];case 3:e[i+2]=Number.isFinite(t[2])?t[2]:n[2];case 2:e[i+1]=Number.isFinite(t[1])?t[1]:n[1];case 1:e[i+0]=Number.isFinite(t[0])?t[0]:n[0]}return e}},{key:"_areValuesEqual",value:function(t,e){for(var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this.size,n=0;n<i;n++)if(t[n]!==e[n])return!1;return!0}},{key:"_updateBufferViaStandardAccessor",value:function(t,e){var i=this.userData.accessor,n=this.value,r=this.size,a=e[i];f("function"==typeof a,'accessor "'.concat(i,'" is not a function'));var o=0,s=ft(t),c=s.iterable,u=s.objectInfo,l=!0,h=!1,p=void 0;try{for(var d,v=c[Symbol.iterator]();!(l=(d=v.next()).done);l=!0){var g=d.value;u.index++;var y=a(g,u);this._normalizeValue(y,n,o),o+=r}}catch(m){h=!0,p=m}finally{try{l||null==v.return||v.return()}finally{if(h)throw p}}this.update({value:n})}},{key:"_validateAttributeUpdaters",value:function(){var t=this.userData;if(!(t.noAlloc||"function"==typeof t.update||"string"==typeof t.accessor))throw new Error("Attribute ".concat(this.id," missing update or accessor"))}},{key:"_checkAttributeArray",value:function(){var t=this.value;if(t&&t.length>=4&&!(Number.isFinite(t[0])&&Number.isFinite(t[1])&&Number.isFinite(t[2])&&Number.isFinite(t[3])))throw new Error("Illegal attribute generated for ".concat(this.id))}},{key:"bufferLayout",get:function(){return this.userData.bufferLayout},set:function(t){this.userData.bufferLayout=t}}]),e}(yt);function wt(t){var e=(arguments.length>1&&void 0!==arguments[1]?arguments[1]:{}).clamped,i=void 0===e||e;switch(t){case 5126:return Float32Array;case 5123:case 33635:case 32819:case 32820:return Uint16Array;case 5125:return Uint32Array;case 5121:return i?Uint8ClampedArray:Uint8Array;case 5120:return Int8Array;case 5122:return Int16Array;case 5124:return Int32Array;default:throw new Error("Failed to deduce type from array")}}function _t(t){var e=t.source,i=t.target,n=t.start,r=void 0===n?0:n,a=t.end,o=t.getData;a=a||i.length;var s=e.length,c=a-r;if(s>c)i.set(e.subarray(0,c),r);else if(i.set(e,r),o)for(var u=s;u<c;)for(var l=o(u,e),h=0;h<l.length;h++)i[r+u]=l[h],u++}var kt={1:"float",2:"vec2",3:"vec3",4:"vec4"};function jt(t){var e={},i={};for(var n in t){var r=t[n],o=r.fromState,s=r.toState,c=r.buffer;e["".concat(n,"From")]=o instanceof a.c?[o,{divisor:0}]:o,e["".concat(n,"To")]=s,i["".concat(n)]=c}return{sourceBuffers:e,feedbackBuffers:i}}function Pt(t){var e=t.fromState,i=t.toState,n=t.fromLength,r=t.toLength,o=t.fromBufferLayout,s=t.toBufferLayout,c=t.getData,u=void 0===c?function(t){return t}:c;if((o&&s||!(n>=r))&&e instanceof a.c){var l=new Float32Array(r),h=e.getData({}),p=i.size,d=i.constant,v=d?i.getValue():i.getBuffer().getData({}),f=d?function(t,e){return u(v,e)}:function(t,e){return u(v.subarray(t,t+p),e)};!function(t){var e=t.source,i=t.target,n=t.size,r=t.getData,a=t.sourceLayout,o=t.targetLayout;if(!Array.isArray(o))return _t({source:e,target:i,getData:r}),i;for(var s=0,c=0,u=r&&function(t,e){return r(t+c,e)},l=Math.min(a.length,o.length),h=0;h<l;h++){var p=a[h]*n,d=o[h]*n;_t({source:e.subarray(s,s+p),target:i,start:c,end:c+d,getData:u}),s+=p,c+=d}c<i.length&&_t({source:[],target:i,start:c,getData:u})}({source:h,target:l,sourceLayout:o,targetLayout:s,size:i.size,getData:f}),e.setData({data:l})}}var Ot={NONE:"none",PENDING:"pending",IN_PROGRESS:"in_progress",ENDED:"ended"};function St(){}var xt=function(){function t(e){Object(C.a)(this,t),this._startTime=null,this._state=Ot.NONE,this.duration=1,this.easing=function(t){return t},this.onStart=St,this.onUpdate=St,this.onInterrupt=St,this.onEnd=St,Object.assign(this,e)}return Object(L.a)(t,[{key:"start",value:function(t){this.inProgress&&this.onInterrupt(this),Object.assign(this,t),this._setState(Ot.PENDING)}},{key:"cancel",value:function(){this.inProgress&&(this.onInterrupt(this),this._setState(Ot.NONE))}},{key:"update",value:function(t){if(this.state===Ot.PENDING&&(this._startTime=t,this._setState(Ot.IN_PROGRESS)),this.state===Ot.IN_PROGRESS){var e=!1,i=(t-this._startTime)/this.duration;return i>=1&&(i=1,e=!0),this.time=this.easing(i),this.onUpdate(this),e&&this._setState(Ot.ENDED),!0}return!1}},{key:"_setState",value:function(t){if(this._state!==t)switch(this._state=t,t){case Ot.PENDING:this.onStart(this);break;case Ot.ENDED:this.onEnd(this)}}},{key:"state",get:function(){return this._state}},{key:"inProgress",get:function(){return this._state===Ot.PENDING||this._state===Ot.IN_PROGRESS}}]),t}(),Mt=function(){},Et={duration:0,easing:function(t){return t},onStart:Mt,onEnd:Mt,onInterrupt:Mt},Tt=function(){function t(e,i){var n=i.id;Object(C.a)(this,t),this.id=n,this.gl=e,this.attributeTransitions={},this.needsRedraw=!1,this.transform=null,this.numInstances=0,a.o.isSupported(e)?this.isSupported=!0:e&&r.warn("WebGL2 not supported by this browser. Transition animation is disabled.")()}return Object(L.a)(t,[{key:"finalize",value:function(){for(var t in this.transform&&this.transform.delete(),this.attributeTransitions)this._removeTransition(t)}},{key:"update",value:function(t){var e=t.attributes,i=t.transitions,n=void 0===i?{}:i,r=t.numInstances;if(this.opts=n,this.numInstances=r||1,this.isSupported){var a=this.attributeTransitions,o={};for(var s in e){this._updateAttribute(s,e[s])&&(o[s]=a[s])}for(var c in a){var u=e[c];u&&u.supportsTransition()||this._removeTransition(c)}if(this.transform){if(this.transform){var l=jt(o),h=l.sourceBuffers,p=l.feedbackBuffers;this.transform.update({elementCount:this.numInstances,sourceBuffers:h,feedbackBuffers:p})}}else this._createModel()}}},{key:"hasAttribute",value:function(t){return t in this.attributeTransitions}},{key:"getAttributes",value:function(){var t={};for(var e in this.attributeTransitions){var i=this.attributeTransitions[e];i.buffer&&(t[e]=i.attributeInTransition)}return t}},{key:"setCurrentTime",value:function(t){if(!this.transform||0===this.numInstances)return!1;var e={},i=this.needsRedraw;for(var n in this.needsRedraw=!1,this.attributeTransitions){var r=this.attributeTransitions[n];r.update(t)&&(e["".concat(n,"Time")]=r.time,i=!0)}return i&&this.transform.run({uniforms:e}),i}},{key:"_createTransition",value:function(t,e){var i=this.attributeTransitions[t];return i?null:(i=new xt({name:t,attribute:e,attributeInTransition:new bt(this.gl,e),bufferLayout:e.bufferLayout}),this.attributeTransitions[t]=i,this._invalidateModel(),i)}},{key:"_removeTransition",value:function(t){var e=this.attributeTransitions[t];e&&(e.buffer&&e.buffer.delete(),e._swapBuffer&&e._swapBuffer.delete(),delete this.attributeTransitions[t],this._invalidateModel())}},{key:"_updateAttribute",value:function(t,e){var i=e.getTransitionSetting(this.opts);if(i){var n,r=this.attributeTransitions[t];if(r?n=e.needsRedraw():(r=this._createTransition(t,e),n=!0),n)return this._triggerTransition(r,i),!0}return!1}},{key:"_invalidateModel",value:function(){this.transform&&(this.transform.delete(),this.transform=null)}},{key:"_createModel",value:function(){0!==Object.keys(this.attributeTransitions).length&&(this.transform=new a.o(this.gl,Object.assign({elementCount:this.numInstances},jt(this.attributeTransitions),function(t){var e=[],i=[],n=[],r=[],a=[];for(var o in t){var s=t[o],c=kt[s.attribute.size];c&&(s.bufferIndex=e.length,e.push(o),i.push("attribute ".concat(c," ").concat(o,"From;")),i.push("attribute ".concat(c," ").concat(o,"To;")),n.push("uniform float ".concat(o,"Time;")),r.push("varying ".concat(c," ").concat(o,";")),a.push("".concat(o," = mix(").concat(o,"From, ").concat(o,"To,\n        ").concat(o,"Time);")))}return{vs:"\n#define SHADER_NAME feedback-vertex-shader\n".concat(i.join("\n"),"\n").concat(n.join("\n"),"\n").concat(r.join("\n"),"\n\nvoid main(void) {\n  ").concat(a.join("\n"),"\n  gl_Position = vec4(0.0);\n}\n"),fs:"#define SHADER_NAME feedback-fragment-shader\n\nprecision highp float;\n\n".concat(r.join("\n"),"\n\nvoid main(void) {\n  gl_FragColor = vec4(0.0);\n}\n"),varyings:e}}(this.attributeTransitions))))}},{key:"_getNextTransitionStates",value:function(t,e){var i,n=t.attribute,r=n.size;i=n.constant?new yt(this.gl,{constant:!0,value:n.value,size:r}):new yt(this.gl,{constant:!1,buffer:n.getBuffer(),divisor:0,size:r,value:n.externalBuffer?null:n.value});var o=t.buffer||i,s=this.numInstances*r,c=o instanceof a.c&&o.getElementCount()||s,u=t._swapBuffer;return t._swapBuffer=t.buffer,u?u.getElementCount()<s&&u.setData({data:new Float32Array(s)}):u=new a.c(this.gl,{data:new Float32Array(s),usage:35050}),t.attributeInTransition.update({buffer:u}),Pt({fromState:o,toState:i,fromLength:c,toLength:s,fromBufferLayout:t.bufferLayout,toBufferLayout:n.bufferLayout,getData:e.enter}),t.bufferLayout=n.bufferLayout,{fromState:o,toState:i,buffer:u}}},{key:"_triggerTransition",value:function(t,e){f(e&&e.duration>0),this.needsRedraw=!0;var i=Object.assign({},Et,e);t.start(Object.assign({},this._getNextTransitionStates(t,e),i))}}]),t}();function Ct(){}var Lt={savedMessages:null,timeStart:null,onLog:function(t){var e=t.level,i=t.message;r.log(e,i)()},onUpdateStart:function(t){t.level,t.numInstances;Lt.savedMessages=[],Lt.timeStart=new Date},onUpdate:function(t){t.level;var e=t.message;Lt.savedMessages&&Lt.savedMessages.push(e)},onUpdateEnd:function(t){var e=t.level,i=t.id,n=t.numInstances,a=Math.round(new Date-Lt.timeStart),o="".concat(a,"ms");r.group(e,"Updated attributes for ".concat(n," instances in ").concat(i," in ").concat(o),{collapsed:!0})();var s=!0,c=!1,u=void 0;try{for(var l,h=Lt.savedMessages[Symbol.iterator]();!(s=(l=h.next()).done);s=!0){var p=l.value;r.log(e,p)()}}catch(d){c=!0,u=d}finally{try{s||null==h.return||h.return()}finally{if(c)throw u}}r.groupEnd(e,"Updated attributes for ".concat(n," instances in ").concat(i," in ").concat(o))(),Lt.savedMessages=null}},At=function(){function t(e){var i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=i.id,r=void 0===n?"attribute-manager":n,a=i.stats;Object(C.a)(this,t),this.id=r,this.gl=e,this.attributes={},this.updateTriggers={},this.accessors={},this.needsRedraw=!0,this.userData={},this.stats=a,this.attributeTransitionManager=new Tt(e,{id:"".concat(r,"-transitions")}),Object.seal(this)}return Object(L.a)(t,null,[{key:"setDefaultLogFunctions",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=t.onLog,i=t.onUpdateStart,n=t.onUpdate,r=t.onUpdateEnd;void 0!==e&&(Lt.onLog=e||Ct),void 0!==i&&(Lt.onUpdateStart=i||Ct),void 0!==n&&(Lt.onUpdate=n||Ct),void 0!==r&&(Lt.onUpdateEnd=r||Ct)}}]),Object(L.a)(t,[{key:"finalize",value:function(){for(var t in this.attributes)this.attributes[t].delete();this.attributeTransitionManager.finalize()}},{key:"getNeedsRedraw",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{clearRedrawFlags:!1},e=this.needsRedraw;return this.needsRedraw=this.needsRedraw&&!t.clearRedrawFlags,e&&this.id}},{key:"setNeedsRedraw",value:function(){!(arguments.length>0&&void 0!==arguments[0])||arguments[0];return this.needsRedraw=!0,this}},{key:"add",value:function(t,e){this._add(t,e)}},{key:"addInstanced",value:function(t,e){this._add(t,e,{instanced:1})}},{key:"remove",value:function(t){for(var e=0;e<t.length;e++){var i=t[e];void 0!==this.attributes[i]&&(this.attributes[i].delete(),delete this.attributes[i])}}},{key:"invalidate",value:function(t){var e=this._invalidateTrigger(t);Lt.onLog({level:3,message:"invalidated attributes ".concat(e," (").concat(t,") for ").concat(this.id)})}},{key:"invalidateAll",value:function(){for(var t in this.attributes)this.attributes[t].setNeedsUpdate();Lt.onLog({level:3,message:"invalidated all attributes for ".concat(this.id)})}},{key:"update",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=t.data,i=t.numInstances,n=t.transitions,r=t.props,a=void 0===r?{}:r,o=t.buffers,s=void 0===o?{}:o,c=t.context,u=void 0===c?{}:c,l=!1;for(var h in Lt.onUpdateStart({level:2,id:this.id,numInstances:i}),this.stats&&this.stats.get("Update Attributes").timeStart(),this.attributes){var p=this.attributes[h];if(p.setExternalBuffer(s[h],this.numInstances)||p.setGenericValue(a[p.getAccessor()])||p.needsUpdate()&&(l=!0,this._updateAttribute({attribute:p,numInstances:i,data:e,props:a,context:u})),p.userData.shaderAttributes){var d=p.userData.shaderAttributes;for(var v in d){var f=d[v];f.update({buffer:p.buffer,value:f.value||p.value,constant:p.constant})}}this.needsRedraw|=p.needsRedraw()}l&&Lt.onUpdateEnd({level:2,id:this.id,numInstances:i}),this.stats&&this.stats.get("Update Attributes").timeEnd(),this.attributeTransitionManager.update({attributes:this.attributes,numInstances:i,transitions:n})}},{key:"updateTransition",value:function(t){var e=this.attributeTransitionManager.setCurrentTime(t);return this.needsRedraw=this.needsRedraw||e,e}},{key:"getAttributes",value:function(){return this.attributes}},{key:"getChangedAttributes",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{clearChangedFlags:!1},e=this.attributes,i=this.attributeTransitionManager,n=Object.assign({},i.getAttributes()),r={};for(var a in e){var o=e[a];o.needsRedraw(t)&&!i.hasAttribute(a)&&(n[a]=o)}for(var s in n){var c=n[s];if(c.userData.shaderAttributes){var u=c.userData.shaderAttributes;for(var l in u)r[l]=u[l]}else r[s]=c}return r}},{key:"getAccessors",value:function(){return this.updateTriggers}},{key:"_add",value:function(t,e){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};e&&r.warn("AttributeManager.add({updaters}) - updater map no longer supported")();var n={};for(var a in t){var o=t[a],s=this._createAttribute(a,o,i);o.shaderAttributes&&this._addShaderAttributes(s,o.shaderAttributes,i),n[a]=s}Object.assign(this.attributes,n),this._mapUpdateTriggersToAttributes()}},{key:"_addShaderAttributes",value:function(t,e,i){for(var n in t.userData.shaderAttributes={},e){var r=e[n];t.userData.shaderAttributes[n]=this._createAttribute(n,r,i,!0)}}},{key:"_createAttribute",value:function(t,e,i){var n=arguments.length>3&&void 0!==arguments[3]&&arguments[3],r={id:t,constant:e.constant||!1,isIndexed:e.isIndexed||e.elements,size:e.elements?1:e.size,value:e.value||null,divisor:e.instanced||i.instanced?1:e.divisor};return n&&(r.noAlloc=!0),new bt(this.gl,Object.assign({},e,r))}},{key:"_mapUpdateTriggersToAttributes",value:function(){var t=this,e={},i=function(i){t.attributes[i].getUpdateTriggers().forEach(function(t){e[t]||(e[t]=[]),e[t].push(i)})};for(var n in this.attributes)i(n);this.updateTriggers=e}},{key:"_invalidateTrigger",value:function(t){var e=this.attributes,i=this.updateTriggers[t];if(i)i.forEach(function(t){var i=e[t];i&&i.setNeedsUpdate()});else{var n="invalidating non-existent trigger ".concat(t," for ").concat(this.id,"\n");n+="Valid triggers: ".concat(Object.keys(e).join(", ")),r.warn(n,i)()}return i}},{key:"_updateAttribute",value:function(t){var e=t.attribute,i=t.numInstances,n=t.data,r=t.props,a=t.context;e.allocate(i)&&Lt.onUpdate({level:3,message:"".concat(e.id," allocated ").concat(i),id:this.id});var o=Date.now();if(e.updateBuffer({numInstances:i,data:n,props:r,context:a})){this.needsRedraw=!0;var s=Math.round(Date.now()-o);Lt.onUpdate({level:3,message:"".concat(e.id," updated ").concat(i," in ").concat(s,"ms")})}}}]),t}(),It=i(217),Rt=i(265),Ft=i.n(Rt),zt=new Map,Dt=function(t){if(Ft.a.isReady()&&t.id){var e=zt.get(t.id);e&&e.forEach(function(e,i){!function t(e,i,n){e&&(i.length>1?t(e[i[0]],i.slice(1),n):e[i[0]]=n)}(t,i,e),"data"===i[0]&&(t.data=Object(It.a)(t.data))})}},Nt=function(t){Ft.a.isReady()&&Ft.a.listenFor("deck.gl",t)},Vt=function(t){Ft.a.isReady()&&Ft.a.listenFor("init",t)},Ut=function(t){if(Ft.a.isReady()&&t){var e=[t.constructor.layerName];Ft.a.listItem("deck.gl",t.id,{badges:e,links:t.state&&t.state.model?["luma.gl:".concat(t.state.model.id)]:void 0,parent:t.parent?t.parent.id:void 0})}},Bt=function(t){if(Ft.a.isReady()&&!Ft.a.throttle("deck.gl:".concat(t.id),1e3)){var e=function(t){var e=[{path:"objects.props",data:t.props}],i=[t.constructor.layerName];if(t.state){if(t.getAttributeManager()){var n=t.getAttributeManager().getAttributes();e.push({path:"objects.attributes",data:n})}if(t.state.model){t.state.model.setProps({timerQueryEnabled:!0});var r=t.state.model.stats.lastFrameTime;r&&i.push("".concat((1e3*r).toFixed(0),"Î¼s"))}}return e.push({path:"badges",data:i}),e}(t);Ft.a.multiUpdate("deck.gl",t.id,e)}};var Zt=i(208);function Gt(t,e){var i=Xt({newProps:t,oldProps:e,propTypes:Yt(t),ignoreProps:{data:null,updateTriggers:null}}),n=function(t,e){if(null===e)return"oldProps is null, initial diff";var i=t.dataComparator;if(i){if(!i(t.data,e.data))return"Data comparator detected a change"}else if(t.data!==e.data)return"A new data container was supplied";return null}(t,e),r=!1;return n||(r=function(t,e){if(null===e)return"oldProps is null, initial diff";if("all"in t.updateTriggers){var i=Wt(t,e,"all");if(i)return{all:!0}}var n={},r=!1;for(var a in t.updateTriggers)if("all"!==a){var o=Wt(t,e,a);o&&(n[a]=!0,r=n)}return r}(t,e)),{dataChanged:n,propsChanged:i,updateTriggersChanged:r}}function Xt(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=t.newProps,i=t.oldProps,n=t.ignoreProps,r=void 0===n?{}:n,a=t.propTypes,o=void 0===a?{}:a,s=t.triggerName,c=void 0===s?"props":s;if(f(void 0!==i&&void 0!==e,"compareProps args"),i===e)return null;if("object"!==Object(Zt.a)(e)||null===e)return"".concat(c," changed shallowly");if("object"!==Object(Zt.a)(i)||null===i)return"".concat(c," changed shallowly");for(var u in i)if(!(u in r)){if(!(u in e))return"".concat(c,".").concat(u," dropped");var l=e[u],h=i[u],p=o[u],d=p&&p.equal;if(d&&!d(l,h,p))return"".concat(c,".").concat(u," changed deeply");if(!d&&(d=l&&h&&l.equals)&&!d.call(l,h))return"".concat(c,".").concat(u," changed deeply");if(!d&&h!==l)return"".concat(c,".").concat(u," changed shallowly")}for(var v in e)if(!(v in r||v in i))return"".concat(c,".").concat(v," added: undefined -> ").concat(e[v]);return null}function Wt(t,e,i){var n=t.updateTriggers[i];n=null==n?{}:n;var r=e.updateTriggers[i];return Xt({oldProps:r=null==r?{}:r,newProps:n,triggerName:i})}function Yt(t){var e=t._component,i=e&&e.constructor;return i?i._propTypes:{}}var qt="count(): argument not an object",Ht="count(): argument not a container";function Kt(t){if(null===(e=t)||"object"!==Object(Zt.a)(e))throw new Error(qt);var e;if("function"==typeof t.count)return t.count();if(Number.isFinite(t.size))return t.size;if(Number.isFinite(t.length))return t.length;if(function(t){return null!==t&&"object"===Object(Zt.a)(t)&&t.constructor===Object}(t))return Object.keys(t).length;throw new Error(Ht)}var Jt={NO_STATE:"Awaiting state",MATCHED:"Matched. State transferred from previous layer",INITIALIZED:"Initialized",AWAITING_GC:"Discarded. Awaiting garbage collection",AWAITING_FINALIZATION:"No longer matched. Awaiting garbage collection",FINALIZED:"Finalized! Awaiting garbage collection"},Qt={boolean:{validate:function(t,e){return!0},equal:function(t,e,i){return Boolean(t)===Boolean(e)}},number:{validate:function(t,e){return Number.isFinite(t)&&(!("max"in e)||t<=e.max)&&(!("min"in e)||t>=e.min)}},color:{validate:function(t,e){return ie(t)&&(3===t.length||4===t.length)},equal:function(t,e,i){return $t(t,e)}},accessor:{validate:function(t,e){var i=ne(t);return"function"===i||i===ne(e.value)},equal:function(t,e,i){return"function"==typeof e||$t(t,e)}},array:{validate:function(t,e){return e.optional&&!t||ie(t)},equal:function(t,e,i){return i.compare?$t(t,e):t===e}},function:{validate:function(t,e){return e.optional&&!t||"function"==typeof t},equal:function(t,e,i){return!i.compare||t===e}}};function $t(t,e){if(t===e)return!0;if(!ie(t)||!ie(e))return!1;var i=t.length;if(i!==e.length)return!1;for(var n=0;n<i;n++)if(t[n]!==e[n])return!1;return!0}function te(t,e){switch(ne(e)){case"object":return ee(t,e);case"array":return ee(t,{type:"array",value:e,compare:!1});case"boolean":return ee(t,{type:"boolean",value:e});case"number":return ee(t,{type:"number",value:e});case"function":return ee(t,{type:"function",value:e,compare:!0});default:return{name:t,type:"unknown",value:e}}}function ee(t,e){return"type"in e?Object.assign({name:t},Qt[e.type],e):"value"in e?Object.assign({name:t,type:ne(e.value)},e):{name:t,type:"object",value:e}}function ie(t){return Array.isArray(t)||ArrayBuffer.isView(t)}function ne(t){return ie(t)?"array":null===t?"null":Object(Zt.a)(t)}function re(t,e,i){if(e)for(var n in i)if(se(e,n)){var a="".concat(t||"Layer",": ").concat(n),o=!0,s=!1,c=void 0;try{for(var u,l=i[n][Symbol.iterator]();!(o=(u=l.next()).done);o=!0){var h=u.value;se(e,h)||(e[h]=e[n])}}catch(p){s=!0,c=p}finally{try{o||null==l.return||l.return()}finally{if(s)throw c}}r.deprecated(a,i[n].join("/"))()}}function ae(t){var e=ce(t,"_mergedDefaultProps");return e?{defaultProps:e,propTypes:ce(t,"_propTypes"),deprecatedProps:ce(t,"_deprecatedProps")}:function(t){var e=t.prototype;if(!e)return{defaultProps:{}};var i=Object.getPrototypeOf(t),n=e&&ae(i)||null,a=function(t){for(var e={},i={},n={},r=Object.entries(t),a=0;a<r.length;a++){var o=Object(U.a)(r[a],2),s=o[0],c=o[1];if(c&&c.deprecatedFor)n[s]=Array.isArray(c.deprecatedFor)?c.deprecatedFor:[c.deprecatedFor];else{var u=te(s,c);e[s]=u,i[s]=u.value}}return{propTypes:e,defaultProps:i,deprecatedProps:n}}(ce(t,"defaultProps")||{}),o=Object.assign({},n&&n.propTypes,a.propTypes),s=function(t,e,i,n){var a=Object.create(null);Object.assign(a,e,t);var o=function(t){var e=ce(t,"layerName")||ce(t,"componentName");e||r.once(0,"".concat(t.name,".componentName not specified"))();return e||t.name}(n);return delete t.id,Object.defineProperties(a,{id:{configurable:!1,writable:!0,value:o}}),function(t,e){var i={},n={_asyncPropDefaultValues:{enumerable:!1,value:i},_asyncPropOriginalValues:{enumerable:!1,value:{}}};for(var r in e){var a=e[r],o=a.name,s=a.value;a.async&&(i[o]=s,n[o]=oe(o))}Object.defineProperties(t,n)}(a,i),a}(a.defaultProps,n&&n.defaultProps,o,t),c=Object.assign({},n&&n.deprecatedProps,a.deprecatedProps);return t._mergedDefaultProps=s,t._propTypes=o,t._deprecatedProps=c,{propTypes:o,defaultProps:s,deprecatedProps:c}}(t)}function oe(t){return{configurable:!1,enumerable:!0,set:function(e){"string"==typeof e||e instanceof Promise?this._asyncPropOriginalValues[t]=e:this._asyncPropResolvedValues[t]=e},get:function(){if(this._asyncPropResolvedValues){if(t in this._asyncPropResolvedValues){var e=this._asyncPropResolvedValues[t];return"data"===t?e||this._asyncPropDefaultValues[t]:e}if(t in this._asyncPropOriginalValues){var i=this._component&&this._component.internalState;if(i&&i.hasAsyncProp(t))return i.getAsyncProp(t)}}return this._asyncPropDefaultValues[t]}}}function se(t,e){return Object.prototype.hasOwnProperty.call(t,e)}function ce(t,e){return se(t,e)&&t[e]}var ue=Object.freeze({}),le=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;Object(C.a)(this,t),this.component=e,this.asyncProps={},this.onAsyncPropUpdated=function(){},this.oldProps=ue,this.oldAsyncProps=null}return Object(L.a)(t,[{key:"getOldProps",value:function(){return this.oldAsyncProps||this.oldProps}},{key:"resetOldProps",value:function(){this.oldAsyncProps=null,this.oldProps=this.component.props}},{key:"freezeAsyncOldProps",value:function(){if(!this.oldAsyncProps)for(var t in this.oldProps=this.oldProps||this.component.props,this.oldAsyncProps={},this.oldProps)this.oldAsyncProps[t]=this.oldProps[t]}},{key:"hasAsyncProp",value:function(t){return t in this.asyncProps}},{key:"getAsyncProp",value:function(t){var e=this.asyncProps[t];return e&&e.resolvedValue}},{key:"isAsyncPropLoading",value:function(t){var e=this.asyncProps[t];return Boolean(e&&e.pendingLoadCount>0&&e.pendingLoadCount!==e.resolvedLoadCount)}},{key:"setAsyncProps",value:function(t){var e=t._asyncPropResolvedValues||{},i=t._asyncPropOriginalValues||t,n=t._asyncPropDefaultValues||{};for(var r in e){var a=e[r];this._createAsyncPropData(r,a,n[r]),this._updateAsyncProp(r,a)}for(var o in i){var s=i[o];this._createAsyncPropData(o,s,n[o]),this._updateAsyncProp(o,s)}}},{key:"_updateAsyncProp",value:function(t,e){if(this._didAsyncInputValueChange(t,e)){if("string"==typeof e)e=(0,this.layer.props.fetch)(e,{propName:t,layer:this.layer});e instanceof Promise?this._watchPromise(t,e):this._setPropValue(t,e)}}},{key:"_didAsyncInputValueChange",value:function(t,e){var i=this.asyncProps[t];return e!==i.lastValue&&(i.lastValue=e,!0)}},{key:"_setPropValue",value:function(t,e){var i=this.asyncProps[t];i.value=e,i.resolvedValue=e,i.pendingLoadCount++,i.resolvedLoadCount=i.pendingLoadCount}},{key:"_setAsyncPropValue",value:function(t,e,i){var n=this.asyncProps[t];n&&i>=n.resolvedLoadCount&&(f(void 0!==e),this.freezeAsyncOldProps(),e=this._postProcessValue(t,e),n.resolvedValue=e,n.resolvedLoadCount=i,this.onAsyncPropUpdated(t,e))}},{key:"_watchPromise",value:function(t,e){var i=this,n=this.asyncProps[t];n.pendingLoadCount++;var a=n.pendingLoadCount;e.then(function(e){return i._setAsyncPropValue(t,e,a)}).catch(function(t){return r.error(t)()})}},{key:"_postProcessValue",value:function(t,e){var i=(this.component?this.component.props:{}).dataTransform;return"data"===t&&i&&(e=i(e)),e}},{key:"_createAsyncPropData",value:function(t,e,i){this.asyncProps[t]||(this.asyncProps[t]={lastValue:null,resolvedValue:i,pendingLoadCount:0,resolvedLoadCount:0})}}]),t}(),he=0,pe=function(){function t(){Object(C.a)(this,t),this.props=function(){for(var t=ae(this.constructor),e=t.defaultProps,i=Object.create(e,{_component:{enumerable:!1,value:this},_asyncPropOriginalValues:{enumerable:!1,value:{}},_asyncPropResolvedValues:{enumerable:!1,value:{}}}),n=0;n<arguments.length;++n)Object.assign(i,arguments[n]);var r=this.constructor.layerName,a=t.deprecatedProps;return re(r,i,a),re(r,i.updateTriggers,a),re(r,i.transitions,a),Dt(i),Object.freeze(i),i}.apply(this,arguments),this.id=this.props.id,this.count=he++,this.lifecycle=Jt.NO_STATE,this.parent=null,this.context=null,this.state=null,this.internalState=null,Object.seal(this)}return Object(L.a)(t,[{key:"clone",value:function(t){var e=this.props,i={};for(var n in e._asyncPropDefaultValues)n in e._asyncPropResolvedValues?i[n]=e._asyncPropResolvedValues[n]:n in e._asyncPropOriginalValues&&(i[n]=e._asyncPropOriginalValues[n]);return new this.constructor(Object.assign({},e,i,t))}},{key:"_initState",value:function(){this.internalState=new le({})}},{key:"stats",get:function(){return this.internalState.stats}}]),t}();pe.defaultProps={};var de=function(t){function e(t){var i,n=t.attributeManager,r=t.layer;return Object(C.a)(this,e),(i=Object(A.a)(this,Object(I.a)(e).call(this,r))).attributeManager=n,i.model=null,i.needsRedraw=!0,i.subLayers=null,i}return Object(R.a)(e,t),Object(L.a)(e,[{key:"layer",get:function(){return this.component},set:function(t){this.component=t}}]),e}(le),ve=Object.freeze([]),fe=new Uint8ClampedArray(0),ge={data:{type:"data",value:ve,async:!0},dataComparator:null,dataTransform:{type:"function",value:function(t){return t},compare:!1},fetch:{type:"function",value:function(t){return fetch(t).then(function(t){return t.json()})},compare:!1},updateTriggers:{},numInstances:void 0,visible:!0,pickable:!1,opacity:{type:"number",min:0,max:1,value:.8},onHover:{type:"function",value:null,compare:!1,optional:!0},onClick:{type:"function",value:null,compare:!1,optional:!0},onDragStart:{type:"function",value:null,compare:!1,optional:!0},onDrag:{type:"function",value:null,compare:!1,optional:!0},onDragEnd:{type:"function",value:null,compare:!1,optional:!0},coordinateSystem:h.LNGLAT,coordinateOrigin:{type:"array",value:[0,0,0],compare:!0},modelMatrix:{type:"array",value:null,compare:!0,optional:!0},wrapLongitude:!1,parameters:{},uniforms:{},framebuffer:null,animation:null,getPolygonOffset:{type:"function",value:function(t){return[0,100*-t.layerIndex]},compare:!1},highlightedObjectIndex:null,autoHighlight:!1,highlightColor:{type:"color",value:[0,0,128,128]}},ye=function(t){function e(){return Object(C.a)(this,e),Object(A.a)(this,Object(I.a)(e).apply(this,arguments))}return Object(R.a)(e,t),Object(L.a)(e,[{key:"toString",value:function(){var t=this.constructor.layerName||this.constructor.name;return"".concat(t,"({id: '").concat(this.props.id,"'})")}},{key:"setState",value:function(t){this.setChangeFlags({stateChanged:!0}),Object.assign(this.state,t),this.setNeedsRedraw()}},{key:"setNeedsRedraw",value:function(){var t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this.internalState&&(this.internalState.needsRedraw=t)}},{key:"setLayerNeedsUpdate",value:function(){this.context.layerManager.setNeedsUpdate(String(this))}},{key:"getNeedsRedraw",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{clearRedrawFlags:!1};return this._getNeedsRedraw(t)}},{key:"needsUpdate",value:function(){return this.shouldUpdateState(this._getUpdateParams())}},{key:"isPickable",value:function(){return this.props.pickable&&this.props.visible}},{key:"getModels",value:function(){return this.state&&(this.state.models||(this.state.model?[this.state.model]:[]))}},{key:"getSingleModel",value:function(){return this.state&&this.state.model}},{key:"getAttributeManager",value:function(){return this.internalState&&this.internalState.attributeManager}},{key:"getCurrentLayer",value:function(){return this.internalState&&this.internalState.layer}},{key:"getFirstObject",value:function(){var t=this.props.data,e=!0,i=!1,n=void 0;try{for(var r,a=t[Symbol.iterator]();!(e=(r=a.next()).done);e=!0){return r.value}}catch(o){i=!0,n=o}finally{try{e||null==a.return||a.return()}finally{if(i)throw n}}return null}},{key:"project",value:function(t){var e=this.context.viewport,i=ct(ht(t,{viewport:e,modelMatrix:this.props.modelMatrix,coordinateOrigin:this.props.coordinateOrigin,coordinateSystem:this.props.coordinateSystem}),e.pixelProjectionMatrix),n=Object(U.a)(i,3),r=n[0],a=n[1],o=n[2];return 2===t.length?[r,a]:[r,a,o]}},{key:"unproject",value:function(t){var e=this.context.viewport;return f(Array.isArray(t)),e.unproject(t)}},{key:"projectPosition",value:function(t){return f(Array.isArray(t)),pt(t,{viewport:this.context.viewport,modelMatrix:this.props.modelMatrix,coordinateOrigin:this.props.coordinateOrigin,coordinateSystem:this.props.coordinateSystem})}},{key:"projectFlat",value:function(t){r.deprecated("layer.projectFlat","layer.projectPosition")();var e=this.context.viewport;return f(Array.isArray(t)),e.projectFlat(t)}},{key:"unprojectFlat",value:function(t){r.deprecated("layer.unprojectFlat")();var e=this.context.viewport;return f(Array.isArray(t)),e.unprojectFlat(t)}},{key:"use64bitProjection",value:function(){if(this.props.fp64){if(this.props.coordinateSystem===h.LNGLAT_DEPRECATED)return!0;r.once(0,"Legacy 64-bit mode only works with coordinateSystem set to\n        COORDINATE_SYSTEM.LNGLAT_DEPRECATED. Rendering in 32-bit mode instead")()}return!1}},{key:"use64bitPositions",value:function(){return this.props.fp64||this.props.coordinateSystem===h.LNGLAT}},{key:"screenToDevicePixels",value:function(t){return r.deprecated("screenToDevicePixels","DeckGL prop useDevicePixels for conversion")(),t*("undefined"!=typeof window?window.devicePixelRatio:1)}},{key:"onHover",value:function(t,e){return!!this.props.onHover&&this.props.onHover(t,e)}},{key:"onClick",value:function(t,e){return!!this.props.onClick&&this.props.onClick(t,e)}},{key:"nullPickingColor",value:function(){return[0,0,0]}},{key:"encodePickingColor",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];return f(t<16777215,"index out of picking color range"),e[0]=t+1&255,e[1]=t+1>>8&255,e[2]=t+1>>8>>8&255,e}},{key:"decodePickingColor",value:function(t){f(t instanceof Uint8Array);var e=Object(U.a)(t,3);return e[0]+256*e[1]+65536*e[2]-1}},{key:"initializeState",value:function(){throw new Error("Layer ".concat(this," has not defined initializeState"))}},{key:"shouldUpdateState",value:function(t){t.oldProps,t.props,t.context;return t.changeFlags.propsOrDataChanged}},{key:"updateState",value:function(t){t.oldProps,t.props,t.context;var e=t.changeFlags,i=this.getAttributeManager();e.dataChanged&&i&&i.invalidateAll()}},{key:"finalizeState",value:function(){var t=!0,e=!1,i=void 0;try{for(var n,r=this.getModels()[Symbol.iterator]();!(t=(n=r.next()).done);t=!0){n.value.delete()}}catch(o){e=!0,i=o}finally{try{t||null==r.return||r.return()}finally{if(e)throw i}}var a=this.getAttributeManager();a&&a.finalize()}},{key:"draw",value:function(t){var e=!0,i=!1,n=void 0;try{for(var r,a=this.getModels()[Symbol.iterator]();!(e=(r=a.next()).done);e=!0){r.value.draw(t)}}catch(o){i=!0,n=o}finally{try{e||null==a.return||a.return()}finally{if(i)throw n}}}},{key:"getPickingInfo",value:function(t){var e=t.info,i=(t.mode,e.index);return i>=0&&Array.isArray(this.props.data)&&(e.object=this.props.data[i]),e}},{key:"invalidateAttribute",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"all",e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",i=this.getAttributeManager();i&&("all"===t?(r.log(1,"updateTriggers invalidating all attributes: ".concat(e))(),i.invalidateAll()):(r.log(1,"updateTriggers invalidating attribute ".concat(t,": ").concat(e))(),i.invalidate(t)))}},{key:"updateAttributes",value:function(t){var e=this.getAttributeManager();if(e){var i=this.getNumInstances(t);e.update({data:t.data,numInstances:i,props:t,transitions:t.transitions,buffers:t,context:this,ignoreUnknownAttributes:!0});var n=this.getModels();if(n.length>0)for(var r=e.getChangedAttributes({clearChangedFlags:!0}),a=0,o=n.length;a<o;++a)this._setModelAttributes(n[a],r)}}},{key:"updateTransition",value:function(){var t=this.getAttributeManager();t&&t.updateTransition(this.context.time)}},{key:"calculateInstancePickingColors",value:function(t,e){var i=e.numInstances,n=t.value,r=t.size;if(1!==n[0]){var a=fe.length/r;if(a<i){var o=new Uint8ClampedArray(i*r);o.set(fe);for(var s=[],c=a;c<i;c++)this.encodePickingColor(c,s),o[c*r+0]=s[0],o[c*r+1]=s[1],o[c*r+2]=s[2];fe=o}n.set(i<a?fe.subarray(0,i*r):fe)}}},{key:"_setModelAttributes",value:function(t,e){if(t.userData.excludeAttributes){var i={},n=t.userData.excludeAttributes;for(var r in e)n[r]||(i[r]=e[r]);t.setAttributes(i)}else t.setAttributes(e)}},{key:"_clearInstancePickingColor",value:function(t){var e=this.getAttributeManager().attributes.instancePickingColors,i=e.value,n=e.size,r=this.decodePickingColor(t);i[r*n+0]=0,i[r*n+1]=0,i[r*n+2]=0,e.update({value:i})}},{key:"_clearPickingColor",value:function(t){for(var e=this.getAttributeManager().attributes.pickingColors,i=e.value,n=0;n<i.length;n+=3)i[n+0]===t[0]&&i[n+1]===t[1]&&i[n+2]===t[2]&&(i[n+0]=0,i[n+1]=0,i[n+2]=0);e.update({value:i})}},{key:"clearPickingColor",value:function(t){this.getAttributeManager().attributes.pickingColors?this._clearPickingColor(t):this._clearInstancePickingColor(t)}},{key:"copyPickingColors",value:function(){var t=this.getAttributeManager().attributes,e=t.pickingColors,i=t.instancePickingColors;return new Uint8ClampedArray((e||i).value)}},{key:"restorePickingColors",value:function(t){var e=this.getAttributeManager().attributes,i=e.pickingColors,n=e.instancePickingColors;(i||n).update({value:t})}},{key:"getNumInstances",value:function(t){return void 0!==(t=t||this.props).numInstances?t.numInstances:this.state&&void 0!==this.state.numInstances?this.state.numInstances:Kt(this.props.data)}},{key:"_initialize",value:function(){this._initState(),this.initializeState(this.context),this.state.attributeManager=this.getAttributeManager(),this.setChangeFlags({dataChanged:!0,propsChanged:!0,viewportChanged:!0}),this._updateState();var t=this.getSingleModel();t&&(t.id=this.props.id,t.program.id="".concat(this.props.id,"-program"))}},{key:"_update",value:function(){this.needsUpdate()&&this._updateState()}},{key:"_updateState",value:function(){var t=this._getUpdateParams();if(this.context.gl)this.updateState(t);else try{this.updateState(t)}catch(e){}this.isComposite?this._renderLayers(t):(this.setNeedsRedraw(),this.updateAttributes(this.props),this._updateBaseUniforms(),this.state.model&&this.state.model.setInstanceCount(this.getNumInstances())),this.clearChangeFlags(),this.internalState.resetOldProps()}},{key:"_finalize",value:function(){var t;f(this.internalState&&this.state),this.finalizeState(this.context),t=this.id,Ft.a.isReady()&&t&&Ft.a.deleteItem("deck.gl",t)}},{key:"drawLayer",value:function(t){var e=this,i=t.moduleParameters,n=void 0===i?null:i,r=t.uniforms,o=void 0===r?{}:r,s=t.parameters,c=void 0===s?{}:s;o.picking_uActive||this.updateTransition(),n&&this.setModuleParameters(n);var u=this.context.animationProps;if(u){var l=!0,h=!1,p=void 0;try{for(var d,v=this.getModels()[Symbol.iterator]();!(l=(d=v.next()).done);l=!0){d.value._setAnimationProps(u)}}catch(y){h=!0,p=y}finally{try{l||null==v.return||v.return()}finally{if(h)throw p}}}var f=this.props.getPolygonOffset,g=f&&f(o)||[0,0];c.polygonOffset=g,Object(a.M)(this.context.gl,c,function(){e.draw({moduleParameters:n,uniforms:o,parameters:c,context:e.context})})}},{key:"pickLayer",value:function(t){return this.getPickingInfo(t)}},{key:"getChangeFlags",value:function(){return this.internalState.changeFlags}},{key:"setChangeFlags",value:function(t){var e=this;this.internalState.changeFlags=this.internalState.changeFlags||{};var i=this.internalState.changeFlags;t.dataChanged&&!i.dataChanged&&(i.dataChanged=t.dataChanged,r.log(2,function(){return"dataChanged: ".concat(t.dataChanged," in ").concat(e.id)})()),t.updateTriggersChanged&&!i.updateTriggersChanged&&(i.updateTriggersChanged=i.updateTriggersChanged&&t.updateTriggersChanged?Object.assign({},t.updateTriggersChanged,i.updateTriggersChanged):t.updateTriggersChanged||i.updateTriggersChanged,r.log(2,function(){return"updateTriggersChanged: "+"".concat(Object.keys(t.updateTriggersChanged).join(", ")," in ").concat(e.id)})()),t.propsChanged&&!i.propsChanged&&(i.propsChanged=t.propsChanged,r.log(2,function(){return"propsChanged: ".concat(t.propsChanged," in ").concat(e.id)})()),t.viewportChanged&&!i.viewportChanged&&(i.viewportChanged=t.viewportChanged,r.log(3,function(){return"viewportChanged: ".concat(t.viewportChanged," in ").concat(e.id)})()),t.stateChanged&&!i.stateChanged&&(i.stateChanged=t.stateChanged,r.log(2,function(){return"stateChanged: ".concat(t.stateChanged," in ").concat(e.id)})());var n=t.dataChanged||t.updateTriggersChanged||t.propsChanged;i.propsOrDataChanged=i.propsOrDataChanged||n,i.somethingChanged=i.somethingChanged||n||t.viewportChanged||t.stateChanged}},{key:"clearChangeFlags",value:function(){this.internalState.changeFlags={dataChanged:!1,propsChanged:!1,updateTriggersChanged:!1,viewportChanged:!1,stateChanged:!1,propsOrDataChanged:!1,somethingChanged:!1}}},{key:"printChangeFlags",value:function(){var t=this.internalState.changeFlags;return"".concat(t.dataChanged?"data ":"").concat(t.propsChanged?"props ":"").concat(t.updateTriggersChanged?"triggers ":"").concat(t.viewportChanged?"viewport":"")}},{key:"diffProps",value:function(t,e){var i=Gt(t,e);if(i.updateTriggersChanged)for(var n in i.updateTriggersChanged)i.updateTriggersChanged[n]&&this._activeUpdateTrigger(n);return this.setChangeFlags(i)}},{key:"validateProps",value:function(){!function(t){var e=Yt(t);for(var i in e){var n=e[i],r=n.validate;if(r&&!r(t[i],n))throw new Error("Invalid prop ".concat(i,": ").concat(t[i]))}}(this.props)}},{key:"setModuleParameters",value:function(t){var e=!0,i=!1,n=void 0;try{for(var r,a=this.getModels()[Symbol.iterator]();!(e=(r=a.next()).done);e=!0){r.value.updateModuleSettings(t)}}catch(o){i=!0,n=o}finally{try{e||null==a.return||a.return()}finally{if(i)throw n}}}},{key:"_getUpdateParams",value:function(){return{props:this.props,oldProps:this.internalState.getOldProps(),context:this.context,changeFlags:this.internalState.changeFlags}}},{key:"_getNeedsRedraw",value:function(t){if(!this.internalState)return!1;var e=!1;e=e||this.internalState.needsRedraw&&this.id,this.internalState.needsRedraw=this.internalState.needsRedraw&&!t.clearRedrawFlags;var i=this.getAttributeManager(),n=i&&i.getNeedsRedraw(t);return e=e||n}},{key:"_getAttributeManager",value:function(){return new At(this.context.gl,{id:this.props.id,stats:this.context.stats})}},{key:"_initState",value:function(){f(!this.internalState&&!this.state);var t=this._getAttributeManager();t&&t.addInstanced({instancePickingColors:{type:5121,size:3,update:this.calculateInstancePickingColors}}),this.internalState=new de({attributeManager:t,layer:this}),this.state={},this.state.attributeManager=t,this.internalState.onAsyncPropUpdated=this._onAsyncPropUpdated.bind(this),this.internalState.setAsyncProps(this.props)}},{key:"_transferState",value:function(t){var e=t.state,i=t.internalState;if(f(e&&i),this!==t){this.internalState=i,this.internalState.component=this,this.state=e,e.layer=this,this.internalState.setAsyncProps(this.props);var n=!0,r=!1,a=void 0;try{for(var o,s=this.getModels()[Symbol.iterator]();!(n=(o=s.next()).done);n=!0){o.value.userData.layer=this}}catch(c){r=!0,a=c}finally{try{n||null==s.return||s.return()}finally{if(r)throw a}}this.diffProps(this.props,this.internalState.getOldProps())}}},{key:"_onAsyncPropUpdated",value:function(){this.diffProps(this.props,this.internalState.getOldProps()),this.setLayerNeedsUpdate()}},{key:"_activeUpdateTrigger",value:function(t){this.invalidateAttribute(t)}},{key:"_updateBaseUniforms",value:function(){var t=this,e={opacity:"function"==typeof this.props.opacity?function(e){return Math.pow(t.props.opacity(e),1/2.2)}:Math.pow(this.props.opacity,1/2.2)},i=!0,n=!1,r=void 0;try{for(var a,o=this.getModels()[Symbol.iterator]();!(i=(a=o.next()).done);i=!0){a.value.setUniforms(e)}}catch(s){n=!0,r=s}finally{try{i||null==o.return||o.return()}finally{if(n)throw r}}}},{key:"setUniforms",value:function(t){var e=!0,i=!1,n=void 0;try{for(var a,o=this.getModels()[Symbol.iterator]();!(e=(a=o.next()).done);e=!0){a.value.setUniforms(t)}}catch(s){i=!0,n=s}finally{try{e||null==o.return||o.return()}finally{if(i)throw n}}this.setNeedsRedraw(),r.deprecated("layer.setUniforms","model.setUniforms")()}},{key:"is64bitEnabled",value:function(){return r.deprecated("is64bitEnabled","use64bitProjection")(),this.use64bitProjection()}}]),e}(pe);ye.layerName="Layer",ye.defaultProps=ge;var me=i(218);function be(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},i=e.filter,n=void 0===i?function(){return!0}:i,r=e.map,a=void 0===r?function(t){return t}:r,o=e.result,s=void 0===o?[]:o;return Array.isArray(t)?function t(e,i,n,r){var a=-1;for(;++a<e.length;){var o=e[a];Array.isArray(o)?t(o,i,n,r):i(o)&&r.push(n(o))}return r}(t,n,a,s):n(t)?[a(t)]:[]}function we(t){for(var e=t.target,i=t.source,n=t.start,r=void 0===n?0:n,a=t.count,o=void 0===a?1:a,s=i.length,c=o*s,u=0,l=r;u<s;u++)e[l++]=i[u];for(;u<c;)u<c-u?(e.copyWithin(r+u,r,r+u),u*=2):(e.copyWithin(r+u,r,r+c-u),u=c);return e}(function(t){function e(){return Object(C.a)(this,e),Object(A.a)(this,Object(I.a)(e).apply(this,arguments))}return Object(R.a)(e,t),Object(L.a)(e,[{key:"getSubLayers",value:function(){return this.internalState&&this.internalState.subLayers||[]}},{key:"initializeState",value:function(){}},{key:"setState",value:function(t){Object(me.a)(Object(I.a)(e.prototype),"setState",this).call(this,t),this.setLayerNeedsUpdate()}},{key:"getPickingInfo",value:function(t){return t.info}},{key:"renderLayers",value:function(){return null}},{key:"shouldRenderSubLayer",value:function(t,e){var i=this.props._subLayerProps;return e&&e.length||i&&i[t]}},{key:"getSubLayerClass",value:function(t,e){var i=this.props._subLayerProps;return i&&i[t]&&i[t].type||e}},{key:"getSubLayerProps",value:function(t){var e=this.props,i=e.opacity,n=e.pickable,r=e.visible,a=e.parameters,o=e.getPolygonOffset,s=e.highlightedObjectIndex,c=e.autoHighlight,u=e.highlightColor,l=e.coordinateSystem,h=e.coordinateOrigin,p=e.wrapLongitude,d=e.positionFormat,v=e.modelMatrix,f=e._subLayerProps,g={opacity:i,pickable:n,visible:r,parameters:a,getPolygonOffset:o,highlightedObjectIndex:s,autoHighlight:c,highlightColor:u,coordinateSystem:l,coordinateOrigin:h,wrapLongitude:p,positionFormat:d,modelMatrix:v};return t&&Object.assign(g,t,f&&f[t.id],{id:"".concat(this.props.id,"-").concat(t.id),updateTriggers:Object.assign({all:this.props.updateTriggers.all},t.updateTriggers)}),g}},{key:"_getAttributeManager",value:function(){return null}},{key:"_renderLayers",value:function(){var t=this.internalState.subLayers;t&&!this.needsUpdate()?r.log(3,"Composite layer reused subLayers ".concat(this),this.internalState.subLayers)():(t=be(t=this.renderLayers(),{filter:Boolean}),this.internalState.subLayers=t,r.log(2,"Composite layer rendered new subLayers ".concat(this),t)());var e=!0,i=!1,n=void 0;try{for(var a,o=t[Symbol.iterator]();!(e=(a=o.next()).done);e=!0){a.value.parent=this}}catch(s){i=!0,n=s}finally{try{e||null==o.return||o.return()}finally{if(i)throw n}}}},{key:"isComposite",get:function(){return!0}}]),e}(ye)).layerName="CompositeLayer";var _e=i(289);var ke=i(224),je=i(360),Pe=i(275),Oe=Math.PI/180,Se=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],xe=[0,0,0],Me=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};Object(C.a)(this,t);var i=e.id,n=void 0===i?null:i,r=e.x,a=void 0===r?0:r,o=e.y,s=void 0===o?0:o,c=e.width,u=void 0===c?1:c,l=e.height,h=void 0===l?1:l;this.id=n||this.constructor.displayName||"viewport",this.x=a,this.y=s,this.width=u||1,this.height=h||1,this._initViewMatrix(e),this._initProjectionMatrix(e),this._initPixelMatrices(),this.equals=this.equals.bind(this),this.project=this.project.bind(this),this.unproject=this.unproject.bind(this),this.projectPosition=this.projectPosition.bind(this),this.unprojectPosition=this.unprojectPosition.bind(this),this.projectFlat=this.projectFlat.bind(this),this.unprojectFlat=this.unprojectFlat.bind(this),this.getMatrices=this.getMatrices.bind(this)}return Object(L.a)(t,[{key:"equals",value:function(e){return e instanceof t&&(e.width===this.width&&e.height===this.height&&e.scale===this.scale&&Object(ke.e)(e.projectionMatrix,this.projectionMatrix)&&Object(ke.e)(e.viewMatrix,this.viewMatrix))}},{key:"project",value:function(t){var e=(arguments.length>1&&void 0!==arguments[1]?arguments[1]:{}).topLeft,i=void 0===e||e,n=ct(this.projectPosition(t),this.pixelProjectionMatrix),r=Object(U.a)(n,2),a=r[0],o=r[1],s=i?o:this.height-o;return 2===t.length?[a,s]:[a,s,n[2]]}},{key:"unproject",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},i=e.topLeft,n=void 0===i||i,r=e.targetZ,a=Object(U.a)(t,3),o=a[0],s=a[1],c=a[2],u=n?s:this.height-s,l=r&&r*this.distanceScales.pixelsPerMeter[2],h=ut([o,u,c],this.pixelUnprojectionMatrix,l),p=this.unprojectPosition(h),d=Object(U.a)(p,3),v=d[0],f=d[1],g=d[2];return Number.isFinite(c)?[v,f,g]:Number.isFinite(r)?[v,f,r]:[v,f]}},{key:"projectPosition",value:function(t){var e=this.projectFlat(t),i=Object(U.a)(e,2);return[i[0],i[1],(t[2]||0)*this.distanceScales.pixelsPerMeter[2]]}},{key:"unprojectPosition",value:function(t){var e=this.unprojectFlat(t),i=Object(U.a)(e,2);return[i[0],i[1],(t[2]||0)*this.distanceScales.metersPerPixel[2]]}},{key:"projectFlat",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.scale;if(this.isGeospatial)return it(t,e);var i=this.distanceScales.pixelsPerMeter;return[t[0]*i[0],t[1]*i[1]]}},{key:"unprojectFlat",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.scale;if(this.isGeospatial)return nt(t,e);var i=this.distanceScales.metersPerPixel;return[t[0]*i[0],t[1]*i[1]]}},{key:"getDistanceScales",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;return t?rt({longitude:t[0],latitude:t[1],scale:this.scale,highPrecision:!0}):this.distanceScales}},{key:"getMatrices",value:function(){var t=(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{}).modelMatrix,e=void 0===t?null:t,i=this.viewProjectionMatrix,n=this.pixelProjectionMatrix,r=this.pixelUnprojectionMatrix;return e&&(i=u.g([],this.viewProjectionMatrix,e),n=u.g([],this.pixelProjectionMatrix,e),r=u.e([],n)),Object.assign({modelViewProjectionMatrix:i,viewProjectionMatrix:this.viewProjectionMatrix,viewMatrix:this.viewMatrix,projectionMatrix:this.projectionMatrix,pixelProjectionMatrix:n,pixelUnprojectionMatrix:r,width:this.width,height:this.height,scale:this.scale})}},{key:"containsPixel",value:function(t){var e=t.x,i=t.y,n=t.width,r=void 0===n?1:n,a=t.height,o=void 0===a?1:a;return e<this.x+this.width&&this.x<e+r&&i<this.y+this.height&&this.y<i+o}},{key:"getCameraPosition",value:function(){return this.cameraPosition}},{key:"getCameraDirection",value:function(){return this.cameraDirection}},{key:"getCameraUp",value:function(){return this.cameraUp}},{key:"_addMetersToLngLat",value:function(t,e){var i=Object(U.a)(t,3),n=i[0],r=i[1],a=i[2],o=void 0===a?0:a,s=this._metersToLngLatDelta(e),c=Object(U.a)(s,3),u=c[0],l=c[1],h=c[2],p=void 0===h?0:h;return 2===t.length?[n+u,r+l]:[n+u,r+l,o+p]}},{key:"_metersToLngLatDelta",value:function(t){var e=Object(U.a)(t,3),i=e[0],n=e[1],r=e[2],a=void 0===r?0:r;f(Number.isFinite(i)&&Number.isFinite(n)&&Number.isFinite(a),"Illegal argument to Viewport");var o=this.distanceScales,s=o.pixelsPerMeter,c=o.degreesPerPixel,u=i*s[0]*c[0],l=n*s[1]*c[1];return 2===t.length?[u,l]:[u,l,a]}},{key:"_createProjectionMatrix",value:function(t){var e=t.orthographic,i=t.fovyRadians,n=t.aspect,r=t.focalDistance,a=t.near,o=t.far;return f(Number.isFinite(i)),e?(new je.a).orthographic({fovy:i,aspect:n,focalDistance:r,near:a,far:o}):(new je.a).perspective({fovy:i,aspect:n,near:a,far:o})}},{key:"_initViewMatrix",value:function(t){var e=t.viewMatrix,i=void 0===e?Se:e,n=t.longitude,r=void 0===n?null:n,a=t.latitude,o=void 0===a?null:a,s=t.zoom,c=void 0===s?null:s,l=t.position,h=void 0===l?null:l,p=t.modelMatrix,d=void 0===p?null:p,v=t.focalDistance,f=void 0===v?1:v,g=t.distanceScales,y=void 0===g?null:g;this.isGeospatial=Number.isFinite(o)&&Number.isFinite(r),this.zoom=c,Number.isFinite(this.zoom)||(this.zoom=this.isGeospatial?function(t){var e=t.latitude;W(Number.isFinite(e));var i=Math.cos(e*H);return et(Q*i)-9}({latitude:o})+Math.log2(f):0);var m=Math.pow(2,this.zoom);this.scale=m,this.distanceScales=this.isGeospatial?rt({latitude:o,longitude:r,scale:this.scale}):y||{pixelsPerMeter:[m,m,m],metersPerPixel:[1/m,1/m,1/m]},this.focalDistance=f,this.distanceScales.metersPerPixel=new Pe.a(this.distanceScales.metersPerPixel),this.distanceScales.pixelsPerMeter=new Pe.a(this.distanceScales.pixelsPerMeter),this.position=xe,this.meterOffset=xe,h&&(this.position=h,this.modelMatrix=d,this.meterOffset=d?d.transformVector(h):h),this.isGeospatial?(this.longitude=r,this.latitude=o,this.center=this._getCenterInWorld({longitude:r,latitude:o}),this.viewMatrixUncentered=u.n([],i,[1,-1,1])):(this.center=h?this.projectPosition(h):[0,0,0],this.viewMatrixUncentered=i),this.viewMatrix=(new je.a).multiplyRight(this.viewMatrixUncentered).translate(new Pe.a(this.center||xe).negate())}},{key:"_getCenterInWorld",value:function(t){var e=t.longitude,i=t.latitude,n=this.meterOffset,r=this.scale,a=this.distanceScales,o=this.projectFlat([e,i],r),s=new Pe.a(o[0],o[1],0);if(n){var c=new Pe.a(n).scale(a.pixelsPerMeter);s.add(c)}return s}},{key:"_initProjectionMatrix",value:function(t){var e=t.projectionMatrix,i=void 0===e?null:e,n=t.orthographic,r=void 0!==n&&n,a=t.fovyRadians,o=t.fovyDegrees,s=t.fovy,c=t.near,u=void 0===c?.1:c,l=t.far,h=void 0===l?1e3:l,p=t.focalDistance,d=void 0===p?1:p,v=t.orthographicFocalDistance,f=a||(o||s||75)*Oe;this.projectionMatrix=i||this._createProjectionMatrix({orthographic:r,fovyRadians:f,aspect:this.width/this.height,focalDistance:v||d,near:u,far:h})}},{key:"_initPixelMatrices",value:function(){var t=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1];u.g(t,t,this.projectionMatrix),u.g(t,t,this.viewMatrix),this.viewProjectionMatrix=t,this.viewMatrixInverse=u.e([],this.viewMatrix)||this.viewMatrix;var e,i,n,a=(e={viewMatrix:this.viewMatrix,viewMatrixInverse:this.viewMatrixInverse},i=e.viewMatrix,{eye:[(n=e.viewMatrixInverse)[12],n[13],n[14]],direction:[i[2],i[6],i[10]],up:[i[1],i[5],i[9]]}),o=a.eye,s=a.direction,c=a.up;this.cameraPosition=o,this.cameraDirection=s,this.cameraUp=c;var l=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],h=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1];u.n(l,l,[this.width/2,-this.height/2,1]),u.o(l,l,[1,-1,0]),u.g(h,l,this.viewProjectionMatrix),this.pixelProjectionMatrix=h,this.viewportMatrix=l,this.pixelUnprojectionMatrix=u.e([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],this.pixelProjectionMatrix),this.pixelUnprojectionMatrix||r.warn("Pixel project matrix not invertible")()}}]),t}();Me.displayName="Viewport";var Ee=Object.seal({layerManager:null,deck:null,gl:null,time:-1,useDevicePixels:!0,stats:null,shaderCache:null,pickingFBO:null,animationProps:null,userData:{}}),Te=function(t){return t instanceof ye?"".concat(t):t?"invalid":"null"},Ce=function(){function t(e){var i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=i.deck,r=i.stats,o=i.viewport,s=void 0===o?null:o;Object(C.a)(this,t),this.lastRenderedLayers=[],this.layers=[],this.context=Object.assign({},Ee,{layerManager:this,deck:n,gl:e,shaderCache:e&&new a.q({gl:e,_cachePrograms:!0}),stats:r||new _e.a({id:"deck.gl"}),viewport:s||new Me({id:"DEFAULT-INITIAL-VIEWPORT"})}),this._needsRedraw="Initial render",this._needsUpdate=!1,this._debug=!1,this.activateViewport=this.activateViewport.bind(this),this._initSeer=this._initSeer.bind(this),this._editSeer=this._editSeer.bind(this),Object.seal(this),Vt(this._initSeer),Nt(this._editSeer)}return Object(L.a)(t,[{key:"finalize",value:function(){Ft.a.removeListener(this._initSeer),Ft.a.removeListener(this._editSeer)}},{key:"needsRedraw",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{clearRedrawFlags:!1};return this._checkIfNeedsRedraw(t)}},{key:"needsUpdate",value:function(){return this._needsUpdate}},{key:"setNeedsRedraw",value:function(t){this._needsRedraw=this._needsRedraw||t}},{key:"setNeedsUpdate",value:function(t){this._needsUpdate=this._needsUpdate||t}},{key:"getLayers",value:function(){var t=(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{}).layerIds,e=void 0===t?null:t;return e?this.layers.filter(function(t){return e.find(function(e){return 0===t.id.indexOf(e)})}):this.layers}},{key:"setProps",value:function(t){"debug"in t&&(this._debug=t.debug),"userData"in t&&(this.context.userData=t.userData),"useDevicePixels"in t&&(this.context.useDevicePixels=t.useDevicePixels),"layers"in t&&this.setLayers(t.layers)}},{key:"setLayers",value:function(t){if(t===this.lastRenderedLayers)return r.log(3,"Ignoring layer update due to layer array not changed")(),this;this.lastRenderedLayers=t,t=be(t,{filter:Boolean});var e=!0,i=!1,n=void 0;try{for(var a,o=t[Symbol.iterator]();!(e=(a=o.next()).done);e=!0){a.value.context=this.context}}catch(l){i=!0,n=l}finally{try{e||null==o.return||o.return()}finally{if(i)throw n}}var s=this._updateLayers({oldLayers:this.layers,newLayers:t}),c=s.error,u=s.generatedLayers;if(this.layers=u,c)throw c;return this}},{key:"updateLayers",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};"time"in t&&(this.context.time=t.time);var e=this.needsUpdate();e&&(this.setNeedsRedraw("updating layers: ".concat(e)),this.setLayers(Object(It.a)(this.lastRenderedLayers)))}},{key:"_checkIfNeedsRedraw",value:function(t){var e=this._needsRedraw;t.clearRedrawFlags&&(this._needsRedraw=!1);var i=!0,n=!1,r=void 0;try{for(var a,o=this.layers[Symbol.iterator]();!(i=(a=o.next()).done);i=!0){var s=a.value.getNeedsRedraw(t);e=e||s}}catch(c){n=!0,r=c}finally{try{i||null==o.return||o.return()}finally{if(n)throw r}}return e}},{key:"activateViewport",value:function(t){var e=this.context.viewport;if(!e||!t.equals(e)){r.log(4,"Viewport changed",t)(),this.context.viewport=t;var i=!0,n=!1,a=void 0;try{for(var o,s=this.layers[Symbol.iterator]();!(i=(o=s.next()).done);i=!0){var c=o.value;c.setChangeFlags({viewportChanged:"Viewport changed"}),this._updateLayer(c)}}catch(u){n=!0,a=u}finally{try{i||null==s.return||s.return()}finally{if(n)throw a}}}return f(this.context.viewport,"LayerManager: viewport not set"),this}},{key:"_updateLayers",value:function(t){var e=t.oldLayers,i=t.newLayers,n={},a=!0,o=!1,s=void 0;try{for(var c,u=e[Symbol.iterator]();!(a=(c=u.next()).done);a=!0){var l=c.value;n[l.id]?r.warn("Multiple old layers with same id ".concat(Te(l)))():n[l.id]=l}}catch(v){o=!0,s=v}finally{try{a||null==u.return||u.return()}finally{if(o)throw s}}var h=[],p=this._updateSublayersRecursively({newLayers:i,oldLayerMap:n,generatedLayers:h}),d=this._finalizeOldLayers(n);return this._needsUpdate=!1,{error:p||d,generatedLayers:h}}},{key:"_updateSublayersRecursively",value:function(t){var e=t.newLayers,i=t.oldLayerMap,n=t.generatedLayers,a=null,o=!0,s=!1,c=void 0;try{for(var u,l=e[Symbol.iterator]();!(o=(u=l.next()).done);o=!0){var h=u.value;h.context=this.context;var p=i[h.id];null===p&&r.warn("Multiple new layers with same id ".concat(Te(h)))(),i[h.id]=null;var d=null;try{if(this._debug&&p!==h&&h.validateProps(),p){this._transferLayerState(p,h);var v=this._updateLayer(h);a=a||v,Bt(h)}else{var f=this._initializeLayer(h);a=a||f,Ut(h)}n.push(h),d=h.isComposite&&h.getSubLayers()}catch(f){r.warn("error during matching of ".concat(Te(h)),f)(),a=a||f}if(d){var g=this._updateSublayersRecursively({newLayers:d,oldLayerMap:i,generatedLayers:n});a=a||g}}}catch(f){s=!0,c=f}finally{try{o||null==l.return||l.return()}finally{if(s)throw c}}return a}},{key:"_finalizeOldLayers",value:function(t){var e=null;for(var i in t){var n=t[i];n&&(e=e||this._finalizeLayer(n))}return e}},{key:"_initializeLayer",value:function(t){r.log(2,"initializing ".concat(Te(t)))();var e=null;try{t._initialize(),t.lifecycle=Jt.INITIALIZED}catch(c){r.warn("error while initializing ".concat(Te(t),"\n"),c)(),e=e||c}t.internalState.layer=t;var i=!0,n=!1,a=void 0;try{for(var o,s=t.getModels()[Symbol.iterator]();!(i=(o=s.next()).done);i=!0){o.value.userData.layer=t}}catch(c){n=!0,a=c}finally{try{i||null==s.return||s.return()}finally{if(n)throw a}}return e}},{key:"_transferLayerState",value:function(t,e){e._transferState(t),e.lifecycle=Jt.MATCHED,e!==t?(r.log(4,"matched ".concat(Te(e)),t,"->",e)(),t.lifecycle=Jt.AWAITING_GC):r.log(4,"Matching layer is unchanged ".concat(e.id))()}},{key:"_updateLayer",value:function(t){r.log(4,"updating ".concat(t," because: ").concat(t.printChangeFlags()))();var e=null;try{t._update()}catch(i){r.warn("error during update of ".concat(Te(t)),i)(),e=i}return e}},{key:"_finalizeLayer",value:function(t){f(t.lifecycle!==Jt.AWAITING_FINALIZATION),t.lifecycle=Jt.AWAITING_FINALIZATION;var e=null;this.setNeedsRedraw("finalized ".concat(Te(t)));try{t._finalize()}catch(i){r.warn("error during finalization of ".concat(Te(t)),i)(),e=i}return t.lifecycle=Jt.FINALIZED,r.log(2,"finalizing ".concat(Te(t)))(),e}},{key:"_initSeer",value:function(){this.layers.forEach(function(t){Ut(t),Bt(t)})}},{key:"_editSeer",value:function(t){var e,i,n;"edit"===t.type&&"props"===t.valuePath[0]&&(e=t.itemKey,i=t.valuePath.slice(1),n=t.value,Ft.a.isReady()&&(zt.has(e)||zt.set(e,new Map),zt.get(e).set(i,n)),this.updateLayers())}}]),t}();!function(t){function e(){return Object(C.a)(this,e),Object(A.a)(this,Object(I.a)(e).apply(this,arguments))}Object(R.a)(e,t),Object(L.a)(e,[{key:"getProjectedLight",value:function(t){var e=t.layer,i=e.context.viewport,n=e.props,r=n.coordinateSystem,a=n.coordinateOrigin,o=j({viewport:i,modelMatrix:n.modelMatrix,coordinateSystem:r,coordinateOrigin:a}).project_uCameraPosition;return this.projectedLight.position=o,this.projectedLight}}])}(function(t){function e(t){var i;return Object(C.a)(this,e),(i=Object(A.a)(this,Object(I.a)(e).call(this,t))).projectedLight=new a.l(t),i}return Object(R.a)(e,t),Object(L.a)(e,[{key:"getProjectedLight",value:function(t){var e=t.layer,i=e.context.viewport,n=e.props,r=n.coordinateSystem,a=n.coordinateOrigin,o=pt(this.position,{viewport:i,coordinateSystem:r,coordinateOrigin:a,fromCoordinateSystem:i.isGeospatial?h.LNGLAT:h.IDENTITY,fromCoordinateOrigin:[0,0,0]});return this.projectedLight.position=o,this.projectedLight}}]),e}(a.l));function Le(t,e){if(null==t)return{};var i,n,r=function(t,e){if(null==t)return{};var i,n,r={},a=Object.keys(t);for(n=0;n<a.length;n++)i=a[n],e.indexOf(i)>=0||(r[i]=t[i]);return r}(t,e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(t);for(n=0;n<a.length;n++)i=a[n],e.indexOf(i)>=0||Object.prototype.propertyIsEnumerable.call(t,i)&&(r[i]=t[i])}return r}var Ae=Math.PI/180,Ie=864e5,Re=2440588,Fe=2451545,ze=23.4397*Ae,De=357.5291,Ne=.98560028,Ve=280.147,Ue=360.9856235;function Be(t,e,i){var n,r,a,o,s,c,u=Ae*-i,l=Ae*e,h=function(t){return function(t){return t/Ie-.5+Re}(t)-Fe}(t),p=(n=Ae*(De+Ne*h),r=Ae*(1.9148*Math.sin(n)+.02*Math.sin(2*n)+3e-4*Math.sin(3*n)),a=n+r+102.9372*Ae+Math.PI,{declination:(o=a,s=0,c=o,Math.asin(Math.sin(s)*Math.cos(ze)+Math.cos(s)*Math.sin(ze)*Math.sin(c))),rightAscension:Ze(a,0)}),d=function(t,e){return Ae*(Ve+Ue*t)-e}(h,u)-p.rightAscension;return{azimuth:Ge(d,l,p.declination),altitude:Xe(d,l,p.declination)}}function Ze(t,e){var i=t;return Math.atan2(Math.sin(i)*Math.cos(ze)-Math.tan(e)*Math.sin(ze),Math.cos(i))}function Ge(t,e,i){var n=t,r=e,a=i;return Math.atan2(Math.sin(n),Math.cos(n)*Math.sin(r)-Math.tan(a)*Math.cos(r))}function Xe(t,e,i){var n=t,r=e,a=i;return Math.asin(Math.sin(r)*Math.sin(a)+Math.cos(r)*Math.cos(a)*Math.cos(n))}!function(t){function e(t){var i,n=t.timestamp,r=Le(t,["timestamp"]);return Object(C.a)(this,e),(i=Object(A.a)(this,Object(I.a)(e).call(this,r))).timestamp=n,i}Object(R.a)(e,t),Object(L.a)(e,[{key:"getProjectedLight",value:function(t){var e=t.layer.context.viewport,i=e.latitude,n=e.longitude;return this.direction=function(t,e,i){var n=Be(t,e,i),r=n.azimuth,a=n.altitude,o=r+Math.PI;return[-Math.sin(o),-Math.cos(o),-Math.sin(a)]}(this.timestamp,i,n),this}}])}(a.d);function We(t,e){return t===e||Object.keys(t).every(function(i){return Array.isArray(t[i])&&Array.isArray(e[i])?We(t[i],e[i]):t[i]===e[i]})}var Ye=/([0-9]+\.?[0-9]*)(%|px)/;function qe(t){switch(Object(Zt.a)(t)){case"number":return{position:t,relative:!1};case"string":var e=t.match(Ye);if(e&&e.length>=3){var i="%"===e[2],n=parseFloat(e[1]);return{position:i?n/100:n,relative:i}}default:throw new Error("Could not parse position string ".concat(t))}}function He(t,e){return t.relative?Math.round(t.position*e):t.position}var Ke=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};Object(C.a)(this,t);var i=e.id,n=void 0===i?null:i,r=e.x,a=void 0===r?0:r,o=e.y,s=void 0===o?0:o,c=e.width,u=void 0===c?"100%":c,l=e.height,h=void 0===l?"100%":l,p=e.projectionMatrix,d=void 0===p?null:p,v=e.fovy,g=void 0===v?50:v,y=e.near,m=void 0===y?.1:y,b=e.far,w=void 0===b?1e3:b,_=e.modelMatrix,k=void 0===_?null:_,j=e.viewportInstance,P=void 0===j?null:j,O=e.type,S=void 0===O?Me:O;f(!P||P instanceof Me),this.viewportInstance=P,this.id=n||this.constructor.displayName||"view",this.type=S,this.props=Object.assign({},e,{projectionMatrix:d,fovy:g,near:m,far:w,modelMatrix:k}),this._parseDimensions({x:a,y:s,width:u,height:h}),this.equals=this.equals.bind(this),Object.seal(this)}return Object(L.a)(t,[{key:"equals",value:function(t){return this===t||(this.viewportInstance?t.viewportInstance&&this.viewportInstance.equals(t.viewportInstance):We(this.props,t.props))}},{key:"makeViewport",value:function(t){var e=t.width,i=t.height,n=t.viewState;if(this.viewportInstance)return this.viewportInstance;n=this.filterViewState(n);var r=this.getDimensions({width:e,height:i}),a=Object.assign({viewState:n},n,this.props,r);return this._getViewport(a)}},{key:"getViewStateId",value:function(){switch(Object(Zt.a)(this.props.viewState)){case"string":return this.props.viewState;case"object":return this.props.viewState&&this.props.viewState.id;default:return this.id}}},{key:"filterViewState",value:function(t){if(this.props.viewState&&"object"===Object(Zt.a)(this.props.viewState)){if(!this.props.viewState.id)return this.props.viewState;var e=Object.assign({},t);for(var i in this.props.viewState)"id"!==i&&(e[i]=this.props.viewState[i]);return e}return t}},{key:"getDimensions",value:function(t){var e=t.width,i=t.height;return{x:He(this._x,e),y:He(this._y,i),width:He(this._width,e),height:He(this._height,i)}}},{key:"_getControllerProps",value:function(t){var e=this.props.controller;return e?!0===e?t:("function"==typeof e&&(e={type:e}),Object.assign({},t,e)):null}},{key:"_getViewport",value:function(t){return new(0,this.type)(t)}},{key:"_parseDimensions",value:function(t){var e=t.x,i=t.y,n=t.width,r=t.height;this._x=qe(e),this._y=qe(i),this._width=qe(n),this._height=qe(r)}}]),t}(),Je=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};Object(C.a)(this,t),this.views=[],this.width=100,this.height=100,this.viewState={},this.controllers={},this._viewports=[],this._viewportMap={},this._isUpdating=!1,this._needsRedraw="Initial render",this._needsUpdate=!0,this._eventManager=e.eventManager,this._eventCallbacks={onViewStateChange:e.onViewStateChange,onInteractiveStateChange:e.onInteractiveStateChange},Object.seal(this),this.setProps(e)}return Object(L.a)(t,[{key:"finalize",value:function(){for(var t in this.controllers)this.controllers[t]&&this.controllers[t].finalize();this.controllers={}}},{key:"needsRedraw",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{clearRedrawFlags:!1},e=this._needsRedraw;return t.clearRedrawFlags&&(this._needsRedraw=!1),e}},{key:"setNeedsUpdate",value:function(t){this._needsUpdate=this._needsUpdate||t,this._needsRedraw=this._needsRedraw||t}},{key:"updateViewStates",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if("time"in t)for(var e in this.controllers){var i=this.controllers[e];i&&i.updateTransition(t.time)}}},{key:"getViewports",value:function(t){return t?this._viewports.filter(function(e){return e.containsPixel(t)}):this._viewports}},{key:"getViews",value:function(){var t={};return this.views.forEach(function(e){t[e.id]=e}),t}},{key:"getView",value:function(t){return"string"==typeof t?this.views.find(function(e){return e.id===t}):t}},{key:"getViewState",value:function(t){var e=this.getView(t),i=e&&this.viewState[e.getViewStateId()]||this.viewState;return e?e.filterViewState(i):i}},{key:"getViewport",value:function(t){return this._viewportMap[t]}},{key:"project",value:function(t){for(var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{topLeft:!0},i=this.getViewports(),n=i.length-1;n>=0;--n){var r=i[n];if(r.contains(t,e))return r.project(t,e)}return null}},{key:"unproject",value:function(t,e){for(var i=this.getViewports(),n=i.length-1;n>=0;--n){var r=i[n];if(r.containsPixel(t,e))return r.unproject(t)}return null}},{key:"setProps",value:function(t){"views"in t&&this._setViews(t.views),"viewState"in t&&this._setViewState(t.viewState),("width"in t||"height"in t)&&this._setSize(t.width,t.height),this._isUpdating||this._update()}},{key:"_update",value:function(){this._isUpdating=!0,this._needsUpdate&&(this._needsUpdate=!1,this._rebuildViewports()),this._needsUpdate&&(this._needsUpdate=!1,this._rebuildViewports()),this._isUpdating=!1}},{key:"_setSize",value:function(t,e){f(Number.isFinite(t)&&Number.isFinite(e)),t===this.width&&e===this.height||(this.width=t,this.height=e,this.setNeedsUpdate("Size changed"))}},{key:"_setViews",value:function(t){t=be(t,{filter:Boolean}).map(function(t){return t instanceof Me?new Ke({viewportInstance:t}):t}),this._diffViews(t,this.views)&&this.setNeedsUpdate("views changed"),this.views=t}},{key:"_setViewState",value:function(t){t?(!We(t,this.viewState)&&this.setNeedsUpdate("viewState changed"),this.viewState=t):r.warn("setting null viewState")()}},{key:"_onViewStateChange",value:function(t,e){e.viewId=t,this._eventCallbacks.onViewStateChange(e)}},{key:"_createController",value:function(t){return new(0,t.type)(Object.assign({eventManager:this._eventManager,onViewStateChange:this._onViewStateChange.bind(this,t.id),onStateChange:this._eventCallbacks.onInteractiveStateChange},t))}},{key:"_updateController",value:function(t,e,i,n){if(t.controller){var r=Object.assign({},t.controller,e,{id:t.id,x:i.x,y:i.y,width:i.width,height:i.height});return n?n.setProps(r):n=this._createController(r),n}return null}},{key:"_rebuildViewports",value:function(){var t=this,e=this.width,i=this.height,n=this.views,r=this.controllers;for(var a in this.controllers={},this._viewports=n.map(function(n){var a=t.getViewState(n),o=n.makeViewport({width:e,height:i,viewState:a});return t.controllers[n.id]=t._updateController(n,a,o,r[n.id]),o}),r)r[a]&&!this.controllers[a]&&r[a].finalize();this._buildViewportMap()}},{key:"_buildViewportMap",value:function(){var t=this;this._viewportMap={},this._viewports.forEach(function(e){e.id&&(t._viewportMap[e.id]=t._viewportMap[e.id]||e)})}},{key:"_diffViews",value:function(t,e){return t.length!==e.length||t.some(function(i,n){return!t[n].equals(e[n])})}}]),t}(),Qe=i(209),$e=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],ti=function(t){function e(){var t,i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=i.width,r=i.height,a=i.latitude,o=void 0===a?0:a,s=i.longitude,c=void 0===s?0:s,l=i.zoom,h=void 0===l?0:l,p=i.pitch,d=void 0===p?0:p,v=i.bearing,f=void 0===v?0:v,g=i.altitude,y=void 0===g?1.5:g,m=i.nearZMultiplier,b=i.farZMultiplier;Object(C.a)(this,e),n=n||1,r=r||1;var w=tt(h);y=Math.max(.75,y);var _=it([c,o],w);_[2]=0;var k=function(t){var e=t.width,i=t.height,n=t.pitch,r=st({width:e,height:i,altitude:t.altitude,pitch:n,nearZMultiplier:t.nearZMultiplier,farZMultiplier:t.farZMultiplier}),a=r.fov,o=r.aspect,s=r.near,c=r.far;return u.i([],a,o,s,c)}({width:n,height:r,pitch:d,bearing:f,altitude:y,nearZMultiplier:m||1/r,farZMultiplier:b||1.01}),j=ot({height:r,center:_,pitch:d,bearing:f,altitude:y,flipY:!0});return(t=Object(A.a)(this,Object(I.a)(e).call(this,{width:n,height:r,viewMatrix:j,projectionMatrix:k}))).latitude=o,t.longitude=c,t.zoom=h,t.pitch=d,t.bearing=f,t.altitude=y,t.scale=w,t.center=_,t.pixelsPerMeter=rt(Object(Qe.a)(Object(Qe.a)(t))).pixelsPerMeter[2],Object.freeze(Object(Qe.a)(Object(Qe.a)(t))),t}return Object(R.a)(e,t),Object(L.a)(e,[{key:"projectFlat",value:function(t){return it(t,arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.scale)}},{key:"unprojectFlat",value:function(t){return nt(t,arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.scale)}},{key:"getMapCenterByLngLatPosition",value:function(t){var e=t.lngLat,i=ut(t.pos,this.pixelUnprojectionMatrix),n=it(e,this.scale),r=X.a([],n,X.e([],i));return nt(X.a([],this.center,r),this.scale)}},{key:"getLocationAtPoint",value:function(t){var e=t.lngLat,i=t.pos;return this.getMapCenterByLngLatPosition({lngLat:e,pos:i})}},{key:"fitBounds",value:function(t){var i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=this.width,r=this.height,a=ei(Object.assign({width:n,height:r,bounds:t},i));return new e({width:n,height:r,longitude:a.longitude,latitude:a.latitude,zoom:a.zoom})}}]),e}(function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},i=e.width,n=e.height,r=e.viewMatrix,a=void 0===r?$e:r,o=e.projectionMatrix,s=void 0===o?$e:o;Object(C.a)(this,t),this.width=i||1,this.height=n||1,this.scale=1,this.pixelsPerMeter=1,this.viewMatrix=a,this.projectionMatrix=s;var c=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1];u.g(c,c,this.projectionMatrix),u.g(c,c,this.viewMatrix),this.viewProjectionMatrix=c;var l=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1];u.n(l,l,[this.width/2,-this.height/2,1]),u.o(l,l,[1,-1,0]),u.g(l,l,this.viewProjectionMatrix);var h=u.e([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],l);if(!h)throw new Error("Pixel project matrix not invertible");this.pixelProjectionMatrix=l,this.pixelUnprojectionMatrix=h,this.equals=this.equals.bind(this),this.project=this.project.bind(this),this.unproject=this.unproject.bind(this),this.projectPosition=this.projectPosition.bind(this),this.unprojectPosition=this.unprojectPosition.bind(this),this.projectFlat=this.projectFlat.bind(this),this.unprojectFlat=this.unprojectFlat.bind(this)}return Object(L.a)(t,[{key:"equals",value:function(e){return e instanceof t&&(e.width===this.width&&e.height===this.height&&u.b(e.projectionMatrix,this.projectionMatrix)&&u.b(e.viewMatrix,this.viewMatrix))}},{key:"project",value:function(t){var e=(arguments.length>1&&void 0!==arguments[1]?arguments[1]:{}).topLeft,i=void 0===e||e,n=ct(this.projectPosition(t),this.pixelProjectionMatrix),r=Object(U.a)(n,2),a=r[0],o=r[1],s=i?o:this.height-o;return 2===t.length?[a,s]:[a,s,n[2]]}},{key:"unproject",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},i=e.topLeft,n=void 0===i||i,r=e.targetZ,a=Object(U.a)(t,3),o=a[0],s=a[1],c=a[2],u=n?s:this.height-s,l=r&&r*this.pixelsPerMeter,h=ut([o,u,c],this.pixelUnprojectionMatrix,l),p=this.unprojectPosition(h),d=Object(U.a)(p,3),v=d[0],f=d[1],g=d[2];return Number.isFinite(c)?[v,f,g]:Number.isFinite(r)?[v,f,r]:[v,f]}},{key:"projectPosition",value:function(t){var e=this.projectFlat(t),i=Object(U.a)(e,2);return[i[0],i[1],(t[2]||0)*this.pixelsPerMeter]}},{key:"unprojectPosition",value:function(t){var e=this.unprojectFlat(t),i=Object(U.a)(e,2);return[i[0],i[1],(t[2]||0)/this.pixelsPerMeter]}},{key:"projectFlat",value:function(t){arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.scale;return t}},{key:"unprojectFlat",value:function(t){arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.scale;return t}}]),t}());function ei(t){var e=t.width,i=t.height,n=t.bounds,r=t.padding,a=void 0===r?0:r,o=t.offset,s=void 0===o?[0,0]:o,c=Object(U.a)(n,2),u=Object(U.a)(c[0],2),l=u[0],h=u[1],p=Object(U.a)(c[1],2),d=p[0],v=p[1];if(Number.isFinite(a)){a={top:a,bottom:a,left:a,right:a}}else W(Number.isFinite(a.top)&&Number.isFinite(a.bottom)&&Number.isFinite(a.left)&&Number.isFinite(a.right));var f=new ti({width:e,height:i,longitude:0,latitude:0,zoom:0}),g=f.project([l,v]),y=f.project([d,h]),m=[Math.abs(y[0]-g[0]),Math.abs(y[1]-g[1])],b=[e-a.left-a.right-2*Math.abs(s[0]),i-a.top-a.bottom-2*Math.abs(s[1])];W(b[0]>0&&b[1]>0);var w=b[0]/m[0],_=b[1]/m[1],k=(a.right-a.left)/2/w,j=(a.bottom-a.top)/2/_,P=[(y[0]+g[0])/2+k,(y[1]+g[1])/2+j],O=f.unproject(P),S=f.zoom+Math.log2(Math.abs(Math.min(w,_)));return{longitude:O[0],latitude:O[1],zoom:S}}var ii=function(t){function e(){var t,i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};Object(C.a)(this,e);var n=i.latitude,r=void 0===n?0:n,a=i.longitude,o=void 0===a?0:a,s=i.zoom,c=void 0===s?11:s,u=i.pitch,l=void 0===u?0:u,h=i.bearing,p=void 0===h?0:h,d=i.nearZMultiplier,v=void 0===d?.1:d,f=i.farZMultiplier,g=void 0===f?10:f,y=i.orthographic,m=void 0!==y&&y,b=i.width,w=i.height,_=i.altitude,k=void 0===_?1.5:_,j=st({width:b=b||1,height:w=w||1,pitch:l,altitude:k=Math.max(.75,k),nearZMultiplier:v,farZMultiplier:g}),P=j.fov,O=j.aspect,S=j.focalDistance,x=j.near,M=j.far,E=ot({height:w,pitch:l,bearing:p,altitude:k}),T=i.position&&[i.position[0],i.position[1],0],L=Object.assign({},i,{width:b,height:w,viewMatrix:E,longitude:o,latitude:r,zoom:c,position:T,orthographic:m,fovyRadians:P,aspect:O,orthographicFocalDistance:S,near:x,far:M});return(t=Object(A.a)(this,Object(I.a)(e).call(this,L))).latitude=r,t.longitude=o,t.zoom=c,t.pitch=l,t.bearing=p,t.altitude=k,t.orthographic=m,t.metersToLngLatDelta=t.metersToLngLatDelta.bind(Object(Qe.a)(Object(Qe.a)(t))),t.lngLatDeltaToMeters=t.lngLatDeltaToMeters.bind(Object(Qe.a)(Object(Qe.a)(t))),t.addMetersToLngLat=t.addMetersToLngLat.bind(Object(Qe.a)(Object(Qe.a)(t))),Object.freeze(Object(Qe.a)(Object(Qe.a)(t))),t}return Object(R.a)(e,t),Object(L.a)(e,[{key:"metersToLngLatDelta",value:function(t){var e=Object(U.a)(t,3),i=e[0],n=e[1],r=e[2],a=void 0===r?0:r;f(Number.isFinite(i)&&Number.isFinite(n)&&Number.isFinite(a),"Illegal argument to WebMercatorViewport");var o=this.distanceScales,s=o.pixelsPerMeter,c=o.degreesPerPixel,u=i*s[0]*c[0],l=n*s[1]*c[1];return 2===t.length?[u,l]:[u,l,a]}},{key:"lngLatDeltaToMeters",value:function(t){var e=Object(U.a)(t,3),i=e[0],n=e[1],r=e[2],a=void 0===r?0:r;f(Number.isFinite(i)&&Number.isFinite(n)&&Number.isFinite(a),"Illegal argument to WebMercatorViewport");var o=this.distanceScales,s=o.pixelsPerDegree,c=o.metersPerPixel,u=i*s[0]*c[0],l=n*s[1]*c[1];return 2===t.length?[u,l]:[u,l,a]}},{key:"addMetersToLngLat",value:function(t,e){return at(t,e)}},{key:"getMapCenterByLngLatPosition",value:function(t){var e=t.lngLat,i=ut(t.pos,this.pixelUnprojectionMatrix),n=this.projectFlat(e),r=X.a([],n,X.e([],i)),a=X.a([],this.center,r);return this.unprojectFlat(a)}},{key:"getLocationAtPoint",value:function(t){var e=t.lngLat,i=t.pos;return this.getMapCenterByLngLatPosition({lngLat:e,pos:i})}},{key:"fitBounds",value:function(t){var i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=this.width,r=this.height,a=ei(Object.assign({width:n,height:r,bounds:t},i));return new e({width:n,height:r,longitude:a.longitude,latitude:a.latitude,zoom:a.zoom})}}]),e}(Me);ii.displayName="WebMercatorViewport";var ni=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};Object(C.a)(this,t),Array.isArray(e)&&(e={compare:e,extract:e,required:e});var i=e,n=i.compare,r=i.extract,a=i.required;this._propsToCompare=n,this._propsToExtract=r,this._requiredProps=a}return Object(L.a)(t,[{key:"arePropsEqual",value:function(t,e){var i=!0,n=!1,r=void 0;try{for(var a,o=(this._propsToCompare||Object.keys(e))[Symbol.iterator]();!(i=(a=o.next()).done);i=!0){var s=a.value;if(!Object(ke.e)(t[s],e[s]))return!1}}catch(c){n=!0,r=c}finally{try{i||null==o.return||o.return()}finally{if(n)throw r}}return!0}},{key:"initializeProps",value:function(t,e){var i;if(this._propsToExtract){var n={},r={},a=!0,o=!1,s=void 0;try{for(var c,u=this._propsToExtract[Symbol.iterator]();!(a=(c=u.next()).done);a=!0){var l=c.value;n[l]=t[l],r[l]=e[l]}}catch(h){o=!0,s=h}finally{try{a||null==u.return||u.return()}finally{if(o)throw s}}i={start:n,end:r}}else i={start:t,end:e};return this._checkRequiredProps(i.start),this._checkRequiredProps(i.end),i}},{key:"interpolateProps",value:function(t,e,i){f(!1,"interpolateProps is not implemented")}},{key:"_checkRequiredProps",value:function(t){this._requiredProps&&this._requiredProps.forEach(function(e){var i=t[e];f(Number.isFinite(i)||Array.isArray(i),"".concat(e," is required for transition"))})}}]),t}(),ri=["longitude","latitude","zoom","bearing","pitch"],ai=function(t){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:ri;return Object(C.a)(this,e),Object(A.a)(this,Object(I.a)(e).call(this,t))}return Object(R.a)(e,t),Object(L.a)(e,[{key:"interpolateProps",value:function(t,e,i){var n={};for(var r in e)n[r]=Object(ke.g)(t[r],e[r],i);return n}}]),e}(ni),oi=function(){},si=1,ci=2,ui=3,li={transitionDuration:0,transitionEasing:function(t){return t},transitionInterpolator:new ai,transitionInterruption:si,onTransitionStart:oi,onTransitionInterrupt:oi,onTransitionEnd:oi},hi=function(){function t(e){var i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};Object(C.a)(this,t),f(e),this.ControllerState=e,this.props=Object.assign({},li,i),this.propsInTransition=null,this.time=0,this.transition=new xt,this.onViewStateChange=i.onViewStateChange,this._onTransitionUpdate=this._onTransitionUpdate.bind(this)}return Object(L.a)(t,[{key:"finalize",value:function(){}},{key:"getViewportInTransition",value:function(){return this.propsInTransition}},{key:"processViewStateChange",value:function(t){var e=!1,i=this.props;if(t=Object.assign({},li,t),this.props=t,this._shouldIgnoreViewportChange(i,t))return e;if(this._isTransitionEnabled(t)){var n=Object.assign({},i,this.transition.interruption===ci?this.transition.endProps:this.propsInTransition||i);this._triggerTransition(n,t),e=!0}else this.transition.cancel();return e}},{key:"updateTransition",value:function(t){this.time=t,this._updateTransition()}},{key:"_isTransitionEnabled",value:function(t){return t.transitionDuration>0&&t.transitionInterpolator}},{key:"_isUpdateDueToCurrentTransition",value:function(t){return!!this.transition.inProgress&&this.transition.interpolator.arePropsEqual(t,this.propsInTransition)}},{key:"_shouldIgnoreViewportChange",value:function(t,e){return this.transition.inProgress?this.transition.interruption===ui||this._isUpdateDueToCurrentTransition(e):!this._isTransitionEnabled(e)||e.transitionInterpolator.arePropsEqual(t,e)}},{key:"_triggerTransition",value:function(t,e){f(this._isTransitionEnabled(e),"Transition is not enabled");var i=new this.ControllerState(t),n=new this.ControllerState(e).shortestPathFrom(i),r=e.transitionInterpolator.initializeProps(t,n);this.propsInTransition={},this.transition.start({duration:e.transitionDuration,easing:e.transitionEasing,interpolator:e.transitionInterpolator,interruption:e.transitionInterruption,startProps:r.start,endProps:r.end,onStart:e.onTransitionStart,onUpdate:this._onTransitionUpdate,onInterrupt:this._onTransitionEnd(e.onTransitionInterrupt),onEnd:this._onTransitionEnd(e.onTransitionEnd)}),this._updateTransition()}},{key:"_updateTransition",value:function(){this.transition.update(this.time)}},{key:"_onTransitionEnd",value:function(t){var e=this;return function(i){e.propsInTransition=null,t(i)}}},{key:"_onTransitionUpdate",value:function(t){var e=t.interpolator,i=t.startProps,n=t.endProps,r=t.time,a=e.interpolateProps(i,n,r);this.propsInTransition=new this.ControllerState(Object.assign({},this.props,a)).getViewportProps(),this.onViewStateChange&&this.onViewStateChange({viewState:this.propsInTransition,interactionState:{inTransition:!0}})}}]),t}();hi.defaultProps=li;var pi={transitionDuration:0},di=["wheel"],vi=["panstart","panmove","panend"],fi=["pinchstart","pinchmove","pinchend"],gi=["doubletap"],yi=["keydown"],mi=function(){function t(e){var i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};Object(C.a)(this,t),f(e),this.ControllerState=e,this.controllerState=null,this.controllerStateProps=null,this.eventManager=null,this.transitionManager=new hi(e,i),this._events=null,this._state={isDragging:!1},this.events=[],this.onViewStateChange=null,this.onStateChange=null,this.invertPan=!1,this.handleEvent=this.handleEvent.bind(this),this.setProps(i)}return Object(L.a)(t,[{key:"finalize",value:function(){for(var t in this._events)this._events[t]&&this.eventManager.off(t,this.handleEvent);this.transitionManager.finalize()}},{key:"handleEvent",value:function(t){var e=this.ControllerState;switch(this.controllerState=new e(Object.assign({},this.controllerStateProps,this._state)),t.type){case"panstart":return this._onPanStart(t);case"panmove":return this._onPan(t);case"panend":return this._onPanEnd(t);case"pinchstart":return this._onPinchStart(t);case"pinchmove":return this._onPinch(t);case"pinchend":return this._onPinchEnd(t);case"doubletap":return this._onDoubleTap(t);case"wheel":return this._onWheel(t);case"keydown":return this._onKeyDown(t);default:return!1}}},{key:"getCenter",value:function(t){var e=this.controllerStateProps,i=e.x,n=e.y,r=t.offsetCenter;return[r.x-i,r.y-n]}},{key:"isPointInBounds",value:function(t){var e=this.controllerStateProps,i=e.width,n=e.height;return t[0]>=0&&t[0]<=i&&t[1]>=0&&t[1]<=n}},{key:"isFunctionKeyPressed",value:function(t){var e=t.srcEvent;return Boolean(e.metaKey||e.altKey||e.ctrlKey||e.shiftKey)}},{key:"isDragging",value:function(){return this._state.isDragging}},{key:"setProps",value:function(t){"onViewportChange"in t&&r.removed("onViewportChange")(),"onViewStateChange"in t&&(this.onViewStateChange=t.onViewStateChange),"onStateChange"in t&&(this.onStateChange=t.onStateChange),this.controllerStateProps=t,"eventManager"in t&&this.eventManager!==t.eventManager&&(this.eventManager=t.eventManager,this._events={},this.toggleEvents(this.events,!0)),this.transitionManager.processViewStateChange(this.controllerStateProps);var e=t.scrollZoom,i=void 0===e||e,n=t.dragPan,a=void 0===n||n,o=t.dragRotate,s=void 0===o||o,c=t.doubleClickZoom,u=void 0===c||c,l=t.touchZoom,h=void 0===l||l,p=t.touchRotate,d=void 0!==p&&p,v=t.keyboard,f=void 0===v||v,g=Boolean(this.onViewStateChange);this.toggleEvents(di,g&&i),this.toggleEvents(vi,g&&(a||s)),this.toggleEvents(fi,g&&(h||d)),this.toggleEvents(gi,g&&u),this.toggleEvents(yi,g&&f),this.scrollZoom=i,this.dragPan=a,this.dragRotate=s,this.doubleClickZoom=u,this.touchZoom=h,this.touchRotate=d,this.keyboard=f}},{key:"updateTransition",value:function(t){this.transitionManager.updateTransition(t)}},{key:"toggleEvents",value:function(t,e){var i=this;this.eventManager&&t.forEach(function(t){i._events[t]!==e&&(i._events[t]=e,e?i.eventManager.on(t,i.handleEvent):i.eventManager.off(t,i.handleEvent))})}},{key:"setOptions",value:function(t){return this.setProps(t)}},{key:"updateViewport",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},n=Object.assign({},t.getViewportProps(),e);if(this.controllerState!==t){var r=this.controllerState?this.controllerState.getViewportProps():null;this.onViewStateChange&&this.onViewStateChange({viewState:n,interactionState:i,oldViewState:r})}Object.assign(this._state,Object.assign({},t.getInteractiveState(),i)),this.onStateChange&&this.onStateChange(this._state)}},{key:"_onPanStart",value:function(t){var e=this.getCenter(t);if(!this.isPointInBounds(e))return!1;var i=this.controllerState.panStart({pos:e}).rotateStart({pos:e});return this.updateViewport(i,pi,{isDragging:!0})}},{key:"_onPan",value:function(t){var e=this.isFunctionKeyPressed(t)||t.rightButton;return(e=this.invertPan?!e:e)?this._onPanMove(t):this._onPanRotate(t)}},{key:"_onPanEnd",value:function(t){var e=this.controllerState.panEnd().rotateEnd();return this.updateViewport(e,null,{isDragging:!1})}},{key:"_onPanMove",value:function(t){if(!this.dragPan)return!1;var e=this.getCenter(t);if(!this.isDragging())return!1;var i=this.controllerState.pan({pos:e});return this.updateViewport(i,pi,{isDragging:!0})}},{key:"_onPanRotate",value:function(t){if(!this.dragRotate)return!1;var e=t.deltaX,i=t.deltaY,n=this.controllerState.getViewportProps(),r=e/n.width,a=i/n.height,o=this.controllerState.rotate({deltaScaleX:r,deltaScaleY:a});return this.updateViewport(o,pi,{isDragging:!0})}},{key:"_onWheel",value:function(t){if(!this.scrollZoom)return!1;t.preventDefault();var e=this.getCenter(t);if(!this.isPointInBounds(e))return!1;var i=t.delta,n=2/(1+Math.exp(-Math.abs(.01*i)));i<0&&0!==n&&(n=1/n);var r=this.controllerState.zoom({pos:e,scale:n});return this.updateViewport(r,pi)}},{key:"_onPinchStart",value:function(t){var e=this.getCenter(t);if(!this.isPointInBounds(e))return!1;var i=this.controllerState.zoomStart({pos:e}).rotateStart({pos:e});return this._state.startPinchRotation=t.rotation,this.updateViewport(i,pi,{isDragging:!0})}},{key:"_onPinch",value:function(t){if(!this.touchZoom&&!this.touchRotate)return!1;var e=this.controllerState;if(this.touchZoom){var i=t.scale,n=this.getCenter(t);e=e.zoom({pos:n,scale:i})}if(this.touchRotate){var r=t.rotation,a=this._state.startPinchRotation;e=e.rotate({deltaScaleX:-(r-a)/180})}return this.updateViewport(e,pi,{isDragging:!0})}},{key:"_onPinchEnd",value:function(t){var e=this.controllerState.zoomEnd().rotateEnd();return this._state.startPinchRotation=0,this.updateViewport(e,null,{isDragging:!1})}},{key:"_onDoubleTap",value:function(t){if(!this.doubleClickZoom)return!1;var e=this.getCenter(t);if(!this.isPointInBounds(e))return!1;var i=this.isFunctionKeyPressed(t),n=this.controllerState.zoom({pos:e,scale:i?.5:2});return this.updateViewport(n,this._getTransitionProps())}},{key:"_onKeyDown",value:function(t){if(!this.keyboard)return!1;var e,i=this.isFunctionKeyPressed(t),n=this.controllerState;switch(t.srcEvent.keyCode){case 189:e=i?n.zoomOut().zoomOut():n.zoomOut();break;case 187:e=i?n.zoomIn().zoomIn():n.zoomIn();break;case 37:e=i?n.rotateLeft():n.moveLeft();break;case 39:e=i?n.rotateRight():n.moveRight();break;case 38:e=i?n.rotateUp():n.moveUp();break;case 40:e=i?n.rotateDown():n.moveDown();break;default:return!1}return this.updateViewport(e,this._getTransitionProps())}},{key:"_getTransitionProps",value:function(){return pi}}]),t}(),bi=6371e3,wi=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},i=e.phi,n=e.theta,r=e.radius,a=e.bearing,o=e.pitch,s=(e.altitude,e.radiusScale),c=void 0===s?bi:s;Object(C.a)(this,t),0===arguments.length?(this.phi=0,this.theta=0,this.radius=1):Number.isFinite(i)||Number.isFinite(n)?(this.phi=i||0,this.theta=n||0):(Number.isFinite(a)||Number.isFinite(o))&&(this.bearing=a||0,this.pitch=o||0),this.radius=r||1,this.radiusScale=c||1,this.check()}return Object(L.a)(t,[{key:"toString",value:function(){return this.formatString(ke.c)}},{key:"formatString",value:function(t){var e=t.printTypes,i=(t.printDegrees,ke.f);return"".concat(e?"Spherical":"","[rho:").concat(i(this.radius),",theta:").concat(i(this.theta),",phi:").concat(i(this.phi),"]")}},{key:"equals",value:function(t){return Object(ke.e)(this.radius,t.radius)&&Object(ke.e)(this.theta,t.theta)&&Object(ke.e)(this.phi,t.phi)}},{key:"exactEquals",value:function(t){return this.radius===t.radius&&this.theta===t.theta&&this.phi===t.phi}},{key:"set",value:function(t,e,i){return this.radius=t,this.phi=e,this.theta=i,this.check()}},{key:"clone",value:function(){return(new this.constructor).copy(this)}},{key:"copy",value:function(t){return this.radius=t.radius,this.phi=t.phi,this.theta=t.theta,this.check()}},{key:"fromLngLatZ",value:function(t){var e=Object(U.a)(t,3),i=e[0],n=e[1],r=e[2];this.radius=1+r/this.radiusScale,this.phi=Object(ke.h)(n),this.theta=Object(ke.h)(i)}},{key:"fromVector3",value:function(t){return this.radius=B.g(t),0===this.radius?(this.theta=0,this.phi=0):(this.theta=Math.atan2(t[0],t[1]),this.phi=Math.acos(Object(ke.b)(t[2]/this.radius,-1,1))),this.check()}},{key:"toVector3",value:function(){return new Pe.a(0,0,this.radius).rotateX({radians:this.theta}).rotateZ({radians:this.phi})}},{key:"makeSafe",value:function(){this.phi=Math.max(1e-6,Math.min(Math.PI-1e-6,this.phi))}},{key:"check",value:function(){if(!(Number.isFinite(this.phi)&&Number.isFinite(this.theta)&&this.radius>0))throw new Error("SphericalCoordinates: some fields set to invalid numbers");return this}},{key:"bearing",get:function(){return 180-Object(ke.d)(this.phi)},set:function(t){this.phi=Math.PI-Object(ke.h)(t)}},{key:"pitch",get:function(){return Object(ke.d)(this.theta)},set:function(t){this.theta=Object(ke.h)(t)}},{key:"longitude",get:function(){return Object(ke.d)(this.phi)}},{key:"latitude",get:function(){return Object(ke.d)(this.theta)}},{key:"lng",get:function(){return Object(ke.d)(this.phi)}},{key:"lat",get:function(){return Object(ke.d)(this.theta)}},{key:"z",get:function(){return(this.radius-1)*this.radiusScale}}]),t}(),_i={position:[0,0,0],lookAt:[0,0,0],up:[0,0,1],rotationX:0,rotationY:0,fov:50,near:1,far:100},ki=function(){function t(e){Object(C.a)(this,t);var i=e.width,n=e.height,r=e.position,a=void 0===r?_i.position:r;f(Number.isFinite(i),"`width` must be supplied"),f(Number.isFinite(n),"`height` must be supplied"),this._viewportProps=this._applyConstraints(Object.assign({},e,{position:new Pe.a(a)}))}return Object(L.a)(t,[{key:"getViewportProps",value:function(){return this._viewportProps}},{key:"getDirection",value:function(){return new wi({bearing:this._viewportProps.bearing,pitch:this._viewportProps.pitch}).toVector3().normalize()}},{key:"getDirectionFromBearing",value:function(t){return new wi({bearing:t,pitch:90}).toVector3().normalize()}},{key:"shortestPathFrom",value:function(t){return this._viewportProps}},{key:"_applyConstraints",value:function(t){return t}}]),t}(),ji=85.05113,Pi=-85.05113;var Oi={transitionDuration:300,transitionEasing:function(t){return t},transitionInterpolator:new ai,transitionInterruption:si},Si={transitionDuration:0},xi={minZoom:0,maxZoom:20,minPitch:0,maxPitch:60},Mi={pitch:0,bearing:0,altitude:1.5},Ei=function(t){function e(){var t,i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=i.width,r=i.height,a=i.latitude,o=i.longitude,s=i.zoom,c=i.bearing,u=void 0===c?Mi.bearing:c,l=i.pitch,h=void 0===l?Mi.pitch:l,p=i.altitude,d=void 0===p?Mi.altitude:p,v=i.maxZoom,g=void 0===v?xi.maxZoom:v,y=i.minZoom,m=void 0===y?xi.minZoom:y,b=i.maxPitch,w=void 0===b?xi.maxPitch:b,_=i.minPitch,k=void 0===_?xi.minPitch:_,j=i.startPanLngLat,P=i.startZoomLngLat,O=i.startBearing,S=i.startPitch,x=i.startZoom;return Object(C.a)(this,e),f(Number.isFinite(o),"`longitude` must be supplied"),f(Number.isFinite(a),"`latitude` must be supplied"),f(Number.isFinite(s),"`zoom` must be supplied"),(t=Object(A.a)(this,Object(I.a)(e).call(this,{width:n,height:r,latitude:a,longitude:o,zoom:s,bearing:u,pitch:h,altitude:d,maxZoom:g,minZoom:m,maxPitch:w,minPitch:k})))._interactiveState={startPanLngLat:j,startZoomLngLat:P,startBearing:O,startPitch:S,startZoom:x},t}return Object(R.a)(e,t),Object(L.a)(e,[{key:"getViewportProps",value:function(){return this._viewportProps}},{key:"getInteractiveState",value:function(){return this._interactiveState}},{key:"panStart",value:function(t){var e=t.pos;return this._getUpdatedState({startPanLngLat:this._unproject(e)})}},{key:"pan",value:function(t){var e=t.pos,i=t.startPos,n=this._interactiveState.startPanLngLat||this._unproject(i);if(!n)return this;var r=this._calculateNewLngLat({startPanLngLat:n,pos:e}),a=Object(U.a)(r,2),o=a[0],s=a[1];return this._getUpdatedState({longitude:o,latitude:s})}},{key:"panEnd",value:function(){return this._getUpdatedState({startPanLngLat:null})}},{key:"rotateStart",value:function(t){t.pos;return this._getUpdatedState({startBearing:this._viewportProps.bearing,startPitch:this._viewportProps.pitch})}},{key:"rotate",value:function(t){var e=t.deltaScaleX,i=void 0===e?0:e,n=t.deltaScaleY,r=void 0===n?0:n,a=this._interactiveState,o=a.startBearing,s=a.startPitch;if(!Number.isFinite(o)||!Number.isFinite(s))return this;var c=this._calculateNewPitchAndBearing({deltaScaleX:i,deltaScaleY:r,startBearing:o,startPitch:s}),u=c.pitch,l=c.bearing;return this._getUpdatedState({bearing:l,pitch:u})}},{key:"rotateEnd",value:function(){return this._getUpdatedState({startBearing:null,startPitch:null})}},{key:"zoomStart",value:function(t){var e=t.pos;return this._getUpdatedState({startZoomLngLat:this._unproject(e),startZoom:this._viewportProps.zoom})}},{key:"zoom",value:function(t){var e=t.pos,i=t.startPos,n=t.scale;f(n>0,"`scale` must be a positive number");var r=this._interactiveState,a=r.startZoom,o=r.startZoomLngLat;Number.isFinite(a)||(a=this._viewportProps.zoom,o=this._unproject(i)||this._unproject(e)),f(o,"`startZoomLngLat` prop is required for zoom behavior to calculate where to position the map.");var s=this._calculateNewZoom({scale:n,startZoom:a}),c=new ti(Object.assign({},this._viewportProps,{zoom:s})).getLocationAtPoint({lngLat:o,pos:e}),u=Object(U.a)(c,2),l=u[0],h=u[1];return this._getUpdatedState({zoom:s,longitude:l,latitude:h})}},{key:"zoomEnd",value:function(){return this._getUpdatedState({startZoomLngLat:null,startZoom:null})}},{key:"zoomIn",value:function(){return this._zoomFromCenter(2)}},{key:"zoomOut",value:function(){return this._zoomFromCenter(.5)}},{key:"moveLeft",value:function(){return this._panFromCenter([100,0])}},{key:"moveRight",value:function(){return this._panFromCenter([-100,0])}},{key:"moveUp",value:function(){return this._panFromCenter([0,100])}},{key:"moveDown",value:function(){return this._panFromCenter([0,-100])}},{key:"rotateLeft",value:function(){return this._getUpdatedState({bearing:this._viewportProps.bearing-15})}},{key:"rotateRight",value:function(){return this._getUpdatedState({bearing:this._viewportProps.bearing+15})}},{key:"rotateUp",value:function(){return this._getUpdatedState({pitch:this._viewportProps.pitch+10})}},{key:"rotateDown",value:function(){return this._getUpdatedState({pitch:this._viewportProps.pitch-10})}},{key:"shortestPathFrom",value:function(t){var e=t.getViewportProps(),i=Object.assign({},this._viewportProps),n=i.bearing,r=i.longitude;return Math.abs(n-e.bearing)>180&&(i.bearing=n<0?n+360:n-360),Math.abs(r-e.longitude)>180&&(i.longitude=r<0?r+360:r-360),i}},{key:"_zoomFromCenter",value:function(t){var e=this._viewportProps,i=e.width,n=e.height;return this.zoom({pos:[i/2,n/2],scale:t})}},{key:"_panFromCenter",value:function(t){var e=this._viewportProps,i=e.width,n=e.height;return this.pan({startPos:[i/2,n/2],pos:[i/2+t[0],n/2+t[1]]})}},{key:"_getUpdatedState",value:function(t){return new e(Object.assign({},this._viewportProps,this._interactiveState,t))}},{key:"_applyConstraints",value:function(t){var e=t.maxZoom,i=t.minZoom,n=t.zoom;t.zoom=Object(ke.b)(n,i,e);var r=t.maxPitch,a=t.minPitch,o=t.pitch;return t.pitch=Object(ke.b)(o,a,r),Object.assign(t,function(t){var e=t.width,i=t.height,n=t.longitude,r=t.latitude,a=t.zoom,o=t.pitch,s=void 0===o?0:o,c=t.bearing,u=void 0===c?0:c;(n<-180||n>180)&&(n=G(n+180,360)-180),(u<-180||u>180)&&(u=G(u+180,360)-180);var l=new ti({width:e,height:i,longitude:n,latitude:r,zoom:a}),h=l.project([n,ji])[1],p=l.project([n,Pi])[1],d=0;return p-h<i&&(a+=Math.log2(i/(p-h)),h=(l=new ti({width:e,height:i,longitude:n,latitude:r,zoom:a})).project([n,ji])[1],p=l.project([n,Pi])[1]),h>0?d=h:p<i&&(d=p-i),d&&(r=l.unproject([e/2,i/2+d])[1]),{width:e,height:i,longitude:n,latitude:r,zoom:a,pitch:s,bearing:u}}(t)),t}},{key:"_unproject",value:function(t){var e=new ti(this._viewportProps);return t&&e.unproject(t)}},{key:"_calculateNewLngLat",value:function(t){var e=t.startPanLngLat,i=t.pos;return new ti(this._viewportProps).getMapCenterByLngLatPosition({lngLat:e,pos:i})}},{key:"_calculateNewZoom",value:function(t){var e=t.scale,i=t.startZoom,n=this._viewportProps,r=n.maxZoom,a=n.minZoom,o=i+Math.log2(e);return Object(ke.b)(o,a,r)}},{key:"_calculateNewPitchAndBearing",value:function(t){var e=t.deltaScaleX,i=t.deltaScaleY,n=t.startBearing,r=t.startPitch;i=Object(ke.b)(i,-1,1);var a=this._viewportProps,o=a.minPitch,s=a.maxPitch,c=r;return i>0?c=r+i*(s-r):i<0&&(c=r-i*(o-r)),{pitch:c,bearing:n+180*e}}}]),e}(ki),Ti=function(t){function e(t){var i;return Object(C.a)(this,e),(i=Object(A.a)(this,Object(I.a)(e).call(this,Ei,t))).invertPan=!0,i}return Object(R.a)(e,t),Object(L.a)(e,[{key:"_getTransitionProps",value:function(){return Oi}},{key:"_onPanRotate",value:function(t){if(!this.dragRotate)return!1;var e=t.deltaX,i=t.deltaY,n=this.getCenter(t),r=Object(U.a)(n,2)[1],a=r-i,o=this.controllerState.getViewportProps(),s=o.width,c=o.height,u=e/s,l=0;i>0?Math.abs(c-a)>5&&(l=i/(a-c)*1.2):i<0&&a>5&&(l=1-r/a),l=Math.min(1,Math.max(-1,l));var h=this.controllerState.rotate({deltaScaleX:u,deltaScaleY:l});return this.updateViewport(h,Si,{isDragging:!0})}}]),e}(mi),Ci=function(t){function e(t){return Object(C.a)(this,e),Object(A.a)(this,Object(I.a)(e).call(this,Object.assign({},t,{type:ii})))}return Object(R.a)(e,t),Object(L.a)(e,[{key:"controller",get:function(){return this._getControllerProps({type:Ti})}}]),e}(Ke);Ci.displayName="MapView";var Li=function(){function t(){Object(C.a)(this,t),this.effects=[],this._needsRedraw="Initial render",this.defaultLightingEffect=new V,this.needApplyDefaultLighting=!1}return Object(L.a)(t,[{key:"setProps",value:function(t){"effects"in t&&(t.effects.length===this.effects.length&&We(t.effects,this.effects)||(this.setEffects(t.effects),this._needsRedraw="effects changed")),this.checkLightingEffect()}},{key:"needsRedraw",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{clearRedrawFlags:!1},e=this._needsRedraw;return t.clearRedrawFlags&&(this._needsRedraw=!1),e}},{key:"getEffects",value:function(){var t=this.effects;return this.needApplyDefaultLighting&&(t=this.effects.slice()).push(this.defaultLightingEffect),t}},{key:"setEffects",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];this.effects=t}},{key:"checkLightingEffect",value:function(){var t=!1,e=!0,i=!1,n=void 0;try{for(var r,a=this.effects[Symbol.iterator]();!(e=(r=a.next()).done);e=!0){if(r.value instanceof V){t=!0;break}}}catch(o){i=!0,n=o}finally{try{e||null==a.return||a.return()}finally{if(i)throw n}}this.needApplyDefaultLighting=!t}}]),t}(),Ai=function(t){function e(){return Object(C.a)(this,e),Object(A.a)(this,Object(I.a)(e).apply(this,arguments))}return Object(R.a)(e,t),Object(L.a)(e,[{key:"render",value:function(t){return this.drawLayers(t)}},{key:"drawLayers",value:function(t){var e=this,i=t.layers,n=t.viewports,r=t.views,a=t.onViewportActive,o=t.deviceRect,s=void 0===o?null:o,c=t.parameters,u=void 0===c?{}:c,l=t.pass,h=void 0===l?"draw":l,p=t.redrawReason,d=void 0===p?"":p,v=t.clearCanvas,f=void 0===v||v,g=t.effects,y=t.effectProps,m=this.gl;f&&this.clearCanvas(m);var b=[];return n.forEach(function(t,n){var o=e.getViewportFromDescriptor(t),c=r&&r[o.id];a(o);var l=e.drawLayersInViewport(m,{layers:i,viewport:o,view:c,deviceRect:s,parameters:u,pass:h,redrawReason:d,effects:g,effectProps:y});b.push(l)}),b}},{key:"drawLayersInViewport",value:function(t,e){var i=this,n=e.layers,r=e.viewport,o=e.view,s=(e.deviceRect,e.parameters),c=void 0===s?{}:s,u=(e.pass,e.redrawReason,e.effects),l=e.effectProps,h=this.getGLViewport(t,{viewport:r});if(o&&o.props.clear){var p=!0===o.props.clear?{color:!0,depth:!0}:o.props.clear;Object(a.M)(t,{scissorTest:!0,scissor:h},function(){return Object(a.s)(t,p)})}var d={totalCount:n.length,visibleCount:0,compositeCount:0,pickableCount:0};return Object(a.I)(t,c||{}),n.forEach(function(e,n){var a=i.shouldDrawLayer(e,r);a&&e.props.pickable&&d.pickableCount++,e.isComposite&&d.compositeCount++,a&&(d.visibleCount++,i.drawLayerInViewport({gl:t,layer:e,layerIndex:n,glViewport:h,parameters:c,effects:u,effectProps:l}))}),d}},{key:"drawLayerInViewport",value:function(t){t.gl;var e=t.layer,i=t.layerIndex,n=t.glViewport,r=t.parameters,a=t.effects,o=t.effectProps,s=this.getModuleParameters(e,a,o),c=Object.assign({},e.context.uniforms,{layerIndex:i}),u=this.getLayerParameters(e,i,n,r);e.drawLayer({moduleParameters:s,uniforms:c,parameters:u})}},{key:"getViewportFromDescriptor",value:function(t){return t.viewport?t.viewport:t}},{key:"shouldDrawLayer",value:function(t,e){var i=this.props.layerFilter,n=!t.isComposite&&t.props.visible;return n&&i&&(n=i({layer:t,viewport:e,isPicking:!1})),n}},{key:"getModuleParameters",value:function(t){return Object.assign(Object.create(t.props),{viewport:t.context.viewport,pickingActive:0,devicePixelRatio:this.props.pixelRatio})}},{key:"getLayerParameters",value:function(t,e,i,n){var r=Object.assign({},t.props.parameters||{},n);return Object.assign(r,{viewport:i}),r}},{key:"getGLViewport",value:function(t,e){var i=e.viewport,n=t.canvas?t.canvas.clientHeight||t.canvas.height:100,r=i,a=this.props.pixelRatio;return[r.x*a,(n-r.y-r.height)*a,r.width*a,r.height*a]}},{key:"clearCanvas",value:function(t){var e=t.drawingBufferWidth,i=t.drawingBufferHeight;Object(a.M)(t,{viewport:[0,0,e,i]},function(){t.clear(16640)})}}]),e}(function(){function t(e){var i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};Object(C.a)(this,t);var n=i.id,r=void 0===n?"pass":n;this.id=r,this.gl=e,this.props={},Object.assign(this.props,i)}return Object(L.a)(t,[{key:"setProps",value:function(t){Object.assign(this.props,t)}},{key:"render",value:function(){}}]),t}()),Ii=function(t){function e(){return Object(C.a)(this,e),Object(A.a)(this,Object(I.a)(e).apply(this,arguments))}return Object(R.a)(e,t),Object(L.a)(e,[{key:"getModuleParameters",value:function(t,i,n){var r=Object(me.a)(Object(I.a)(e.prototype),"getModuleParameters",this).call(this,t);Object.assign(r,this.getObjectHighlightParameters(t),n);var a=!0,o=!1,s=void 0;try{for(var c,u=i[Symbol.iterator]();!(a=(c=u.next()).done);a=!0){var l=c.value;Object.assign(r,l.getParameters(t))}}catch(h){o=!0,s=h}finally{try{a||null==u.return||u.return()}finally{if(o)throw s}}return r}},{key:"getObjectHighlightParameters",value:function(t){var e=t.props,i=e.highlightedObjectIndex,n=e.highlightColor,r={pickingHighlightColor:[n[0],n[1],n[2],n[3]||255]};return Number.isInteger(i)&&(r.pickingSelectedColor=i>=0?t.encodePickingColor(i):null),r}}]),e}(Ai),Ri=function(t){function e(){return Object(C.a)(this,e),Object(A.a)(this,Object(I.a)(e).apply(this,arguments))}return Object(R.a)(e,t),Object(L.a)(e,[{key:"render",value:function(t){t.pickingFBO?this.drawPickingBuffer(t):Object(me.a)(Object(I.a)(e.prototype),"render",this).call(this,t)}},{key:"drawPickingBuffer",value:function(t){var e=this,i=t.layers,n=t.viewports,r=t.onViewportActive,o=t.pickingFBO,s=t.effectProps,c=t.deviceRect,u=c.x,l=c.y,h=c.width,p=c.height,d=t.redrawReason,v=void 0===d?"":d,f=this.gl;return Object(a.M)(f,{framebuffer:o,scissorTest:!0,scissor:[u,l,h,p],clearColor:[0,0,0,0]},function(){e.drawLayers({layers:i,viewports:n,onViewportActive:r,pass:"picking",redrawReason:v,effectProps:s,parameters:{blend:!0,blendFunc:[1,0,32771,0],blendEquation:32774,blendColor:[0,0,0,0],depthMask:!0,depthTest:!0,depthRange:[0,1],colorMask:[!0,!0,!0,!0]}})})}},{key:"shouldDrawLayer",value:function(t,e){var i=this.props.layerFilter,n=!t.isComposite&&t.props.visible&&t.props.pickable;return n&&i&&(n=i({layer:t,viewport:e,isPicking:!0})),n}},{key:"getModuleParameters",value:function(t,e,i){var n=Object.assign(Object.create(t.props),{viewport:t.context.viewport,pickingActive:1,devicePixelRatio:this.props.pixelRatio});return Object.assign(n,i),n}},{key:"getLayerParameters",value:function(t,e,i,n){var r=Object.assign({},t.props.parameters||{},n);return Object.assign(r,{viewport:i,blendColor:[0,0,0,(e+1)/255]}),r}}]),e}(Ai);function Fi(t){return f("boolean"==typeof t,"Invalid useDevicePixels"),t&&"undefined"!=typeof window?window.devicePixelRatio:1}var zi=function(){function t(e){Object(C.a)(this,t),this.gl=e,this.pixelRatio=null,this.layerFilter=null,this.drawPickingColors=!1,this.drawLayersPass=new Ii(e),this.pickLayersPass=new Ri(e),this.renderCount=0,this._needsRedraw="Initial render"}return Object(L.a)(t,[{key:"setProps",value:function(t){"useDevicePixels"in t&&(this.pixelRatio=Fi(t.useDevicePixels)),"layerFilter"in t&&this.layerFilter!==t.layerFilter&&(this.layerFilter=t.layerFilter,this._needsRedraw="layerFilter changed"),"drawPickingColors"in t&&this.drawPickingColors!==t.drawPickingColors&&(this.drawPickingColors=t.drawPickingColors,this._needsRedraw="drawPickingColors changed");var e=this.pixelRatio,i=this.layerFilter;this.drawLayersPass.setProps({pixelRatio:e,layerFilter:i}),this.pickLayersPass.setProps({pixelRatio:e,layerFilter:i})}},{key:"renderLayers",value:function(t){var e=this,i=t.layers,n=t.viewports,a=t.activateViewport,o=t.views,s=t.redrawReason,c=void 0===s?"unknown reason":s,u=t.clearCanvas,l=void 0===u||u,h=t.effects,p=void 0===h?[]:h,d=t.pass,v=t.stats,f=this.drawPickingColors?this.pickLayersPass:this.drawLayersPass,g=this.prepareEffects(p),y=f.render({layers:i,viewports:n,views:o,onViewportActive:a,redrawReason:c,clearCanvas:l,effects:p,effectProps:g});this.renderCount++,r.priority>=2&&y.forEach(function(t){e.logRenderStats({status:t,pass:d,redrawReason:c,stats:v})})}},{key:"needsRedraw",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{clearRedrawFlags:!1},e=this._needsRedraw;return t.clearRedrawFlags&&(this._needsRedraw=!1),e}},{key:"prepareEffects",value:function(t){var e={},i=!0,n=!1,r=void 0;try{for(var a,o=t[Symbol.iterator]();!(i=(a=o.next()).done);i=!0){var s=a.value;Object.assign(e,s.prepare())}}catch(c){n=!0,r=c}finally{try{i||null==o.return||o.return()}finally{if(n)throw r}}return e}},{key:"logRenderStats",value:function(t){var e=t.renderStats,i=t.pass,n=t.redrawReason,a=t.stats,o=e.totalCount,s=e.visibleCount,c=e.compositeCount,u=e.pickableCount,l=o-c-s,h="";h+="RENDER #".concat(this.renderCount," ").concat(s," (of ").concat(o," layers) to ").concat(i," because ").concat(n," "),r.priority>2&&(h+="(".concat(l," hidden, ").concat(c," composite ").concat(u," pickable)")),r.log(2,h)(),a&&a.get("Redraw Layers").add(s)}}]),t}(),Di={pickedColor:null,pickedLayer:null,pickedObjectIndex:-1};function Ni(t){var e=t.pickedColors,i=t.layers,n=t.deviceX,a=t.deviceY,o=t.deviceRadius,s=t.deviceRect;if(e){for(var c=s.x,u=s.y,l=s.width,h=s.height,p=o*o,d=-1,v=0,f=0;f<h;f++){var g=f+u-a,y=g*g;if(y>p)v+=4*l;else for(var m=0;m<l;m++){if(e[v+3]-1>=0){var b=m+c-n,w=b*b+y;w<=p&&(p=w,d=v)}v+=4}}if(d>=0){var _=e[d+3]-1,k=e.slice(d,d+4),j=i[_];if(j){var P=j.decodePickingColor(k);return{pickedColor:k,pickedLayer:j,pickedObjectIndex:P}}r.error("Picked non-existent layer. Is picking buffer corrupt?")()}}return Di}function Vi(t){var e=t.pickInfo,i=t.lastPickedInfo,n=t.mode,r=t.layers,a=t.viewports,o=t.x,s=t.y,c=t.deviceX,u=t.deviceY,l=t.pixelRatio,h=e.pickedColor,p=e.pickedLayer,d=e.pickedObjectIndex,v=p?[p]:[];if("hover"===n){var f=i.index,g=i.layerId,y=p&&p.props.id;if(y!==g||d!==f){if(y!==g){var m=r.find(function(t){return t.props.id===g});m&&v.unshift(m)}i.layerId=y,i.index=d,i.info=null}}var b={viewports:a}.viewports[0],w=b&&b.unproject([o,s]),_={color:null,layer:null,index:-1,picked:!1,x:o,y:s,pixel:[o,s],coordinate:w,lngLat:w,devicePixel:[c,u],pixelRatio:l},k=new Map;return k.set(null,_),v.forEach(function(t){var e=Object.assign({},_);if(t===p&&(e.color=h,e.index=d,e.picked=!0),e=Ui({layer:t,info:e,mode:n}),t===p&&"hover"===n&&(i.info=e),e&&k.set(e.layer.id,e),"hover"===n){var r=t.props.autoHighlight&&p===t?h:null;t.setModuleParameters({pickingSelectedColor:r}),t.setNeedsRedraw()}}),k}function Ui(t){for(var e=t.layer,i=t.info,n=t.mode;e&&i;){var r=i.layer||e;i.layer=e,i=e.pickLayer({info:i,mode:n,sourceLayer:r}),e=e.parent}return i}var Bi=function(){function t(e){Object(C.a)(this,t),this.gl=e,this.pickingFBO=null,this.pickLayersPass=new Ri(e),this.pixelRatio=null,this.layerFilter=null,this.pickingEvent=null,this.lastPickedInfo={index:-1,layerId:null,info:null}}return Object(L.a)(t,[{key:"setProps",value:function(t){"useDevicePixels"in t&&(this.pixelRatio=Fi(t.useDevicePixels)),"layerFilter"in t&&(this.layerFilter=t.layerFilter),this.pickLayersPass.setProps({pixelRatio:this.pixelRatio,layerFilter:this.layerFilter})}},{key:"pickObject",value:function(t){var e=t.x,i=t.y,n=t.mode,r=t.radius,a=void 0===r?0:r,o=t.layers,s=t.viewports,c=t.activateViewport,u=t.depth,l=void 0===u?1:u,h=t.event,p=void 0===h?null:h;this.pickingEvent=p;var d=this.pickClosestObject({x:e,y:i,radius:a,layers:o,mode:n,depth:l,viewports:s,onViewportActive:c});return this.pickingEvent=null,d}},{key:"pickObjects",value:function(t){var e=t.x,i=t.y,n=t.width,r=t.height,a=t.layers,o=t.viewports,s=t.activateViewport;return this.pickVisibleObjects({x:e,y:i,width:n,height:r,layers:a,mode:"pickObjects",viewports:o,onViewportActive:s})}},{key:"getLastPickedObject",value:function(t){var e=t.x,i=t.y,n=t.layers,r=t.viewports,a=this.lastPickedInfo.info,o=a&&a.layer&&a.layer.id,s=o?n.find(function(t){return t.id===o}):null,c=r[0]&&r[0].unproject([e,i]),u={x:e,y:i,coordinate:c,lngLat:c,layer:s};return s?Object.assign({},a,u):Object.assign(u,{color:null,object:null,index:-1})}},{key:"updatePickingBuffer",value:function(){var t=this.gl;return this.pickingFBO||(this.pickingFBO=new a.f(t)),this.pickingFBO.resize({width:t.canvas.width,height:t.canvas.height}),this.pickingFBO}},{key:"pickClosestObject",value:function(t){var e=t.layers,i=t.viewports,n=t.x,r=t.y,a=t.radius,o=t.depth,s=void 0===o?1:o,c=t.mode,u=t.onViewportActive;this.updatePickingBuffer();for(var l,h=this.pixelRatio,p=Math.round(n*h),d=Math.round(this.gl.canvas.height-r*h),v=Math.round(a*h),f=this.pickingFBO,g=f.width,y=f.height,m=this.getPickingRect({deviceX:p,deviceY:d,deviceRadius:v,deviceWidth:g,deviceHeight:y}),b=[],w={},_=0;_<s;_++){var k=Ni({pickedColors:m&&this.drawAndSamplePickingBuffer({layers:e,viewports:i,onViewportActive:u,deviceRect:m,redrawReason:c}),layers:e,deviceX:p,deviceY:d,deviceRadius:v,deviceRect:m});if(k.pickedColor&&_+1<s){var j=k.pickedColor[3]-1;w[j]||(w[j]=e[j].copyPickingColors()),e[j].clearPickingColor(k.pickedColor)}l=Vi({pickInfo:k,lastPickedInfo:this.lastPickedInfo,mode:c,layers:e,viewports:i,x:n,y:r,deviceX:p,deviceY:d,pixelRatio:h});var P=this.callLayerPickingCallbacks(l,c);if(P&&P.forEach(function(t){return b.push(t)}),!k.pickedColor)break}return Object.keys(w).forEach(function(t){return e[t].restorePickingColors(w[t])}),{result:b,emptyInfo:l&&l.get(null)}}},{key:"pickVisibleObjects",value:function(t){var e=t.layers,i=t.viewports,n=t.x,a=t.y,o=t.width,s=t.height,c=t.mode,u=t.onViewportActive;this.updatePickingBuffer();var l=this.pixelRatio,h=Math.round(n*l),p=Math.round(this.gl.canvas.height-a*l),d=Math.round((n+o)*l),v=Math.round(this.gl.canvas.height-(a+s)*l),f={x:h,y:v,width:d-h,height:p-v},g=function(t){var e=t.pickedColors,i=t.layers,n=new Map;if(e)for(var a=0;a<e.length;a+=4){var o=e[a+3]-1;if(o>=0){var s=e.slice(a,a+4),c=s.join(",");if(!n.has(c)){var u=i[o];u?n.set(c,{pickedColor:s,pickedLayer:u,pickedObjectIndex:u.decodePickingColor(s)}):r.error("Picked non-existent layer. Is picking buffer corrupt?")()}}}return Array.from(n.values())}({pickedColors:this.drawAndSamplePickingBuffer({layers:e,viewports:i,onViewportActive:u,deviceRect:f,redrawReason:c}),layers:e}),y=new Map;return g.forEach(function(t){var e={color:t.pickedColor,layer:null,index:t.pickedObjectIndex,picked:!0,x:n,y:a,width:o,height:s,pixelRatio:l};e=Ui({layer:t.pickedLayer,info:e,mode:c}),y.has(e.object)||y.set(e.object,e)}),Array.from(y.values())}},{key:"drawAndSamplePickingBuffer",value:function(t){var e=t.layers,i=t.viewports,n=t.onViewportActive,r=t.deviceRect,o=t.redrawReason;if(f(r),f(Number.isFinite(r.width)&&r.width>0,"`width` must be > 0"),f(Number.isFinite(r.height)&&r.height>0,"`height` must be > 0"),e.filter(function(t){return t.isPickable()}).length<1)return null;var s=this.pickingFBO;this.pickLayersPass.render({layers:e,viewports:i,onViewportActive:n,pickingFBO:s,deviceRect:r,redrawReason:o,effectProps:{lightSources:{}}});var c=r.x,u=r.y,l=r.width,h=r.height,p=new Uint8Array(l*h*4);return Object(a.F)(s,{sourceX:c,sourceY:u,sourceWidth:l,sourceHeight:h,target:p}),p}},{key:"getPickingRect",value:function(t){var e=t.deviceX,i=t.deviceY,n=t.deviceRadius,r=t.deviceWidth,a=t.deviceHeight;if(!(e>=0&&i>=0&&e<r&&i<a))return null;var o=Math.max(0,e-n),s=Math.max(0,i-n);return{x:o,y:s,width:Math.min(r,e+n)-o+1,height:Math.min(a,i+n)-s+1}}},{key:"callLayerPickingCallbacks",value:function(t,e){var i=[],n=this.pickingEvent;return t.forEach(function(t){if(t.layer){var r=!1;switch(e){case"hover":r=t.layer.onHover(t,n);break;case"query":break;default:throw new Error("unknown pick type")}r||i.push(t)}}),i}}]),t}(),Zi=1,Gi=2,Xi=4,Wi={mousedown:Zi,mousemove:Gi,mouseup:Xi};var Yi,qi,Hi=null;"undefined"!=typeof document&&(Hi=i(319),Yi=Hi.PointerEventInput,qi=Yi.prototype.handler,Yi.prototype.handler=function(t){var e=this.store;t.button>0&&(function(t,e){for(var i=0;i<t.length;i++)if(e(t[i]))return!0;return!1}(e,function(e){return e.pointerId===t.pointerId})||e.push(t)),qi.call(this,t)},Hi.MouseInput.prototype.handler=function(t){var e=Wi[t.type];e&Zi&&t.button>=0&&(this.pressed=!0),e&Gi&&0===t.which&&(e=Xi),this.pressed&&(e&Xi&&(this.pressed=!1),this.callback(this.manager,e,{pointers:[t],changedPointers:[t],pointerType:"mouse",srcEvent:t}))});var Ki=Hi;var Ji=Ki?[[Ki.Rotate,{enable:!1}],[Ki.Pinch,{enable:!1}],[Ki.Swipe,{enable:!1}],[Ki.Pan,{threshold:0,enable:!1}],[Ki.Press,{enable:!1}],[Ki.Tap,{event:"doubletap",taps:2,enable:!1}],[Ki.Tap,{event:"anytap",enable:!1}],[Ki.Tap,{enable:!1}]]:null,Qi={rotate:["pinch"],doubletap:["anytap"],anytap:["tap"]},$i={doubletap:["tap"]},tn={pointerdown:"pointerdown",pointermove:"pointermove",pointerup:"pointerup",touchstart:"pointerdown",touchmove:"pointermove",touchend:"pointerup",mousedown:"pointerdown",mousemove:"pointermove",mouseup:"pointerup"},en=["keydown","keyup"],nn=["mousedown","mousemove","mouseup","mouseover","mouseout","mouseleave"],rn=["wheel","mousewheel","DOMMouseScroll"],an={tap:"tap",anytap:"anytap",doubletap:"doubletap",press:"press",pinch:"pinch",pinchin:"pinch",pinchout:"pinch",pinchstart:"pinch",pinchmove:"pinch",pinchend:"pinch",pinchcancel:"pinch",rotate:"rotate",rotatestart:"rotate",rotatemove:"rotate",rotateend:"rotate",rotatecancel:"rotate",pan:"pan",panstart:"pan",panmove:"pan",panup:"pan",pandown:"pan",panleft:"pan",panright:"pan",panend:"pan",pancancel:"pan",swipe:"swipe",swipeleft:"swipe",swiperight:"swipe",swipeup:"swipe",swipedown:"swipe"},on={click:"tap",anyclick:"anytap",dblclick:"doubletap",mousedown:"pointerdown",mousemove:"pointermove",mouseup:"pointerup",mouseover:"pointerover",mouseout:"pointerout",mouseleave:"pointerleave"},sn=i(320),cn=-1!==sn.b.indexOf("firefox"),un=rn,ln=function(){function t(e,i){var n=this,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};Object(C.a)(this,t),this.element=e,this.callback=i,this.options=Object.assign({enable:!0},r),this.events=un.concat(r.events||[]),this.handleEvent=this.handleEvent.bind(this),this.events.forEach(function(t){return e.addEventListener(t,n.handleEvent,!!sn.a&&{passive:!1})})}return Object(L.a)(t,[{key:"destroy",value:function(){var t=this;this.events.forEach(function(e){return t.element.removeEventListener(e,t.handleEvent)})}},{key:"enableEventType",value:function(t,e){"wheel"===t&&(this.options.enable=e)}},{key:"handleEvent",value:function(t){if(this.options.enable){var e=t.deltaY;sn.c.WheelEvent&&(cn&&t.deltaMode===sn.c.WheelEvent.DOM_DELTA_PIXEL&&(e/=sn.c.devicePixelRatio),t.deltaMode===sn.c.WheelEvent.DOM_DELTA_LINE&&(e*=40));var i={x:t.clientX,y:t.clientY};0!==e&&e%4.000244140625==0&&(e=Math.floor(e/4.000244140625)),t.shiftKey&&e&&(e*=.25),this._onWheel(t,-e,i)}}},{key:"_onWheel",value:function(t,e,i){this.callback({type:"wheel",center:i,delta:e,srcEvent:t,pointerType:"mouse",target:t.target})}}]),t}(),hn=nn,pn=function(){function t(e,i){var n=this,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};Object(C.a)(this,t),this.element=e,this.callback=i,this.pressed=!1,this.options=Object.assign({enable:!0},r),this.enableMoveEvent=this.options.enable,this.enableLeaveEvent=this.options.enable,this.enableOutEvent=this.options.enable,this.enableOverEvent=this.options.enable,this.events=hn.concat(r.events||[]),this.handleEvent=this.handleEvent.bind(this),this.events.forEach(function(t){return e.addEventListener(t,n.handleEvent)})}return Object(L.a)(t,[{key:"destroy",value:function(){var t=this;this.events.forEach(function(e){return t.element.removeEventListener(e,t.handleEvent)})}},{key:"enableEventType",value:function(t,e){"pointermove"===t&&(this.enableMoveEvent=e),"pointerover"===t&&(this.enableOverEvent=e),"pointerout"===t&&(this.enableOutEvent=e),"pointerleave"===t&&(this.enableLeaveEvent=e)}},{key:"handleEvent",value:function(t){this.handleOverEvent(t),this.handleOutEvent(t),this.handleLeaveEvent(t),this.handleMoveEvent(t)}},{key:"handleOverEvent",value:function(t){this.enableOverEvent&&"mouseover"===t.type&&this.callback({type:"pointerover",srcEvent:t,pointerType:"mouse",target:t.target})}},{key:"handleOutEvent",value:function(t){this.enableOutEvent&&"mouseout"===t.type&&this.callback({type:"pointerout",srcEvent:t,pointerType:"mouse",target:t.target})}},{key:"handleLeaveEvent",value:function(t){this.enableLeaveEvent&&"mouseleave"===t.type&&this.callback({type:"pointerleave",srcEvent:t,pointerType:"mouse",target:t.target})}},{key:"handleMoveEvent",value:function(t){if(this.enableMoveEvent)switch(t.type){case"mousedown":t.button>=0&&(this.pressed=!0);break;case"mousemove":0===t.which&&(this.pressed=!1),this.pressed||this.callback({type:"pointermove",srcEvent:t,pointerType:"mouse",target:t.target});break;case"mouseup":this.pressed=!1}}}]),t}(),dn=en,vn=function(){function t(e,i){var n=this,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};Object(C.a)(this,t),this.element=e,this.callback=i,this.options=Object.assign({enable:!0},r),this.enableDownEvent=this.options.enable,this.enableUpEvent=this.options.enable,this.events=dn.concat(r.events||[]),this.handleEvent=this.handleEvent.bind(this),e.tabIndex=1,e.style.outline="none",this.events.forEach(function(t){return e.addEventListener(t,n.handleEvent)})}return Object(L.a)(t,[{key:"destroy",value:function(){var t=this;this.events.forEach(function(e){return t.element.removeEventListener(e,t.handleEvent)})}},{key:"enableEventType",value:function(t,e){"keydown"===t&&(this.enableDownEvent=e),"keyup"===t&&(this.enableUpEvent=e)}},{key:"handleEvent",value:function(t){var e=t.target||t.srcElement;"INPUT"===e.tagName&&"text"===e.type||"TEXTAREA"===e.tagName||(this.enableDownEvent&&"keydown"===t.type&&this.callback({type:"keydown",srcEvent:t,key:t.key,target:t.target}),this.enableUpEvent&&"keyup"===t.type&&this.callback({type:"keyup",srcEvent:t,key:t.key,target:t.target}))}}]),t}(),fn=function(){function t(e,i){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};Object(C.a)(this,t),this.element=e,this.callback=i,this.options=Object.assign({enable:!0},n),this.handleEvent=this.handleEvent.bind(this),e.addEventListener("contextmenu",this.handleEvent)}return Object(L.a)(t,[{key:"destroy",value:function(){this.element.removeEventListener("contextmenu",this.handleEvent)}},{key:"enableEventType",value:function(t,e){"contextmenu"===t&&(this.options.enable=e)}},{key:"handleEvent",value:function(t){this.options.enable&&this.callback({type:"contextmenu",center:{x:t.clientX,y:t.clientY},srcEvent:t,pointerType:"mouse",target:t.target})}}]),t}(),gn=1,yn=2,mn=4,bn={pointerdown:gn,pointermove:yn,pointerup:mn,mousedown:gn,mousemove:yn,mouseup:mn},wn=1,_n=2,kn=3,jn=0,Pn=1,On=2,Sn=1,xn=2,Mn=4;var En=function(){function t(e){Object(C.a)(this,t),this.eventManager=e,this.handlers=[],this.handlersByElement=new Map,this.handleEvent=this.handleEvent.bind(this)}return Object(L.a)(t,[{key:"isEmpty",value:function(){return 0===this.handlers.length}},{key:"add",value:function(t,e){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"root",n=this.handlers,r=this.handlersByElement;r.has(i)||r.set(i,[]);var a={type:t,handler:e,srcElement:i};n.push(a),r.get(i).push(a)}},{key:"remove",value:function(t,e){for(var i=this.handlers,n=this.handlersByElement,r=i.length-1;r>=0;r--){var a=i[r];if(a.type===t&&a.handler===e){i.splice(r,1);var o=n.get(a.srcElement);o.splice(o.indexOf(a),1),0===o.length&&n.delete(a.srcElement)}}}},{key:"handleEvent",value:function(t){if(!this.isEmpty()){for(var e=this._normalizeEvent(t),i=t.srcEvent.target;i&&i!==e.rootElement;){if(this._emit(e,i),e.handled)return;i=i.parentNode}this._emit(e,"root")}}},{key:"_emit",value:function(t,e){var i=this.handlersByElement.get(e);if(i)for(var n=!1,r=function(){t.handled=!0},a=function(){t.handled=!0,n=!0},o=0;o<i.length;o++){var s=i[o],c=s.type;if((0,s.handler)(Object.assign({},t,{type:c,stopPropagation:r,stopImmediatePropagation:a})),n)break}}},{key:"_normalizeEvent",value:function(t){var e=this.eventManager.element;return Object.assign({},t,function(t){var e=bn[t.srcEvent.type];if(!e)return null;var i=t.srcEvent,n=i.buttons,r=i.button,a=i.which,o=!1,s=!1,c=!1;return e===mn||e===yn&&!Number.isFinite(n)?(o=a===wn,s=a===_n,c=a===kn):e===yn?(o=Boolean(n&Sn),s=Boolean(n&Mn),c=Boolean(n&xn)):e===gn&&(o=r===jn,s=r===Pn,c=r===On),{leftButton:o,middleButton:s,rightButton:c}}(t),function(t,e){var i=t.srcEvent;if(!t.center&&!Number.isFinite(i.clientX))return null;var n=t.center||{x:i.clientX,y:i.clientY},r=e.getBoundingClientRect(),a=r.width/e.offsetWidth,o=r.height/e.offsetHeight;return{center:n,offsetCenter:{x:(n.x-r.left-e.clientLeft)/a,y:(n.y-r.top-e.clientTop)/o}}}(t,e),{handled:!1,rootElement:e})}}]),t}(),Tn={events:null,recognizers:null,Manager:Ki?Ki.Manager:function(t){var e={},i=function(){return e};return e.get=function(){return null},e.set=i,e.on=i,e.off=i,e.destroy=i,e.emit=i,e},touchAction:"none"},Cn=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};Object(C.a)(this,t),this.options=Object.assign({},Tn,i),this.events=new Map,this._onBasicInput=this._onBasicInput.bind(this),this._onOtherEvent=this._onOtherEvent.bind(this),this.setElement(e);var n=i.events;n&&this.on(n)}return Object(L.a)(t,[{key:"setElement",value:function(t){var e=this;if(this.element&&this.destroy(),this.element=t,t){var i=this.options,n=i.Manager;this.manager=new n(t,{touchAction:i.touchAction,recognizers:i.recognizers||Ji}).on("hammer.input",this._onBasicInput),i.recognizers||Object.keys(Qi).forEach(function(t){var i=e.manager.get(t);i&&Qi[t].forEach(function(t){i.recognizeWith(t)})}),this.wheelInput=new ln(t,this._onOtherEvent,{enable:!1}),this.moveInput=new pn(t,this._onOtherEvent,{enable:!1}),this.keyInput=new vn(t,this._onOtherEvent,{enable:!1}),this.contextmenuInput=new fn(t,this._onOtherEvent,{enable:!1});var r=!0,a=!1,o=void 0;try{for(var s,c=this.events[Symbol.iterator]();!(r=(s=c.next()).done);r=!0){var u=Object(U.a)(s.value,2),l=u[0],h=u[1];h.isEmpty()||(this._toggleRecognizer(h.recognizerName,!0),this.manager.on(l,h.handleEvent))}}catch(p){a=!0,o=p}finally{try{r||null==c.return||c.return()}finally{if(a)throw o}}}}},{key:"destroy",value:function(){this.element&&(this.wheelInput.destroy(),this.moveInput.destroy(),this.keyInput.destroy(),this.contextmenuInput.destroy(),this.manager.destroy(),this.wheelInput=null,this.moveInput=null,this.keyInput=null,this.contextmenuInput=null,this.manager=null,this.element=null)}},{key:"on",value:function(t,e,i){if("string"==typeof t)this._addEventHandler(t,e,i);else for(var n in i=e,t)this._addEventHandler(n,t[n],i)}},{key:"off",value:function(t,e){if("string"==typeof t)this._removeEventHandler(t,e);else for(var i in t)this._removeEventHandler(i,t[i])}},{key:"_toggleRecognizer",value:function(t,e){var i=this.manager;if(i){var n=i.get(t);if(n&&n.options.enable!==e){n.set({enable:e});var r=$i[t];r&&!this.options.recognizers&&r.forEach(function(r){var a=i.get(r);e?(a.requireFailure(t),n.dropRequireFailure(r)):a.dropRequireFailure(t)})}this.wheelInput.enableEventType(t,e),this.moveInput.enableEventType(t,e),this.keyInput.enableEventType(t,e),this.contextmenuInput.enableEventType(t,e)}}},{key:"_addEventHandler",value:function(t,e,i){var n=this.manager,r=this.events,a=on[t]||t,o=r.get(a);o||(o=new En(this),r.set(a,o),o.recognizerName=an[a]||a,n&&n.on(a,o.handleEvent)),this._toggleRecognizer(o.recognizerName,!0),o.add(t,e,i)}},{key:"_removeEventHandler",value:function(t,e){var i=this.events,n=on[t]||t,r=i.get(n);if(r&&(r.remove(t,e),r.isEmpty())){var a=r.recognizerName,o=!1,s=!0,c=!1,u=void 0;try{for(var l,h=i.values()[Symbol.iterator]();!(s=(l=h.next()).done);s=!0){var p=l.value;if(p.recognizerName===a&&!p.isEmpty()){o=!0;break}}}catch(d){c=!0,u=d}finally{try{s||null==h.return||h.return()}finally{if(c)throw u}}o||this._toggleRecognizer(a,!1)}}},{key:"_onBasicInput",value:function(t){var e=t.srcEvent,i=tn[e.type];i&&this.manager.emit(i,t)}},{key:"_onOtherEvent",value:function(t){this.manager.emit(t.type,t)}}]),t}();function Ln(){}var An={id:"deckgl-overlay",width:"100%",height:"100%",pickingRadius:0,layerFilter:null,glOptions:{},gl:null,layers:[],effects:[],views:null,controller:null,useDevicePixels:!0,_animate:!1,onWebGLInitialized:Ln,onResize:Ln,onViewStateChange:Ln,onBeforeRender:Ln,onAfterRender:Ln,onLoad:Ln,_onMetrics:null,getCursor:function(t){return t.isDragging?"grabbing":"grab"},debug:!1,drawPickingColors:!1},In=function(){function t(e){Object(C.a)(this,t),e=Object.assign({},An,e),this.width=0,this.height=0,this.viewManager=null,this.layerManager=null,this.effectManager=null,this.deckRenderer=null,this.deckPicker=null,this._needsRedraw=!0,this._pickRequest={},this.viewState=e.initialViewState||null,this.interactiveState={isDragging:!1},this._onEvent=this._onEvent.bind(this),this._onPointerDown=this._onPointerDown.bind(this),this._onPointerMove=this._onPointerMove.bind(this),this._onPointerLeave=this._onPointerLeave.bind(this),this._pickAndCallback=this._pickAndCallback.bind(this),this._onRendererInitialized=this._onRendererInitialized.bind(this),this._onRenderFrame=this._onRenderFrame.bind(this),this._onViewStateChange=this._onViewStateChange.bind(this),this._onInteractiveStateChange=this._onInteractiveStateChange.bind(this),e.gl||"undefined"!=typeof document&&(this.canvas=this._createCanvas(e)),this.animationLoop=this._createAnimationLoop(e),this.stats=new _e.a({id:"deck.gl"}),this.setProps(e),this.animationLoop.start()}return Object(L.a)(t,[{key:"finalize",value:function(){this.animationLoop.stop(),this.animationLoop=null,this.layerManager&&(this.layerManager.finalize(),this.layerManager=null),this.viewManager&&(this.viewManager.finalize(),this.viewManager=null),this.eventManager&&this.eventManager.destroy(),this.props.canvas||this.props.gl||!this.canvas||(this.canvas.parentElement.removeChild(this.canvas),this.canvas=null)}},{key:"setProps",value:function(t){this.stats.get("setProps Time").timeStart(),"onLayerHover"in t&&r.removed("onLayerHover","onHover")(),"onLayerClick"in t&&r.removed("onLayerClick","onClick")(),t=Object.assign({},this.props,t),this.props=t,this._setCanvasSize(t);var e=Object.assign({},t,{views:this._getViews(t),width:this.width,height:this.height}),i=this._getViewState(t);i&&(e.viewState=i),this.viewManager&&this.viewManager.setProps(e),this.layerManager&&this.layerManager.setProps(e),this.effectManager&&this.effectManager.setProps(e),this.animationLoop&&this.animationLoop.setProps(e),this.deckRenderer&&this.deckRenderer.setProps(e),this.deckPicker&&this.deckPicker.setProps(e),this.stats.get("setProps Time").timeEnd()}},{key:"needsRedraw",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{clearRedrawFlags:!1};if(this.props._animate)return"Deck._animate";var e=this._needsRedraw;t.clearRedrawFlags&&(this._needsRedraw=!1);var i=this.viewManager.needsRedraw(t),n=this.layerManager.needsRedraw(t),r=this.effectManager.needsRedraw(t),a=this.deckRenderer.needsRedraw(t);return e=e||i||n||r||a}},{key:"redraw",value:function(t){if(this.layerManager){var e=t||this.needsRedraw({clearRedrawFlags:!0});e&&(this.stats.get("Redraw Count").incrementCount(),this.props._customRender?this.props._customRender(e):this._drawLayers(e))}}},{key:"getViews",value:function(){return this.viewManager.views}},{key:"getViewports",value:function(t){return this.viewManager.getViewports(t)}},{key:"pickObject",value:function(t){var e=t.x,i=t.y,n=t.radius,r=void 0===n?0:n,a=t.layerIds,o=void 0===a?null:a;this.stats.get("pickObject Time").timeStart();var s=this.layerManager.getLayers({layerIds:o}),c=this.layerManager.activateViewport,u=this.deckPicker.pickObject({x:e,y:i,radius:r,layers:s,viewports:this.getViewports({x:e,y:i}),activateViewport:c,mode:"query",depth:1}).result;return this.stats.get("pickObject Time").timeEnd(),u.length?u[0]:null}},{key:"pickMultipleObjects",value:function(t){var e=t.x,i=t.y,n=t.radius,r=void 0===n?0:n,a=t.layerIds,o=void 0===a?null:a,s=t.depth,c=void 0===s?10:s;this.stats.get("pickMultipleObjects Time").timeStart();var u=this.layerManager.getLayers({layerIds:o}),l=this.layerManager.activateViewport,h=this.deckPicker.pickObject({x:e,y:i,radius:r,layers:u,viewports:this.getViewports({x:e,y:i}),activateViewport:l,mode:"query",depth:c}).result;return this.stats.get("pickMultipleObjects Time").timeEnd(),h}},{key:"pickObjects",value:function(t){var e=t.x,i=t.y,n=t.width,r=void 0===n?1:n,a=t.height,o=void 0===a?1:a,s=t.layerIds,c=void 0===s?null:s;this.stats.get("pickObjects Time").timeStart();var u=this.layerManager.getLayers({layerIds:c}),l=this.layerManager.activateViewport,h=this.deckPicker.pickObjects({x:e,y:i,width:r,height:o,layers:u,viewports:this.getViewports({x:e,y:i,width:r,height:o}),activateViewport:l});return this.stats.get("pickObjects Time").timeEnd(),h}},{key:"_createCanvas",value:function(t){var e=t.canvas;("string"==typeof e&&f(e=document.getElementById(e)),e)||(e=document.createElement("canvas"),(t.parent||document.body).appendChild(e));var i=t.id,n=t.style;return e.id=i,Object.assign(e.style,n),e}},{key:"_setCanvasSize",value:function(t){if(this.canvas){var e=t.width,i=t.height;(e||0===e)&&(e=Number.isFinite(e)?"".concat(e,"px"):e,this.canvas.style.width=e),(i||0===i)&&(i=Number.isFinite(i)?"".concat(i,"px"):i,this.canvas.style.position="absolute",this.canvas.style.height=i)}}},{key:"_updateCanvasSize",value:function(){if(this._checkForCanvasSizeChange()){var t=this.width,e=this.height;this.viewManager.setProps({width:t,height:e}),this.props.onResize({width:this.width,height:this.height})}}},{key:"_checkForCanvasSizeChange",value:function(){var t=this.canvas;if(!t)return!1;var e=t.clientWidth||t.width,i=t.clientHeight||t.height;return(e!==this.width||i!==this.height)&&(this.width=e,this.height=i,!0)}},{key:"_createAnimationLoop",value:function(t){var e=this,i=t.width,n=t.height,r=t.gl,o=t.glOptions,s=t.debug,c=t.useDevicePixels,u=t.autoResizeDrawingBuffer;return new a.b({width:i,height:n,useDevicePixels:c,autoResizeDrawingBuffer:u,gl:r,onCreateContext:function(t){return Object(a.t)(Object.assign({},o,t,{canvas:e.canvas,debug:s}))},onInitialize:this._onRendererInitialized,onRender:this._onRenderFrame,onBeforeRender:t.onBeforeRender,onAfterRender:t.onAfterRender})}},{key:"_getViewState",value:function(t){return t.viewState||this.viewState}},{key:"_getViews",value:function(t){var e=t.views||[new Ci({id:"default-view"})];return(e=Array.isArray(e)?e:[e]).length&&t.controller&&(e[0].props.controller=t.controller),e}},{key:"_requestPick",value:function(t){var e=t.event,i=t.callback,n=t.mode,r=t.immediate,a=this._pickRequest;if("pointerleave"===e.type)a.x=-1,a.y=-1,a.radius=0;else{var o=e.offsetCenter;if(!o)return;a.x=o.x,a.y=o.y,a.radius=this.props.pickingRadius}a.callback=i,a.event=e,a.mode=n,r&&this._pickAndCallback()}},{key:"_pickAndCallback",value:function(){var t=this._pickRequest;if(t.mode){var e=this.deckPicker.pickObject(Object.assign({layers:this.layerManager.getLayers(),viewports:this.getViewports(t),activateViewport:this.layerManager.activateViewport,depth:1},t)),i=e.result,n=e.emptyInfo;if(t.callback){var r=i.find(function(t){return t.index>=0})||n;t.callback(r,t.event)}t.mode=null}}},{key:"_updateCursor",value:function(){this.canvas&&(this.canvas.style.cursor=this.props.getCursor(this.interactiveState))}},{key:"_updateAnimationProps",value:function(t){this.layerManager.context.animationProps=t}},{key:"_setGLContext",value:function(t){if(!this.layerManager){for(var e in this.canvas||(this.canvas=t.canvas,Object(a.K)(t,{enable:!0,copyState:!0})),Object(a.I)(t,{blend:!0,blendFunc:[770,771,1,771],polygonOffsetFill:!0,depthTest:!0,depthFunc:515}),this.props.onWebGLInitialized(t),this.eventManager=new Cn(t.canvas,{events:{pointerdown:this._onPointerDown,pointermove:this._onPointerMove,pointerleave:this._onPointerLeave}}),p)this.eventManager.on(e,this._onEvent);this.viewManager=new Je({eventManager:this.eventManager,onViewStateChange:this._onViewStateChange,onInteractiveStateChange:this._onInteractiveStateChange,views:this._getViews(this.props),viewState:this._getViewState(this.props),width:this.width,height:this.height}),f(this.viewManager);var i=this.viewManager.getViewports()[0];this.layerManager=new Ce(t,{deck:this,stats:this.stats,viewport:i}),this.effectManager=new Li,this.deckRenderer=new zi(t),this.deckPicker=new Bi(t),this.setProps(this.props),this._updateCanvasSize(),this.props.onLoad()}}},{key:"_drawLayers",value:function(t,e){var i=this.layerManager.context.gl;Object(a.I)(i,this.props.parameters),this.props.onBeforeRender({gl:i});var n=this.layerManager.getLayers(),r=this.layerManager.activateViewport;this.deckRenderer.renderLayers(Object.assign({layers:n,viewports:this.viewManager.getViewports(),activateViewport:r,views:this.viewManager.getViews(),pass:"screen",redrawReason:t,effects:this.effectManager.getEffects()},e)),this.props.onAfterRender({gl:i})}},{key:"_onRendererInitialized",value:function(t){var e=t.gl;this._setGLContext(e)}},{key:"_onRenderFrame",value:function(t){if(this.stats.get("frameRate").timeEnd(),this.stats.get("frameRate").timeStart(),t.tick%60==0){var e={};this.stats.forEach(function(t){e[t.name]={time:t.time||0,count:t.count||0,average:t.getAverageTime()||0,hz:t.getHz()||0}}),this.stats.reset(),r.table(3,e)(),this.props._onMetrics&&this.props._onMetrics(e)}this._updateCanvasSize(),this._updateCursor(),this.layerManager.updateLayers(t),this._updateAnimationProps(t),this._pickAndCallback(),this.redraw(!1),this.viewManager&&this.viewManager.updateViewStates(t)}},{key:"_onViewStateChange",value:function(t){var e=this.props.onViewStateChange(t)||t.viewState;this.viewState&&(this.viewState[t.viewId]=e,this.viewManager.setProps({viewState:e}))}},{key:"_onInteractiveStateChange",value:function(t){var e=t.isDragging,i=void 0!==e&&e;i!==this.interactiveState.isDragging&&(this.interactiveState.isDragging=i)}},{key:"_onEvent",value:function(t){var e=p[t.type],i=t.offsetCenter;if(e&&i){var n=this.layerManager.getLayers(),r=this.deckPicker.getLastPickedObject({x:i.x,y:i.y,layers:n,viewports:this.getViewports(i)}),a=r.layer,o=a&&(a[e.handler]||a.props[e.handler]),s=this.props[e.handler],c=!1;o&&(c=o.call(a,r,t)),!c&&s&&s(r,t)}}},{key:"_onPointerDown",value:function(t){this._requestPick({callback:null,event:t,mode:"hover",immediate:!0})}},{key:"_onPointerMove",value:function(t){t.leftButton||t.rightButton||this._requestPick({callback:this.props.onHover,event:t,mode:"hover"})}},{key:"_onPointerLeave",value:function(t){this._requestPick({callback:this.props.onHover,event:t,mode:"hover"})}}]),t}();In.getPropTypes=function(t){return{id:t.string,width:t.oneOfType([t.number,t.string]),height:t.oneOfType([t.number,t.string]),layers:t.oneOfType([t.object,t.array]),layerFilter:t.func,views:t.oneOfType([t.object,t.array]),viewState:t.object,effects:t.arrayOf(t.instanceOf(z)),controller:t.oneOfType([t.func,t.bool,t.object]),gl:t.object,glOptions:t.object,parameters:t.object,pickingRadius:t.number,useDevicePixels:t.bool,onWebGLInitialized:t.func,onResize:t.func,onViewStateChange:t.func,onBeforeRender:t.func,onAfterRender:t.func,onLoad:t.func,debug:t.bool,drawPickingColors:t.bool,_animate:t.bool}},In.defaultProps=An;function Rn(t,e){return Number.isFinite(t)?t:e}var Fn=function(t){function e(t){var i,n=t.width,r=t.height,a=t.position,o=t.bearing,s=t.pitch,c=t.longitude,u=t.latitude,l=t.zoom,h=(t.syncBearing,t.bounds,t.startPanEventPosition),p=t.startPanPosition,d=t.startRotateCenter,v=t.startRotateViewport,f=t.startZoomPos,g=t.startZoom;return Object(C.a)(this,e),(i=Object(A.a)(this,Object(I.a)(e).call(this,{width:n,height:r,position:a,bearing:o,pitch:s,longitude:c,latitude:u,zoom:l})))._interactiveState={startPanEventPosition:h,startPanPosition:p,startRotateCenter:d,startRotateViewport:v,startZoomPos:f,startZoom:g},i}return Object(R.a)(e,t),Object(L.a)(e,[{key:"getInteractiveState",value:function(){return this._interactiveState}},{key:"panStart",value:function(t){var e=t.pos,i=this._viewportProps,n=i.translationX,r=i.translationY;return this._getUpdatedState({startPanPosition:[n,r],startPanEventPosition:e})}},{key:"pan",value:function(t){var e=t.pos,i=t.startPos,n=this._interactiveState.startPanEventPosition||i;if(!n)return this;var r=this._interactiveState.startPanPosition||[],a=Object(U.a)(r,2),o=a[0],s=a[1];o=Rn(o,this._viewportProps.translationX),s=Rn(s,this._viewportProps.translationY);var c=e[0]-n[0],u=e[1]-n[1];return this._getUpdatedState({translationX:o+c,translationY:s-u})}},{key:"panEnd",value:function(){return this._getUpdatedState({startPanPosition:null,startPanPos:null})}},{key:"rotateStart",value:function(t){t.pos;return this._getUpdatedState({startRotateCenter:this._viewportProps.position,startRotateViewport:this._viewportProps})}},{key:"rotate",value:function(t){var e=t.deltaScaleX,i=t.deltaScaleY;if(!this._interactiveState.startRotateCenter)return this;var n=this._viewportProps,r=n.bearing,a=n.pitch;return this._getUpdatedState({bearing:r+10*e,pitch:a-10*i})}},{key:"rotateEnd",value:function(){return this._getUpdatedState({startRotateCenter:null,startRotateViewport:null})}},{key:"zoomStart",value:function(t){var e=t.pos;return this._getUpdatedState({startZoomPos:e,startZoom:this._viewportProps.zoom})}},{key:"zoom",value:function(t){var e=t.pos,i=t.startPos,n=t.scale,r=this._viewportProps,a=r.zoom,o=r.minZoom,s=r.maxZoom,c=r.width,u=r.height,l=(r.translationX,r.translationY,this._interactiveState.startZoomPos||i||e),h=Object(ke.b)(a*n,o,s);e[0],l[0],e[1],l[1],l[0],l[1];return h/a<1?this.moveBackward():this.moveForward()}},{key:"zoomEnd",value:function(){return this._getUpdatedState({startZoomPos:null,startZoom:null})}},{key:"moveLeft",value:function(){var t=this._viewportProps.bearing-2;return this._getUpdatedState({bearing:t})}},{key:"moveRight",value:function(){var t=this._viewportProps.bearing+2;return this._getUpdatedState({bearing:t})}},{key:"moveForward",value:function(){var t=this._viewportProps.position,e=this.getDirection(),i=new Pe.a(e).normalize().scale(1);return this._getUpdatedState({position:new Pe.a(t).add(i)})}},{key:"moveBackward",value:function(){var t=this._viewportProps.position,e=this.getDirection(),i=new Pe.a(e).normalize().scale(-1);return this._getUpdatedState({position:new Pe.a(t).add(i)})}},{key:"moveUp",value:function(){var t=this._viewportProps.position;return this._getUpdatedState({position:new Pe.a(t).add([0,0,1])})}},{key:"moveDown",value:function(){var t=this._viewportProps.position,e=t[2]>=1?[0,0,-1]:[0,0,0];return this._getUpdatedState({position:new Pe.a(t).add(e)})}},{key:"zoomIn",value:function(){return this._getUpdatedState({zoom:this._viewportProps.zoom+.2})}},{key:"zoomOut",value:function(){return this._getUpdatedState({zoom:this._viewportProps.zoom-.2})}},{key:"_getUpdatedState",value:function(t){return new e(Object.assign({},this._viewportProps,this._interactiveState,t))}}]),e}(ki),zn=function(t){function e(t){return Object(C.a)(this,e),Object(A.a)(this,Object(I.a)(e).call(this,Fn,t))}return Object(R.a)(e,t),e}(mi);(function(t){function e(){return Object(C.a)(this,e),Object(A.a)(this,Object(I.a)(e).apply(this,arguments))}return Object(R.a)(e,t),Object(L.a)(e,[{key:"_getViewport",value:function(t){var e=t.viewState,i=e.modelMatrix,n=void 0===i?null:i,r=e.bearing,a=e.up,o=void 0===a?[0,0,1]:a,s=function(t){var e=t.bearing,i=t.pitch;return new wi({bearing:e,pitch:i}).toVector3().normalize()}({bearing:r,pitch:89}),c=n?n.transformDirection(s):s,u=(new je.a).lookAt({eye:[0,0,0],center:c,up:o});return new Me(Object.assign({},t,{zoom:null,viewMatrix:u}))}},{key:"controller",get:function(){return this._getControllerProps({type:zn})}}]),e}(Ke)).displayName="FirstPersonView",(function(t){function e(){return Object(C.a)(this,e),Object(A.a)(this,Object(I.a)(e).apply(this,arguments))}return Object(R.a)(e,t),Object(L.a)(e,[{key:"_getViewport",value:function(t){var e=t.viewState,i=e.bearing,n=e.pitch,r=e.position,a=e.up,o=50*e.zoom,s=function(t){var e=t.bearing,i=t.pitch;return new wi({bearing:e,pitch:i}).toVector3().normalize()}({bearing:i,pitch:n}).scale(-o).multiply(new Pe.a(1,1,-1)),c=(new je.a).multiplyRight((new je.a).lookAt({eye:s,center:r,up:a}));return new Me(Object.assign({},t,{id:this.id,zoom:null,viewMatrix:c}))}}]),e}(Ke)).displayName="ThirdPersonView";var Dn=i(318),Nn={orbitAxis:"Z",rotationX:0,rotationOrbit:0,fovy:50,zoom:0,target:[0,0,0],minZoom:-1/0,maxZoom:1/0},Vn={transitionDuration:300,transitionEasing:function(t){return t},transitionInterpolator:new ai(["target","zoom","rotationX","rotationOrbit"]),transitionInterruption:si},Un=function(t){return Math.pow(2,t)},Bn=function(t){function e(t){var i,n=t.ViewportType,r=t.width,a=t.height,o=t.orbitAxis,s=void 0===o?Nn.orbitAxis:o,c=t.rotationX,u=void 0===c?Nn.rotationX:c,l=t.rotationOrbit,h=void 0===l?Nn.rotationOrbit:l,p=t.target,d=void 0===p?Nn.target:p,v=t.zoom,f=void 0===v?Nn.zoom:v,g=t.fovy,y=void 0===g?Nn.fovy:g,m=t.minZoom,b=void 0===m?Nn.minZoom:m,w=t.maxZoom,_=void 0===w?Nn.maxZoom:w,k=t.startPanPosition,j=t.startTarget,P=t.startRotationX,O=t.startRotationOrbit,S=t.startZoomPosition,x=t.startZoom;return Object(C.a)(this,e),(i=Object(A.a)(this,Object(I.a)(e).call(this,{width:r,height:a,orbitAxis:s,rotationX:u,rotationOrbit:h,target:d,fovy:y,zoom:f,minZoom:b,maxZoom:_})))._interactiveState={startPanPosition:k,startTarget:j,startRotationX:P,startRotationOrbit:O,startZoomPosition:S,startZoom:x},i.ViewportType=n,i}return Object(R.a)(e,t),Object(L.a)(e,[{key:"getViewportProps",value:function(){return this._viewportProps}},{key:"getInteractiveState",value:function(){return this._interactiveState}},{key:"panStart",value:function(t){var e=t.pos,i=this._viewportProps.target;return this._getUpdatedState({startPanPosition:e,startTarget:i})}},{key:"pan",value:function(t){var e=t.pos,i=(t.startPos,this._interactiveState),n=i.startPanPosition,r=i.startTarget,a=new Dn.a(e).subtract(n);return this._getUpdatedState({target:this._calculateNewTarget({startTarget:r,pixelOffset:a})})}},{key:"panEnd",value:function(){return this._getUpdatedState({startPanPosition:null,startTarget:null})}},{key:"rotateStart",value:function(t){t.pos;return this._getUpdatedState({startRotationX:this._viewportProps.rotationX,startRotationOrbit:this._viewportProps.rotationOrbit})}},{key:"rotate",value:function(t){var e=t.deltaScaleX,i=t.deltaScaleY,n=this._interactiveState,r=n.startRotationX,a=n.startRotationOrbit;if(!Number.isFinite(r)||!Number.isFinite(a))return this;var o=Object(ke.b)(r+180*i,-89.999,89.999),s=(a+180*e)%360;return this._getUpdatedState({rotationX:o,rotationOrbit:s,isRotating:!0})}},{key:"rotateEnd",value:function(){return this._getUpdatedState({startRotationX:null,startRotationOrbit:null})}},{key:"shortestPathFrom",value:function(t){return Object.assign({},this._viewportProps)}},{key:"zoomStart",value:function(t){var e=t.pos;return this._getUpdatedState({startZoomPosition:e,startTarget:this._viewportProps.target,startZoom:this._viewportProps.zoom})}},{key:"zoom",value:function(t){var e=t.pos,i=t.startPos,n=t.scale,r=this._viewportProps,a=r.zoom,o=r.width,s=r.height,c=r.target,u=this._interactiveState,l=u.startZoom,h=u.startZoomPosition,p=u.startTarget;Number.isFinite(l)||(l=a,p=c,h=i||e);var d=this._calculateNewZoom({scale:n,startZoom:l}),v=Un(l),f=Un(d),g=(o/2-h[0])*(f/v-1),y=(s/2-h[1])*(f/v-1);return this._getUpdatedState({zoom:d,target:this._calculateNewTarget({startTarget:p,zoom:d,pixelOffset:[g,y]})})}},{key:"zoomEnd",value:function(){return this._getUpdatedState({startZoomPosition:null,startTarget:null,startZoom:null})}},{key:"zoomIn",value:function(){return this._getUpdatedState({zoom:this._calculateNewZoom({scale:2})})}},{key:"zoomOut",value:function(){return this._getUpdatedState({zoom:this._calculateNewZoom({scale:.5})})}},{key:"moveLeft",value:function(){var t=[-50,0];return this._getUpdatedState({target:this._calculateNewTarget({pixelOffset:t})})}},{key:"moveRight",value:function(){var t=[50,0];return this._getUpdatedState({target:this._calculateNewTarget({pixelOffset:t})})}},{key:"moveUp",value:function(){var t=[0,-50];return this._getUpdatedState({target:this._calculateNewTarget({pixelOffset:t})})}},{key:"moveDown",value:function(){var t=[0,50];return this._getUpdatedState({target:this._calculateNewTarget({pixelOffset:t})})}},{key:"rotateLeft",value:function(){return this._getUpdatedState({rotationOrbit:this._viewportProps.rotationOrbit-15})}},{key:"rotateRight",value:function(){return this._getUpdatedState({rotationOrbit:this._viewportProps.rotationOrbit+15})}},{key:"rotateUp",value:function(){return this._getUpdatedState({rotationX:this._viewportProps.rotationX-10})}},{key:"rotateDown",value:function(){return this._getUpdatedState({rotationX:this._viewportProps.rotationX+10})}},{key:"_calculateNewZoom",value:function(t){var e=t.scale,i=t.startZoom,n=this._viewportProps,r=n.maxZoom,a=n.minZoom;Number.isFinite(i)||(i=this._viewportProps.zoom);var o=i+Math.log2(e);return Object(ke.b)(o,a,r)}},{key:"_calculateNewTarget",value:function(t){var e=t.startTarget,i=t.zoom,n=t.pixelOffset,r=Object.assign({},this._viewportProps);Number.isFinite(i)&&(r.zoom=i),e&&(r.target=e);var a=new this.ViewportType(r),o=a.project(r.target);return a.unproject([o[0]-n[0],o[1]-n[1],o[2]])}},{key:"_getUpdatedState",value:function(t){return new e(Object.assign({},this._viewportProps,this._interactiveState,t))}},{key:"_applyConstraints",value:function(t){var e=t.maxZoom,i=t.minZoom,n=t.zoom;return t.zoom=n>e?e:n,t.zoom=n<i?i:n,t}}]),e}(ki),Zn=function(t){function e(t){return Object(C.a)(this,e),Object(A.a)(this,Object(I.a)(e).call(this,Bn,t))}return Object(R.a)(e,t),Object(L.a)(e,[{key:"_getTransitionProps",value:function(){return Vn}}]),e}(mi),Gn=Math.PI/180;function Xn(t){var e=t.height,i=t.fovy,n=t.orbitAxis,r=t.rotationX,a=t.rotationOrbit,o=(t.zoom,.5/Math.tan(i*Gn/2)),s=(new je.a).lookAt({eye:[0,0,o]});s.rotateX(r*Gn),"Z"===n?s.rotateZ(a*Gn):s.rotateY(a*Gn);var c=1/(e||1);return s.scale([c,c,c]),s}var Wn=function(t){function e(t){Object(C.a)(this,e);var i=t.id,n=t.x,r=t.y,a=t.width,o=t.height,s=t.fovy,c=void 0===s?50:s,u=t.near,l=t.far,h=t.orbitAxis,p=void 0===h?"Z":h,d=t.target,v=void 0===d?[0,0,0]:d,f=t.rotationX,g=void 0===f?0:f,y=t.rotationOrbit,m=void 0===y?0:y,b=t.zoom,w=void 0===b?0:b;return Object(A.a)(this,Object(I.a)(e).call(this,{id:i,viewMatrix:Xn({height:o,fovy:c,orbitAxis:p,rotationX:g,rotationOrbit:m,zoom:w}),fovy:c,near:u,far:l,x:n,y:r,position:v,width:a,height:o,zoom:w}))}return Object(R.a)(e,t),e}(Me),Yn=function(t){function e(){return Object(C.a)(this,e),Object(A.a)(this,Object(I.a)(e).apply(this,arguments))}return Object(R.a)(e,t),Object(L.a)(e,[{key:"_getViewport",value:function(t){var e=t.x,i=t.y,n=t.width,r=t.height,a=t.viewState;return new Wn(Object.assign({id:this.id,x:e,y:i,width:n,height:r},this.props,a))}},{key:"controller",get:function(){return this._getControllerProps({type:Zn,ViewportType:Wn})}}]),e}(Ke);Yn.displayName="OrbitView";var qn=Math.PI/180;(function(t){function e(){return Object(C.a)(this,e),Object(A.a)(this,Object(I.a)(e).apply(this,arguments))}return Object(R.a)(e,t),Object(L.a)(e,[{key:"_getViewport",value:function(t){var e=t.x,i=t.y,n=t.width,r=t.height,a=t.viewState,o=a.eye,s=a.lookAt,c=void 0===s?[0,0,0]:s,l=a.up,h=void 0===l?[0,1,0]:l,p=t.fovy||a.fovy||75,d=t.near||a.near||1,v=t.far||a.far||100,f=Number.isFinite(a.aspect)?a.aspect:n/r,g=p*qn;return new Me({id:this.id,x:e,y:i,width:n,height:r,viewMatrix:u.f([],o,c,h),projectionMatrix:u.i([],g,f,d,v)})}}]),e}(Ke)).displayName="PerspectiveView";var Hn={transitionDuration:300,transitionEasing:function(t){return t},transitionInterpolator:new ai(["target","zoom"]),transitionInterruption:si},Kn=function(t){function e(t){var i;return Object(C.a)(this,e),(i=Object(A.a)(this,Object(I.a)(e).call(this,Bn,t))).invertPan=!0,i}return Object(R.a)(e,t),Object(L.a)(e,[{key:"_onPanRotate",value:function(t){return!1}},{key:"_getTransitionProps",value:function(){return Hn}}]),e}(mi),Jn=(new je.a).lookAt({eye:[0,0,1]});function Qn(t){var e=t.width,i=t.height,n=t.near,r=t.far;return e=e||1,i=i||1,(new je.a).ortho({left:-e/2,right:e/2,bottom:i/2,top:-i/2,near:n,far:r})}var $n=function(t){function e(t){var i=t.id,n=t.x,r=t.y,a=t.width,o=t.height,s=t.near,c=void 0===s?.1:s,u=t.far,l=void 0===u?1e3:u,h=t.zoom,p=void 0===h?0:h,d=t.target,v=void 0===d?[0,0,0]:d;return Object(C.a)(this,e),Object(A.a)(void 0,new Me({id:i,x:n,y:r,width:a,height:o,position:v,viewMatrix:Jn,projectionMatrix:Qn({width:a,height:o,near:c,far:l}),zoom:p}))}return Object(R.a)(e,t),e}(Me);(function(t){function e(){return Object(C.a)(this,e),Object(A.a)(this,Object(I.a)(e).apply(this,arguments))}return Object(R.a)(e,t),Object(L.a)(e,[{key:"_getViewport",value:function(t){var e=t.x,i=t.y,n=t.width,r=t.height,a=t.viewState;return new $n(Object.assign({id:this.id,x:e,y:i,width:n,height:r},this.props,a))}},{key:"controller",get:function(){return this._getControllerProps({type:Kn,ViewportType:$n})}}]),e}(Ke)).displayName="OrthographicView";var tr=.01,er=["longitude","latitude","zoom"];var ir=["bearing","pitch"],nr=(function(t){function e(){return Object(C.a)(this,e),Object(A.a)(this,Object(I.a)(e).call(this,{compare:["longitude","latitude","zoom","bearing","pitch"],extract:["width","height","longitude","latitude","zoom","bearing","pitch"],required:["width","height","latitude","longitude","zoom"]}))}Object(R.a)(e,t),Object(L.a)(e,[{key:"interpolateProps",value:function(t,e,i){for(var n=function(t,e,i){var n,r={},a=t.zoom,o=[t.longitude,t.latitude],s=tt(a),c=e.zoom,u=[e.longitude,e.latitude],l=tt(c-a),h=it(o,s),p=it(u,s),d=X.g([],p,h),v=Math.max(t.width,t.height),f=v/l,g=X.c(d);if(Math.abs(g)<tr){for(var y=0;y<er.length;y++){var m=er[y],b=t[m],w=e[m];r[m]=(n=i)*w+(1-n)*b}return r}var _=1.414*1.414,k=(f*f-v*v+_*_*g*g)/(2*v*_*g),j=(f*f-v*v-_*_*g*g)/(2*f*_*g),P=Math.log(Math.sqrt(k*k+1)-k),O=i*((Math.log(Math.sqrt(j*j+1)-j)-P)/1.414),S=Math.cosh(P)/Math.cosh(P+1.414*O),x=v*((Math.cosh(P)*Math.tanh(P+1.414*O)-Math.sinh(P))/_)/g,M=1/S,E=a+et(M),T=X.f([],d,x);X.a(T,T,h),X.f(T,T,M);var C=nt(T,tt(E));return r.longitude=C[0],r.latitude=C[1],r.zoom=E,r}(t,e,i),r=0;r<ir.length;r++){var a=ir[r];n[a]=Object(ke.g)(t[a]||0,e[a]||0,i)}return n}}])}(ni),function(){function t(){var e=(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{}).overAlloc,i=void 0===e?1:e;Object(C.a)(this,t),this.overAlloc=i}return Object(L.a)(t,[{key:"allocate",value:function(t,e,i){var n=i.size,r=i.type,a=i.copy,o=void 0!==a&&a,s=e*n;if(t&&s<=t.length)return t;var c=Math.max(Math.ceil(s*this.overAlloc),1),u=this._allocate(r,c);return t&&o&&u.set(t),this._release(t),u}},{key:"_allocate",value:function(){return new(arguments.length>0&&void 0!==arguments[0]?arguments[0]:Float32Array)(arguments.length>1?arguments[1]:void 0)}},{key:"_release",value:function(t){}}]),t}()),rr=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};Object(C.a)(this,t);var i=e.attributes,n=void 0===i?{}:i;this.typedArrayManager=new nr,this.indexLayout=null,this.bufferLayout=null,this.vertexCount=0,this.instanceCount=0,this.attributes={},this._attributeDefs=n,this.updateGeometry(e),Object.seal(this)}return Object(L.a)(t,[{key:"updateGeometry",value:function(t){var e=t.data,i=t.getGeometry,n=t.positionFormat,r=t.fp64;this.data=e,this.getGeometry=i,this.fp64=r,this.positionSize="XY"===n?2:3,this._rebuildGeometry()}},{key:"updatePartialGeometry",value:function(t){t.start,t.count,t.objects}},{key:"updateGeometryAttributes",value:function(t,e,i){throw new Error("Not implemented")}},{key:"getGeometrySize",value:function(t){throw new Error("Not implemented")}},{key:"_forEachGeometry",value:function(t){var e=this.data,i=this.getGeometry,n=ft(e),r=n.iterable,a=n.objectInfo,o=!0,s=!1,c=void 0;try{for(var u,l=r[Symbol.iterator]();!(o=(u=l.next()).done);o=!0){var h=u.value;a.index++,t(i(h,a),a.index)}}catch(p){s=!0,c=p}finally{try{o||null==l.return||l.return()}finally{if(s)throw c}}}},{key:"_updateAttribute",value:function(t){var e=t.target,i=t.size,n=t.getValue,r=this.data,a=this.bufferLayout,o=0,s=ft(r),c=s.iterable,u=s.objectInfo,l=!0,h=!1,p=void 0;try{for(var d,v=c[Symbol.iterator]();!(l=(d=v.next()).done);l=!0){var f=d.value;u.index++;var g=n(f,u),y=a[u.index];we({target:e,source:g,start:o,count:y}),o+=y*i}}catch(m){h=!0,p=m}finally{try{l||null==v.return||v.return()}finally{if(h)throw p}}return e}},{key:"_rebuildGeometry",value:function(){var t=this;if(this.data&&this.getGeometry){var e=[],i=[],n=0;this._forEachGeometry(function(e,r){var a=t.getGeometrySize(e);n+=a,i[r]=a});var r=this.attributes,a=this._attributeDefs,o=this.typedArrayManager,s=this.fp64;for(var c in a){var u=a[c];u.fp64Only&&!s||(r[c]=o.allocate(r[c],n,u))}this.indexLayout=e,this.bufferLayout=i,this.instanceCount=n;var l={vertexStart:0,indexStart:0};this._forEachGeometry(function(n,r){var a=i[r];l.geometryIndex=r,l.geometrySize=a,t.updateGeometryAttributes(n,l),l.vertexStart+=a,l.indexStart+=e[r]||0}),this.vertexCount=l.indexStart}}}]),t}();i.d(e,"h",function(){return ar}),i.d(e,"a",function(){return h}),i.d(e,"b",function(){return In}),i.d(e,"c",function(){return ye}),i.d(e,"f",function(){return Ke}),i.d(e,"e",function(){return Yn}),i.d(e,"d",function(){return ai}),i.d(e,"i",function(){return r}),i.d(e,"g",function(){return ft});var ar={Tesselator:rr,flattenVertices:function t(e){for(var i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=i.result,r=void 0===n?[]:n,a=i.dimensions,o=void 0===a?3:a,s=-1,c=0;++s<e.length;){var u=e[s];Array.isArray(u)||ArrayBuffer.isView(u)?t(u,{result:r,dimensions:o}):c<o&&(r.push(u),c++)}return c>0&&c<o&&r.push(0),r},fillArray:we,count:Kt,memoize:v}},250:function(t,e,i){var n=i(20);n(n.S,"Math",{log2:function(t){return Math.log(t)/Math.LN2}})},298:function(t,e,i){"use strict";(function(t,n){i.d(e,"a",function(){return a});var r=i(208),a=("object"!==(void 0===t?"undefined":Object(r.a)(t))||"[object process]"!==String(t)||t.browser,"undefined"!=typeof window&&window,void 0!==n?n:window);"undefined"!=typeof document&&document}).call(this,i(117),i(77))},319:function(t,e,i){var n;!function(r,a,o,s){"use strict";var c,u=["","webkit","Moz","MS","ms","o"],l=a.createElement("div"),h="function",p=Math.round,d=Math.abs,v=Date.now;function f(t,e,i){return setTimeout(k(t,i),e)}function g(t,e,i){return!!Array.isArray(t)&&(y(t,i[e],i),!0)}function y(t,e,i){var n;if(t)if(t.forEach)t.forEach(e,i);else if(t.length!==s)for(n=0;n<t.length;)e.call(i,t[n],n,t),n++;else for(n in t)t.hasOwnProperty(n)&&e.call(i,t[n],n,t)}function m(t,e,i){var n="DEPRECATED METHOD: "+e+"\n"+i+" AT \n";return function(){var e=new Error("get-stack-trace"),i=e&&e.stack?e.stack.replace(/^[^\(]+?[\n$]/gm,"").replace(/^\s+at\s+/gm,"").replace(/^Object.<anonymous>\s*\(/gm,"{anonymous}()@"):"Unknown Stack Trace",a=r.console&&(r.console.warn||r.console.log);return a&&a.call(r.console,n,i),t.apply(this,arguments)}}c="function"!=typeof Object.assign?function(t){if(t===s||null===t)throw new TypeError("Cannot convert undefined or null to object");for(var e=Object(t),i=1;i<arguments.length;i++){var n=arguments[i];if(n!==s&&null!==n)for(var r in n)n.hasOwnProperty(r)&&(e[r]=n[r])}return e}:Object.assign;var b=m(function(t,e,i){for(var n=Object.keys(e),r=0;r<n.length;)(!i||i&&t[n[r]]===s)&&(t[n[r]]=e[n[r]]),r++;return t},"extend","Use `assign`."),w=m(function(t,e){return b(t,e,!0)},"merge","Use `assign`.");function _(t,e,i){var n,r=e.prototype;(n=t.prototype=Object.create(r)).constructor=t,n._super=r,i&&c(n,i)}function k(t,e){return function(){return t.apply(e,arguments)}}function j(t,e){return typeof t==h?t.apply(e&&e[0]||s,e):t}function P(t,e){return t===s?e:t}function O(t,e,i){y(E(e),function(e){t.addEventListener(e,i,!1)})}function S(t,e,i){y(E(e),function(e){t.removeEventListener(e,i,!1)})}function x(t,e){for(;t;){if(t==e)return!0;t=t.parentNode}return!1}function M(t,e){return t.indexOf(e)>-1}function E(t){return t.trim().split(/\s+/g)}function T(t,e,i){if(t.indexOf&&!i)return t.indexOf(e);for(var n=0;n<t.length;){if(i&&t[n][i]==e||!i&&t[n]===e)return n;n++}return-1}function C(t){return Array.prototype.slice.call(t,0)}function L(t,e,i){for(var n=[],r=[],a=0;a<t.length;){var o=e?t[a][e]:t[a];T(r,o)<0&&n.push(t[a]),r[a]=o,a++}return i&&(n=e?n.sort(function(t,i){return t[e]>i[e]}):n.sort()),n}function A(t,e){for(var i,n,r=e[0].toUpperCase()+e.slice(1),a=0;a<u.length;){if((n=(i=u[a])?i+r:e)in t)return n;a++}return s}var I=1;function R(t){var e=t.ownerDocument||t;return e.defaultView||e.parentWindow||r}var F="ontouchstart"in r,z=A(r,"PointerEvent")!==s,D=F&&/mobile|tablet|ip(ad|hone|od)|android/i.test(navigator.userAgent),N=25,V=1,U=2,B=4,Z=8,G=1,X=2,W=4,Y=8,q=16,H=X|W,K=Y|q,J=H|K,Q=["x","y"],$=["clientX","clientY"];function tt(t,e){var i=this;this.manager=t,this.callback=e,this.element=t.element,this.target=t.options.inputTarget,this.domHandler=function(e){j(t.options.enable,[t])&&i.handler(e)},this.init()}function et(t,e,i){var n=i.pointers.length,r=i.changedPointers.length,a=e&V&&n-r==0,o=e&(B|Z)&&n-r==0;i.isFirst=!!a,i.isFinal=!!o,a&&(t.session={}),i.eventType=e,function(t,e){var i=t.session,n=e.pointers,r=n.length;i.firstInput||(i.firstInput=it(e));r>1&&!i.firstMultiple?i.firstMultiple=it(e):1===r&&(i.firstMultiple=!1);var a=i.firstInput,o=i.firstMultiple,c=o?o.center:a.center,u=e.center=nt(n);e.timeStamp=v(),e.deltaTime=e.timeStamp-a.timeStamp,e.angle=st(c,u),e.distance=ot(c,u),function(t,e){var i=e.center,n=t.offsetDelta||{},r=t.prevDelta||{},a=t.prevInput||{};e.eventType!==V&&a.eventType!==B||(r=t.prevDelta={x:a.deltaX||0,y:a.deltaY||0},n=t.offsetDelta={x:i.x,y:i.y});e.deltaX=r.x+(i.x-n.x),e.deltaY=r.y+(i.y-n.y)}(i,e),e.offsetDirection=at(e.deltaX,e.deltaY);var l=rt(e.deltaTime,e.deltaX,e.deltaY);e.overallVelocityX=l.x,e.overallVelocityY=l.y,e.overallVelocity=d(l.x)>d(l.y)?l.x:l.y,e.scale=o?(h=o.pointers,p=n,ot(p[0],p[1],$)/ot(h[0],h[1],$)):1,e.rotation=o?function(t,e){return st(e[1],e[0],$)+st(t[1],t[0],$)}(o.pointers,n):0,e.maxPointers=i.prevInput?e.pointers.length>i.prevInput.maxPointers?e.pointers.length:i.prevInput.maxPointers:e.pointers.length,function(t,e){var i,n,r,a,o=t.lastInterval||e,c=e.timeStamp-o.timeStamp;if(e.eventType!=Z&&(c>N||o.velocity===s)){var u=e.deltaX-o.deltaX,l=e.deltaY-o.deltaY,h=rt(c,u,l);n=h.x,r=h.y,i=d(h.x)>d(h.y)?h.x:h.y,a=at(u,l),t.lastInterval=e}else i=o.velocity,n=o.velocityX,r=o.velocityY,a=o.direction;e.velocity=i,e.velocityX=n,e.velocityY=r,e.direction=a}(i,e);var h,p;var f=t.element;x(e.srcEvent.target,f)&&(f=e.srcEvent.target);e.target=f}(t,i),t.emit("hammer.input",i),t.recognize(i),t.session.prevInput=i}function it(t){for(var e=[],i=0;i<t.pointers.length;)e[i]={clientX:p(t.pointers[i].clientX),clientY:p(t.pointers[i].clientY)},i++;return{timeStamp:v(),pointers:e,center:nt(e),deltaX:t.deltaX,deltaY:t.deltaY}}function nt(t){var e=t.length;if(1===e)return{x:p(t[0].clientX),y:p(t[0].clientY)};for(var i=0,n=0,r=0;r<e;)i+=t[r].clientX,n+=t[r].clientY,r++;return{x:p(i/e),y:p(n/e)}}function rt(t,e,i){return{x:e/t||0,y:i/t||0}}function at(t,e){return t===e?G:d(t)>=d(e)?t<0?X:W:e<0?Y:q}function ot(t,e,i){i||(i=Q);var n=e[i[0]]-t[i[0]],r=e[i[1]]-t[i[1]];return Math.sqrt(n*n+r*r)}function st(t,e,i){i||(i=Q);var n=e[i[0]]-t[i[0]],r=e[i[1]]-t[i[1]];return 180*Math.atan2(r,n)/Math.PI}tt.prototype={handler:function(){},init:function(){this.evEl&&O(this.element,this.evEl,this.domHandler),this.evTarget&&O(this.target,this.evTarget,this.domHandler),this.evWin&&O(R(this.element),this.evWin,this.domHandler)},destroy:function(){this.evEl&&S(this.element,this.evEl,this.domHandler),this.evTarget&&S(this.target,this.evTarget,this.domHandler),this.evWin&&S(R(this.element),this.evWin,this.domHandler)}};var ct={mousedown:V,mousemove:U,mouseup:B},ut="mousedown",lt="mousemove mouseup";function ht(){this.evEl=ut,this.evWin=lt,this.pressed=!1,tt.apply(this,arguments)}_(ht,tt,{handler:function(t){var e=ct[t.type];e&V&&0===t.button&&(this.pressed=!0),e&U&&1!==t.which&&(e=B),this.pressed&&(e&B&&(this.pressed=!1),this.callback(this.manager,e,{pointers:[t],changedPointers:[t],pointerType:"mouse",srcEvent:t}))}});var pt={pointerdown:V,pointermove:U,pointerup:B,pointercancel:Z,pointerout:Z},dt={2:"touch",3:"pen",4:"mouse",5:"kinect"},vt="pointerdown",ft="pointermove pointerup pointercancel";function gt(){this.evEl=vt,this.evWin=ft,tt.apply(this,arguments),this.store=this.manager.session.pointerEvents=[]}r.MSPointerEvent&&!r.PointerEvent&&(vt="MSPointerDown",ft="MSPointerMove MSPointerUp MSPointerCancel"),_(gt,tt,{handler:function(t){var e=this.store,i=!1,n=t.type.toLowerCase().replace("ms",""),r=pt[n],a=dt[t.pointerType]||t.pointerType,o="touch"==a,s=T(e,t.pointerId,"pointerId");r&V&&(0===t.button||o)?s<0&&(e.push(t),s=e.length-1):r&(B|Z)&&(i=!0),s<0||(e[s]=t,this.callback(this.manager,r,{pointers:e,changedPointers:[t],pointerType:a,srcEvent:t}),i&&e.splice(s,1))}});var yt={touchstart:V,touchmove:U,touchend:B,touchcancel:Z},mt="touchstart",bt="touchstart touchmove touchend touchcancel";function wt(){this.evTarget=mt,this.evWin=bt,this.started=!1,tt.apply(this,arguments)}_(wt,tt,{handler:function(t){var e=yt[t.type];if(e===V&&(this.started=!0),this.started){var i=function(t,e){var i=C(t.touches),n=C(t.changedTouches);e&(B|Z)&&(i=L(i.concat(n),"identifier",!0));return[i,n]}.call(this,t,e);e&(B|Z)&&i[0].length-i[1].length==0&&(this.started=!1),this.callback(this.manager,e,{pointers:i[0],changedPointers:i[1],pointerType:"touch",srcEvent:t})}}});var _t={touchstart:V,touchmove:U,touchend:B,touchcancel:Z},kt="touchstart touchmove touchend touchcancel";function jt(){this.evTarget=kt,this.targetIds={},tt.apply(this,arguments)}_(jt,tt,{handler:function(t){var e=_t[t.type],i=function(t,e){var i=C(t.touches),n=this.targetIds;if(e&(V|U)&&1===i.length)return n[i[0].identifier]=!0,[i,i];var r,a,o=C(t.changedTouches),s=[],c=this.target;if(a=i.filter(function(t){return x(t.target,c)}),e===V)for(r=0;r<a.length;)n[a[r].identifier]=!0,r++;r=0;for(;r<o.length;)n[o[r].identifier]&&s.push(o[r]),e&(B|Z)&&delete n[o[r].identifier],r++;if(!s.length)return;return[L(a.concat(s),"identifier",!0),s]}.call(this,t,e);i&&this.callback(this.manager,e,{pointers:i[0],changedPointers:i[1],pointerType:"touch",srcEvent:t})}});var Pt=2500,Ot=25;function St(){tt.apply(this,arguments);var t=k(this.handler,this);this.touch=new jt(this.manager,t),this.mouse=new ht(this.manager,t),this.primaryTouch=null,this.lastTouches=[]}function xt(t){var e=t.changedPointers[0];if(e.identifier===this.primaryTouch){var i={x:e.clientX,y:e.clientY};this.lastTouches.push(i);var n=this.lastTouches;setTimeout(function(){var t=n.indexOf(i);t>-1&&n.splice(t,1)},Pt)}}_(St,tt,{handler:function(t,e,i){var n="touch"==i.pointerType,r="mouse"==i.pointerType;if(!(r&&i.sourceCapabilities&&i.sourceCapabilities.firesTouchEvents)){if(n)(function(t,e){t&V?(this.primaryTouch=e.changedPointers[0].identifier,xt.call(this,e)):t&(B|Z)&&xt.call(this,e)}).call(this,e,i);else if(r&&function(t){for(var e=t.srcEvent.clientX,i=t.srcEvent.clientY,n=0;n<this.lastTouches.length;n++){var r=this.lastTouches[n],a=Math.abs(e-r.x),o=Math.abs(i-r.y);if(a<=Ot&&o<=Ot)return!0}return!1}.call(this,i))return;this.callback(t,e,i)}},destroy:function(){this.touch.destroy(),this.mouse.destroy()}});var Mt=A(l.style,"touchAction"),Et=Mt!==s,Tt="auto",Ct="manipulation",Lt="none",At="pan-x",It="pan-y",Rt=function(){if(!Et)return!1;var t={},e=r.CSS&&r.CSS.supports;return["auto","manipulation","pan-y","pan-x","pan-x pan-y","none"].forEach(function(i){t[i]=!e||r.CSS.supports("touch-action",i)}),t}();function Ft(t,e){this.manager=t,this.set(e)}Ft.prototype={set:function(t){"compute"==t&&(t=this.compute()),Et&&this.manager.element.style&&Rt[t]&&(this.manager.element.style[Mt]=t),this.actions=t.toLowerCase().trim()},update:function(){this.set(this.manager.options.touchAction)},compute:function(){var t=[];return y(this.manager.recognizers,function(e){j(e.options.enable,[e])&&(t=t.concat(e.getTouchAction()))}),function(t){if(M(t,Lt))return Lt;var e=M(t,At),i=M(t,It);if(e&&i)return Lt;if(e||i)return e?At:It;if(M(t,Ct))return Ct;return Tt}(t.join(" "))},preventDefaults:function(t){var e=t.srcEvent,i=t.offsetDirection;if(this.manager.session.prevented)e.preventDefault();else{var n=this.actions,r=M(n,Lt)&&!Rt[Lt],a=M(n,It)&&!Rt[It],o=M(n,At)&&!Rt[At];if(r){var s=1===t.pointers.length,c=t.distance<2,u=t.deltaTime<250;if(s&&c&&u)return}if(!o||!a)return r||a&&i&H||o&&i&K?this.preventSrc(e):void 0}},preventSrc:function(t){this.manager.session.prevented=!0,t.preventDefault()}};var zt=1,Dt=2,Nt=4,Vt=8,Ut=Vt,Bt=16;function Zt(t){this.options=c({},this.defaults,t||{}),this.id=I++,this.manager=null,this.options.enable=P(this.options.enable,!0),this.state=zt,this.simultaneous={},this.requireFail=[]}function Gt(t){return t&Bt?"cancel":t&Vt?"end":t&Nt?"move":t&Dt?"start":""}function Xt(t){return t==q?"down":t==Y?"up":t==X?"left":t==W?"right":""}function Wt(t,e){var i=e.manager;return i?i.get(t):t}function Yt(){Zt.apply(this,arguments)}function qt(){Yt.apply(this,arguments),this.pX=null,this.pY=null}function Ht(){Yt.apply(this,arguments)}function Kt(){Zt.apply(this,arguments),this._timer=null,this._input=null}function Jt(){Yt.apply(this,arguments)}function Qt(){Yt.apply(this,arguments)}function $t(){Zt.apply(this,arguments),this.pTime=!1,this.pCenter=!1,this._timer=null,this._input=null,this.count=0}function te(t,e){return(e=e||{}).recognizers=P(e.recognizers,te.defaults.preset),new ee(t,e)}Zt.prototype={defaults:{},set:function(t){return c(this.options,t),this.manager&&this.manager.touchAction.update(),this},recognizeWith:function(t){if(g(t,"recognizeWith",this))return this;var e=this.simultaneous;return e[(t=Wt(t,this)).id]||(e[t.id]=t,t.recognizeWith(this)),this},dropRecognizeWith:function(t){return g(t,"dropRecognizeWith",this)?this:(t=Wt(t,this),delete this.simultaneous[t.id],this)},requireFailure:function(t){if(g(t,"requireFailure",this))return this;var e=this.requireFail;return-1===T(e,t=Wt(t,this))&&(e.push(t),t.requireFailure(this)),this},dropRequireFailure:function(t){if(g(t,"dropRequireFailure",this))return this;t=Wt(t,this);var e=T(this.requireFail,t);return e>-1&&this.requireFail.splice(e,1),this},hasRequireFailures:function(){return this.requireFail.length>0},canRecognizeWith:function(t){return!!this.simultaneous[t.id]},emit:function(t){var e=this,i=this.state;function n(i){e.manager.emit(i,t)}i<Vt&&n(e.options.event+Gt(i)),n(e.options.event),t.additionalEvent&&n(t.additionalEvent),i>=Vt&&n(e.options.event+Gt(i))},tryEmit:function(t){if(this.canEmit())return this.emit(t);this.state=32},canEmit:function(){for(var t=0;t<this.requireFail.length;){if(!(this.requireFail[t].state&(32|zt)))return!1;t++}return!0},recognize:function(t){var e=c({},t);if(!j(this.options.enable,[this,e]))return this.reset(),void(this.state=32);this.state&(Ut|Bt|32)&&(this.state=zt),this.state=this.process(e),this.state&(Dt|Nt|Vt|Bt)&&this.tryEmit(e)},process:function(t){},getTouchAction:function(){},reset:function(){}},_(Yt,Zt,{defaults:{pointers:1},attrTest:function(t){var e=this.options.pointers;return 0===e||t.pointers.length===e},process:function(t){var e=this.state,i=t.eventType,n=e&(Dt|Nt),r=this.attrTest(t);return n&&(i&Z||!r)?e|Bt:n||r?i&B?e|Vt:e&Dt?e|Nt:Dt:32}}),_(qt,Yt,{defaults:{event:"pan",threshold:10,pointers:1,direction:J},getTouchAction:function(){var t=this.options.direction,e=[];return t&H&&e.push(It),t&K&&e.push(At),e},directionTest:function(t){var e=this.options,i=!0,n=t.distance,r=t.direction,a=t.deltaX,o=t.deltaY;return r&e.direction||(e.direction&H?(r=0===a?G:a<0?X:W,i=a!=this.pX,n=Math.abs(t.deltaX)):(r=0===o?G:o<0?Y:q,i=o!=this.pY,n=Math.abs(t.deltaY))),t.direction=r,i&&n>e.threshold&&r&e.direction},attrTest:function(t){return Yt.prototype.attrTest.call(this,t)&&(this.state&Dt||!(this.state&Dt)&&this.directionTest(t))},emit:function(t){this.pX=t.deltaX,this.pY=t.deltaY;var e=Xt(t.direction);e&&(t.additionalEvent=this.options.event+e),this._super.emit.call(this,t)}}),_(Ht,Yt,{defaults:{event:"pinch",threshold:0,pointers:2},getTouchAction:function(){return[Lt]},attrTest:function(t){return this._super.attrTest.call(this,t)&&(Math.abs(t.scale-1)>this.options.threshold||this.state&Dt)},emit:function(t){if(1!==t.scale){var e=t.scale<1?"in":"out";t.additionalEvent=this.options.event+e}this._super.emit.call(this,t)}}),_(Kt,Zt,{defaults:{event:"press",pointers:1,time:251,threshold:9},getTouchAction:function(){return[Tt]},process:function(t){var e=this.options,i=t.pointers.length===e.pointers,n=t.distance<e.threshold,r=t.deltaTime>e.time;if(this._input=t,!n||!i||t.eventType&(B|Z)&&!r)this.reset();else if(t.eventType&V)this.reset(),this._timer=f(function(){this.state=Ut,this.tryEmit()},e.time,this);else if(t.eventType&B)return Ut;return 32},reset:function(){clearTimeout(this._timer)},emit:function(t){this.state===Ut&&(t&&t.eventType&B?this.manager.emit(this.options.event+"up",t):(this._input.timeStamp=v(),this.manager.emit(this.options.event,this._input)))}}),_(Jt,Yt,{defaults:{event:"rotate",threshold:0,pointers:2},getTouchAction:function(){return[Lt]},attrTest:function(t){return this._super.attrTest.call(this,t)&&(Math.abs(t.rotation)>this.options.threshold||this.state&Dt)}}),_(Qt,Yt,{defaults:{event:"swipe",threshold:10,velocity:.3,direction:H|K,pointers:1},getTouchAction:function(){return qt.prototype.getTouchAction.call(this)},attrTest:function(t){var e,i=this.options.direction;return i&(H|K)?e=t.overallVelocity:i&H?e=t.overallVelocityX:i&K&&(e=t.overallVelocityY),this._super.attrTest.call(this,t)&&i&t.offsetDirection&&t.distance>this.options.threshold&&t.maxPointers==this.options.pointers&&d(e)>this.options.velocity&&t.eventType&B},emit:function(t){var e=Xt(t.offsetDirection);e&&this.manager.emit(this.options.event+e,t),this.manager.emit(this.options.event,t)}}),_($t,Zt,{defaults:{event:"tap",pointers:1,taps:1,interval:300,time:250,threshold:9,posThreshold:10},getTouchAction:function(){return[Ct]},process:function(t){var e=this.options,i=t.pointers.length===e.pointers,n=t.distance<e.threshold,r=t.deltaTime<e.time;if(this.reset(),t.eventType&V&&0===this.count)return this.failTimeout();if(n&&r&&i){if(t.eventType!=B)return this.failTimeout();var a=!this.pTime||t.timeStamp-this.pTime<e.interval,o=!this.pCenter||ot(this.pCenter,t.center)<e.posThreshold;if(this.pTime=t.timeStamp,this.pCenter=t.center,o&&a?this.count+=1:this.count=1,this._input=t,0===this.count%e.taps)return this.hasRequireFailures()?(this._timer=f(function(){this.state=Ut,this.tryEmit()},e.interval,this),Dt):Ut}return 32},failTimeout:function(){return this._timer=f(function(){this.state=32},this.options.interval,this),32},reset:function(){clearTimeout(this._timer)},emit:function(){this.state==Ut&&(this._input.tapCount=this.count,this.manager.emit(this.options.event,this._input))}}),te.VERSION="2.0.7",te.defaults={domEvents:!1,touchAction:"compute",enable:!0,inputTarget:null,inputClass:null,preset:[[Jt,{enable:!1}],[Ht,{enable:!1},["rotate"]],[Qt,{direction:H}],[qt,{direction:H},["swipe"]],[$t],[$t,{event:"doubletap",taps:2},["tap"]],[Kt]],cssProps:{userSelect:"none",touchSelect:"none",touchCallout:"none",contentZooming:"none",userDrag:"none",tapHighlightColor:"rgba(0,0,0,0)"}};function ee(t,e){var i;this.options=c({},te.defaults,e||{}),this.options.inputTarget=this.options.inputTarget||t,this.handlers={},this.session={},this.recognizers=[],this.oldCssProps={},this.element=t,this.input=new((i=this).options.inputClass||(z?gt:D?jt:F?St:ht))(i,et),this.touchAction=new Ft(this,this.options.touchAction),ie(this,!0),y(this.options.recognizers,function(t){var e=this.add(new t[0](t[1]));t[2]&&e.recognizeWith(t[2]),t[3]&&e.requireFailure(t[3])},this)}function ie(t,e){var i,n=t.element;n.style&&(y(t.options.cssProps,function(r,a){i=A(n.style,a),e?(t.oldCssProps[i]=n.style[i],n.style[i]=r):n.style[i]=t.oldCssProps[i]||""}),e||(t.oldCssProps={}))}ee.prototype={set:function(t){return c(this.options,t),t.touchAction&&this.touchAction.update(),t.inputTarget&&(this.input.destroy(),this.input.target=t.inputTarget,this.input.init()),this},stop:function(t){this.session.stopped=t?2:1},recognize:function(t){var e=this.session;if(!e.stopped){var i;this.touchAction.preventDefaults(t);var n=this.recognizers,r=e.curRecognizer;(!r||r&&r.state&Ut)&&(r=e.curRecognizer=null);for(var a=0;a<n.length;)i=n[a],2===e.stopped||r&&i!=r&&!i.canRecognizeWith(r)?i.reset():i.recognize(t),!r&&i.state&(Dt|Nt|Vt)&&(r=e.curRecognizer=i),a++}},get:function(t){if(t instanceof Zt)return t;for(var e=this.recognizers,i=0;i<e.length;i++)if(e[i].options.event==t)return e[i];return null},add:function(t){if(g(t,"add",this))return this;var e=this.get(t.options.event);return e&&this.remove(e),this.recognizers.push(t),t.manager=this,this.touchAction.update(),t},remove:function(t){if(g(t,"remove",this))return this;if(t=this.get(t)){var e=this.recognizers,i=T(e,t);-1!==i&&(e.splice(i,1),this.touchAction.update())}return this},on:function(t,e){if(t!==s&&e!==s){var i=this.handlers;return y(E(t),function(t){i[t]=i[t]||[],i[t].push(e)}),this}},off:function(t,e){if(t!==s){var i=this.handlers;return y(E(t),function(t){e?i[t]&&i[t].splice(T(i[t],e),1):delete i[t]}),this}},emit:function(t,e){this.options.domEvents&&function(t,e){var i=a.createEvent("Event");i.initEvent(t,!0,!0),i.gesture=e,e.target.dispatchEvent(i)}(t,e);var i=this.handlers[t]&&this.handlers[t].slice();if(i&&i.length){e.type=t,e.preventDefault=function(){e.srcEvent.preventDefault()};for(var n=0;n<i.length;)i[n](e),n++}},destroy:function(){this.element&&ie(this,!1),this.handlers={},this.session={},this.input.destroy(),this.element=null}},c(te,{INPUT_START:V,INPUT_MOVE:U,INPUT_END:B,INPUT_CANCEL:Z,STATE_POSSIBLE:zt,STATE_BEGAN:Dt,STATE_CHANGED:Nt,STATE_ENDED:Vt,STATE_RECOGNIZED:Ut,STATE_CANCELLED:Bt,STATE_FAILED:32,DIRECTION_NONE:G,DIRECTION_LEFT:X,DIRECTION_RIGHT:W,DIRECTION_UP:Y,DIRECTION_DOWN:q,DIRECTION_HORIZONTAL:H,DIRECTION_VERTICAL:K,DIRECTION_ALL:J,Manager:ee,Input:tt,TouchAction:Ft,TouchInput:jt,MouseInput:ht,PointerEventInput:gt,TouchMouseInput:St,SingleTouchInput:wt,Recognizer:Zt,AttrRecognizer:Yt,Tap:$t,Pan:qt,Swipe:Qt,Pinch:Ht,Rotate:Jt,Press:Kt,on:O,off:S,each:y,merge:w,extend:b,assign:c,inherit:_,bindFn:k,prefixed:A}),(void 0!==r?r:"undefined"!=typeof self?self:{}).Hammer=te,(n=function(){return te}.call(e,i,e,t))===s||(t.exports=n)}(window,document)},320:function(t,e,i){"use strict";(function(t){i.d(e,"b",function(){return n}),i.d(e,"c",function(){return r}),i.d(e,"a",function(){return a});var n="undefined"!=typeof navigator?navigator.userAgent.toLowerCase():"",r="undefined"!=typeof window?window:t,a=(void 0!==t||window,"undefined"!=typeof document&&document,!1);try{var o={get passive(){a=!0}};r.addEventListener("test",o,o),r.removeEventListener("test",o,o)}catch(s){}}).call(this,i(77))},357:function(t,e,i){"use strict";var n=i(198),r=i(199),a=i(201),o=i(200),s=i(202),c=i(209),u=i(0),l=i.n(u),h=i(3),p=i.n(h),d=i(239),v=i(217);function f(t,e){for(;t;){if(t===e)return!0;t=Object.getPrototypeOf(t)}return!1}function g(t){return t?"function"==typeof t?Object(u.createElement)(d.f,{},t):Array.isArray(t)?t.map(g):(f(t.type,d.f),t):t}function y(t){var e=t.children,i=t.layers,n=t.views,r=[],a=[],o={};return l.a.Children.forEach(g(e),function(t){if(t){var e=t.type;if(f(e,d.c)){var i=function(t,e){var i={},n=t.defaultProps||{};for(var r in e)n[r]!==e[r]&&(i[r]=e[r]);return new t(i)}(e,t.props);a.push(i)}else r.push(t);if(e!==d.f&&f(e,d.f)&&t.props.id){var n=new e(t.props);o[n.id]=n}}}),Object.keys(o).length>0&&(Array.isArray(n)?n.forEach(function(t){o[t.id]=t}):n&&(o[n.id]=n),n=Object.values(o)),{layers:i=a.length>0?[].concat(a,Object(v.a)(i)):i,children:r,views:n}}function m(t){var e=t.children,i=(t.viewports,(t.deck||{}).viewManager);if(!i||!i.views.length)return[];var n=i.views[0].id;return e.map(function(t,e){t.props.viewportId&&d.i.removed("viewportId","<View>")(),t.props.viewId&&d.i.removed("viewId","<View>")();var r=n,a=t;f(t.type,d.f)&&(r=t.props.id||n,a=t.props.children);var o=i.getViewport(r),s=i.getViewState(r);if(!o)return null;var c=o.x,l=o.y,h=o.width,p=o.height;a=function t(e,i){return e?"function"==typeof e?e(i):Array.isArray(e)?e.map(function(e){return t(e,i)}):Object(u.cloneElement)(e,i):e}(a,{x:c,y:l,width:h,height:p,viewport:o,viewState:s});var v={position:"absolute",left:c,top:l,width:h,height:p},g="view-child-".concat(r,"-").concat(e);return Object(u.createElement)("div",{key:g,id:g,style:v},a)})}var b=["constructor","render","componentWillMount","componentDidMount","componentWillReceiveProps","shouldComponentUpdate","componentWillUpdate","componentDidUpdate","componentWillUnmount"];i.d(e,"a",function(){return j});var w=d.h.memoize,_=d.b.getPropTypes(p.a),k=d.b.defaultProps,j=function(t){function e(t){var i;return Object(n.a)(this,e),(i=Object(a.a)(this,Object(o.a)(e).call(this,t))).viewports=null,i.children=null,i._needsRedraw=null,function(t){var e=Object.getPrototypeOf(t),i=Object.getOwnPropertyNames(e),n=!0,r=!1,a=void 0;try{for(var o,s=function(){var e=o.value;"function"==typeof t[e]&&(b.find(function(t){return e===t})||(t[e]=t[e].bind(t)))},c=i[Symbol.iterator]();!(n=(o=c.next()).done);n=!0)s()}catch(u){r=!0,a=u}finally{try{n||null==c.return||c.return()}finally{if(r)throw a}}}(Object(c.a)(Object(c.a)(i))),i._extractJSXLayers=w(y),i._positionChildrenUnderViews=w(m),i}return Object(s.a)(e,t),Object(r.a)(e,[{key:"componentDidMount",value:function(){var t=this.props.Deck||d.b;this.deck=this.deck||new t(Object.assign({},this.props,{canvas:this.deckCanvas,_customRender:this._customRender})),this._updateFromProps(this.props)}},{key:"shouldComponentUpdate",value:function(t){this._updateFromProps(t);var e=this.children!==this._parseJSX(t).children,i=this.deck.viewManager&&this.deck.viewManager.needsRedraw();return e&&!i}},{key:"componentDidUpdate",value:function(){this._redrawDeck()}},{key:"componentWillUnmount",value:function(){this.deck.finalize()}},{key:"pickObject",value:function(t){var e=t.x,i=t.y,n=t.radius,r=void 0===n?0:n,a=t.layerIds,o=void 0===a?null:a;return this.deck.pickObject({x:e,y:i,radius:r,layerIds:o})}},{key:"pickMultipleObjects",value:function(t){var e=t.x,i=t.y,n=t.radius,r=void 0===n?0:n,a=t.layerIds,o=void 0===a?null:a,s=t.depth,c=void 0===s?10:s;return this.deck.pickMultipleObjects({x:e,y:i,radius:r,layerIds:o,depth:c})}},{key:"pickObjects",value:function(t){var e=t.x,i=t.y,n=t.width,r=void 0===n?1:n,a=t.height,o=void 0===a?1:a,s=t.layerIds,c=void 0===s?null:s;return this.deck.pickObjects({x:e,y:i,width:r,height:o,layerIds:c})}},{key:"_redrawDeck",value:function(){this._needsRedraw&&(this.deck._drawLayers(this._needsRedraw),this._needsRedraw=null)}},{key:"_customRender",value:function(t){this._needsRedraw=t,this.deck.viewManager.getViewports()!==this.viewports?this.forceUpdate():this._redrawDeck()}},{key:"_parseJSX",value:function(t){return this._extractJSXLayers({layers:t.layers,views:t.views,children:t.children})}},{key:"_updateFromProps",value:function(t){var e=this._parseJSX(t),i=e.layers,n=e.views,r=Object.assign({},t,{layers:i,views:n});this.deck.setProps(r)}},{key:"render",value:function(){var t=this,e=(this.deck||{}).viewManager;this.viewports=e&&e.getViewports(),this.children=this._parseJSX(this.props).children;var i=this._positionChildrenUnderViews({children:this.children,viewports:this.viewports,deck:this.deck}),n=Object.assign({},{position:"absolute",left:0,top:0},this.props.style),r=Object(u.createElement)("canvas",{ref:function(e){return t.deckCanvas=e},key:"deck-canvas",id:this.props.id,style:n});return Object(u.createElement)("div",{id:"deckgl-wrapper"},[i,r])}}]),e}(l.a.Component);j.propTypes=_,j.defaultProps=k},358:function(t,e,i){"use strict";var n=i(198),r=i(199),a=i(201),o=i(200),s=i(218),c=i(202),u=i(239),l=i(203);i.d(e,"a",function(){return g});var h=l.v.fp64LowPart,p=[0,0,0,255],d=[0,0,1],v=new l.k,f={sizeUnits:"pixels",pointSize:{type:"number",min:0,value:10},fp64:!1,getPosition:{type:"accessor",value:function(t){return t.position}},getNormal:{type:"accessor",value:d},getColor:{type:"accessor",value:p},material:v,radiusPixels:{deprecatedFor:"pointSize"}},g=function(t){function e(){return Object(n.a)(this,e),Object(a.a)(this,Object(o.a)(e).apply(this,arguments))}return Object(c.a)(e,t),Object(r.a)(e,[{key:"getShaders",value:function(t){return{vs:"#define SHADER_NAME point-cloud-layer-vertex-shader\n\nattribute vec3 positions;\nattribute vec3 instanceNormals;\nattribute vec4 instanceColors;\nattribute vec3 instancePositions;\nattribute vec2 instancePositions64xyLow;\nattribute vec3 instancePickingColors;\n\nuniform float opacity;\nuniform float radiusPixels;\n\nvarying vec4 vColor;\nvarying vec2 unitPosition;\n\nvoid main(void) {\n  unitPosition = positions.xy;\n  vec4 position_commonspace;\n  gl_Position = project_position_to_clipspace(instancePositions, instancePositions64xyLow, vec3(0.), position_commonspace);\n  gl_Position.xy += project_pixel_size_to_clipspace(positions.xy * radiusPixels);\n  vec3 lightColor = lighting_getLightColor(instanceColors.rgb, project_uCameraPosition, position_commonspace.xyz, project_normal(instanceNormals));\n  vColor = vec4(lightColor, instanceColors.a * opacity) / 255.0;\n  picking_setPickingColor(instancePickingColors);\n}\n",fs:"#define SHADER_NAME point-cloud-layer-fragment-shader\n\nprecision highp float;\n\nvarying vec4 vColor;\nvarying vec2 unitPosition;\n\nvoid main(void) {\n\n  float distToCenter = length(unitPosition);\n\n  if (distToCenter > 1.0) {\n    discard;\n  }\n\n  gl_FragColor = vColor;\n  gl_FragColor = picking_filterHighlightColor(gl_FragColor);\n  gl_FragColor = picking_filterPickingColor(gl_FragColor);\n}\n",modules:[this.use64bitProjection()?"project64":"project32","gouraud-lighting","picking"]}}},{key:"initializeState",value:function(){this.getAttributeManager().addInstanced({instancePositions:{size:3,transition:!0,accessor:"getPosition"},instancePositions64xyLow:{size:2,accessor:"getPosition",update:this.calculateInstancePositions64xyLow},instanceNormals:{size:3,transition:!0,accessor:"getNormal",defaultValue:d},instanceColors:{size:4,type:5121,transition:!0,accessor:"getColor",defaultValue:p}})}},{key:"updateState",value:function(t){var i=t.props,n=t.oldProps,r=t.changeFlags;if(Object(s.a)(Object(o.a)(e.prototype),"updateState",this).call(this,{props:i,oldProps:n,changeFlags:r}),i.fp64!==n.fp64){var a=this.context.gl;this.state.model&&this.state.model.delete(),this.setState({model:this._getModel(a)}),this.getAttributeManager().invalidateAll()}}},{key:"draw",value:function(t){var e=t.uniforms,i=this.context.viewport,n=this.props,r=n.pointSize,a="meters"===n.sizeUnits?i.distanceScales.pixelsPerMeter[2]:1;this.state.model.setUniforms(Object.assign({},e,{radiusPixels:r*a})).draw()}},{key:"_getModel",value:function(t){for(var e=[],i=0;i<3;i++){var n=i/3*Math.PI*2;e.push(2*Math.cos(n),2*Math.sin(n),0)}return new l.i(t,Object.assign({},this.getShaders(),{id:this.props.id,geometry:new l.g({drawMode:4,attributes:{positions:new Float32Array(e)}}),isInstanced:!0,shaderCache:this.context.shaderCache}))}},{key:"calculateInstancePositions64xyLow",value:function(t){var e=this.use64bitPositions();if(t.constant=!e,e){var i=this.props,n=i.data,r=i.getPosition,a=t.value,o=0,s=Object(u.g)(n),c=s.iterable,l=s.objectInfo,p=!0,d=!1,v=void 0;try{for(var f,g=c[Symbol.iterator]();!(p=(f=g.next()).done);p=!0){var y=f.value;l.index++;var m=r(y,l);a[o++]=h(m[0]),a[o++]=h(m[1])}}catch(b){d=!0,v=b}finally{try{p||null==g.return||g.return()}finally{if(d)throw v}}}else t.value=new Float32Array(2)}}]),e}(u.c);g.layerName="PointCloudLayer",g.defaultProps=f}}]);
//# sourceMappingURL=3-5792950a53025d360b50.js.map