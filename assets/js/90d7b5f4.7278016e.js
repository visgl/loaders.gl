"use strict";(self.webpackChunkproject_website=self.webpackChunkproject_website||[]).push([[4686],{71713:(t,e,n)=>{n.d(e,{A:()=>Xe});var r=n(63696),o=(n(7470),n(38313)),s=n(94104),i=n(29512),a=n(83073),l=n(2101),c=n(2159);function u(t){const e={};for(const[n,r]of Object.entries(t))"fields"!==n&&r&&(e[n]=JSON.stringify(r));return e}function h(t){switch(t.type.toLowerCase()){case"float32":return"float32";case"number":case"float64":return"float64";case"string":case"utf8":return"utf8";case"boolean":return"bool";default:return"null"}}function d(t){const e={};for(const[n,r]of Object.entries(t))"name"!==n&&r&&(e[n]=JSON.stringify(r));return e}var p=n(80247);const f=t=>null!==t&&"object"==typeof t;function g(t,e){if(!t||!f(t))return null;let n={name:t.name||"",description:t.description||""};if("string"==typeof t.generator&&(n.generator=t.generator),"string"==typeof t.generator_options&&(n.generatorOptions=t.generator_options),n.boundingBox=m(t.bounds)||m(t.antimeridian_adjusted_bounds),n.center=function(t){const e=v(t);if(Array.isArray(e)&&3===e.length&&w(e[0])&&b(e[1])&&(n=e[2],Number.isFinite(n)&&n>=0&&n<=22))return e;var n;return null}(t.center),n.maxZoom=y(t.maxzoom),n.minZoom=y(t.minzoom),"string"==typeof t?.json)try{n.metaJson=JSON.parse(t.json)}catch(i){p.warn("Failed to parse tilejson.json field",i)}const r=function(t,e){if(f(t)&&Array.isArray(t.layers))return t.layers.map((t=>function(t,e){const n=[],r={},o=t.attributes||[];for(const s of o){const t=s.attribute;if("string"==typeof t)if(t.split("|").length>1){const e=t.split("|")[0];r[e]=r[e]||[],r[e].push(s),p.warn("ignoring tilestats indexed field",e)}else n[t]||n.push(_(s,e))}return{name:t.layer||"",dominantGeometry:t.geometry,fields:n}}(t,e)));return[]}(t.tilestats||n.metaJson?.tilestats,e),o=function(t){if(!Array.isArray(t))return[];return t.map((t=>function(t){const e=Object.entries(t.fields||[]).map((t=>{let[e,n]=t;return{name:e,...S(String(n))}})),n={...t};return delete n.fields,{name:t.id||"",...n,fields:e}}(t)))}(t.vector_layers),s=function(t,e){return t.map((t=>{const n=e.find((e=>e.name===t.name)),r=n?.fields||t.fields||[],o={...t,...n,fields:r};return o.schema=function(t){const e=[];if(t.fields)for(const n of t.fields)e.push({name:n.name,type:h(n),metadata:d(n)});return{metadata:u(t),fields:e}}(o),o}))}(o,r);return n={...n,layers:s},null===n.maxZoom&&s.length>0&&(n.maxZoom=s[0].maxZoom||null),null===n.minZoom&&s.length>0&&(n.minZoom=s[0].minZoom||null),n}function m(t){const e=v(t);if(Array.isArray(e)&&4===e.length&&[e[0],e[2]].every(w)&&[e[1],e[3]].every(b))return[[e[0],e[1]],[e[2],e[3]]]}function y(t){const e="string"==typeof t?parseFloat(t):"number"==typeof t?t:null;return null===e||isNaN(e)?null:e}function b(t){return Number.isFinite(t)&&t<=90&&t>=-90}function w(t){return Number.isFinite(t)&&t<=180&&t>=-180}function v(t){return"string"==typeof t?t.split(",").map(parseFloat):Array.isArray(t)?t:null}const x={number:{type:"float32"},numeric:{type:"float32"},string:{type:"utf8"},vachar:{type:"utf8"},float:{type:"float32"},int:{type:"int32"},int4:{type:"int32"},boolean:{type:"boolean"},bool:{type:"boolean"}};function _(t,e){void 0===t&&(t={});const n=S(t.type),r={name:t.attribute,...n};return"number"==typeof t.min&&(r.min=t.min),"number"==typeof t.max&&(r.max=t.max),"number"==typeof t.count&&(r.uniqueValueCount=t.count),t.values&&(r.values=t.values),r.values&&"number"==typeof e.maxValues&&(r.values=r.values?.slice(0,e.maxValues)),r}function S(t){const e=t.toLowerCase();return!e||x[e],x[e]||{type:"string"}}const A={dataType:null,batchType:null,name:"TileJSON",id:"tilejson",module:"pmtiles",version:"undefined"!=typeof __VERSION__?__VERSION__:"latest",worker:!0,extensions:["json"],mimeTypes:["application/json"],text:!0,options:{tilejson:{maxValues:void 0}},parse:async(t,e)=>{const n=(new TextDecoder).decode(t);return g(JSON.parse(n),{...A.options.tilejson,...e?.tilejson})},parseTextSync:(t,e)=>g(JSON.parse(t),{...A.options.tilejson,...e?.tilejson})};var T=n(80247);const{nb:P}=c;function E(t){switch(t){case P.Mvt:return"application/vnd.mapbox-vector-tile";case P.Png:return"image/png";case P.Jpeg:return"image/jpeg";case P.Webp:return"image/webp";case P.Avif:return"image/avif";default:return"application/octet-stream"}}class k{constructor(t,e){this.blob=t,this.key=e}getKey(){return this.blob.url||""}async getBytes(t,e,n){const r=this.blob.slice(t,t+e);return{data:await r.arrayBuffer()}}}const{HC:C}=c,O={name:"PMTiles",id:"pmtiles",module:"pmtiles",version:"1.0.0",extensions:["pmtiles"],mimeTypes:["application/octet-stream"],type:"pmtiles",fromUrl:!0,fromBlob:!0,defaultOptions:{pmtiles:{}},testURL:t=>t.endsWith(".pmtiles"),createDataSource:(t,e)=>new L(t,e)};class L extends s.q{mimeType=null;constructor(t,e){super(t,e,O.defaultOptions);const n="string"==typeof t?(0,i.o1)(t):new k(t,"pmtiles");this.pmtiles=new C(n),this.getTileData=this.getTileData.bind(this),this.metadata=this.getMetadata()}async getSchema(){return{fields:[],metadata:{}}}async getMetadata(){const t=function(t,e,n,r){let o=null;if(e)try{const t=JSON.stringify(e);o=A.parseTextSync?.(t,r)||null}catch(a){T.warn("PMTiles metadata could not be interpreted as TileJSON",a)}const s={};"string"==typeof o?.name&&(s.name=o.name),"string"==typeof o?.htmlAttribution&&(s.attributions=[o.htmlAttribution]);const i={...s,format:"pmtiles",formatVersion:t.specVersion,attributions:[],tileMIMEType:E(t.tileType),minZoom:t.minZoom,maxZoom:t.maxZoom,boundingBox:[[t.minLon,t.minLat],[t.maxLon,t.maxLat]],center:[t.centerLon,t.centerLat],centerZoom:t.centerZoom,etag:t.etag};return o&&(i.tilejson=o),n?.includeFormatHeader&&(i.formatHeader=t,i.formatMetadata=i),i}(await this.pmtiles.getHeader(),await this.pmtiles.getMetadata()||{},{includeFormatHeader:!1},this.loadOptions);return this.options.attributions&&(t.attributions=[...this.options.core?.attributions||[],...t.attributions||[]]),t?.tileMIMEType&&(this.mimeType=t?.tileMIMEType),t}async getTile(t){const{x:e,y:n,z:r}=t,o=await this.pmtiles.getZxy(r,e,n),s=o?.data;return s||null}async getTileData(t){const{x:e,y:n,z:r}=t.index;return"application/vnd.mapbox-vector-tile"===(await this.metadata).tileMIMEType?await this.getVectorTile({x:e,y:n,z:r,layers:[]}):await this.getImageTile({x:e,y:n,z:r,layers:[]})}async getImageTile(t){const e=await this.getTile(t);return e?await a.$.parse(e,this.loadOptions):null}async getVectorTile(t){const e=await this.getTile(t),n={shape:"geojson-table",mvt:{coordinates:"wgs84",tileIndex:{x:t.x,y:t.y,z:t.z},...this.loadOptions?.mvt},...this.loadOptions};return e?await l.h.parse(e,n):null}}var j=n(97354),R=n(55256),I=n(35152),M=n(21143);function N(t,e,n,r,o){const s=e===o.maxZoom?0:o.tolerance/((1<<e)*o.extent),i={protoFeatures:[],sourceFeatures:null,numPoints:0,numSimplified:0,numFeatures:t.length,x:n,y:r,z:e,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0};for(const a of t)U(i,a,s,o);return i}function U(t,e,n,r){const o=e.geometry,s=e.type,i=[];let a;switch(t.minX=Math.min(t.minX,e.minX),t.minY=Math.min(t.minY,e.minY),t.maxX=Math.max(t.maxX,e.maxX),t.maxY=Math.max(t.maxY,e.maxY),s){case"Point":case"MultiPoint":a=1;for(let e=0;e<o.length;e+=3)i.push(o[e],o[e+1]),t.numPoints++,t.numSimplified++;break;case"LineString":a=2,B(i,o,t,n,!1,!1);break;case"MultiLineString":a=2;for(let e=0;e<o.length;e++)B(i,o[e],t,n,!1,0===e);break;case"Polygon":a=3;for(let e=0;e<o.length;e++)B(i,o[e],t,n,!0,0===e);break;case"MultiPolygon":a=3;for(let e=0;e<o.length;e++){const r=o[e];for(let e=0;e<r.length;e++)B(i,r[e],t,n,!0,0===e)}break;default:throw new Error(`Unknown geometry type: ${s}`)}if(i.length){let n=e.tags||null;if("LineString"===s&&r.lineMetrics){n={};for(const t in e.tags)n[t]=e.tags[t];n.mapbox_clip_start=o.start/o.size,n.mapbox_clip_end=o.end/o.size}const l={geometry:i,simplifiedType:a,tags:n};null!==e.id&&(l.id=e.id),t.protoFeatures.push(l)}}function B(t,e,n,r,o,s){const i=r*r;if(r>0&&e.size<(o?i:r))return void(n.numPoints+=e.length/3);const a=[];for(let l=0;l<e.length;l+=3)(0===r||e[l+2]>i)&&(n.numSimplified++,a.push(e[l],e[l+1])),n.numPoints++;o&&function(t,e){let n=0;for(let r=0,o=t.length-2;r<t.length;o=r,r+=2)n+=(t[r]-t[o])*(t[r+1]+t[o+1]);if(n>0===e)for(let r=0,o=t.length;r<o/2;r+=2){const e=t[r],n=t[r+1];t[r]=t[o-2-r],t[r+1]=t[o-1-r],t[o-2-r]=e,t[o-1-r]=n}}(a,s),t.push(a)}function F(t,e){if(t.transformed)return t;const n=1<<t.z,r=t.x,o=t.y;for(const s of t.protoFeatures){const t=s.geometry,i=s.simplifiedType;if(s.geometry=[],1===i)for(let a=0;a<t.length;a+=2)s.geometry.push($(t[a],t[a+1],e,n,r,o));else for(let a=0;a<t.length;a++){const i=[];for(let s=0;s<t[a].length;s+=2)i.push($(t[a][s],t[a][s+1],e,n,r,o));s.geometry.push(i)}}return t.transformed=!0,t}function $(t,e,n,r,o,s){return[Math.round(n*(t*r-o)),Math.round(n*(e*r-s))]}var V=n(20417);function z(t,e,n,r){const o={id:null==t?null:t,type:e,simplifiedType:void 0,geometry:n,tags:r,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};switch(e){case"Point":case"MultiPoint":case"LineString":D(o,n);break;case"MultiLineString":for(const t of n)D(o,t);break;case"Polygon":D(o,n[0]);break;case"MultiPolygon":for(const t of n)D(o,t[0]);break;default:throw new Error(String(e))}return o}function D(t,e){for(let n=0;n<e.length;n+=3)t.minX=Math.min(t.minX,e[n]),t.minY=Math.min(t.minY,e[n+1]),t.maxX=Math.max(t.maxX,e[n]),t.maxY=Math.max(t.maxY,e[n+1])}function J(t,e,n,r){let o=r;const s=n-e>>1;let i,a=n-e;const l=t[e],c=t[e+1],u=t[n],h=t[n+1];for(let d=e+3;d<n;d+=3){const e=q(t[d],t[d+1],l,c,u,h);if(e>o)i=d,o=e;else if(e===o){const t=Math.abs(d-s);t<a&&(i=d,a=t)}}o>r&&(i-e>3&&J(t,e,i,r),t[i+2]=o,n-i>3&&J(t,i,n,r))}function q(t,e,n,r,o,s){let i=o-n,a=s-r;if(0!==i||0!==a){const l=((t-n)*i+(e-r)*a)/(i*i+a*a);l>1?(n=o,r=s):l>0&&(n+=i*l,r+=a*l)}return i=t-n,a=e-r,i*i+a*a}function W(t,e,n){if(!t.geometry)return;const r=t.geometry.coordinates,o=t.geometry.type,s=Math.pow(e.tolerance/((1<<e.maxZoom)*e.extent),2);let i=[],a=t.id;switch(e.promoteId?a=t.properties[e.promoteId]:e.generateId&&(a=n||0),o){case"Point":Z(r,i);break;case"MultiPoint":for(const t of r)Z(t,i);break;case"LineString":Y(r,i,s,!1);break;case"MultiLineString":if(e.lineMetrics){for(const e of r)i=[],Y(e,i,s,!1),features.push(z(a,"LineString",i,t.properties));return}break;case"Polygon":G(r,i,s,!0);break;case"MultiPolygon":for(const t of r){const e=[];G(t,e,s,!0),i.push(e)}break;case"GeometryCollection":for(const n of t.geometry.geometries)W(features,{id:a,geometry:n,properties:t.properties},e);break;default:throw new Error("Input data is not a valid GeoJSON object.")}return z(a,o,i,t.properties)}function Z(t,e){e.push(X(t[0]),Q(t[1]),0)}function Y(t,e,n,r){let o,s,i=0;for(let l=0;l<t.length;l++){const n=X(t[l][0]),a=Q(t[l][1]);e.push(n,a,0),l>0&&(i+=r?(o*a-n*s)/2:Math.sqrt(Math.pow(n-o,2)+Math.pow(a-s,2))),o=n,s=a}const a=e.length-3;e[2]=1,J(e,0,a,n),e[a+2]=1,e.size=Math.abs(i),e.start=0,e.end=e.size}function G(t,e,n,r){for(let o=0;o<t.length;o++){const s=[];Y(t[o],s,n,r),e.push(s)}}function X(t){return t/360+.5}function Q(t){const e=Math.sin(t*Math.PI/180),n=.5-.25*Math.log((1+e)/(1-e))/Math.PI;return n<0?0:n>1?1:n}function K(t,e,n,r,o,s,i,a){if(r/=e,s>=(n/=e)&&i<r)return t;if(i<n||s>=r)return null;const l=[];for(const c of t){const t=c.geometry;let e=c.type;const s=0===o?c.minX:c.minY,i=0===o?c.maxX:c.maxY;if(s>=n&&i<r){l.push(c);continue}if(i<n||s>=r)continue;let u=[];if("Point"===e||"MultiPoint"===e)H(t,u,n,r,o);else if("LineString"===e)tt(t,u,n,r,o,!1,a.lineMetrics);else if("MultiLineString"===e)nt(t,u,n,r,o,!1);else if("Polygon"===e)nt(t,u,n,r,o,!0);else if("MultiPolygon"===e)for(const a of t){const t=[];nt(a,t,n,r,o,!0),t.length&&u.push(t)}if(u.length){if(a.lineMetrics&&"LineString"===e){for(const t of u)l.push(z(c.id,e,t,c.tags));continue}"LineString"!==e&&"MultiLineString"!==e||(1===u.length?(e="LineString",u=u[0]):e="MultiLineString"),"Point"!==e&&"MultiPoint"!==e||(e=3===u.length?"Point":"MultiPoint"),l.push(z(c.id,e,u,c.tags))}}return l.length?l:null}function H(t,e,n,r,o){for(let s=0;s<t.length;s+=3){const i=t[s+o];i>=n&&i<=r&&rt(e,t[s],t[s+1],t[s+2])}}function tt(t,e,n,r,o,s,i){let a=et(t);const l=0===o?ot:st;let c,u,h=t.start;for(let y=0;y<t.length-3;y+=3){const d=t[y],p=t[y+1],f=t[y+2],g=t[y+3],m=t[y+4],b=0===o?d:p,w=0===o?g:m;let v=!1;i&&(c=Math.sqrt(Math.pow(d-g,2)+Math.pow(p-m,2))),b<n?w>n&&(u=l(a,d,p,g,m,n),i&&(a.start=h+c*u)):b>r?w<r&&(u=l(a,d,p,g,m,r),i&&(a.start=h+c*u)):rt(a,d,p,f),w<n&&b>=n&&(u=l(a,d,p,g,m,n),v=!0),w>r&&b<=r&&(u=l(a,d,p,g,m,r),v=!0),!s&&v&&(i&&(a.end=h+c*u),e.push(a),a=et(t)),i&&(h+=c)}let d=t.length-3;const p=t[d],f=t[d+1],g=t[d+2],m=0===o?p:f;m>=n&&m<=r&&rt(a,p,f,g),d=a.length-3,s&&d>=3&&(a[d]!==a[0]||a[d+1]!==a[1])&&rt(a,a[0],a[1],a[2]),a.length&&e.push(a)}function et(t){const e=[];return e.size=t.size,e.start=t.start,e.end=t.end,e}function nt(t,e,n,r,o,s){for(const i of t)tt(i,e,n,r,o,s,!1)}function rt(t,e,n,r){t.push(e,n,r)}function ot(t,e,n,r,o,s){const i=(s-e)/(r-e);return rt(t,s,n+(o-n)*i,1),i}function st(t,e,n,r,o,s){const i=(s-n)/(o-n);return rt(t,e+(r-e)*i,s,1),i}function it(t,e){const n=[];for(let r=0;r<t.length;r++){const o=t[r],s=o.type;let i;switch(s){case"Point":case"MultiPoint":case"LineString":i=at(o.geometry,e);break;case"MultiLineString":case"Polygon":i=[];for(const t of o.geometry)i.push(at(t,e));break;case"MultiPolygon":i=[];for(const t of o.geometry){const n=[];for(const r of t)n.push(at(r,e));i.push(n)}break;default:throw new Error(String(s))}n.push(z(o.id,s,i,o.tags))}return n}function at(t,e){const n=[];n.size=t.size,void 0!==t.start&&(n.start=t.start,n.end=t.end);for(let r=0;r<t.length;r+=3)n.push(t[r]+e,t[r+1],t[r+2]);return n}const lt={name:"TableTiler",id:"table-tiler",module:"mvt",version:"0.0.0",extensions:["mvt"],mimeTypes:["application/octet-stream"],type:"table",fromUrl:!1,fromBlob:!1,defaultOptions:{table:{coordinates:"local",promoteId:void 0,maxZoom:14,indexMaxZoom:5,maxPointsPerTile:1e4,tolerance:3,extent:4096,buffer:64,generateId:void 0}},testURL:t=>t.endsWith(".geojson"),createDataSource(t,e){const n="string"==typeof t||t instanceof Blob,r=e?.core?.loaders?.[0],o=n?async function(t,e){if("string"==typeof t){const n=await fetch(t),r=await n.arrayBuffer();return await e.parse(r)}const n=await t.arrayBuffer();return await e.parse(n)}(t,r):t;return new ct(o,e)}};class ct extends s.q{static stats=(()=>new M.Uz({id:"table-tile-source-all",stats:[new M.ro("count","tiles"),new M.ro("count","features")]}))();stats=(()=>new M.Uz({id:"table-tile-source",stats:[new M.ro("tiles","count"),new M.ro("features","count")]}))();mimeType="application/vnd.mapbox-vector-tile";localCoordinates=!0;schema=null;tiles={};tileCoords=[];constructor(t,e){super(t,e,lt.defaultOptions),this.tableOptions=(0,j.E)(this.options).table,this.getTileData=this.getTileData.bind(this),this.ready=this.initializeTilesAsync(t),this.metadata=this.getMetadata()}async initializeTilesAsync(t){const e=await t;this.schema=(0,I.O)(e),this.createRootTiles(e)}async getMetadata(){return await this.ready,{schema:this.schema,minZoom:0,maxZoom:this.tableOptions.maxZoom}}async getSchema(){return await this.ready,this.schema}async getVectorTile(t){await this.ready;const e=this.getTileSync(t);return R.R.info(2,"getVectorTile",t,e)(),e}async getTile(t){return await this.ready,this.getTileSync(t)}async getTileData(t){const{x:e,y:n,z:r}=t.index,o=await this.getVectorTile({x:e,y:n,z:r});return o?.features||[]}getTileSync(t){const e=this.getProtoTile(t);return e?function(t,e){const n=[];for(const r of t.protoFeatures){if(!r||!r.geometry)continue;let t,o;switch(r.simplifiedType){case 1:1===r.geometry.length?(t="Point",o=r.geometry[0]):(t="MultiPoint",o=r.geometry);break;case 2:1===r.geometry.length?(t="LineString",o=r.geometry[0]):(t="MultiLineString",o=r.geometry);break;case 3:r.geometry.length>1?(t="MultiPolygon",o=[r.geometry]):(t="Polygon",o=r.geometry);break;default:throw new Error(`${r.simplifiedType}is not a valid simplified type`)}switch(e.coordinates){case"EPSG:4326":case"wgs84":(0,V.Tm)(o,e.tileIndex,e.extent);break;default:(0,V.XO)(o,e.extent)}const s={type:"Feature",geometry:{type:t,coordinates:o},properties:r.tags||{},id:r.id};n.push(s)}return 0===n.length?null:{shape:"geojson-table",type:"FeatureCollection",features:n}}(e,{coordinates:this.tableOptions.coordinates,tileIndex:t,extent:this.tableOptions.extent}):null}createRootTiles(t){if(this.tableOptions.maxZoom<0||this.tableOptions.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(this.tableOptions.promoteId&&this.tableOptions.generateId)throw new Error("promoteId and generateId cannot be used together.");R.R.log(1,"TableVectorTileSource creating root tiles",this.tableOptions)(),R.R.time(1,"preprocess table")();let e=function(t,e){const n=[];switch(t.type){case"FeatureCollection":let r=0;for(const o of t.features)n.push(W(o,e,r++));break;case"Feature":n.push(W(t,e));break;default:n.push(W({geometry:t},e))}return n}(t,this.tableOptions);if(R.R.timeEnd(1,"preprocess table")(),R.R.time(1,"generate tiles")(),e=function(t,e){const n=e.buffer/e.extent;let r=t;const o=K(t,1,-1-n,n,0,-1,2,e),s=K(t,1,1-n,2+n,0,-1,2,e);return(o||s)&&(r=K(t,1,-n,1+n,0,-1,2,e)||[],o&&(r=it(o,1).concat(r)),s&&(r=r.concat(it(s,-1)))),r}(e,this.tableOptions),0===e.length)return void R.R.log(1,"TableVectorTileSource: no features generated")();this.splitTile(e,0,0,0);const n=this.tiles[0];R.R.log(1,`root tile features: ${n.numFeatures}, points: ${n.numPoints}`)(),R.R.timeEnd(1,"generate tiles")(),R.R.log(1,`TableVectorTileSource: tiles generated: ${this.stats.get("total").count}`,this.stats)()}getProtoTile(t){const{z:e,y:n}=t;let{x:r}=t;const{extent:o}=this.tableOptions;if(e<0||e>24)return null;const s=1<<e;r=r+s&s-1;const i=ut(e,r,n);if(this.tiles[i])return F(this.tiles[i],o);R.R.log(R.R,"drilling down to z%d-%d-%d",e,r,n)();let a,l=e,c=r,u=n;for(;!a&&l>0;)l--,c>>=1,u>>=1,a=this.tiles[ut(l,c,u)];return a&&a.sourceFeatures?(R.R.log(1,"found parent tile z%d-%d-%d",l,c,u)(),R.R.time(1,"drilling down")(),this.splitTile(a.sourceFeatures,l,c,u,e,r,n),R.R.timeEnd(1,"drilling down")(),this.tiles[i]?F(this.tiles[i],o):null):null}splitTile(t,e,n,r,o,s,i){const a=[t,e,n,r];for(;a.length;){r=a.pop(),n=a.pop(),e=a.pop(),t=a.pop();const l=1<<e,c=ut(e,n,r);let u=this.tiles[c];if(!u){R.R.time(2,"tile creation")(),u=this.tiles[c]=N(t,e,n,r,this.tableOptions),this.tileCoords.push({z:e,x:n,y:r});const o=`z${e}`;let s=this.stats.get(o,"count");s.incrementCount(),s=this.stats.get("total"),s.incrementCount(),s=ct.stats.get(o,"count"),s.incrementCount(),s=ct.stats.get("total"),s.incrementCount(),R.R.log(2,"tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",e,n,r,u.numFeatures,u.numPoints,u.numSimplified)(),R.R.timeEnd(2,"tile creation")()}if(u.sourceFeatures=t,void 0===o){if(e===this.tableOptions.indexMaxZoom||u.numPoints<=this.tableOptions.maxPointsPerTile)continue}else{if(e===this.tableOptions.maxZoom||e===o)continue;if(void 0!==o){const t=o-e;if(n!==s>>t||r!==i>>t)continue}}if(u.sourceFeatures=null,0===t.length)continue;R.R.time(2,"clipping tile")();const h=.5*this.tableOptions.buffer/this.tableOptions.extent,d=.5-h,p=.5+h,f=1+h;let g=null,m=null,y=null,b=null,w=K(t,l,n-h,n+p,0,u.minX,u.maxX,this.tableOptions),v=K(t,l,n+d,n+f,0,u.minX,u.maxX,this.tableOptions);t=null,w&&(g=K(w,l,r-h,r+p,1,u.minY,u.maxY,this.tableOptions),m=K(w,l,r+d,r+f,1,u.minY,u.maxY,this.tableOptions),w=null),v&&(y=K(v,l,r-h,r+p,1,u.minY,u.maxY,this.tableOptions),b=K(v,l,r+d,r+f,1,u.minY,u.maxY,this.tableOptions),v=null),R.R.timeEnd(2,"clipping tile")(),a.push(g||[],e+1,2*n,2*r),a.push(m||[],e+1,2*n,2*r+1),a.push(y||[],e+1,2*n+1,2*r),a.push(b||[],e+1,2*n+1,2*r+1)}}}function ut(t,e,n){return 32*((1<<t)*n+e)+t}var ht=n(69186),dt=n(80247);const pt={name:"MVT",id:"mvt",module:"mvt",version:"0.0.0",extensions:["mvt"],mimeTypes:["application/octet-stream"],type:"mvt",fromUrl:!0,fromBlob:!1,defaultOptions:{mvt:{}},testURL:t=>!0,createDataSource:(t,e)=>new ft(t,e)};class ft extends s.q{metadataUrl=null;schema="tms";mimeType=null;constructor(t,e){var n;super(t,e,pt.defaultOptions),this.metadataUrl=e.mvt?.metadataUrl||`${this.url}/tilejson.json`,this.extension=e.mvt?.extension||".png",this.getTileData=this.getTileData.bind(this),this.metadata=this.getMetadata(),n=this.url,/(?=.*{z})(?=.*{x})(?=.*({y}|{-y}))|(?=.*{x})(?=.*({y}|{-y})(?=.*{z}))/.test(n)&&(this.schema="template")}async getMetadata(){if(!this.metadataUrl)return null;let t;try{t=await this.fetch(this.metadataUrl)}catch(n){return dt.error(n.message),null}if(!t.ok)return dt.error(t.statusText),null;const e=await t.text();return A.parseTextSync?.(e)||null}getTileMIMEType(){return this.mimeType}async getTile(t){const{x:e,y:n,z:r}=t,o=this.getTileURL(e,n,r),s=await this.fetch(o);if(!s.ok)return null;return await s.arrayBuffer()}async getTileData(t){const{x:e,y:n,z:r}=t.index,o=await this.getTile({x:e,y:n,z:r,layers:[]});if(null===o)return null;const s=(0,ht.m)(o);return this.mimeType=this.mimeType||s?.mimeType||"application/vnd.mapbox-vector-tile","application/vnd.mapbox-vector-tile"===this.mimeType?await this._parseVectorTile(o,{x:e,y:n,z:r,layers:[]}):await this._parseImageTile(o)}async getImageTile(t){const e=await this.getTile(t);return e?this._parseImageTile(e):null}async _parseImageTile(t){return await a.$.parse(t,this.loadOptions)}async getVectorTile(t){const e=await this.getTile(t);return e?this._parseVectorTile(e,t):null}async _parseVectorTile(t,e){const n={shape:"geojson-table",mvt:{coordinates:"wgs84",tileIndex:{x:e.x,y:e.y,z:e.z},...this.loadOptions?.mvt},...this.loadOptions};return await l.h.parse(t,n)}getMetadataUrl(){return this.metadataUrl}getTileURL(t,e,n){switch(this.schema){case"xyz":return`${this.url}/${t}/${e}/${n}${this.extension}`;case"tms":return`${this.url}/${n}/${t}/${e}${this.extension}`;case"template":return function(t,e,n,r,o){void 0===o&&(o="0");if(Array.isArray(t)){t=t[(s=o,Math.abs(s.split("").reduce(((t,e)=>(t<<5)-t+e.charCodeAt(0)|0),0))%t.length)]}var s;let i=t;i=i.replace(gt,String(e)),i=i.replace(mt,String(n)),i=i.replace(yt,String(r)),Number.isInteger(n)&&Number.isInteger(r)&&(i=i.replace(/\{-y\}/g,String(Math.pow(2,r)-n-1)));return i}(this.url,t,e,n,"0");default:throw new Error(this.schema)}}}const gt=new RegExp("{x}","g"),mt=new RegExp("{y}","g"),yt=new RegExp("{z}","g");var bt=n(30511);class wt{length=0;rows=null;cursor=0;_headers=[];constructor(t,e){if(this.options=e,this.schema=t,!Array.isArray(t)){this._headers=[];for(const e in t)this._headers[t[e].index]=t[e].name}}rowCount(){return this.length}addArrayRow(t,e){Number.isFinite(e)&&(this.cursor=e),this.shape="array-row-table",this.rows=this.rows||new Array(100),this.rows[this.length]=t,this.length++}addObjectRow(t,e){Number.isFinite(e)&&(this.cursor=e),this.shape="object-row-table",this.rows=this.rows||new Array(100),this.rows[this.length]=t,this.length++}getBatch(){let t=this.rows;if(!t)return null;t=t.slice(0,this.length),this.rows=null;return{shape:this.shape||"array-row-table",batchType:"data",data:t,length:this.length,schema:this.schema,cursor:this.cursor}}}class vt{length=0;objectRows=null;arrayRows=null;cursor=0;_headers=null;constructor(t,e){if(this.options=e,this.schema=t,t){this._headers=[];for(const e in t)this._headers[t[e].index]=t[e].name}}rowCount(){return this.length}addArrayRow(t,e){switch(Number.isFinite(e)&&(this.cursor=e),this._headers||=function(t){const e=[];for(let n=0;n<t.length;n++){const t=`column-${n}`;e.push(t)}return e}(t),this.options.shape){case"object-row-table":const n=function(t,e){if(!t)throw new Error("null row");const n={};if(e)for(let r=0;r<e.length;r++)n[e[r]]=t[r];else for(let r=0;r<t.length;r++)n[`column-${r}`]=t[r];return n}(t,this._headers);this.addObjectRow(n,e);break;case"array-row-table":this.arrayRows=this.arrayRows||new Array(100),this.arrayRows[this.length]=t,this.length++}}addObjectRow(t,e){switch(Number.isFinite(e)&&(this.cursor=e),this._headers||=function(t){return Object.keys(t)}(t),this.options.shape){case"array-row-table":const n=function(t,e){if(!t)throw new Error("null row");if(e){const n=new Array(e.length);for(let r=0;r<e.length;r++)n[r]=t[e[r]];return n}return Object.values(t)}(t,this._headers);this.addArrayRow(n,e);break;case"object-row-table":this.objectRows=this.objectRows||new Array(100),this.objectRows[this.length]=t,this.length++}}getBatch(){let t=this.arrayRows||this.objectRows;return t?(t=t.slice(0,this.length),this.arrayRows=null,this.objectRows=null,{shape:this.options.shape,batchType:"data",data:t,length:this.length,schema:this.schema,cursor:this.cursor}):null}}class xt{length=0;allocated=0;columns={};constructor(t,e){this.schema=t,this._reallocateColumns()}rowCount(){return this.length}addArrayRow(t){this._reallocateColumns();let e=0;for(const n in this.columns)this.columns[n][this.length]=t[e++];this.length++}addObjectRow(t){this._reallocateColumns();for(const e in t)this.columns[e][this.length]=t[e];this.length++}getBatch(){this._pruneColumns();const t=Array.isArray(this.schema)?this.columns:{};if(!Array.isArray(this.schema))for(const e in this.schema){const n=this.schema[e];t[n.name]=this.columns[n.index]}this.columns={};return{shape:"columnar-table",batchType:"data",data:t,schema:this.schema,length:this.length}}_reallocateColumns(){if(!(this.length<this.allocated)){this.allocated=this.allocated>0?this.allocated*=2:100,this.columns={};for(const t in this.schema){const e=this.schema[t],n=e.type||Float32Array,r=this.columns[e.index];if(r&&ArrayBuffer.isView(r)){const t=new n(this.allocated);t.set(r),this.columns[e.index]=t}else r?(r.length=this.allocated,this.columns[e.index]=r):this.columns[e.index]=new n(this.allocated)}}}_pruneColumns(){for(const[t,e]of Object.entries(this.columns))this.columns[t]=e.slice(0,this.length)}}var _t=n(80382),St=n(14957),At=n(37589),Tt=n(62559),Pt=n(9624),Et=n(46252);class kt extends xt{constructor(t,e){super(t,e),this.arrowSchema=null}getBatch(){const t=super.getBatch();if(t){this.arrowSchema=this.arrowSchema||function(t){const e=[];for(const n in t){const r=t[n];if(r.type===Float32Array){const t=new Map,n=new Pt.D(r.name,new At.gh,r.nullable,t);e.push(n)}}if(0===e.length)throw new Error("No arrow convertible fields");return new Pt.S(e)}(t.schema);const e=function(t,e){const n=[];for(const r of t.fields){const t=e[r.name];if(t instanceof Float32Array){const e=Et.g(t);n.push(e)}}if(t.fields.length!==n.length)throw new Error("Some columns not arrow convertible");return n}(this.arrowSchema,t.data),n=new _t.g(this.arrowSchema,St.Hg({type:new At._k(this.arrowSchema.fields),children:e.map((t=>{let{data:e}=t;return e[0]}))}));return{shape:"arrow-table",batchType:"data",data:new Tt.XI([n]),length:t.length}}return null}}const Ct={shape:void 0,batchSize:"auto",batchDebounceMs:0,limit:0,_limitMB:0};class Ot{aggregator=null;batchCount=0;bytesUsed=0;isChunkComplete=!1;lastBatchEmittedMs=(()=>Date.now())();totalLength=0;totalBytes=0;rowBytes=0;constructor(t,e){this.schema=t,this.options={...Ct,...e}}limitReached(){return!!(Boolean(this.options?.limit)&&this.totalLength>=this.options.limit)||!!(Boolean(this.options?._limitMB)&&this.totalBytes/1e6>=this.options._limitMB)}addRow(t){this.limitReached()||(this.totalLength++,this.rowBytes=this.rowBytes||this._estimateRowMB(t),this.totalBytes+=this.rowBytes,Array.isArray(t)?this.addArrayRow(t):this.addObjectRow(t))}addArrayRow(t){if(!this.aggregator){const t=this._getTableBatchType();this.aggregator=new t(this.schema,this.options)}this.aggregator.addArrayRow(t)}addObjectRow(t){if(!this.aggregator){const t=this._getTableBatchType();this.aggregator=new t(this.schema,this.options)}this.aggregator.addObjectRow(t)}chunkComplete(t){t instanceof ArrayBuffer&&(this.bytesUsed+=t.byteLength),"string"==typeof t&&(this.bytesUsed+=t.length),this.isChunkComplete=!0}getFullBatch(t){return this._isFull()?this._getBatch(t):null}getFinalBatch(t){return this._getBatch(t)}_estimateRowMB(t){return Array.isArray(t)?8*t.length:8*Object.keys(t).length}_isFull(){if(!this.aggregator||0===this.aggregator.rowCount())return!1;if("auto"===this.options.batchSize){if(!this.isChunkComplete)return!1}else if(this.options.batchSize>this.aggregator.rowCount())return!1;return!(this.options.batchDebounceMs>Date.now()-this.lastBatchEmittedMs)&&(this.isChunkComplete=!1,this.lastBatchEmittedMs=Date.now(),!0)}_getBatch(t){if(!this.aggregator)return null;t?.bytesUsed&&(this.bytesUsed=t.bytesUsed);const e=this.aggregator.getBatch();return e.count=this.batchCount,e.bytesUsed=this.bytesUsed,Object.assign(e,t),this.batchCount++,this.aggregator=null,e}_getTableBatchType(){switch(this.options.shape){case"array-row-table":case"object-row-table":return vt;case"columnar-table":return xt;case"arrow-table":return kt;default:return wt}}}var Lt=n(27742);const jt=Number.MAX_SAFE_INTEGER;var Rt=function(t){return t[t.BEGIN=0]="BEGIN",t[t.VALUE=1]="VALUE",t[t.OPEN_OBJECT=2]="OPEN_OBJECT",t[t.CLOSE_OBJECT=3]="CLOSE_OBJECT",t[t.OPEN_ARRAY=4]="OPEN_ARRAY",t[t.CLOSE_ARRAY=5]="CLOSE_ARRAY",t[t.TEXT_ESCAPE=6]="TEXT_ESCAPE",t[t.STRING=7]="STRING",t[t.BACKSLASH=8]="BACKSLASH",t[t.END=9]="END",t[t.OPEN_KEY=10]="OPEN_KEY",t[t.CLOSE_KEY=11]="CLOSE_KEY",t[t.TRUE=12]="TRUE",t[t.TRUE2=13]="TRUE2",t[t.TRUE3=14]="TRUE3",t[t.FALSE=15]="FALSE",t[t.FALSE2=16]="FALSE2",t[t.FALSE3=17]="FALSE3",t[t.FALSE4=18]="FALSE4",t[t.NULL=19]="NULL",t[t.NULL2=20]="NULL2",t[t.NULL3=21]="NULL3",t[t.NUMBER_DECIMAL_POINT=22]="NUMBER_DECIMAL_POINT",t[t.NUMBER_DIGIT=23]="NUMBER_DIGIT",t}(Rt||{});const It=9,Mt=10,Nt=13,Ut=32,Bt=34,Ft=43,$t=44,Vt=45,zt=46,Dt=48,Jt=57,qt=58,Wt=69,Zt=91,Yt=92,Gt=93,Xt=97,Qt=98,Kt=101,Ht=102,te=108,ee=110,ne=114,re=115,oe=116,se=117,ie=123,ae=125,le=/[\\"\n]/g,ce={onready:()=>{},onopenobject:()=>{},onkey:()=>{},oncloseobject:()=>{},onopenarray:()=>{},onclosearray:()=>{},onvalue:()=>{},onerror:()=>{},onend:()=>{},onchunkparsed:()=>{}};class ue{options=(()=>ce)();bufferCheckPosition=(()=>jt)();q="";c="";p="";closed=!1;closedRoot=!1;sawRoot=!1;error=null;state=(()=>Rt.BEGIN)();stack=[];position=0;column=0;line=1;slashed=!1;unicodeI=0;unicodeS=null;depth=0;constructor(t){void 0===t&&(t={}),this.options={...ce,...t},this.textNode=void 0,this.numberNode="",this.emit("onready")}end(){return this.state===Rt.VALUE&&0===this.depth||this._error("Unexpected end"),this._closeValue(),this.c="",this.closed=!0,this.emit("onend"),this}resume(){return this.error=null,this}close(){return this.write(null)}emit(t,e){this.options[t]?.(e,this)}emitNode(t,e){this._closeValue(),this.emit(t,e)}write(t){if(this.error)throw this.error;if(this.closed)return this._error("Cannot write after close. Assign an onready handler.");if(null===t)return this.end();let e=0,n=t.charCodeAt(0),r=this.p;for(;n&&(r=n,this.c=n=t.charCodeAt(e++),r!==n?this.p=r:r=this.p,n);)switch(this.position++,n===Mt?(this.line++,this.column=0):this.column++,this.state){case Rt.BEGIN:n===ie?this.state=Rt.OPEN_OBJECT:n===Zt?this.state=Rt.OPEN_ARRAY:he(n)||this._error("Non-whitespace before {[.");continue;case Rt.OPEN_KEY:case Rt.OPEN_OBJECT:if(he(n))continue;if(this.state===Rt.OPEN_KEY)this.stack.push(Rt.CLOSE_KEY);else{if(n===ae){this.emit("onopenobject"),this.depth++,this.emit("oncloseobject"),this.depth--,this.state=this.stack.pop()||Rt.VALUE;continue}this.stack.push(Rt.CLOSE_OBJECT)}n===Bt?this.state=Rt.STRING:this._error('Malformed object key should start with "');continue;case Rt.CLOSE_KEY:case Rt.CLOSE_OBJECT:if(he(n))continue;n===qt?(this.state===Rt.CLOSE_OBJECT?(this.stack.push(Rt.CLOSE_OBJECT),this._closeValue("onopenobject"),this.depth++):this._closeValue("onkey"),this.state=Rt.VALUE):n===ae?(this.emitNode("oncloseobject"),this.depth--,this.state=this.stack.pop()||Rt.VALUE):n===$t?(this.state===Rt.CLOSE_OBJECT&&this.stack.push(Rt.CLOSE_OBJECT),this._closeValue(),this.state=Rt.OPEN_KEY):this._error("Bad object");continue;case Rt.OPEN_ARRAY:case Rt.VALUE:if(he(n))continue;if(this.state===Rt.OPEN_ARRAY){if(this.emit("onopenarray"),this.depth++,this.state=Rt.VALUE,n===Gt){this.emit("onclosearray"),this.depth--,this.state=this.stack.pop()||Rt.VALUE;continue}this.stack.push(Rt.CLOSE_ARRAY)}n===Bt?this.state=Rt.STRING:n===ie?this.state=Rt.OPEN_OBJECT:n===Zt?this.state=Rt.OPEN_ARRAY:n===oe?this.state=Rt.TRUE:n===Ht?this.state=Rt.FALSE:n===ee?this.state=Rt.NULL:n===Vt?this.numberNode+="-":Dt<=n&&n<=Jt?(this.numberNode+=String.fromCharCode(n),this.state=Rt.NUMBER_DIGIT):this._error("Bad value");continue;case Rt.CLOSE_ARRAY:if(n===$t)this.stack.push(Rt.CLOSE_ARRAY),this._closeValue("onvalue"),this.state=Rt.VALUE;else if(n===Gt)this.emitNode("onclosearray"),this.depth--,this.state=this.stack.pop()||Rt.VALUE;else{if(he(n))continue;this._error("Bad array")}continue;case Rt.STRING:void 0===this.textNode&&(this.textNode="");let o=e-1,s=this.slashed,i=this.unicodeI;t:for(;;){for(;i>0;)if(this.unicodeS+=String.fromCharCode(n),n=t.charCodeAt(e++),this.position++,4===i?(this.textNode+=String.fromCharCode(parseInt(this.unicodeS,16)),i=0,o=e-1):i++,!n)break t;if(n===Bt&&!s){this.state=this.stack.pop()||Rt.VALUE,this.textNode+=t.substring(o,e-1),this.position+=e-1-o;break}if(n===Yt&&!s&&(s=!0,this.textNode+=t.substring(o,e-1),this.position+=e-1-o,n=t.charCodeAt(e++),this.position++,!n))break;if(s){if(s=!1,n===ee?this.textNode+="\n":n===ne?this.textNode+="\r":n===oe?this.textNode+="\t":n===Ht?this.textNode+="\f":n===Qt?this.textNode+="\b":n===se?(i=1,this.unicodeS=""):this.textNode+=String.fromCharCode(n),n=t.charCodeAt(e++),this.position++,o=e-1,n)continue;break}le.lastIndex=e;const r=le.exec(t);if(null===r){e=t.length+1,this.textNode+=t.substring(o,e-1),this.position+=e-1-o;break}if(e=r.index+1,n=t.charCodeAt(r.index),!n){this.textNode+=t.substring(o,e-1),this.position+=e-1-o;break}}this.slashed=s,this.unicodeI=i;continue;case Rt.TRUE:n===ne?this.state=Rt.TRUE2:this._error(`Invalid true started with t${n}`);continue;case Rt.TRUE2:n===se?this.state=Rt.TRUE3:this._error(`Invalid true started with tr${n}`);continue;case Rt.TRUE3:n===Kt?(this.emit("onvalue",!0),this.state=this.stack.pop()||Rt.VALUE):this._error(`Invalid true started with tru${n}`);continue;case Rt.FALSE:n===Xt?this.state=Rt.FALSE2:this._error(`Invalid false started with f${n}`);continue;case Rt.FALSE2:n===te?this.state=Rt.FALSE3:this._error(`Invalid false started with fa${n}`);continue;case Rt.FALSE3:n===re?this.state=Rt.FALSE4:this._error(`Invalid false started with fal${n}`);continue;case Rt.FALSE4:n===Kt?(this.emit("onvalue",!1),this.state=this.stack.pop()||Rt.VALUE):this._error(`Invalid false started with fals${n}`);continue;case Rt.NULL:n===se?this.state=Rt.NULL2:this._error(`Invalid null started with n${n}`);continue;case Rt.NULL2:n===te?this.state=Rt.NULL3:this._error(`Invalid null started with nu${n}`);continue;case Rt.NULL3:n===te?(this.emit("onvalue",null),this.state=this.stack.pop()||Rt.VALUE):this._error(`Invalid null started with nul${n}`);continue;case Rt.NUMBER_DECIMAL_POINT:n===zt?(this.numberNode+=".",this.state=Rt.NUMBER_DIGIT):this._error("Leading zero not followed by .");continue;case Rt.NUMBER_DIGIT:Dt<=n&&n<=Jt?this.numberNode+=String.fromCharCode(n):n===zt?(-1!==this.numberNode.indexOf(".")&&this._error("Invalid number has two dots"),this.numberNode+="."):n===Kt||n===Wt?(-1===this.numberNode.indexOf("e")&&-1===this.numberNode.indexOf("E")||this._error("Invalid number has two exponential"),this.numberNode+="e"):n===Ft||n===Vt?(r!==Kt&&r!==Wt&&this._error("Invalid symbol in number"),this.numberNode+=String.fromCharCode(n)):(this._closeNumber(),e--,this.state=this.stack.pop()||Rt.VALUE);continue;default:this._error(`Unknown state: ${this.state}`)}return this.position>=this.bufferCheckPosition&&function(t){const e=Math.max(jt,10);let n=0;for(const r of["textNode","numberNode"]){const o=void 0===t[r]?0:t[r].length;if(o>e)if("text"===r);else t._error(`Max buffer length exceeded: ${r}`);n=Math.max(n,o)}t.bufferCheckPosition=jt-n+t.position}(this),this.emit("onchunkparsed"),this}_closeValue(t){void 0===t&&(t="onvalue"),void 0!==this.textNode&&this.emit(t,this.textNode),this.textNode=void 0}_closeNumber(){this.numberNode&&this.emit("onvalue",parseFloat(this.numberNode)),this.numberNode=""}_error(t){void 0===t&&(t=""),this._closeValue(),t+=`\nLine: ${this.line}\nColumn: ${this.column}\nChar: ${this.c}`;const e=new Error(t);this.error=e,this.emit("onerror",e)}}function he(t){return t===Nt||t===Mt||t===Ut||t===It}class de{constructor(t){if(void 0===t&&(t=null),this.path=["$"],t instanceof de)this.path=[...t.path];else if(Array.isArray(t))this.path.push(...t);else if("string"==typeof t&&(this.path=t.split("."),"$"!==this.path[0]))throw new Error("JSONPaths must start with $")}clone(){return new de(this)}toString(){return this.path.join(".")}push(t){this.path.push(t)}pop(){return this.path.pop()}set(t){this.path[this.path.length-1]=t}equals(t){if(!this||!t||this.path.length!==t.path.length)return!1;for(let e=0;e<this.path.length;++e)if(this.path[e]!==t.path[e])return!1;return!0}setFieldAtPath(t,e){const n=[...this.path];n.shift();const r=n.pop();for(const o of n)t=t[o];t[r]=e}getFieldAtPath(t){const e=[...this.path];e.shift();const n=e.pop();for(const r of e)t=t[r];return t[n]}}class pe{result=void 0;previousStates=[];currentState=(()=>Object.freeze({container:[],key:null}))();jsonpath=(()=>new de)();constructor(t){this.reset(),this.parser=new ue({onready:()=>{this.jsonpath=new de,this.previousStates.length=0,this.currentState.container.length=0},onopenobject:t=>{this._openObject({}),void 0!==t&&this.parser.emit("onkey",t)},onkey:t=>{this.jsonpath.set(t),this.currentState.key=t},oncloseobject:()=>{this._closeObject()},onopenarray:()=>{this._openArray()},onclosearray:()=>{this._closeArray()},onvalue:t=>{this._pushOrSet(t)},onerror:t=>{throw t},onend:()=>{this.result=this.currentState.container.pop()},...t})}reset(){this.result=void 0,this.previousStates=[],this.currentState=Object.freeze({container:[],key:null}),this.jsonpath=new de}write(t){this.parser.write(t)}close(){this.parser.close()}_pushOrSet(t){const{container:e,key:n}=this.currentState;null!==n?(e[n]=t,this.currentState.key=null):e.push(t)}_openArray(t){void 0===t&&(t=[]),this.jsonpath.push(null),this._pushOrSet(t),this.previousStates.push(this.currentState),this.currentState={container:t,isArray:!0,key:null}}_closeArray(){this.jsonpath.pop(),this.currentState=this.previousStates.pop()}_openObject(t){void 0===t&&(t={}),this.jsonpath.push(null),this._pushOrSet(t),this.previousStates.push(this.currentState),this.currentState={container:t,isArray:!1,key:null}}_closeObject(){this.jsonpath.pop(),this.currentState=this.previousStates.pop()}}class fe extends pe{streamingJsonPath=null;streamingArray=null;topLevelObject=null;constructor(t){void 0===t&&(t={}),super({onopenarray:()=>{if(!this.streamingArray&&this._matchJSONPath())return this.streamingJsonPath=this.getJsonPath().clone(),this.streamingArray=[],void this._openArray(this.streamingArray);this._openArray()},onopenobject:t=>{this.topLevelObject?this._openObject({}):(this.topLevelObject={},this._openObject(this.topLevelObject)),void 0!==t&&this.parser.emit("onkey",t)}});const e=t.jsonpaths||[];this.jsonPaths=e.map((t=>new de(t)))}write(t){super.write(t);let e=[];return this.streamingArray&&(e=[...this.streamingArray],this.streamingArray.length=0),e}getPartialResult(){return this.topLevelObject}getStreamingJsonPath(){return this.streamingJsonPath}getStreamingJsonPathAsString(){return this.streamingJsonPath&&this.streamingJsonPath.toString()}getJsonPath(){return this.jsonpath}_matchJSONPath(){const t=this.getJsonPath();if(0===this.jsonPaths.length)return!0;for(const e of this.jsonPaths)if(e.equals(t))return!0;return!1}}const ge={...{dataType:null,batchType:null,name:"GeoJSON",id:"geojson",module:"geojson",version:"undefined"!=typeof __VERSION__?__VERSION__:"latest",worker:!0,extensions:["geojson"],mimeTypes:["application/geo+json"],category:"geometry",text:!0,options:{geojson:{shape:"geojson-table"},json:{shape:"object-row-table",jsonpaths:["$","$.features"]},gis:{format:"geojson"}}},parse:async function(t,e){return me((new TextDecoder).decode(t),e)},parseTextSync:me,parseInBatches:function(t,e){(e={...ge.options,...e}).json={...ge.options.geojson,...e.geojson};const n=async function*(t,e){const n=(0,Lt.W5)(t),{metadata:r}=e,{jsonpaths:o}=e.json||{};let s=!0;const i=new Ot(null,e),a=new fe({jsonpaths:o});for await(const u of n){const t=a.write(u),n=t.length>0&&a.getStreamingJsonPathAsString();if(t.length>0&&s){if(r){const t={shape:e?.json?.shape||"array-row-table",batchType:"partial-result",data:[],length:0,bytesUsed:0,container:a.getPartialResult(),jsonpath:n};yield t}s=!1}for(const e of t){i.addRow(e);const t=i.getFullBatch({jsonpath:n});t&&(yield t)}i.chunkComplete(u);const o=i.getFullBatch({jsonpath:n});o&&(yield o)}const l=a.getStreamingJsonPathAsString(),c=i.getFinalBatch({jsonpath:l});if(c&&(yield c),r){const t={shape:"json",batchType:"final-result",container:a.getPartialResult(),jsonpath:a.getStreamingJsonPathAsString(),data:[],length:0};yield t}}(t,e);if("binary"===e.gis.format)return async function*(t){for await(const e of t)e.data=(0,bt.d)(e.data),yield e}(n);return n}};function me(t,e){let n;(e={...ge.options,...e}).geojson={...ge.options.geojson,...e.geojson},e.gis=e.gis||{};try{n=JSON.parse(t)}catch{n={}}const r={shape:"geojson-table",type:"FeatureCollection",features:n?.features||[]};return"binary"===e.gis.format?(0,bt.d)(r.features):r}var ye=n(17817),be=n(23419),we=n(59452),ve=n(17370),xe=n(83818),_e=n(21515),Se=n(19584),Ae=n(87167),Te=n(80247);class Pe extends xe.A{static defaultProps={data:{type:"object",optional:!1,value:null,async:!1}};updateState(t){super.updateState(t);const{props:e,changeFlags:n}=t;n.dataChanged&&e.data&&this.setState({vectorTileSource:e.data,binary:!1})}async getTileData(t){const e=this.state.vectorTileSource;return await e.getTileData(t)}renderSubLayers(t){return super.renderSubLayers(t)}}class Ee extends we.A{static layerName="TileSourceLayer";static defaultProps={...ve.A.defaultProps,layerMode:"tile",showTileBorders:!0};initializeState(){this.setState({tileSource:null})}updateState(t){let{props:e,changeFlags:n}=t;this.setState({tileSource:e.tileSource})}renderLayers(){const{tileSource:t}=this.state;return this.sourceSupportsMVTLayer()?(t.options.table.coordinates="local",this.renderMVTLayer()):(t.options.table.coordinates="wgs84",this.renderTileLayer())}sourceSupportsMVTLayer(){const{tileSource:t}=this.props;return"application/vnd.mapbox-vector-tile"===t.mimeType&&t.localCoordinates}renderMVTLayer(){const{tileSource:t,showTileBorders:e,metadata:n,onTilesLoad:r}=this.props,o=n?.minZoom||0,s=n?.maxZoom||30,i=this.context.device.getCanvasContext().getDevicePixelRatio();return[new Pe({id:String(t.url),data:t,getLineColor:[0,0,0],getLineWidth:1,getFillColor:[100,120,140],lineWidthUnits:"pixels",pickable:!0,autoHighlight:!0,onViewportLoad:r,minZoom:o,maxZoom:s,tileSize:256,zoomOffset:1===i?-1:0,showTileBorders:e})]}renderTileLayer(){const{tileSource:t,showTileBorders:e,metadata:n,onTilesLoad:r}=this.props,o=n?.minZoom||0,s=n?.maxZoom||30;return[new ve.A({id:String(t.url),getTileData:t.getTileData,maxRequests:20,pickable:!0,autoHighlight:e,onViewportLoad:r,minZoom:o,maxZoom:s,tileSize:256,zoomOffset:1===devicePixelRatio?-1:0,renderSubLayers:ke,tileSource:t,showTileBorders:e})]}}function ke(t){const{tileSource:e,showTileBorders:n,minZoom:r,maxZoom:o,tile:{index:{z:s},bbox:{west:i,south:a,east:l,north:c}}}=t,u=[],h=s<=r||s>=o?[255,0,0,255]:[0,0,255,255];switch(e.mimeType){case"application/vnd.mapbox-vector-tile":u.push(new _e.A({id:`${t.id}-geojson`,data:t.data,pickable:!0,autoHighlight:!0,lineWidthScale:500,lineWidthMinPixels:.5,getFillColor:[100,120,140,255],highlightColor:[0,0,200,255]}));break;case"image/png":case"image/jpeg":case"image/webp":case"image/avif":u.push(new Se.A(t,{data:null,image:t.data,bounds:[i,a,l,c],pickable:!0}));break;default:Te.error("Unknown tile mimeType",e?.mimeType)}return n&&u.push(new Ae.A({id:`${t.id}-border`,data:[[[i,c],[i,a],[l,a],[l,c],[i,c]]],getPath:t=>t,getColor:h,widthMinPixels:4})),u}var Ce=n(86893),Oe=n(56505),Le=n.n(Oe),je=n(75293),Re=n(89511),Ie=n(62540);const Me=je.Ay.div.withConfig({displayName:"example-panel__Container",componentId:"sc-1dag6ia-0"})(["display:flex;flex-direction:column;position:absolute;top:0;right:0;max-width:320px;background:#fff;color:#121212;box-shadow:0 2px 4px rgba(0,0,0,0.3);padding:12px 24px;margin:20px;font-size:13px;line-height:2;outline:none;z-index:100;height:calc(100vh - 105px);width:500px;.loading-indicator{margin:0;text-align:center;transition:opacity 300ms ease-out;}> .monaco-editor{height:calc(100vh - 200px) !important;width:700px !important;}"]),Ne=je.Ay.select.withConfig({displayName:"example-panel__DropDown",componentId:"sc-1dag6ia-1"})(["margin-bottom:6px;"]),Ue=t=>{t={examples:{},droppedFile:null,exampleName:null,categoryName:null,onExampleChange:()=>{},...t};const[e,n]=(0,r.useState)({examples:[],categoryName:null,exampleName:null,example:null,error:null});return(0,r.useEffect)((()=>{const e=function(t,e){if(e)return{[e]:t[e]};return{...t}}(t.examples,t.format),r=t.format||t.initialCategoryName;let o=t.format?Object.keys(e[r])[0]:t.initialExampleName;const s=e[r][o];n((t=>({...t,examples:e,exampleName:o,categoryName:r,example:s})))}),[t.examples,t.format,t.initialCategoryName,t.initialExampleName]),(0,r.useEffect)((()=>{e.example&&t.onExampleChange({categoryName:e.categoryName,exampleName:e.exampleName,example:e.example})}),[e.example]),(0,Ie.jsxs)(Me,{children:[(0,Ie.jsx)(Ve,{...e}),(0,Ie.jsx)(ze,{examples:e.examples,categoryName:e.categoryName,exampleName:e.exampleName,onExampleChange:t=>{let{categoryName:e,exampleName:r,example:o}=t;n((t=>({...t,categoryName:e,exampleName:r,example:o})))}}),t.children]})},Be=t=>(0,Ie.jsx)(Re.Ay,{language:"json",options:{readOnly:!0},theme:"vs-dark",value:t.metadata||"No metadata available"}),Fe={position:"absolute",right:0,bottom:0,backgroundColor:"hsla(0,0%,100%,.5)",padding:"0 5px",font:"12px/20px Helvetica Neue,Arial,Helvetica,sans-serif"};function $e(t){return(0,Ie.jsx)("div",{style:Fe,children:t.attributions?.map((t=>(0,Ie.jsx)("div",{children:t},t)))})}const Ve=t=>{let{categoryName:e,exampleName:n}=t;return e&&n?(0,Ie.jsx)("div",{children:(0,Ie.jsxs)("h3",{children:[n," ",(0,Ie.jsx)("b",{children:e})," "]})}):null},ze=t=>{const{categoryName:e,exampleName:n}=t;if(!e||!n)return!1;const r=`${e}.${n}`;return(0,Ie.jsx)(Ne,{value:r,onChange:e=>{const n=e.target.value.split("."),r=n[0],o=n[1],s=t.examples[r][o];t.onExampleChange({categoryName:r,exampleName:o,example:s})},children:Object.keys(t.examples).map(((e,n)=>{const r=t.examples[e];return(0,Ie.jsx)("optgroup",{label:e,children:Object.keys(r).map(((t,n)=>{const r=`${e}.${t}`;return(0,Ie.jsx)("option",{value:r,children:`${t} (${e})`},n)}))},n)}))})};const De="GeoJSON",Je="Countries",qe="https://basemaps.cartocdn.com/gl/positron-nolabels-gl-style/style.json",We={longitude:-122.4,latitude:37.74,zoom:2,minZoom:1,maxZoom:20,pitch:0,bearing:0},Ze={MVT:{"OpenStreetMap Tiles":{sourceType:"mvt",data:"https://c.tile.openstreetmap.org",viewState:{...We,longitude:40,latitude:57,zoom:5}}},PMTILES:{"FSQ Tiles":{sourceType:"pmtiles",data:"https://4sq-studio-public.s3.us-west-2.amazonaws.com/pmtiles-test/161727fe-7952-4e57-aa05-850b3086b0b2.pmtiles",attributions:["\xa9 Foursquare"],viewState:{...We}},"NZ Buildings":{sourceType:"pmtiles",data:"https://r2-public.protomaps.com/protomaps-sample-datasets/nz-buildings-v3.pmtiles",attributions:["\xa9 Land Information New Zealand"],viewState:{...We}},Terrarium:{sourceType:"pmtiles",data:"https://r2-public.protomaps.com/protomaps-sample-datasets/terrarium_z9.pmtiles",tileSize:[512,512]}},GeoJSON:{Countries:{sourceType:"table",data:"https://d2ad6b4ur7yvpq.cloudfront.net/naturalearth-3.3.0/ne_50m_admin_0_scale_rank.geojson",viewState:{...We,longitude:-4.65,latitude:-29.76,zoom:1.76}}}};var Ye=n(80247);const Ge={latitude:47.65,longitude:7,zoom:2,maxZoom:20};function Xe(t){void 0===t&&(t={});const[e,n]=(0,r.useState)({tileSource:null,metadata:null,viewState:Ge,error:null}),{tileSource:s,metadata:i}=e,a=s&&new Ee({data:s,tileSource:s,showTileBorders:!0,metadata:i,onTilesLoad:t.onTilesLoad,pickable:!0,autoHighlight:!0});return(0,Ie.jsxs)("div",{style:{position:"relative",height:"100%"},children:[(0,Ie.jsxs)(Ue,{title:"Tileset Metadata",examples:Ze,format:t.format,initialCategoryName:De,initialExampleName:Je,onExampleChange:async function(t){const{categoryName:r,exampleName:s,example:i}=t,a=i.data;try{let t=function(t){const e=t.data;return(0,o.O)(e,[O,lt,pt],{core:{attributions:t.attributions,loaders:[ge],loadOptions:{tilejson:{maxValues:10}}},pmtiles:{},table:{generateId:!0},mvt:{}})}(i);n((e=>({...e,tileSource:t,metadata:null}))),(async()=>{const r=await t.getMetadata();let o={...e.viewState,...i.viewState};o=function(t,e){if(!e)return t;t={...t},e.minZoom<t.zoom&&(t.zoom=Math.max(e.minZoom,1.2));e.minZoom>t.zoom&&(t.zoom=e.maxZoom);"number"==typeof e.center?.[0]&&"number"==typeof e.center?.[1]&&(t={...t,longitude:e.center[0],latitude:e.center[1]});return t}(o,r),n((t=>({...t,initialViewState:o,metadata:r?JSON.stringify(r,null,2):""})))})()}catch(l){Ye.error("Failed to load data",a,l),n((t=>({...t,error:`Could not load ${s}: ${l.message}`})))}},children:[(0,Ie.jsx)(Be,{metadata:i}),t.children,(0,Ie.jsx)("pre",{style:{textAlign:"center",margin:0}})]}),(0,Ie.jsxs)(ye.A,{layers:[a],views:new be.A({repeat:!0}),initialViewState:e.viewState,controller:!0,getTooltip:Qe,children:[(0,Ie.jsx)(Ce.T5,{mapLib:Le(),mapStyle:qe}),(0,Ie.jsx)($e,{attributions:i?.attributions})]})]})}function Qe(t){if(t.tile){const{x:e,y:n,z:r}=t.tile.index;return`tile: x: ${e}, y: ${n}, z: ${r}`}return null}},88480:(t,e,n)=>{n.d(e,{Gv:()=>s,H1:()=>d,Pe:()=>h,Sv:()=>c,Td:()=>l,aC:()=>i,qf:()=>u,xZ:()=>a});const r=t=>"boolean"==typeof t,o=t=>"function"==typeof t,s=t=>null!==t&&"object"==typeof t,i=t=>s(t)&&t.constructor==={}.constructor,a=t=>Boolean(t)&&"function"==typeof t[Symbol.iterator],l=t=>t&&"function"==typeof t[Symbol.asyncIterator],c=t=>"undefined"!=typeof Response&&t instanceof Response||t&&t.arrayBuffer&&t.text&&t.json,u=t=>"undefined"!=typeof Blob&&t instanceof Blob,h=t=>t&&"object"==typeof t&&t.isBuffer,d=t=>(t=>"undefined"!=typeof ReadableStream&&t instanceof ReadableStream||s(t)&&o(t.tee)&&o(t.cancel)&&o(t.getReader))(t)||(t=>s(t)&&o(t.read)&&o(t.pipe)&&r(t.readable))(t)},38313:(t,e,n)=>{function r(t,e,n){const r=n?.core?.type||n.type||"auto",o="auto"===r?function(t,e){for(const n of e)if(n.testURL&&n.testURL(t))return n;return null}(t,e):function(t,e){for(const n of e)if(n.type===t)return n;return null}(r,e);if(!o)throw new Error("Not a valid source type");return o.createDataSource(t,n)}n.d(e,{O:()=>r})},85930:(t,e,n)=>{n.d(e,{H:()=>a});var r=n(88480),o=n(22858),s=n(92263),i=n(69681);async function a(t,e,n,a){let l,c;Array.isArray(e)||(0,o.l)(e)?(l=e,c=n):(l=[],c=e);const u=(0,s.z)(c);let h=t;return"string"==typeof t&&(h=await u(t)),(0,r.qf)(t)&&(h=await u(t)),Array.isArray(l),await(0,i.q)(h,l,c)}},69681:(t,e,n)=>{n.d(e,{q:()=>J});var r=n(97354),o=n(99222);class s{terminate(){}}var i=n(46410);const a=new Map;function l(t){(0,i.v)(t.source&&!t.url||!t.source&&t.url);let e=a.get(t.source||t.url);return e||(t.url&&(e=function(t){if(!t.startsWith("http"))return t;return c((e=t,`try {\n  importScripts('${e}');\n} catch (error) {\n  console.error(error);\n  throw error;\n}`));var e}(t.url),a.set(t.url,e)),t.source&&(e=c(t.source),a.set(t.source,e))),(0,i.v)(e),e}function c(t){const e=new Blob([t],{type:"application/javascript"});return URL.createObjectURL(e)}function u(t,e,n){void 0===e&&(e=!0);const r=n||new Set;if(t){if(h(t))r.add(t);else if(h(t.buffer))r.add(t.buffer);else if(ArrayBuffer.isView(t));else if(e&&"object"==typeof t)for(const o in t)u(t[o],e,r)}else;return void 0===n?Array.from(r):[]}function h(t){return!!t&&(t instanceof ArrayBuffer||("undefined"!=typeof MessagePort&&t instanceof MessagePort||("undefined"!=typeof ImageBitmap&&t instanceof ImageBitmap||"undefined"!=typeof OffscreenCanvas&&t instanceof OffscreenCanvas)))}var d=n(80247);const p=()=>{};class f{terminated=!1;_loadableURL="";static isSupported(){return"undefined"!=typeof Worker&&o.Bd||void 0!==s&&!o.Bd}constructor(t){const{name:e,source:n,url:r}=t;(0,i.v)(n||r),this.name=e,this.source=n,this.url=r,this.onMessage=p,this.onError=t=>d.log(t),this.worker=o.Bd?this._createBrowserWorker():this._createNodeWorker()}destroy(){this.onMessage=p,this.onError=p,this.worker.terminate(),this.terminated=!0}get isRunning(){return Boolean(this.onMessage)}postMessage(t,e){e=e||u(t),this.worker.postMessage(t,e)}_getErrorFromErrorEvent(t){let e="Failed to load ";return e+=`worker ${this.name} from ${this.url}. `,t.message&&(e+=`${t.message} in `),t.lineno&&(e+=`:${t.lineno}:${t.colno}`),new Error(e)}_createBrowserWorker(){this._loadableURL=l({source:this.source,url:this.url});const t=new Worker(this._loadableURL,{name:this.name});return t.onmessage=t=>{t.data?this.onMessage(t.data):this.onError(new Error("No data received"))},t.onerror=t=>{this.onError(this._getErrorFromErrorEvent(t)),this.terminated=!0},t.onmessageerror=t=>d.error(t),t}_createNodeWorker(){let t;if(this.url){const e=this.url.includes(":/")||this.url.startsWith("/")?this.url:`./${this.url}`;t=new s(e,{eval:!1})}else{if(!this.source)throw new Error("no worker");t=new s(this.source,{eval:!0})}return t.on("message",(t=>{this.onMessage(t)})),t.on("error",(t=>{this.onError(t)})),t.on("exit",(t=>{})),t}}class g{isRunning=!0;_resolve=()=>{};_reject=()=>{};constructor(t,e){this.name=t,this.workerThread=e,this.result=new Promise(((t,e)=>{this._resolve=t,this._reject=e}))}postMessage(t,e){this.workerThread.postMessage({source:"loaders.gl",type:t,payload:e})}done(t){(0,i.v)(this.isRunning),this.isRunning=!1,this._resolve(t)}error(t){(0,i.v)(this.isRunning),this.isRunning=!1,this._reject(t)}}var m=n(80247);class y{name="unnamed";maxConcurrency=1;maxMobileConcurrency=1;onDebug=()=>{};reuseWorkers=!0;props={};jobQueue=[];idleQueue=[];count=0;isDestroyed=!1;static isSupported(){return f.isSupported()}constructor(t){this.source=t.source,this.url=t.url,this.setProps(t)}destroy(){this.idleQueue.forEach((t=>t.destroy())),this.isDestroyed=!0}setProps(t){this.props={...this.props,...t},void 0!==t.name&&(this.name=t.name),void 0!==t.maxConcurrency&&(this.maxConcurrency=t.maxConcurrency),void 0!==t.maxMobileConcurrency&&(this.maxMobileConcurrency=t.maxMobileConcurrency),void 0!==t.reuseWorkers&&(this.reuseWorkers=t.reuseWorkers),void 0!==t.onDebug&&(this.onDebug=t.onDebug)}async startJob(t,e,n){void 0===e&&(e=(t,e,n)=>t.done(n)),void 0===n&&(n=(t,e)=>t.error(e));const r=new Promise((r=>(this.jobQueue.push({name:t,onMessage:e,onError:n,onStart:r}),this)));return this._startQueuedJob(),await r}async _startQueuedJob(){if(!this.jobQueue.length)return;const t=this._getAvailableWorker();if(!t)return;const e=this.jobQueue.shift();if(e){this.onDebug({message:"Starting job",name:e.name,workerThread:t,backlog:this.jobQueue.length});const r=new g(e.name,t);t.onMessage=t=>e.onMessage(r,t.type,t.payload),t.onError=t=>e.onError(r,t),e.onStart(r);try{await r.result}catch(n){m.error(`Worker exception: ${n}`)}finally{this.returnWorkerToQueue(t)}}}returnWorkerToQueue(t){!o.Bd||this.isDestroyed||!this.reuseWorkers||this.count>this._getMaxConcurrency()?(t.destroy(),this.count--):this.idleQueue.push(t),this.isDestroyed||this._startQueuedJob()}_getAvailableWorker(){if(this.idleQueue.length>0)return this.idleQueue.shift()||null;if(this.count<this._getMaxConcurrency()){this.count++;const t=`${this.name.toLowerCase()} (#${this.count} of ${this.maxConcurrency})`;return new f({name:t,source:this.source,url:this.url})}return null}_getMaxConcurrency(){return o.Fr?this.maxMobileConcurrency:this.maxConcurrency}}const b={maxConcurrency:3,maxMobileConcurrency:1,reuseWorkers:!0,onDebug:()=>{}};class w{workerPools=(()=>new Map)();static isSupported(){return f.isSupported()}static getWorkerFarm(t){return void 0===t&&(t={}),w._workerFarm=w._workerFarm||new w({}),w._workerFarm.setProps(t),w._workerFarm}constructor(t){this.props={...b},this.setProps(t),this.workerPools=new Map}destroy(){for(const t of this.workerPools.values())t.destroy();this.workerPools=new Map}setProps(t){this.props={...this.props,...t};for(const e of this.workerPools.values())e.setProps(this._getWorkerPoolProps())}getWorkerPool(t){const{name:e,source:n,url:r}=t;let o=this.workerPools.get(e);return o||(o=new y({name:e,source:n,url:r}),o.setProps(this._getWorkerPoolProps()),this.workerPools.set(e,o)),o}_getWorkerPoolProps(){return{maxConcurrency:this.props.maxConcurrency,maxMobileConcurrency:this.props.maxMobileConcurrency,reuseWorkers:this.props.reuseWorkers,onDebug:this.props.onDebug}}}var v=n(11654);var x=n(80247);async function _(t,e,n,r,s){const a=t.id,l=function(t,e){void 0===e&&(e={});const n=e[t.id]||{},r=o.Bd?`${t.id}-worker.js`:`${t.id}-worker-node.js`;let s=n.workerUrl;if(s||"compression"!==t.id||(s=e.workerUrl),"test"===e._workerType&&(s=o.Bd?`modules/${t.module}/dist/${r}`:`modules/${t.module}/src/workers/${t.id}-worker-node.ts`),!s){let e=t.version;"latest"===e&&(e=v.x);const n=e?`@${e}`:"";s=`https://unpkg.com/@loaders.gl/${t.module}${n}/dist/${r}`}return(0,i.v)(s),s}(t,n),c=w.getWorkerFarm(n).getWorkerPool({name:a,url:l});n=JSON.parse(JSON.stringify(n)),r=JSON.parse(JSON.stringify(r||{}));const u=await c.startJob("process-on-worker",S.bind(null,s));u.postMessage("process",{input:e,options:n,context:r});const h=await u.result;return await h.result}async function S(t,e,n,r){switch(n){case"done":e.done(r);break;case"error":e.error(new Error(r.error));break;case"process":const{id:s,input:i,options:a}=r;try{const n=await t(i,a);e.postMessage("done",{id:s,result:n})}catch(o){const t=o instanceof Error?o.message:"unknown error";e.postMessage("error",{id:s,error:t})}break;default:x.warn(`parse-with-worker unknown message ${n}`)}}var A=n(9894);var T=n(22858),P=n(88480),E=n(91400),k=n(8001);const C=262144;const O=262144;const L=1048576;var j=n(26951),R=n(53024);function I(t,e){return j.Bd?async function*(t,e){const n=t.getReader();let r;try{for(;;){const t=r||n.read();e?._streamReadAhead&&(r=n.read());const{done:o,value:s}=await t;if(o)return;yield(0,R.XA)(s)}}catch(o){n.releaseLock()}}(t,e):async function*(t){for await(const e of t)yield(0,R.XA)(e)}(t)}function M(t,e){if("string"==typeof t)return function*(t,e){const n=e?.chunkSize||C;let r=0;const o=new TextEncoder;for(;r<t.length;){const e=Math.min(t.length-r,n),s=t.slice(r,r+e);r+=e,yield o.encode(s)}}(t,e);if(t instanceof ArrayBuffer)return function(t,e){return void 0===e&&(e={}),function*(){const{chunkSize:n=O}=e;let r=0;for(;r<t.byteLength;){const e=Math.min(t.byteLength-r,n),o=new ArrayBuffer(e),s=new Uint8Array(t,r,e);new Uint8Array(o).set(s),r+=e,yield o}}()}(t,e);if((0,P.qf)(t))return async function*(t,e){const n=e?.chunkSize||L;let r=0;for(;r<t.size;){const e=r+n,o=await t.slice(r,e).arrayBuffer();r=e,yield o}}(t,e);if((0,P.H1)(t))return I(t,e);if((0,P.Sv)(t)){return I(t.body,e)}throw new Error("makeIterator")}var N=n(45653);const U="Cannot convert supplied data type";async function B(t,e,n){const r=t instanceof ArrayBuffer||ArrayBuffer.isView(t);if("string"==typeof t||r)return function(t,e){if(e.text&&"string"==typeof t)return t;if((0,P.Pe)(t)&&(t=t.buffer),t instanceof ArrayBuffer){const n=t;return e.text&&!e.binary?new TextDecoder("utf8").decode(n):n}if(ArrayBuffer.isView(t)){if(e.text&&!e.binary)return new TextDecoder("utf8").decode(t);let n=t.buffer;const r=t.byteLength||t.length;return 0===t.byteOffset&&r===n.byteLength||(n=n.slice(t.byteOffset,t.byteOffset+r)),n}throw new Error(U)}(t,e);if((0,P.qf)(t)&&(t=await(0,N.wv)(t)),(0,P.Sv)(t)){const n=t;return await(0,N.Mz)(n),e.binary?await n.arrayBuffer():await n.text()}if((0,P.H1)(t)&&(t=M(t,n)),(0,P.xZ)(t)||(0,P.Td)(t))return(0,k.cy)(t);throw new Error(U)}var F=n(92263),$=n(3680),V=n(36970);var z=n(44029),D=n(188);async function J(t,e,n,s){!e||Array.isArray(e)||(0,T.l)(e)||(s=void 0,n=e,e=void 0),t=await t,n=n||{};const a=(0,z.Al)(t),l=function(t,e){if(t&&!Array.isArray(t))return t;let n;if(t&&(n=Array.isArray(t)?t:[t]),e&&e.loaders){const t=Array.isArray(e.loaders)?e.loaders:[e.loaders];n=n?[...n,...t]:t}return n&&n.length?n:void 0}(e,s),c=await(0,D.M)(t,l,n);return c?(s=function(t,e,n){if(n)return n;const r={fetch:(0,F.z)(e,t),...t};if(r.url){const t=(0,$.S3)(r.url);r.baseUrl=t,r.queryString=(0,$.by)(r.url),r.filename=V.iW(t),r.baseUrl=V.pD(t)}return Array.isArray(r.loaders)||(r.loaders=null),r}({url:a,_parse:J,loaders:l},n=(0,E.a5)(n,c,l,a),s||null),await async function(t,e,n,s){if(function(t,e){void 0===e&&(e=A.x),(0,i.v)(t,"no worker provided");const n=t.version}(t),n=(0,r.l)(t.options,n),(0,P.Sv)(e)){const t=e,{ok:n,redirected:r,status:o,statusText:i,type:a,url:l}=t,c=Object.fromEntries(t.headers.entries());s.response={headers:c,ok:n,redirected:r,status:o,statusText:i,type:a,url:l}}e=await B(e,t,n);const a=t;if(a.parseTextSync&&"string"==typeof e)return a.parseTextSync(e,n,s);if(function(t,e){return!!w.isSupported()&&!(!o.Bd&&!e?._nodeWorkers)&&t.worker&&e?.worker}(t,n))return await _(t,e,n,s,J);if(a.parseText&&"string"==typeof e)return await a.parseText(e,n,s);if(a.parse)return await a.parse(e,n,s);throw(0,i.v)(!a.parseSync),new Error(`${t.id} loader - no parser found and worker is disabled`)}(c,t,n,s)):null}},76702:(t,e,n)=>{n.d(e,{Ph:()=>a,mk:()=>i});var r=n(22858),o=n(91400);const s=()=>{const t=(0,o.K2)();return t.loaderRegistry=t.loaderRegistry||[],t.loaderRegistry};function i(t){const e=s();t=Array.isArray(t)?t:[t];for(const n of t){const t=(0,r.D)(n);e.find((e=>t===e))||e.unshift(t)}}function a(){return s()}},188:(t,e,n)=>{n.d(e,{M:()=>p});var r=n(55256),o=n(36970),s=n(95247),i=n(22858),a=n(44029),l=n(95410),c=n(76702),u=n(88480),h=n(3680);const d=/\.([^.]+)$/;async function p(t,e,n,r){if(void 0===e&&(e=[]),!g(t))return null;let o=f(t,e,{...n,nothrow:!0},r);if(o)return o;if((0,u.qf)(t)&&(o=f(t=await t.slice(0,10).arrayBuffer(),e,n,r)),!o&&!n?.nothrow)throw new Error(m(t));return o}function f(t,e,n,o){if(void 0===e&&(e=[]),!g(t))return null;if(e&&!Array.isArray(e))return(0,i.D)(e);let s=[];e&&(s=s.concat(e)),n?.ignoreRegisteredLoaders||s.push(...(0,c.Ph)()),function(t){for(const e of t)(0,i.D)(e)}(s);const l=function(t,e,n,o){const s=(0,a.Al)(t),i=(0,a.z4)(t),l=(0,h.S3)(s)||o?.url;let c=null,u="";n?.mimeType&&(c=y(e,n?.mimeType),u=`match forced by supplied MIME type ${n?.mimeType}`);c=c||function(t,e){const n=e&&d.exec(e),r=n&&n[1];return r?function(t,e){e=e.toLowerCase();for(const n of t)for(const t of n.extensions)if(t.toLowerCase()===e)return n;return null}(t,r):null}(e,l),u=u||(c?`matched url ${l}`:""),c=c||y(e,i),u=u||(c?`matched MIME type ${i}`:""),c=c||function(t,e){if(!e)return null;for(const n of t)if("string"==typeof e){if(b(e,n))return n}else if(ArrayBuffer.isView(e)){if(w(e.buffer,e.byteOffset,n))return n}else if(e instanceof ArrayBuffer){if(w(e,0,n))return n}return null}(e,t),u=u||(c?`matched initial data ${v(t)}`:""),n?.fallbackMimeType&&(c=c||y(e,n?.fallbackMimeType),u=u||(c?`matched fallback MIME type ${i}`:""));u&&r.R.log(1,`selectLoader selected ${c?.name}: ${u}.`);return c}(t,s,n,o);if(!l&&!n?.nothrow)throw new Error(m(t));return l}function g(t){return!(t instanceof Response&&204===t.status)}function m(t){const e=(0,a.Al)(t),n=(0,a.z4)(t);let r="No valid loader found (";r+=e?`${o.iW(e)}, `:"no url provided, ",r+=`MIME type: ${n?`"${n}"`:"not provided"}, `;const s=t?v(t):"";return r+=s?` first bytes: "${s}"`:"first bytes: not available",r+=")",r}function y(t,e){for(const n of t){if(n.mimeTypes?.some((t=>(0,l.JQ)(e,t))))return n;if((0,l.JQ)(e,`application/x.${n.id}`))return n}return null}function b(t,e){if(e.testText)return e.testText(t);return(Array.isArray(e.tests)?e.tests:[e.tests]).some((e=>t.startsWith(e)))}function w(t,e,n){return(Array.isArray(n.tests)?n.tests:[n.tests]).some((n=>function(t,e,n,r){if(r instanceof ArrayBuffer)return(0,s.YV)(r,t,r.byteLength);switch(typeof r){case"function":return r(t);case"string":return r===x(t,e,r.length);default:return!1}}(t,e,0,n)))}function v(t,e){if(void 0===e&&(e=5),"string"==typeof t)return t.slice(0,e);if(ArrayBuffer.isView(t))return x(t.buffer,t.byteOffset,e);if(t instanceof ArrayBuffer){return x(t,0,e)}return""}function x(t,e,n){if(t.byteLength<e+n)return"";const r=new DataView(t);let o="";for(let s=0;s<n;s++)o+=String.fromCharCode(r.getUint8(e+s));return o}},44207:(t,e,n)=>{n.d(e,{t2:()=>s});var r=n(29512),o=n(45653);async function s(t,e){if("string"==typeof t){const n=(0,r.o1)(t);return function(t){return!function(t){return t.startsWith("http:")||t.startsWith("https:")}(t)&&!function(t){return t.startsWith("data:")}(t)}(n)&&globalThis.loaders?.fetchNode?globalThis.loaders?.fetchNode(n,e):await fetch(n,e)}return await(0,o.wv)(t)}},92263:(t,e,n)=>{n.d(e,{z:()=>i});var r=n(88480),o=n(44207),s=n(91400);function i(t,e){const n=(0,s.pp)(),i=t||n;return"function"==typeof i.fetch?i.fetch:(0,r.Gv)(i.fetch)?t=>(0,o.t2)(t,i.fetch):e?.fetch?e?.fetch:o.t2}},22858:(t,e,n)=>{n.d(e,{D:()=>s,l:()=>o});var r=n(10981);function o(t){if(!t)return!1;Array.isArray(t)&&(t=t[0]);return Array.isArray(t?.extensions)}function s(t){let e;return(0,r.v)(t,"null loader"),(0,r.v)(o(t),"invalid loader"),Array.isArray(t)&&(e=t[1],t=t[0],t={...t,options:{...t.options,...e}}),(t?.parseTextSync||t?.parseText)&&(t.text=!0),t.text||(t.binary=!0),t}},91400:(t,e,n)=>{n.d(e,{pp:()=>d,K2:()=>h,a5:()=>p});var r=n(88480),o=n(35593),s=n(80247);const i=new o.t({id:"loaders.gl"});class a{log(){return()=>{}}info(){return()=>{}}warn(){return()=>{}}error(){return()=>{}}}var l=n(26951);const c={fetch:null,mimeType:void 0,nothrow:!1,log:new class{constructor(){this.console=s}log(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];return this.console.log.bind(this.console,...e)}info(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];return this.console.info.bind(this.console,...e)}warn(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];return this.console.warn.bind(this.console,...e)}error(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];return this.console.error.bind(this.console,...e)}},useLocalLibraries:!1,CDN:"https://unpkg.com/@loaders.gl",worker:!0,maxConcurrency:3,maxMobileConcurrency:1,reuseWorkers:l.Bd,_nodeWorkers:!1,_workerType:"",limit:0,_limitMB:0,batchSize:"auto",batchDebounceMs:0,metadata:!1,transforms:[]},u={throws:"nothrow",dataType:"(no longer used)",uri:"baseUri",method:"fetch.method",headers:"fetch.headers",body:"fetch.body",mode:"fetch.mode",credentials:"fetch.credentials",cache:"fetch.cache",redirect:"fetch.redirect",referrer:"fetch.referrer",referrerPolicy:"fetch.referrerPolicy",integrity:"fetch.integrity",keepalive:"fetch.keepalive",signal:"fetch.signal"};function h(){globalThis.loaders=globalThis.loaders||{};const{loaders:t}=globalThis;return t._state||(t._state={}),t._state}function d(){const t=h();return t.globalOptions=t.globalOptions||{...c},t.globalOptions}function p(t,e,n,r){return n=n||[],function(t,e){f(t,null,c,u,e);for(const n of e){const r=t&&t[n.id]||{},o=n.options&&n.options[n.id]||{},s=n.deprecatedOptions&&n.deprecatedOptions[n.id]||{};f(r,n.id,o,s,e)}}(t,n=Array.isArray(n)?n:[n]),m(e,t,r)}function f(t,e,n,o,s){const a=e||"Top level",l=e?`${e}.`:"";for(const c in t){const u=!e&&(0,r.Gv)(t[c]);if(!(c in n)&&!("baseUri"===c&&!e)&&!("workerUrl"===c&&e))if(c in o)i.warn(`${a} loader option '${l}${c}' no longer supported, use '${o[c]}'`)();else if(!u){const t=g(c,s);i.warn(`${a} loader option '${l}${c}' not recognized. ${t}`)()}}}function g(t,e){const n=t.toLowerCase();let r="";for(const o of e)for(const e in o.options){if(t===e)return`Did you mean '${o.id}.${e}'?`;const s=e.toLowerCase();(n.startsWith(s)||s.startsWith(n))&&(r=r||`Did you mean '${o.id}.${e}'?`)}return r}function m(t,e,n){const r={...t.options||{}};return function(t,e){e&&!("baseUri"in t)&&(t.baseUri=e)}(r,n),null===r.log&&(r.log=new a),y(r,d()),y(r,e),r}function y(t,e){for(const n in e)if(n in e){const o=e[n];(0,r.aC)(o)&&(0,r.aC)(t[n])?t[n]={...t[n],...e[n]}:t[n]=e[n]}}},95410:(t,e,n)=>{n.d(e,{JQ:()=>s,OA:()=>i,d_:()=>a});const r=/^data:([-\w.]+\/[-\w.+]+)(;|,)/,o=/^([-\w.]+\/[-\w.+]+)/;function s(t,e){return t.toLowerCase()===e.toLowerCase()}function i(t){const e=o.exec(t);return e?e[1]:t}function a(t){const e=r.exec(t);return e?e[1]:""}},44029:(t,e,n)=>{n.d(e,{Al:()=>i,_E:()=>l,z4:()=>a});var r=n(88480),o=n(95410),s=n(3680);function i(t){if((0,r.Sv)(t)){return t.url}if((0,r.qf)(t)){return t.name||""}return"string"==typeof t?t:""}function a(t){if((0,r.Sv)(t)){const e=t,n=e.headers.get("content-type")||"",r=(0,s.S3)(e.url);return(0,o.OA)(n)||(0,o.d_)(r)}if((0,r.qf)(t)){return t.type||""}return"string"==typeof t?(0,o.d_)(t):""}function l(t){if((0,r.Sv)(t)){return t.headers["content-length"]||-1}if((0,r.qf)(t)){return t.size}return"string"==typeof t?t.length:t instanceof ArrayBuffer||ArrayBuffer.isView(t)?t.byteLength:-1}},45653:(t,e,n)=>{n.d(e,{Mz:()=>l,wv:()=>a});var r=n(88480);class o extends Error{constructor(t,e){super(t),this.reason=e.reason,this.url=e.url,this.response=e.response}}var s=n(44029),i=n(3680);async function a(t){if((0,r.Sv)(t))return t;const e={},n=(0,s._E)(t);n>=0&&(e["content-length"]=String(n));const o=(0,s.Al)(t),i=(0,s.z4)(t);i&&(e["content-type"]=i);const a=await async function(t){const e=5;if("string"==typeof t)return`data:,${t.slice(0,e)}`;if(t instanceof Blob){const e=t.slice(0,5);return await new Promise((t=>{const n=new FileReader;n.onload=e=>t(e?.target?.result),n.readAsDataURL(e)}))}if(t instanceof ArrayBuffer){return`data:base64,${function(t){let e="";const n=new Uint8Array(t);for(let r=0;r<n.byteLength;r++)e+=String.fromCharCode(n[r]);return btoa(e)}(t.slice(0,e))}`}return null}(t);a&&(e["x-first-bytes"]=a),"string"==typeof t&&(t=(new TextEncoder).encode(t));const l=new Response(t,{headers:e});return Object.defineProperty(l,"url",{value:o}),l}async function l(t){if(!t.ok){const e=await async function(t){const n=(0,i.E1)(t.url);let r=`Failed to fetch resource (${t.status}) ${t.statusText}: ${n}`;r=r.length>100?`${r.slice(0,100)}...`:r;const s={reason:t.statusText,url:t.url,response:t};try{const e=t.headers.get("Content-Type");s.reason=!t.bodyUsed&&e?.includes("application/json")?await t.json():await t.text()}catch(e){}return new o(r,s)}(t);throw e}}},3680:(t,e,n)=>{n.d(e,{E1:()=>i,S3:()=>s,by:()=>o});const r=/\?.*/;function o(t){const e=t.match(r);return e&&e[0]}function s(t){return t.replace(r,"")}function i(t){if(t.length<50)return t;const e=t.slice(t.length-15);return`${t.substr(0,32)}...${e}`}},94842:(t,e,n)=>{n.d(e,{p:()=>o});var r=n(93670);function o(t,e){const n=e?.globalFeatureId;return void 0!==n?function(t,e){const n=s(t);for(const r of n){let t=0,n=r.featureIds.value[0];for(let o=0;o<r.featureIds.value.length;o++){const s=r.featureIds.value[o];if(s!==n){if(e===r.globalFeatureIds.value[t])return i(r,t,o);t=o,n=s}}if(e===r.globalFeatureIds.value[t])return i(r,t,r.featureIds.value.length)}throw new Error(`featureId:${e} not found`)}(t,n):function(t,e){const n=s(t,e);return function(t){const e=[];for(const n of t){if(0===n.featureIds.value.length)continue;let t=0,r=n.featureIds.value[0];for(let o=0;o<n.featureIds.value.length;o++){const s=n.featureIds.value[o];s!==r&&(e.push(i(n,t,o)),t=o,r=s)}e.push(i(n,t,n.featureIds.value.length))}return e}(n)}(t,e?.type)}function s(t,e){const n=[];return t.points&&(t.points.type="Point",n.push(t.points)),t.lines&&(t.lines.type="LineString",n.push(t.lines)),t.polygons&&(t.polygons.type="Polygon",n.push(t.polygons)),n}function i(t,e,n){const o=(0,r.s)(t,e,n),s=function(t,e){void 0===e&&(e=0);const n=Object.assign({},t.properties[t.featureIds.value[e]]);for(const r in t.numericProps)n[r]=t.numericProps[r].value[e];return n}(t,e),i=function(t,e){void 0===e&&(e=0);return t.fields&&t.fields[t.featureIds.value[e]]}(t,e);return{type:"Feature",geometry:o,properties:s,...i}}},92940:(t,e,n)=>{n.d(e,{A:()=>o});var r=n(1746);function o(t,e,n){const r=function(t){const e={};for(const n of t)if(n.properties)for(const t in n.properties){const r=n.properties[t];e[t]=d(r,e[t])}return e}(t),o=Object.keys(r).filter((t=>r[t]!==Array));return function(t,e,n){const{pointPositionsCount:r,pointFeaturesCount:o,linePositionsCount:l,linePathsCount:u,lineFeaturesCount:d,polygonPositionsCount:p,polygonObjectsCount:f,polygonRingsCount:g,polygonFeaturesCount:m,propArrayTypes:y,coordLength:b}=e,{numericPropKeys:w=[],PositionDataType:v=Float32Array,triangulate:x=!0}=n,_=t[0]&&"id"in t[0],S=t.length>65535?Uint32Array:Uint16Array,A={type:"Point",positions:new v(r*b),globalFeatureIds:new S(r),featureIds:o>65535?new Uint32Array(r):new Uint16Array(r),numericProps:{},properties:[],fields:[]},T={type:"LineString",pathIndices:l>65535?new Uint32Array(u+1):new Uint16Array(u+1),positions:new v(l*b),globalFeatureIds:new S(l),featureIds:d>65535?new Uint32Array(l):new Uint16Array(l),numericProps:{},properties:[],fields:[]},P={type:"Polygon",polygonIndices:p>65535?new Uint32Array(f+1):new Uint16Array(f+1),primitivePolygonIndices:p>65535?new Uint32Array(g+1):new Uint16Array(g+1),positions:new v(p*b),globalFeatureIds:new S(p),featureIds:m>65535?new Uint32Array(p):new Uint16Array(p),numericProps:{},properties:[],fields:[]};x&&(P.triangles=[]);for(const s of[A,T,P])for(const t of w){const e=y[t];s.numericProps[t]=new e(s.positions.length/b)}T.pathIndices[u]=l,P.polygonIndices[f]=p,P.primitivePolygonIndices[g]=p;const E={pointPosition:0,pointFeature:0,linePosition:0,linePath:0,lineFeature:0,polygonPosition:0,polygonObject:0,polygonRing:0,polygonFeature:0,feature:0};for(const c of t){const t=c.geometry,e=c.properties||{};switch(t.type){case"Point":s(t,A,E,b,e),A.properties.push(h(e,w)),_&&A.fields.push({id:c.id}),E.pointFeature++;break;case"LineString":i(t,T,E,b,e),T.properties.push(h(e,w)),_&&T.fields.push({id:c.id}),E.lineFeature++;break;case"Polygon":a(t,P,E,b,e),P.properties.push(h(e,w)),_&&P.fields.push({id:c.id}),E.polygonFeature++;break;default:throw new Error("Invalid geometry type")}E.feature++}return function(t,e,n,r){const o={shape:"binary-feature-collection",points:{...t,positions:{value:t.positions,size:r},globalFeatureIds:{value:t.globalFeatureIds,size:1},featureIds:{value:t.featureIds,size:1},numericProps:c(t.numericProps,1)},lines:{...e,positions:{value:e.positions,size:r},pathIndices:{value:e.pathIndices,size:1},globalFeatureIds:{value:e.globalFeatureIds,size:1},featureIds:{value:e.featureIds,size:1},numericProps:c(e.numericProps,1)},polygons:{...n,positions:{value:n.positions,size:r},polygonIndices:{value:n.polygonIndices,size:1},primitivePolygonIndices:{value:n.primitivePolygonIndices,size:1},globalFeatureIds:{value:n.globalFeatureIds,size:1},featureIds:{value:n.featureIds,size:1},numericProps:c(n.numericProps,1)}};o.polygons&&n.triangles&&(o.polygons.triangles={value:new Uint32Array(n.triangles),size:1});return o}(A,T,P,b)}(t,{propArrayTypes:r,...e},{numericPropKeys:n&&n.numericPropKeys||o,PositionDataType:n?n.PositionDataType:Float32Array,triangulate:!n||n.triangulate})}function s(t,e,n,r,o){e.positions.set(t.data,n.pointPosition*r);const s=t.data.length/r;u(e,o,n.pointPosition,s),e.globalFeatureIds.fill(n.feature,n.pointPosition,n.pointPosition+s),e.featureIds.fill(n.pointFeature,n.pointPosition,n.pointPosition+s),n.pointPosition+=s}function i(t,e,n,r,o){e.positions.set(t.data,n.linePosition*r);const s=t.data.length/r;u(e,o,n.linePosition,s),e.globalFeatureIds.fill(n.feature,n.linePosition,n.linePosition+s),e.featureIds.fill(n.lineFeature,n.linePosition,n.linePosition+s);for(let i=0,a=t.indices.length;i<a;++i){const o=t.indices[i],s=i===a-1?t.data.length:t.indices[i+1];e.pathIndices[n.linePath++]=n.linePosition,n.linePosition+=(s-o)/r}}function a(t,e,n,r,o){e.positions.set(t.data,n.polygonPosition*r);const s=t.data.length/r;u(e,o,n.polygonPosition,s),e.globalFeatureIds.fill(n.feature,n.polygonPosition,n.polygonPosition+s),e.featureIds.fill(n.polygonFeature,n.polygonPosition,n.polygonPosition+s);for(let i=0,a=t.indices.length;i<a;++i){const o=n.polygonPosition;e.polygonIndices[n.polygonObject++]=o;const s=t.areas[i],a=t.indices[i],c=t.indices[i+1];for(let i=0,l=a.length;i<l;++i){const o=a[i],s=i===l-1?void 0===c?t.data.length:c[0]:a[i+1];e.primitivePolygonIndices[n.polygonRing++]=n.polygonPosition,n.polygonPosition+=(s-o)/r}l(e,s,a,{startPosition:o,endPosition:n.polygonPosition,coordLength:r})}}function l(t,e,n,o){let{startPosition:s,endPosition:i,coordLength:a}=o;if(!t.triangles)return;const l=s*a,c=i*a,u=t.positions.subarray(l,c),h=n[0],d=n.slice(1).map((t=>(t-h)/a)),p=(0,r.hY)(u,d,a,e);for(let r=0,f=p.length;r<f;++r)t.triangles.push(s+p[r])}function c(t,e){const n={};for(const r in t)n[r]={value:t[r],size:e};return n}function u(t,e,n,r){for(const o in t.numericProps)if(o in e){const s=e[o];t.numericProps[o].fill(s,n,n+r)}}function h(t,e){const n={};for(const r in t)e.includes(r)||(n[r]=t[r]);return n}function d(t,e){return e!==Array&&Number.isFinite(t)?e===Float64Array||Math.fround(t)!==t?Float64Array:Float32Array:Array}},30511:(t,e,n)=>{n.d(e,{d:()=>c});var r=n(1746);function o(t,e){return void 0===e&&(e={coordLength:2,fixRingWinding:!0}),t.map((t=>function(t,e){const{geometry:n}=t;if("GeometryCollection"===n.type)throw new Error("GeometryCollection type not supported");const r=[],o=[];let l,c;switch(n.type){case"Point":c="Point",s(n.coordinates,r,o,e);break;case"MultiPoint":c="Point",n.coordinates.map((t=>s(t,r,o,e)));break;case"LineString":c="LineString",i(n.coordinates,r,o,e);break;case"MultiLineString":c="LineString",n.coordinates.map((t=>i(t,r,o,e)));break;case"Polygon":c="Polygon",l=[],a(n.coordinates,r,o,l,e);break;case"MultiPolygon":c="Polygon",l=[],n.coordinates.map((t=>a(t,r,o,l,e)));break;default:throw new Error(`Unknown type: ${c}`)}return{...t,geometry:{type:c,indices:o,data:r,areas:l}}}(t,e)))}function s(t,e,n,r){n.push(e.length),e.push(...t);for(let o=t.length;o<r.coordLength;o++)e.push(0)}function i(t,e,n,r){n.push(e.length);for(const o of t){e.push(...o);for(let t=o.length;t<r.coordLength;t++)e.push(0)}}function a(t,e,n,o,s){let a=0;const l=[],c=[];for(const u of t){const t=u.map((t=>t.slice(0,2)));let n=(0,r.IC)(t.flat());const o=n<0;s.fixRingWinding&&(0===a&&!o||a>0&&o)&&(u.reverse(),n=-n),l.push(n),i(u,e,c,s),a++}a>0&&(o.push(l),n.push(c))}var l=n(92940);function c(t,e){void 0===e&&(e={fixRingWinding:!0,triangulate:!0});const n=function(t){let e=0,n=0,r=0,o=0,s=0,i=0,a=0,l=0,c=0;const u=new Set;for(const h of t){const t=h.geometry;switch(t.type){case"Point":n++,e++,u.add(t.coordinates.length);break;case"MultiPoint":n++,e+=t.coordinates.length;for(const e of t.coordinates)u.add(e.length);break;case"LineString":s++,r+=t.coordinates.length,o++;for(const e of t.coordinates)u.add(e.length);break;case"MultiLineString":s++;for(const e of t.coordinates){r+=e.length,o++;for(const t of e)u.add(t.length)}break;case"Polygon":c++,a++,l+=t.coordinates.length;const h=t.coordinates.flat();i+=h.length;for(const t of h)u.add(t.length);break;case"MultiPolygon":c++;for(const e of t.coordinates){a++,l+=e.length;const t=e.flat();i+=t.length;for(const e of t)u.add(e.length)}break;default:throw new Error(`Unsupported geometry type: ${t.type}`)}}return{coordLength:u.size>0?Math.max(...u):2,pointPositionsCount:e,pointFeaturesCount:n,linePositionsCount:r,linePathsCount:o,lineFeaturesCount:s,polygonPositionsCount:i,polygonObjectsCount:a,polygonRingsCount:l,polygonFeaturesCount:c}}(t),r=n.coordLength,{fixRingWinding:s}=e,i=o(t,{coordLength:r,fixRingWinding:s});return(0,l.A)(i,n,{numericPropKeys:e.numericPropKeys,PositionDataType:e.PositionDataType||Float32Array,triangulate:e.triangulate})}},93670:(t,e,n)=>{function r(t,e,n){switch(t.type){case"Point":return function(t,e,n){const{positions:r}=t,o=s(r,e,n);if(o.length>1)return{type:"MultiPoint",coordinates:o};return{type:"Point",coordinates:o[0]}}(t,e,n);case"LineString":return function(t,e,n){void 0===e&&(e=-1/0);void 0===n&&(n=1/0);const{positions:r}=t,o=t.pathIndices.value.filter((t=>t>=e&&t<=n));if(!(o.length>2)){return{type:"LineString",coordinates:s(r,o[0],o[1])}}const i=[];for(let a=0;a<o.length-1;a++){const t=s(r,o[a],o[a+1]);i.push(t)}return{type:"MultiLineString",coordinates:i}}(t,e,n);case"Polygon":return o(t,e,n);default:const r=t;throw new Error(`Unsupported geometry type: ${r?.type}`)}}function o(t,e,n){void 0===e&&(e=-1/0),void 0===n&&(n=1/0);const{positions:r}=t,i=t.polygonIndices.value.filter((t=>t>=e&&t<=n)),a=t.primitivePolygonIndices.value.filter((t=>t>=e&&t<=n));if(!(i.length>2)){const t=[];for(let e=0;e<a.length-1;e++){const n=s(r,a[e],a[e+1]);t.push(n)}return{type:"Polygon",coordinates:t}}const l=[];for(let s=0;s<i.length-1;s++){const e=o(t,i[s],i[s+1]).coordinates;l.push(e)}return{type:"MultiPolygon",coordinates:l}}function s(t,e,n){e=e||0,n=n||t.value.length/t.size;const r=[];for(let o=e;o<n;o++){const e=Array();for(let n=o*t.size;n<(o+1)*t.size;n++)e.push(Number(t.value[n]));r.push(e)}return r}n.d(e,{s:()=>r})},83073:(t,e,n)=>{n.d(e,{$:()=>_});const r="undefined"!=typeof __VERSION__?__VERSION__:"latest";var o=n(10981),s=n(26951);const i=globalThis.loaders?.parseImageNode,a="undefined"!=typeof Image,l="undefined"!=typeof ImageBitmap,c=Boolean(i),u=!!s.Bd||c;var h=n(47216);const d=/^data:image\/svg\+xml/,p=/\.svg((\?|#).*)?$/;function f(t){return t&&(d.test(t)||p.test(t))}function g(t,e){if(f(e))throw new Error("SVG cannot be parsed directly to imagebitmap");return new Blob([new Uint8Array(t)])}async function m(t,e,n){const r=function(t,e){if(f(e)){let e=(new TextDecoder).decode(t);try{"function"==typeof unescape&&"function"==typeof encodeURIComponent&&(e=unescape(encodeURIComponent(e)))}catch(n){throw new Error(n.message)}return`data:image/svg+xml;base64,${btoa(e)}`}return g(t,e)}(t,n),o=self.URL||self.webkitURL,s="string"!=typeof r&&o.createObjectURL(r);try{return await async function(t,e){const n=new Image;if(n.src=t,e.image&&e.image.decode&&n.decode)return await n.decode(),n;return await new Promise(((t,e)=>{try{n.onload=()=>t(n),n.onerror=t=>{const n=t instanceof Error?t.message:"error";e(new Error(n))}}catch(r){e(r)}}))}(s||r,e)}finally{s&&o.revokeObjectURL(s)}}var y=n(80247);const b={};let w=!0;async function v(t,e,n){let r;if(f(n)){r=await m(t,e,n)}else r=g(t,n);const o=e&&e.imagebitmap;return await async function(t,e){void 0===e&&(e=null);!function(t){for(const e in t||b)return!1;return!0}(e)&&w||(e=null);if(e)try{return await createImageBitmap(t,e)}catch(n){y.warn(n),w=!1}return await createImageBitmap(t)}(r,o)}var x=n(69186);const _={dataType:null,batchType:null,id:"image",module:"images",name:"Images",version:r,mimeTypes:["image/png","image/jpeg","image/gif","image/webp","image/avif","image/bmp","image/vnd.microsoft.icon","image/svg+xml"],extensions:["png","jpg","jpeg","gif","webp","bmp","ico","svg","avif"],parse:async function(t,e,n){const r=((e=e||{}).image||{}).type||"auto",{url:s}=n||{};let i;switch(function(t){switch(t){case"auto":case"data":return function(){if(l)return"imagebitmap";if(a)return"image";if(u)return"data";throw new Error("Install '@loaders.gl/polyfills' to parse images under Node.js")}();default:return function(t){switch(t){case"auto":return l||a||u;case"imagebitmap":return l;case"image":return a;case"data":return u;default:throw new Error(`@loaders.gl/images: image ${t} not supported in this environment`)}}(t),t}}(r)){case"imagebitmap":i=await v(t,e,s);break;case"image":i=await m(t,e,s);break;case"data":i=await async function(t){const{mimeType:e}=(0,x.m)(t)||{},n=globalThis.loaders?.parseImageNode;return(0,o.v)(n),await n(t,e)}(t);break;default:(0,o.v)(!1)}return"data"===r&&(i=(0,h.M5)(i)),i},tests:[t=>Boolean((0,x.m)(new DataView(t)))],options:{image:{type:"auto",decode:!0}}}},69186:(t,e,n)=>{function r(t){return function(t,e,n){void 0===n&&(n=0);const r=(o=e,[...o].map((t=>t.charCodeAt(0))));var o;for(let s=0;s<r.length;++s)if(r[s]!==t[s+n])return!1;return!0}(t,"ftyp",4)&&96&t[8]?function(t){switch((e=t,n=8,r=12,String.fromCharCode(...e.slice(n,r))).replace("\0"," ").trim()){case"avif":case"avis":return{extension:"avif",mimeType:"image/avif"};default:return null}var e,n,r}(t):null}n.d(e,{m:()=>i});const o=!1,s=!0;function i(t){const e=a(t);return function(t){const e=a(t),n=e.byteLength>=24&&2303741511===e.getUint32(0,o);if(!n)return null;return{mimeType:"image/png",width:e.getUint32(16,o),height:e.getUint32(20,o)}}(e)||function(t){const e=a(t),n=e.byteLength>=3&&65496===e.getUint16(0,o)&&255===e.getUint8(2);if(!n)return null;const{tableMarkers:r,sofMarkers:s}=function(){const t=new Set([65499,65476,65484,65501,65534]);for(let n=65504;n<65520;++n)t.add(n);const e=new Set([65472,65473,65474,65475,65477,65478,65479,65481,65482,65483,65485,65486,65487,65502]);return{tableMarkers:t,sofMarkers:e}}();let i=2;for(;i+9<e.byteLength;){const t=e.getUint16(i,o);if(s.has(t))return{mimeType:"image/jpeg",height:e.getUint16(i+5,o),width:e.getUint16(i+7,o)};if(!r.has(t))return null;i+=2,i+=e.getUint16(i,o)}return null}(e)||function(t){const e=a(t),n=e.byteLength>=10&&1195984440===e.getUint32(0,o);if(!n)return null;return{mimeType:"image/gif",width:e.getUint16(6,s),height:e.getUint16(8,s)}}(e)||function(t){const e=a(t),n=e.byteLength>=14&&16973===e.getUint16(0,o)&&e.getUint32(2,s)===e.byteLength;if(!n)return null;return{mimeType:"image/bmp",width:e.getUint32(18,s),height:e.getUint32(22,s)}}(e)||function(t){const e=new Uint8Array(t instanceof DataView?t.buffer:t),n=r(e);if(!n)return null;return{mimeType:n.mimeType,width:0,height:0}}(e)}function a(t){if(t instanceof DataView)return t;if(ArrayBuffer.isView(t))return new DataView(t.buffer);if(t instanceof ArrayBuffer)return new DataView(t);throw new Error("toDataView")}},47216:(t,e,n)=>{function r(t){const e=s(t);if(!e)throw new Error("Not an image");return e}function o(t){switch(r(t)){case"data":return t;case"image":case"imagebitmap":const e=document.createElement("canvas"),n=e.getContext("2d");if(!n)throw new Error("getImageData");return e.width=t.width,e.height=t.height,n.drawImage(t,0,0),n.getImageData(0,0,t.width,t.height);default:throw new Error("getImageData")}}function s(t){return"undefined"!=typeof ImageBitmap&&t instanceof ImageBitmap?"imagebitmap":"undefined"!=typeof Image&&t instanceof Image?"image":t&&"object"==typeof t&&t.data&&t.width&&t.height?"data":null}n.d(e,{M5:()=>o})},95247:(t,e,n)=>{function r(t,e,n){if(n=n||t.byteLength,t.byteLength<n||e.byteLength<n)return!1;const r=new Uint8Array(t),o=new Uint8Array(e);for(let s=0;s<r.length;++s)if(r[s]!==o[s])return!1;return!0}function o(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];return function(t){const e=t.map((t=>t instanceof ArrayBuffer?new Uint8Array(t):t)),n=e.reduce(((t,e)=>t+e.byteLength),0),r=new Uint8Array(n);let o=0;for(const s of e)r.set(s,o),o+=s.byteLength;return r.buffer}(e)}function s(t,e,n){const r=void 0!==n?new Uint8Array(t).subarray(e,e+n):new Uint8Array(t).subarray(e);return new Uint8Array(r).buffer}n.d(e,{AQ:()=>o,YV:()=>r,_m:()=>s})},53024:(t,e,n)=>{function r(t){if((e=t)&&"object"==typeof e&&e.isBuffer)return t;var e;if(t instanceof ArrayBuffer)return t;if(ArrayBuffer.isView(t))return 0===t.byteOffset&&t.byteLength===t.buffer.byteLength?t.buffer:t.buffer.slice(t.byteOffset,t.byteOffset+t.byteLength);if("string"==typeof t){const e=t;return(new TextEncoder).encode(e).buffer}if(t&&"object"==typeof t&&t._toArrayBuffer)return t._toArrayBuffer();throw new Error("toArrayBuffer")}n.d(e,{XA:()=>r})},10981:(t,e,n)=>{function r(t,e){if(!t)throw new Error(e||"loader assertion failed.")}n.d(e,{v:()=>r})},26951:(t,e,n)=>{n.d(e,{Bd:()=>o});var r=n(88538);"undefined"!=typeof self&&self,"undefined"!=typeof window&&window,void 0!==n.g&&n.g,"undefined"!=typeof document&&document;const o=Boolean("object"!=typeof r||"[object process]"!==String(r)||r.browser),s=void 0!==r&&r.version&&/v([0-9]*)/.exec(r.version);s&&parseFloat(s[1])},8001:(t,e,n)=>{n.d(e,{cy:()=>s,jJ:()=>o});var r=n(95247);async function o(t,e){for(;;){const{done:n,value:r}=await t.next();if(n)return void t.return();if(e(r))return}}async function s(t){const e=[];for await(const n of t)e.push(n);return(0,r.AQ)(...e)}},27742:(t,e,n)=>{function r(t,e){try{return void 0===e&&(e={}),async function*(){const n=new TextDecoder(void 0,e);for await(const e of t)yield"string"==typeof e?e:n.decode(e,{stream:!0})}()}catch(n){return Promise.reject(n)}}async function*o(t){let e="";for await(const n of t){let t;for(e+=n;(t=e.indexOf("\n"))>=0;){const n=e.slice(0,t+1);e=e.slice(t+1),yield n}}e.length>0&&(yield e)}n.d(e,{R3:()=>o,W5:()=>r})},55256:(t,e,n)=>{n.d(e,{R:()=>i});var r=n(35593);const o="undefined"!=typeof __VERSION__?__VERSION__:"latest",s=o[0]>="0"&&o[0]<="9"?`v${o}`:"";const i=function(){const t=new r.t({id:"loaders.gl"});return globalThis.loaders=globalThis.loaders||{},globalThis.loaders.log=t,globalThis.loaders.version=s,globalThis.probe=globalThis.probe||{},globalThis.probe.loaders=t,t}()},97354:(t,e,n)=>{function r(t){return t}function o(t,e){return s(t||{},e)}function s(t,e,n){if(void 0===n&&(n=0),n>3)return e;const r={...t};for(const[o,i]of Object.entries(e))i&&"object"==typeof i&&!Array.isArray(i)?r[o]=s(r[o]||{},e[o],n+1):r[o]=e[o];return r}n.d(e,{E:()=>r,l:()=>o})},29512:(t,e,n)=>{n.d(e,{o1:()=>s});let r="";const o={};function s(t){for(const e in o)if(t.startsWith(e)){const n=o[e];t=t.replace(e,n)}return t.startsWith("http://")||t.startsWith("https://")||(t=`${r}${t}`),t}},36970:(t,e,n)=>{n.d(e,{pD:()=>i,iW:()=>s,hd:()=>a});var r=n(88538);function o(){if(void 0!==r&&void 0!==r.cwd)return r.cwd();const t=window.location?.pathname;return t?.slice(0,t.lastIndexOf("/")+1)||""}function s(t){const e=t?t.lastIndexOf("/"):-1;return e>=0?t.substr(e+1):""}function i(t){const e=t?t.lastIndexOf("/"):-1;return e>=0?t.substr(0,e):""}function a(){const t=[];for(let o=0;o<arguments.length;o++)t[o]=o<0||arguments.length<=o?void 0:arguments[o];let e,n="",r=!1;for(let s=t.length-1;s>=-1&&!r;s--){let i;s>=0?i=t[s]:(void 0===e&&(e=o()),i=e),0!==i.length&&(n=`${i}/${n}`,r=i.charCodeAt(0)===l)}return n=function(t,e){let n,r="",o=-1,s=0,i=!1;for(let a=0;a<=t.length;++a){if(a<t.length)n=t.charCodeAt(a);else{if(n===l)break;n=l}if(n===l){if(o===a-1||1===s);else if(o!==a-1&&2===s){if(r.length<2||!i||r.charCodeAt(r.length-1)!==c||r.charCodeAt(r.length-2)!==c)if(r.length>2){const t=r.length-1;let e=t;for(;e>=0&&r.charCodeAt(e)!==l;--e);if(e!==t){r=-1===e?"":r.slice(0,e),o=a,s=0,i=!1;continue}}else if(2===r.length||1===r.length){r="",o=a,s=0,i=!1;continue}e&&(r.length>0?r+="/..":r="..",i=!0)}else{const e=t.slice(o+1,a);r.length>0?r+=`/${e}`:r=e,i=!1}o=a,s=0}else n===c&&-1!==s?++s:s=-1}return r}(n,!r),r?`/${n}`:n.length>0?n:"."}const l=47,c=46},85796:(t,e,n)=>{n.d(e,{A:()=>s});var r=n(21143);const o={id:"request-scheduler",throttleRequests:!0,maxRequests:6,debounceTime:0};class s{activeRequestCount=0;requestQueue=[];requestMap=(()=>new Map)();updateTimer=null;constructor(t){void 0===t&&(t={}),this.props={...o,...t},this.stats=new r.Uz({id:this.props.id}),this.stats.get("Queued Requests"),this.stats.get("Active Requests"),this.stats.get("Cancelled Requests"),this.stats.get("Queued Requests Ever"),this.stats.get("Active Requests Ever")}scheduleRequest(t,e){if(void 0===e&&(e=()=>0),!this.props.throttleRequests)return Promise.resolve({done:()=>{}});if(this.requestMap.has(t))return this.requestMap.get(t);const n={handle:t,priority:0,getPriority:e},r=new Promise((t=>(n.resolve=t,n)));return this.requestQueue.push(n),this.requestMap.set(t,r),this._issueNewRequests(),r}_issueRequest(t){const{handle:e,resolve:n}=t;let r=!1;const o=()=>{r||(r=!0,this.requestMap.delete(e),this.activeRequestCount--,this._issueNewRequests())};return this.activeRequestCount++,n?n({done:o}):Promise.resolve({done:o})}_issueNewRequests(){null!==this.updateTimer&&clearTimeout(this.updateTimer),this.updateTimer=setTimeout((()=>this._issueNewRequestsAsync()),this.props.debounceTime)}_issueNewRequestsAsync(){null!==this.updateTimer&&clearTimeout(this.updateTimer),this.updateTimer=null;const t=Math.max(this.props.maxRequests-this.activeRequestCount,0);if(0!==t){this._updateAllRequests();for(let e=0;e<t;++e){const t=this.requestQueue.shift();t&&this._issueRequest(t)}}}_updateAllRequests(){const t=this.requestQueue;for(let e=0;e<t.length;++e){const n=t[e];this._updateRequest(n)||(t.splice(e,1),this.requestMap.delete(n.handle),e--)}t.sort(((t,e)=>t.priority-e.priority))}_updateRequest(t){return t.priority=t.getPriority(t.handle),!(t.priority<0)||(t.resolve(null),!1)}}},94104:(t,e,n)=>{n.d(e,{q:()=>s});var r=n(97354),o=n(29512);class s{static defaultOptions={core:{type:"auto",attributions:[],loadOptions:{},loaders:[]}};_needsRefresh=!0;constructor(t,e,n){this.options=n?(0,r.l)({...n,core:s.defaultOptions},e):{...e},this.data=t,this.url="string"==typeof t?(0,o.o1)(t):"",this.loadOptions={...this.options.core?.loadOptions},this.fetch=function(t){const e=t?.fetch;if(e&&"function"==typeof e)return(t,n)=>e(t,n);const n=t?.fetch;if(n&&"function"!=typeof n)return t=>fetch(t,n);return t=>fetch(t)}(this.loadOptions)}setProps(t){this.options=Object.assign(this.options,t),this.setNeedsRefresh()}setNeedsRefresh(){this._needsRefresh=!0}getNeedsRefresh(t){void 0===t&&(t=!0);const e=this._needsRefresh;return t&&(this._needsRefresh=!1),e}}},20417:(t,e,n)=>{n.d(e,{Tm:()=>a,XO:()=>s,aJ:()=>c,cD:()=>l,rt:()=>u,ys:()=>i});var r=n(1746);function o(t){let e=0;for(let n,r,o=0,s=t.length-1;o<t.length;s=o++)n=t[o],r=t[s],e+=(r[0]-n[0])*(n[1]+r[1]);return e}function s(t,e){if(Array.isArray(t[0])){for(const n of t)s(n,e);return}const n=t;n[0]/=e,n[1]/=e}function i(t,e){for(let n=0;n<t.length;++n)t[n]/=e}function a(t,e,n){if("number"!=typeof t[0][0]){for(const r of t)a(r,e,n);return}const r=n*Math.pow(2,e.z),o=n*e.x,s=n*e.y;for(let i=0;i<t.length;i++){const e=t[i];e[0]=360*(e[0]+o)/r-180;const n=180-360*(e[1]+s)/r;e[1]=360/Math.PI*Math.atan(Math.exp(n*Math.PI/180))-90}}function l(t,e,n){const{x:r,y:o,z:s}=e,i=n*Math.pow(2,s),a=n*r,l=n*o;for(let c=0,u=t.length;c<u;c+=2){t[c]=360*(t[c]+a)/i-180;const e=180-360*(t[c+1]+l)/i;t[c+1]=360/Math.PI*Math.atan(Math.exp(e*Math.PI/180))-90}}function c(t){const e=t.length;if(e<=1)return[t];const n=[];let r,s;for(let i=0;i<e;i++){const e=o(t[i]);0!==e&&(void 0===s&&(s=e<0),s===e<0?(r&&n.push(r),r=[t[i]]):r&&r.push(t[i]))}return r&&n.push(r),n}function u(t){const e=t.indices.length,n="Polygon";if(e<=1)return{type:n,data:t.data,areas:[[(0,r.IC)(t.data)]],indices:[t.indices]};const o=[],s=[];let i,a=[],l=[],c=0;for(let u,h,d=0;d<e;d++){h=t.indices[d]-c,u=t.indices[d+1]-c||t.data.length;const e=t.data.slice(h,u),n=(0,r.IC)(e);if(0!==n)void 0===i&&(i=n<0),i===n<0?(l.length&&(o.push(a),s.push(l)),l=[h],a=[n]):(a.push(n),l.push(h));else{const e=t.data.slice(0,h),n=t.data.slice(u);t.data=e.concat(n),c+=u-h}}return a&&o.push(a),l.length&&s.push(l),{type:n,areas:o,indices:s,data:t.data}}},2101:(t,e,n)=>{n.d(e,{h:()=>x,f:()=>v});var r=n(92940),o=n(55256),s=n(93571),i=n.n(s),a=n(20417);class l{static types=["Unknown","Point","LineString","Polygon"];constructor(t,e,n,r,o,s){this.properties={},this.extent=n,this.type=0,this.id=null,this._pbf=t,this._geometry=-1,this._keys=r,this._values=o,this._geometryInfo=s,t.readFields(u,this,e)}toGeoJSONFeature(t,e){const n=this.loadGeometry();return c(this,n,"wgs84"===t?t=>(0,a.Tm)(t,e,this.extent):a.XO)}toBinaryFeature(t,e){const n=this.loadFlatGeometry();return"wgs84"===t?this._toBinaryCoordinates(n,(t=>(0,a.cD)(t,e,this.extent))):this._toBinaryCoordinates(n,a.ys)}bbox(){const t=this._pbf;t.pos=this._geometry;const e=t.readVarint()+t.pos;let n=1,r=0,o=0,s=0,i=1/0,a=-1/0,l=1/0,c=-1/0;for(;t.pos<e;){if(r<=0){const e=t.readVarint();n=7&e,r=e>>3}if(r--,1===n||2===n)o+=t.readSVarint(),s+=t.readSVarint(),o<i&&(i=o),o>a&&(a=o),s<l&&(l=s),s>c&&(c=s);else if(7!==n)throw new Error(`unknown command ${n}`)}return[i,l,a,c]}_toBinaryCoordinates(t,e){let n;e(t.data,this.extent);switch(this.type){case 1:this._geometryInfo.pointFeaturesCount++,this._geometryInfo.pointPositionsCount+=t.indices.length,n={type:"Point",...t};break;case 2:this._geometryInfo.lineFeaturesCount++,this._geometryInfo.linePathsCount+=t.indices.length,this._geometryInfo.linePositionsCount+=t.data.length/2,n={type:"LineString",...t};break;case 3:n=(0,a.rt)(t),this._geometryInfo.polygonFeaturesCount++,this._geometryInfo.polygonObjectsCount+=n.indices.length;for(const t of n.indices)this._geometryInfo.polygonRingsCount+=t.length;this._geometryInfo.polygonPositionsCount+=n.data.length/2;break;default:throw new Error(`Invalid geometry type: ${this.type}`)}const r={type:"Feature",geometry:n,properties:this.properties};return null!==this.id&&(r.id=this.id),r}loadGeometry(){const t=this._pbf;t.pos=this._geometry;const e=t.readVarint()+t.pos;let n=1,r=0,o=0,s=0;const i=[];let a;for(;t.pos<e;){if(r<=0){const e=t.readVarint();n=7&e,r=e>>3}switch(r--,n){case 1:case 2:o+=t.readSVarint(),s+=t.readSVarint(),1===n&&(a&&i.push(a),a=[]),a&&a.push([o,s]);break;case 7:a&&a.push(a[0].slice());break;default:throw new Error(`unknown command ${n}`)}}return a&&i.push(a),i}loadFlatGeometry(){const t=this._pbf;t.pos=this._geometry;const e=t.readVarint()+t.pos;let n,r=1,o=0,s=0,i=0,a=0;const l=[],c=[];for(;t.pos<e;)if(o<=0&&(n=t.readVarint(),r=7&n,o=n>>3),o--,1===r||2===r)s+=t.readSVarint(),i+=t.readSVarint(),1===r&&l.push(a),c.push(s,i),a+=2;else{if(7!==r)throw new Error(`unknown command ${r}`);if(a>0){const t=l[l.length-1];c.push(c[t],c[t+1]),a+=2}}return{data:c,indices:l}}}function c(t,e,n){let r,o,s,i=l.types[t.type];switch(t.type){case 1:const i=[];for(r=0;r<e.length;r++)i[r]=e[r][0];s=i,n(s,t.extent);break;case 2:for(s=e,r=0;r<s.length;r++)n(s[r],t.extent);break;case 3:for(s=(0,a.aJ)(e),r=0;r<s.length;r++)for(o=0;o<s[r].length;o++)n(s[r][o],t.extent);break;default:throw new Error("illegal vector tile type")}1===s.length?s=s[0]:i=`Multi${i}`;const c={type:"Feature",geometry:{type:i,coordinates:s},properties:t.properties};return null!==t.id&&(c.properties||={},c.properties.id=t.id),c}function u(t,e,n){e&&n&&(1===t?e.id=n.readVarint():2===t?function(t,e){const n=t.readVarint()+t.pos;for(;t.pos<n;){const n=e._keys[t.readVarint()],r=e._values[t.readVarint()];e.properties[n]=r}}(n,e):3===t?e.type=n.readVarint():4===t&&(e._geometry=n.pos))}class h{constructor(t,e){this.version=1,this.name="",this.extent=4096,this.length=0,this._pbf=t,this._keys=[],this._values=[],this._features=[],t.readFields(d,this,e),this.length=this._features.length}getGeoJSONFeature(t){if(t<0||t>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[t];const e=this._pbf.readVarint()+this._pbf.pos;return new l(this._pbf,e,this.extent,this._keys,this._values)}getBinaryFeature(t,e){if(t<0||t>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[t];const n=this._pbf.readVarint()+this._pbf.pos;return new l(this._pbf,n,this.extent,this._keys,this._values,e)}}function d(t,e,n){e&&n&&(15===t?e.version=n.readVarint():1===t?e.name=n.readString():5===t?e.extent=n.readVarint():2===t?e._features.push(n.pos):3===t?e._keys.push(n.readString()):4===t&&e._values.push(function(t){let e=null;const n=t.readVarint()+t.pos;for(;t.pos<n;){const n=t.readVarint()>>3;e=1===n?t.readString():2===n?t.readFloat():3===n?t.readDouble():4===n?t.readVarint64():5===n?t.readVarint():6===n?t.readSVarint():7===n?t.readBoolean():null}return e}(n)))}class p{constructor(t,e){this.layers=t.readFields(f,{},e)}}function f(t,e,n){if(3===t&&n){const t=new h(n,n.readVarint()+n.pos);t.length&&e&&(e[t.name]=t)}}function g(t,e){const n=function(t){if(!t?.mvt)throw new Error("mvt options required");if("wgs84"===t.mvt?.coordinates&&!t.mvt.tileIndex)throw new Error("MVT Loader: WGS84 coordinates need tileIndex property");t.gis&&o.R.warn('MVTLoader: "options.gis" is deprecated, use "options.mvt.shape" instead')();return t.mvt}(e),r=e?.gis?.format||e?.mvt?.shape||e?.shape;switch(r){case"columnar-table":return{shape:"columnar-table",data:m(t,n)};case"geojson-table":return{shape:"geojson-table",type:"FeatureCollection",features:y(t,n)};case"geojson":return y(t,n);case"binary-geometry":case"binary":return m(t,n);default:throw new Error(r||"undefined shape")}}function m(t,e){const[n,o]=function(t,e){const n=[],r={coordLength:2,pointPositionsCount:0,pointFeaturesCount:0,linePositionsCount:0,linePathsCount:0,lineFeaturesCount:0,polygonPositionsCount:0,polygonObjectsCount:0,polygonRingsCount:0,polygonFeaturesCount:0};if(t.byteLength<=0)return[n,r];const o=new p(new(i())(t)),s=e&&Array.isArray(e.layers)?e.layers:Object.keys(o.layers);return s.forEach((t=>{const s=o.layers[t];if(s)for(let o=0;o<s.length;o++){const i=w(s.getBinaryFeature(o,r),e,t);n.push(i)}})),[n,r]}(t,e),s=(0,r.A)(n,o);return s.byteLength=t.byteLength,s}function y(t,e){if(t.byteLength<=0)return[];const n=[],r=new p(new(i())(t));return(Array.isArray(e.layers)?e.layers:Object.keys(r.layers)).forEach((t=>{const o=r.layers[t];if(o)for(let r=0;r<o.length;r++){const s=b(o.getGeoJSONFeature(r),e,t);n.push(s)}})),n}function b(t,e,n){const r=t.toGeoJSONFeature(e.coordinates||"local",e.tileIndex);return e.layerProperty&&(r.properties||={},r.properties[e.layerProperty]=n),r}function w(t,e,n){const r=t.toBinaryFeature(e.coordinates||"local",e.tileIndex);return e.layerProperty&&r.properties&&(r.properties[e.layerProperty]=n),r}const v={dataType:null,batchType:null,name:"Mapbox Vector Tile",id:"mvt",module:"mvt",version:"undefined"!=typeof __VERSION__?__VERSION__:"latest",extensions:["mvt","pbf"],mimeTypes:["application/vnd.mapbox-vector-tile","application/x-protobuf"],worker:!0,category:"geometry",options:{mvt:{shape:"geojson",coordinates:"local",layerProperty:"layerName",layers:void 0,tileIndex:void 0}}},x={...v,parse:async(t,e)=>g(t,e),parseSync:g,binary:!0}},83500:(t,e,n)=>{function r(t,e){return void 0===e&&(e="float32"),t instanceof Date?"date-millisecond":t instanceof Number?e:"string"==typeof t?"utf8":"null"}function o(t){let e=s(t);return"null"!==e?{type:e,nullable:!1}:t.length>0?(e=r(t[0]),{type:e,nullable:!0}):{type:"null",nullable:!0}}function s(t){switch(t.constructor){case Int8Array:return"int8";case Uint8Array:case Uint8ClampedArray:return"uint8";case Int16Array:return"int16";case Uint16Array:return"uint16";case Int32Array:return"int32";case Uint32Array:return"uint32";case Float32Array:return"float32";case Float64Array:return"float64";default:return"null"}}function i(t,e){if(!e)switch(t){case"int8":return Int8Array;case"uint8":return Uint8Array;case"int16":return Int16Array;case"uint16":return Uint16Array;case"int32":return Int32Array;case"uint32":return Uint32Array;case"float32":return Float32Array;case"float64":return Float64Array}return Array}n.d(e,{IT:()=>o,UE:()=>s,k1:()=>r,my:()=>i})},35152:(t,e,n)=>{n.d(e,{O:()=>o});var r=n(83500);function o(t){switch(t.shape){case"array-row-table":case"object-row-table":return i(t.data);case"geojson-table":return function(t){if(!t.length)throw new Error("deduce from empty table");const e=[],n=t[0].properties||{};for(const[r,o]of Object.entries(n))e.push(l(o,r));return{fields:e,metadata:{}}}(t.features);case"columnar-table":return s(t.data);default:throw new Error("Deduce schema")}}function s(t){const e=[];for(const[n,r]of Object.entries(t)){const t=a(r,n);e.push(t)}return{fields:e,metadata:{}}}function i(t){if(!t.length)throw new Error("deduce from empty table");const e=[],n=t[0];for(const[r,o]of Object.entries(n))e.push(l(o,r));return{fields:e,metadata:{}}}function a(t,e){if(ArrayBuffer.isView(t)){const n=(0,r.IT)(t);return{name:e,type:n.type||"null",nullable:n.nullable}}if(Array.isArray(t)&&t.length>0){const n=t[0];return{name:e,type:(0,r.k1)(n),nullable:!0}}throw new Error("empty table")}function l(t,e){return{name:e,type:(0,r.k1)(t),nullable:!0}}},46410:(t,e,n)=>{function r(t,e){if(!t)throw new Error(e||"loaders.gl assertion failed.")}n.d(e,{v:()=>r})},99222:(t,e,n)=>{n.d(e,{Bd:()=>o,Fr:()=>i,xD:()=>s});var r=n(88538);"undefined"!=typeof self&&self,"undefined"!=typeof window&&window,void 0!==n.g&&n.g,"undefined"!=typeof document&&document;const o="object"!=typeof r||"[object process]"!==String(r)||r.browser,s="function"==typeof importScripts,i="undefined"!=typeof window&&void 0!==window.orientation,a=void 0!==r&&r.version&&/v([0-9]*)/.exec(r.version);a&&parseFloat(a[1])},9894:(t,e,n)=>{n.d(e,{x:()=>s});var r=n(11654),o=n(80247);const s=(globalThis._loadersgl_?.version||(globalThis._loadersgl_=globalThis._loadersgl_||{},"undefined"==typeof __VERSION__?(o.warn("loaders.gl: The __VERSION__ variable is not injected using babel plugin. Latest unstable workers would be fetched from the CDN."),globalThis._loadersgl_.version=r.x):globalThis._loadersgl_.version=__VERSION__),globalThis._loadersgl_.version)},11654:(t,e,n)=>{n.d(e,{x:()=>r});const r="beta"},19498:(t,e,n)=>{n.r(e),n.d(e,{assets:()=>c,contentTitle:()=>a,default:()=>d,frontMatter:()=>i,metadata:()=>l,toc:()=>u});var r=n(62540),o=n(43023),s=n(71713);const i={},a="TableTileSource",l={id:"tiles/table-tiler",title:"TableTileSource",description:"TableTileSource dynamically generates tiles from GeoJSON data loaded into the browser.",source:"@site/src/examples/tiles/table-tiler.mdx",sourceDirName:"tiles",slug:"/tiles/table-tiler",permalink:"/examples/tiles/table-tiler",draft:!1,unlisted:!1,tags:[],version:"current",frontMatter:{},sidebar:"sidebars",previous:{title:"PMTiles",permalink:"/examples/tiles/pmtiles"},next:{title:"WMS",permalink:"/examples/tiles/wms"}},c={},u=[];function h(t){const e={a:"a",code:"code",h1:"h1",header:"header",p:"p",strong:"strong",...(0,o.R)(),...t.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(e.header,{children:(0,r.jsx)(e.h1,{id:"tabletilesource",children:"TableTileSource"})}),"\n","\n",(0,r.jsx)("div",{style:{height:"100vh"},children:(0,r.jsx)(s.A,{format:"GeoJSON",children:(0,r.jsxs)(e.p,{children:[(0,r.jsx)(e.a,{href:"/docs/modules/mvt/api-reference/table-tile-source",children:(0,r.jsx)(e.strong,{children:(0,r.jsx)(e.code,{children:"TableTileSource"})})})," dynamically ",(0,r.jsx)(e.strong,{children:"generates"})," tiles from GeoJSON data loaded into the browser."]})})})]})}function d(t={}){const{wrapper:e}={...(0,o.R)(),...t.components};return e?(0,r.jsx)(e,{...t,children:(0,r.jsx)(h,{...t})}):h(t)}}}]);