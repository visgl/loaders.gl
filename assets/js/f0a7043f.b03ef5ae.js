"use strict";(self.webpackChunkproject_website=self.webpackChunkproject_website||[]).push([[2242],{35437:(e,r,t)=>{t.r(r),t.d(r,{assets:()=>o,contentTitle:()=>i,default:()=>h,frontMatter:()=>a,metadata:()=>c,toc:()=>d});var n=t(62540),s=t(43023);const a={},i="AsyncIterators",c={id:"developer-guide/concepts/async-iterators",title:"AsyncIterators",description:"Streaming functionality in loaders.gl is built on the ES2018 AsyncIterator concept.",source:"@site/../docs/developer-guide/concepts/async-iterators.md",sourceDirName:"developer-guide/concepts",slug:"/developer-guide/concepts/async-iterators",permalink:"/docs/developer-guide/concepts/async-iterators",draft:!1,unlisted:!1,editUrl:"https://github.com/visgl/loaders.gl/tree/master/website/../docs/developer-guide/concepts/async-iterators.md",tags:[],version:"current",frontMatter:{},sidebar:"tutorialSidebar",previous:{title:"Streaming",permalink:"/docs/developer-guide/concepts/streaming"},next:{title:"Worker Threads",permalink:"/docs/developer-guide/concepts/worker-threads"}},o={},d=[{value:"Availability",id:"availability",level:2},{value:"Iterators and TypeScript",id:"iterators-and-typescript",level:2},{value:"Batched Parsing and Endcoding using AsyncIterators",id:"batched-parsing-and-endcoding-using-asynciterators",level:2},{value:"Using AsyncIterators",id:"using-asynciterators",level:2},{value:"Using Streams as AsyncIterators",id:"using-streams-as-asynciterators",level:2},{value:"Creating AsyncIterators",id:"creating-asynciterators",level:2}];function l(e){const r={a:"a",code:"code",h1:"h1",h2:"h2",header:"header",li:"li",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,s.R)(),...e.components};return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(r.header,{children:(0,n.jsx)(r.h1,{id:"asynciterators",children:"AsyncIterators"})}),"\n",(0,n.jsxs)(r.p,{children:["Streaming functionality in loaders.gl is built on the ES2018 ",(0,n.jsx)(r.code,{children:"AsyncIterator"})," concept.\nThis page gives some background on ",(0,n.jsx)(r.code,{children:"AsyncIterator"}),"."]}),"\n",(0,n.jsx)(r.h2,{id:"availability",children:"Availability"}),"\n",(0,n.jsxs)(r.p,{children:[(0,n.jsx)(r.code,{children:"AsyncIterator"})," and the ",(0,n.jsx)(r.code,{children:"for await of"})," iteration syntax are standard JavaScript ES2018 features and are supported by all recent evergreen browsers and Node.js versions as well as e.g. the babel transpiler."]}),"\n",(0,n.jsx)(r.h2,{id:"iterators-and-typescript",children:"Iterators and TypeScript"}),"\n",(0,n.jsx)(r.p,{children:"There are multiple similar-sounding types supporting the type safe use of iterators which can be a source of confusion to users, so some information is provided here:"}),"\n",(0,n.jsxs)(r.p,{children:["| Type | Async Type | Type Parameters |\nDescription |\n| ------------------ | ----------------------- | ---------------------------------------------------------------------------------------------------------------------------------------- |\n| ",(0,n.jsx)(r.code,{children:"Iterator"})," | ",(0,n.jsx)(r.code,{children:"AsyncIterator"})," | ",(0,n.jsx)(r.code,{children:"<...>"})," | An iterator has ",(0,n.jsx)(r.code,{children:"next()"}),", ... methods |\n| ",(0,n.jsx)(r.code,{children:"Iterable"})," | ",(0,n.jsx)(r.code,{children:"AsyncIterable"})," | ",(0,n.jsx)(r.code,{children:"<...>"})," | An iterable is a class that has a ",(0,n.jsx)(r.code,{children:"[Symbol.iterator]"})," or ",(0,n.jsx)(r.code,{children:"[Symbol.asyncIterator]"})," property that returns an ",(0,n.jsx)(r.code,{children:"Iterator"})," or ",(0,n.jsx)(r.code,{children:"AsyncIterator"})," |\n| ",(0,n.jsx)(r.code,{children:"Generator"})," | ",(0,n.jsx)(r.code,{children:"AsyncGenerator"})," | ",(0,n.jsx)(r.code,{children:"<...>"})," | A generator is a function that takes some parameters and when called returns an ",(0,n.jsx)(r.code,{children:"Iterator"})," or ",(0,n.jsx)(r.code,{children:"AsyncIterator"})," |\n| ",(0,n.jsx)(r.code,{children:"IterableIterator"})," | ",(0,n.jsx)(r.code,{children:"AsyncIterableIterator"})," | ",(0,n.jsx)(r.code,{children:"<...>"})," | It is convenient to define ",(0,n.jsx)(r.code,{children:"Iterator"}),"s that are also ",(0,n.jsx)(r.code,{children:"Iterable"}),". Most built in container classes return this type. |"]}),"\n",(0,n.jsxs)(r.p,{children:["An ",(0,n.jsx)(r.code,{children:"IterableIterator"})," can"]}),"\n",(0,n.jsxs)(r.ul,{children:["\n",(0,n.jsx)(r.li,{children:"be used in a for..of loop"}),"\n",(0,n.jsx)(r.li,{children:"be spread into an array"}),"\n",(0,n.jsx)(r.li,{children:"be spread into a parameter list"}),"\n",(0,n.jsxs)(r.li,{children:["be used in APIs that accept iterables like ",(0,n.jsx)(r.code,{children:"Array.from()"}),", ",(0,n.jsx)(r.code,{children:"new Set()"}),", ",(0,n.jsx)(r.code,{children:"new Map()"})]}),"\n"]}),"\n",(0,n.jsx)(r.pre,{children:(0,n.jsx)(r.code,{className:"language-typescript",children:"interface Iterable {\n  [Symbol.iterator](): Iterator;\n}\ninterface Iterator {\n  next(): IteratorResult;\n  return?(value?: any): IteratorResult;\n}\ninterface IteratorResult {\n  value: any;\n  done: boolean;\n}\n"})}),"\n",(0,n.jsx)(r.p,{children:(0,n.jsx)(r.a,{href:"https://exploringjs.com/es6/ch_iteration.html#sec_implementing-iterables",children:"https://exploringjs.com/es6/ch_iteration.html#sec_implementing-iterables"})}),"\n",(0,n.jsx)(r.h2,{id:"batched-parsing-and-endcoding-using-asynciterators",children:"Batched Parsing and Endcoding using AsyncIterators"}),"\n",(0,n.jsx)(r.p,{children:"The input and output from streaming loaders and writers can both be expressed in terms of async iterators."}),"\n",(0,n.jsx)(r.h2,{id:"using-asynciterators",children:"Using AsyncIterators"}),"\n",(0,n.jsxs)(r.p,{children:["Remember that an ",(0,n.jsx)(r.code,{children:"AsyncIterator"})," or ",(0,n.jsx)(r.code,{children:"AsyncIterable"})," can be consumed (iterated over) via the for-await construct:"]}),"\n",(0,n.jsx)(r.pre,{children:(0,n.jsx)(r.code,{className:"language-typescript",children:"for await (const x of asyncIterable) {\n}\n"})}),"\n",(0,n.jsx)(r.h2,{id:"using-streams-as-asynciterators",children:"Using Streams as AsyncIterators"}),"\n",(0,n.jsxs)(r.p,{children:["With a little effort, streams in JavaScript can be treated as AsyncIterators. As the section about ",(0,n.jsx)(r.a,{href:"/docs/developer-guide/concepts/streaming",children:"Javascript Streams"})," explains, instead of registering callbacks on the stream, you can now work with streams in this way:"]}),"\n",(0,n.jsx)(r.pre,{children:(0,n.jsx)(r.code,{className:"language-typescript",children:"for await (const buf of fs.createReadStream('foo.txt')) {\n  // do something\n}\n"})}),"\n",(0,n.jsx)(r.h2,{id:"creating-asynciterators",children:"Creating AsyncIterators"}),"\n",(0,n.jsxs)(r.p,{children:["Remember that any object in JavaScript that implements the ",(0,n.jsx)(r.code,{children:"[Symbol.asyncIterator]()"})," method is an ",(0,n.jsx)(r.code,{children:"AsyncIterable"}),"."]}),"\n",(0,n.jsxs)(r.p,{children:["And the async ",(0,n.jsx)(r.strong,{children:"generator"})," syntax ",(0,n.jsx)(r.code,{children:"async function *"})," can be used to generate new async iterators"]}),"\n",(0,n.jsx)(r.pre,{children:(0,n.jsx)(r.code,{className:"language-typescript",children:"async function * makeAsyncIterator() {\n  yield new Promise(...)\n}\n\nfor await (const x of makeAsyncIterator()) {} // Notice parens after 'makeAsyncIterator'\n"})})]})}function h(e={}){const{wrapper:r}={...(0,s.R)(),...e.components};return r?(0,n.jsx)(r,{...e,children:(0,n.jsx)(l,{...e})}):l(e)}},43023:(e,r,t)=>{t.d(r,{R:()=>i,x:()=>c});var n=t(63696);const s={},a=n.createContext(s);function i(e){const r=n.useContext(a);return n.useMemo((function(){return"function"==typeof e?e(r):{...r,...e}}),[r,e])}function c(e){let r;return r=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:i(e.components),n.createElement(a.Provider,{value:r},e.children)}}}]);