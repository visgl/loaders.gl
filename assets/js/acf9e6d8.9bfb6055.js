"use strict";(self.webpackChunkproject_website=self.webpackChunkproject_website||[]).push([[5397],{12591:(e,t,r)=>{r.d(t,{A:()=>J});var n=r(63696),s=(r(7470),r(86893)),i=r(56505),o=r.n(i),a=r(17817),c=r(73281),u=r(67483),l=r(85930),d=r(33183),f=r(51060);function h(e,t){if(!t)return[255,255,255,255];const{minValue:r,maxValue:n,minColor:s,maxColor:i}=t,o=(e-r)/(n-r),a=[255,255,255,255];for(let c=0;c<s.length;c++)a[c]=Math.round((i[c]-s[c])*o+s[c]);return a}async function A(e,t,r,n){const s=r.findIndex((t=>{let{name:r}=t;return e===r}));if(-1===s)return null;const i=(0,f.vd)(t[s],n),o=(0,d.kI)(r[s]);return await(0,l.H)(i,d.Tv,{attributeName:e,attributeType:o})}const m=async(e,t)=>{const r={isColored:!1,id:e.id};if(e.content.customColors!==t)if(e.content&&t){e.content.originalColorsAttributes?"multiply"===t.mode&&e.content.attributes.colors.value.set(e.content.originalColorsAttributes.value):e.content.originalColorsAttributes={...e.content.attributes.colors,value:new Uint8Array(e.content.attributes.colors.value)},e.content.customColors=t;const n=await async function(e,t,r,n,s,i,o){if(!i)return e;const a={...e,value:new Uint8Array(e.value)},c=n.find((e=>{let{name:t}=e;return t===i?.attributeName}));if(!c||!["esriFieldTypeDouble","esriFieldTypeInteger","esriFieldTypeSmallInteger"].includes(c.type))return e;const u=await A(c.name,r,s,o);if(!u)return e;const l=n.find((e=>{let{type:t}=e;return"esriFieldTypeOID"===t}));if(!l)return e;const d=await A(l.name,r,s,o);if(!d)return e;const f={};for(let A=0;A<d[l.name].length;A++)f[d[l.name][A]]=h(u[c.name][A],i);for(let h=0;h<t.length;h++){const e=f[t[h]];e&&("multiply"===i.mode?e.forEach(((e,t)=>{a.value[4*h+t]=a.value[4*h+t]*e/255})):a.value.set(e,4*h))}return a}(e.content.attributes.colors,e.content.featureIds,e.header.attributeUrls,e.tileset.tileset.fields,e.tileset.tileset.attributeStorageInfo,t,e.tileset.loadOptions.i3s.token);e.content.customColors===t&&(e.content.attributes.colors=n,r.isColored=!0)}else e.content&&e.content.originalColorsAttributes&&(e.content.attributes.colors.value=e.content.originalColorsAttributes.value,e.content.customColors=null,r.isColored=!0);return r};var p=r(72117),B=r(4825),C=r(75293);const y="\n  font-family: sans-serif;\n  font-size: 16px;\n  font-style: normal;\n  font-weight: 500;\n  line-height: 19px;\n  letter-spacing: 0em;\n  text-align: left;\n",g="\n  display: flex;\n  flex-direction: column;\n  align-items: flex-start;\n  position: absolute;\n",b="\n  background: #0E111A;\n  color: white;\n";var _=r(62540);const T=C.Ay.select.withConfig({displayName:"drop-down__StyledDropDown",componentId:"sc-7dg1kh-0"})([""," "," "," width:170px;"],b,y,"\n  position: static;\n  display: flex;\n  flex-direction: row;\n  justify-content: space-between;\n  align-items: center;\n  padding: 4px 16px;\n  cursor: pointer;\n  border-radius: 4px;\n  box-sizing: border-box;\n  option {\n    color: white;\n    background: #0E111A;\n    display: flex;\n    white-space: pre;\n  }\n  &:hover {\n    background: #4F52CC;\n    color: black;\n  }\n"),E=e=>{let{items:t,onSelect:r}=e;return(0,_.jsx)(T,{onChange:e=>r(e.target.value),children:t.map((e=>(0,_.jsx)("option",{children:e},e)))})},S=C.Ay.div.withConfig({displayName:"control-panel__Container",componentId:"sc-qp2xu8-0"})([""," "," gap:10px;padding:16px;margin:10px;line-height:28px;border-radius:8px;"],g,b);function R(e){let{tileSets:t,onSelectTileset:r}=e;return(0,_.jsx)(S,{children:(0,_.jsx)(E,{items:t,onSelect:r})})}const D=C.Ay.div.withConfig({displayName:"colorization-panel__Container",componentId:"sc-zfp8ex-0"})([""," "," top:70px;gap 10px;padding:16px;margin:10px;line-height:28px;border-radius:8px;"],g,b),M=C.Ay.div.withConfig({displayName:"colorization-panel__RowWrapper",componentId:"sc-zfp8ex-1"})(["display:flex;direction:row;justify-content:space-between;align-items:center;width:100%;"]),w=C.Ay.div.withConfig({displayName:"colorization-panel__Label",componentId:"sc-zfp8ex-2"})([""," margin-right:10px;"],y);function I(e){let{colorizeModes:t,colorizeAttributes:r,onSelectColorizeMode:n,onSelectAttribute:s}=e;return(0,_.jsxs)(D,{children:[(0,_.jsxs)(M,{children:[(0,_.jsx)(w,{children:"Colorize Mode"}),(0,_.jsx)(E,{items:t,onSelect:n})]}),(0,_.jsxs)(M,{children:[(0,_.jsx)(w,{children:"Colorize Attribute"}),(0,_.jsx)(E,{items:Object.keys(r),onSelect:s})]})]})}var G=r(97564);const v={"New York":{name:"New York",url:"https://tiles.arcgis.com/tiles/P3ePLMYs2RVChkJx/arcgis/rest/services/Buildings_NewYork_17/SceneServer/layers/0"}},O=4e3,F={type:G.A,maxPitch:60,inertia:!0,scrollZoom:{speed:.01,smooth:!0},touchRotate:!0,dragMode:!1},x={longitude:-120,latitude:34,pitch:45,maxPitch:90,bearing:0,minZoom:2,maxZoom:30,zoom:14.5},P=["replace","multiply","none"],U={min:{hex:"#9292FC",rgba:[146,146,252,255]},max:{hex:"#2C2CAF",rgba:[44,44,175,255]}};var H=r(44207),L=r(80247);async function N(e,t,r){const n=function(e,t){const r=new URL(e,`${t}/`);return decodeURI(r.toString())}(t,e);try{let e=null;const t=await(0,H.t2)(n),s=JSON.parse(await t.text());if(e=s?.stats||null,"number"==typeof e?.min&&"number"==typeof e?.max)return{name:r,min:e.min,max:e.max}}catch(s){L.error(s)}return null}function J(){const e=Object.keys(v),[t,r]=(0,n.useState)(e[0]),[i,l]=(0,n.useState)(x),[d,f]=(0,n.useState)({}),[h,A]=(0,n.useState)({mode:P[0],attributeName:""}),[C,y]=(0,n.useState)(null);function g(e){const{zoom:t,cartographicCenter:r}=e,[n,s]=r||[],i={...x,zoom:t+2,longitude:n,latitude:s,transitionDuration:O,transitionInterpolator:new c.A};l(i),function(e){const t=[];for(const r of e.tileset?.statisticsInfo)t.push(N(e.tileset?.basePath,r.href,r.name));Promise.allSettled(t).then((e=>{const t={};for(const r of e)"fulfilled"===r.status&&r.value&&r.value.name&&(t[r.value.name]={min:r.value.min,max:r.value.max});Object.keys(t).length>0&&(f(t),A({...h,attributeName:Object.keys(t)[0]}))}))}(e)}return(0,n.useEffect)((()=>{"none"!==h.mode&&""!==h.attributeName?y({attributeName:h.attributeName,minValue:d[h.attributeName]?.min||0,maxValue:d[h.attributeName]?.max||0,minColor:U.min.rgba,maxColor:U.max.rgba,mode:h.mode}):y(null)}),[h]),(0,_.jsxs)("div",{style:{position:"relative",height:"100%"},children:[(0,_.jsx)(a.A,{initialViewState:i,layers:function(){const e={i3s:{coordinateSystem:p.rf.LNGLAT_OFFSETS}};return new u.n({data:v[t].url,loader:B.R,onTilesetLoad:g,loadOptions:e,colorsByAttribute:C,customizeColors:m})}(),controller:F,children:(0,_.jsx)(s.Ay,{reuseMaps:!0,mapLib:o(),mapStyle:"https://basemaps.cartocdn.com/gl/dark-matter-nolabels-gl-style/style.json",preventStyleDiffing:!0,preserveDrawingBuffer:!0})}),(0,_.jsx)(R,{tileSets:e,onSelectTileset:function(e){r(e)}}),(0,_.jsx)(I,{colorizeModes:P,colorizeAttributes:d,onSelectColorizeMode:function(e){A({...h,mode:e})},onSelectAttribute:function(e){A({...h,attributeName:e})}})]})}},38950:(e,t,r)=>{r.d(t,{i:()=>Je});var n=r(36970),s=r(68118);const i="undefined"!=typeof __VERSION__?__VERSION__:"latest",o={COMPOSITE:"cmpt",POINT_CLOUD:"pnts",BATCHED_3D_MODEL:"b3dm",INSTANCED_3D_MODEL:"i3dm",GEOMETRY:"geom",VECTOR:"vect",GLTF:"glTF"};Object.keys(o);var a=r(10981);function c(e,t,r){(0,a.v)(e instanceof ArrayBuffer);const n=new TextDecoder("utf8"),s=new Uint8Array(e,t,r);return n.decode(s)}var u=r(73719),l=r(66160),d=r(94510),f=r(87597);const h={[d.Zf.DOUBLE]:Float64Array,[d.Zf.FLOAT]:Float32Array,[d.Zf.UNSIGNED_SHORT]:Uint16Array,[d.Zf.UNSIGNED_INT]:Uint32Array,[d.Zf.UNSIGNED_BYTE]:Uint8Array,[d.Zf.BYTE]:Int8Array,[d.Zf.SHORT]:Int16Array,[d.Zf.INT]:Int32Array},A={DOUBLE:d.Zf.DOUBLE,FLOAT:d.Zf.FLOAT,UNSIGNED_SHORT:d.Zf.UNSIGNED_SHORT,UNSIGNED_INT:d.Zf.UNSIGNED_INT,UNSIGNED_BYTE:d.Zf.UNSIGNED_BYTE,BYTE:d.Zf.BYTE,SHORT:d.Zf.SHORT,INT:d.Zf.INT},m="Failed to convert GL type";class p{static fromTypedArray(e){e=ArrayBuffer.isView(e)?e.constructor:e;for(const t in h){if(h[t]===e)return t}throw new Error(m)}static fromName(e){const t=A[e];if(!t)throw new Error(m);return t}static getArrayType(e){switch(e){case d.Zf.UNSIGNED_SHORT_5_6_5:case d.Zf.UNSIGNED_SHORT_4_4_4_4:case d.Zf.UNSIGNED_SHORT_5_5_5_1:return Uint16Array;default:const t=h[e];if(!t)throw new Error(m);return t}}static getByteSize(e){return p.getArrayType(e).BYTES_PER_ELEMENT}static validate(e){return Boolean(p.getArrayType(e))}static createTypedArray(e,t,r,n){void 0===r&&(r=0),void 0===n&&(n=(t.byteLength-r)/p.getByteSize(e));return new(p.getArrayType(e))(t,r,n)}}class B{featuresLength=0;_cachedTypedArrays={};constructor(e,t){this.json=e,this.buffer=t}getExtension(e){return this.json.extensions&&this.json.extensions[e]}hasProperty(e){return Boolean(this.json[e])}getGlobalProperty(e,t,r){void 0===t&&(t=d.GL.UNSIGNED_INT),void 0===r&&(r=1);const n=this.json[e];return n&&Number.isFinite(n.byteOffset)?this._getTypedArrayFromBinary(e,t,r,1,n.byteOffset):n}getPropertyArray(e,t,r){const n=this.json[e];return n&&Number.isFinite(n.byteOffset)?("componentType"in n&&(t=p.fromName(n.componentType)),this._getTypedArrayFromBinary(e,t,r,this.featuresLength,n.byteOffset)):this._getTypedArrayFromArray(e,t,n)}getProperty(e,t,r,n,s){const i=this.json[e];if(!i)return i;const o=this.getPropertyArray(e,t,r);if(1===r)return o[n];for(let a=0;a<r;++a)s[a]=o[r*n+a];return s}_getTypedArrayFromBinary(e,t,r,n,s){const i=this._cachedTypedArrays;let o=i[e];return o||(o=p.createTypedArray(t,this.buffer.buffer,this.buffer.byteOffset+s,n*r),i[e]=o),o}_getTypedArrayFromArray(e,t,r){const n=this._cachedTypedArrays;let s=n[e];return s||(s=p.createTypedArray(t,r),n[e]=s),s}}const C={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},y={SCALAR:(e,t)=>e[t],VEC2:(e,t)=>[e[2*t+0],e[2*t+1]],VEC3:(e,t)=>[e[3*t+0],e[3*t+1],e[3*t+2]],VEC4:(e,t)=>[e[4*t+0],e[4*t+1],e[4*t+2],e[4*t+3]],MAT2:(e,t)=>[e[4*t+0],e[4*t+1],e[4*t+2],e[4*t+3]],MAT3:(e,t)=>[e[9*t+0],e[9*t+1],e[9*t+2],e[9*t+3],e[9*t+4],e[9*t+5],e[9*t+6],e[9*t+7],e[9*t+8]],MAT4:(e,t)=>[e[16*t+0],e[16*t+1],e[16*t+2],e[16*t+3],e[16*t+4],e[16*t+5],e[16*t+6],e[16*t+7],e[16*t+8],e[16*t+9],e[16*t+10],e[16*t+11],e[16*t+12],e[16*t+13],e[16*t+14],e[16*t+15]]},g={SCALAR:(e,t,r)=>{t[r]=e},VEC2:(e,t,r)=>{t[2*r+0]=e[0],t[2*r+1]=e[1]},VEC3:(e,t,r)=>{t[3*r+0]=e[0],t[3*r+1]=e[1],t[3*r+2]=e[2]},VEC4:(e,t,r)=>{t[4*r+0]=e[0],t[4*r+1]=e[1],t[4*r+2]=e[2],t[4*r+3]=e[3]},MAT2:(e,t,r)=>{t[4*r+0]=e[0],t[4*r+1]=e[1],t[4*r+2]=e[2],t[4*r+3]=e[3]},MAT3:(e,t,r)=>{t[9*r+0]=e[0],t[9*r+1]=e[1],t[9*r+2]=e[2],t[9*r+3]=e[3],t[9*r+4]=e[4],t[9*r+5]=e[5],t[9*r+6]=e[6],t[9*r+7]=e[7],t[9*r+8]=e[8],t[9*r+9]=e[9]},MAT4:(e,t,r)=>{t[16*r+0]=e[0],t[16*r+1]=e[1],t[16*r+2]=e[2],t[16*r+3]=e[3],t[16*r+4]=e[4],t[16*r+5]=e[5],t[16*r+6]=e[6],t[16*r+7]=e[7],t[16*r+8]=e[8],t[16*r+9]=e[9],t[16*r+10]=e[10],t[16*r+11]=e[11],t[16*r+12]=e[12],t[16*r+13]=e[13],t[16*r+14]=e[14],t[16*r+15]=e[15]}};var b=r(80247);const _=e=>void 0!==e;function T(e,t,r){if(!t)return null;let n=e.getExtension("3DTILES_batch_table_hierarchy");const s=t.HIERARCHY;return s&&(b.warn("3D Tile Parser: HIERARCHY is deprecated. Use 3DTILES_batch_table_hierarchy."),t.extensions=t.extensions||{},t.extensions["3DTILES_batch_table_hierarchy"]=s,n=s),n?function(e,t){let r,n,s;const i=e.instancesLength,o=e.classes;let a,c=e.classIds,u=e.parentCounts,l=e.parentIds,d=i;_(c.byteOffset)&&(c.componentType=defaultValue(c.componentType,GL.UNSIGNED_SHORT),c.type=AttributeType.SCALAR,s=getBinaryAccessor(c),c=s.createArrayBufferView(t.buffer,t.byteOffset+c.byteOffset,i));if(_(u))for(_(u.byteOffset)&&(u.componentType=defaultValue(u.componentType,GL.UNSIGNED_SHORT),u.type=AttributeType.SCALAR,s=getBinaryAccessor(u),u=s.createArrayBufferView(t.buffer,t.byteOffset+u.byteOffset,i)),a=new Uint16Array(i),d=0,r=0;r<i;++r)a[r]=d,d+=u[r];_(l)&&_(l.byteOffset)&&(l.componentType=defaultValue(l.componentType,GL.UNSIGNED_SHORT),l.type=AttributeType.SCALAR,s=getBinaryAccessor(l),l=s.createArrayBufferView(t.buffer,t.byteOffset+l.byteOffset,d));const f=o.length;for(r=0;r<f;++r){const e=o[r].length,n=o[r].instances,s=getBinaryProperties(e,n,t);o[r].instances=combine(s,n)}const h=new Array(f).fill(0),A=new Uint16Array(i);for(r=0;r<i;++r)n=c[r],A[r]=h[n],++h[n];const m={classes:o,classIds:c,classIndexes:A,parentCounts:u,parentIndexes:a,parentIds:l};return function(e){const t=e.classIds,r=t.length;for(let n=0;n<r;++n)S(e,n,stack)}(m),m}(n,r):null}function E(e,t,r){if(!e)return;const n=e.parentCounts;return e.parentIds?r(e,t):n>0?function(e,t,r){const n=e.classIds,s=e.parentCounts,i=e.parentIds,o=e.parentIndexes,a=n.length,c=scratchVisited;c.length=Math.max(c.length,a);const u=++marker,l=scratchStack;l.length=0,l.push(t);for(;l.length>0;){if(c[t=l.pop()]===u)continue;c[t]=u;const n=r(e,t);if(_(n))return n;const a=s[t],d=o[t];for(let e=0;e<a;++e){const r=i[d+e];r!==t&&l.push(r)}}return null}(e,t,r):function(e,t,r){let n=!0;for(;n;){const s=r(e,t);if(_(s))return s;const i=e.parentIds[t];n=i!==t,t=i}throw new Error("traverseHierarchySingleParent")}(e,t,r)}function S(e,t,r){const n=e.parentCounts,s=e.parentIds,i=e.parentIndexes,o=e.classIds.length;if(!_(s))return;assert(t<o,`Parent index ${t} exceeds the total number of instances: ${o}`),assert(-1===r.indexOf(t),"Circular dependency detected in the batch table hierarchy."),r.push(t);const a=_(n)?n[t]:1,c=_(n)?i[t]:t;for(let u=0;u<a;++u){const n=s[c+u];n!==t&&S(e,n,r)}r.pop(t)}function R(e){return null!=e}const D=(e,t)=>e,M={HIERARCHY:!0,extensions:!0,extras:!0};class w{constructor(e,t,r,n){void 0===n&&(n={}),(0,a.v)(r>=0),this.json=e||{},this.binary=t,this.featureCount=r,this._extensions=this.json?.extensions||{},this._properties={};for(const s in this.json)M[s]||(this._properties[s]=this.json[s]);this._binaryProperties=this._initializeBinaryProperties(),n["3DTILES_batch_table_hierarchy"]&&(this._hierarchy=T(this,this.json,this.binary))}getExtension(e){return this.json&&this.json.extensions&&this.json.extensions[e]}memorySizeInBytes(){return 0}isClass(e,t){if(this._checkBatchId(e),(0,a.v)("string"==typeof t,t),this._hierarchy){return R(E(this._hierarchy,e,((e,r)=>{const n=e.classIds[r];return e.classes[n].name===t})))}return!1}isExactClass(e,t){return(0,a.v)("string"==typeof t,t),this.getExactClassName(e)===t}getExactClassName(e){if(this._checkBatchId(e),this._hierarchy){const t=this._hierarchy.classIds[e];return this._hierarchy.classes[t].name}}hasProperty(e,t){return this._checkBatchId(e),(0,a.v)("string"==typeof t,t),R(this._properties[t])||this._hasPropertyInHierarchy(e,t)}getPropertyNames(e,t){this._checkBatchId(e),(t=R(t)?t:[]).length=0;const r=Object.keys(this._properties);return t.push(...r),this._hierarchy&&this._getPropertyNamesInHierarchy(e,t),t}getProperty(e,t){if(this._checkBatchId(e),(0,a.v)("string"==typeof t,t),this._binaryProperties){const r=this._binaryProperties[t];if(R(r))return this._getBinaryProperty(r,e)}const r=this._properties[t];if(R(r))return D(r[e]);if(this._hierarchy){const r=this._getHierarchyProperty(e,t);if(R(r))return r}}setProperty(e,t,r){const n=this.featureCount;if(this._checkBatchId(e),(0,a.v)("string"==typeof t,t),this._binaryProperties){const n=this._binaryProperties[t];if(n)return void this._setBinaryProperty(n,e,r)}if(this._hierarchy&&this._setHierarchyProperty(this,e,t,r))return;let s=this._properties[t];R(s)||(this._properties[t]=new Array(n),s=this._properties[t]),s[e]=D(r)}_checkBatchId(e){if(!(e>=0&&e<this.featureCount))throw new Error("batchId not in range [0, featureCount - 1].")}_getBinaryProperty(e,t){return e.unpack(e.typedArray,t)}_setBinaryProperty(e,t,r){e.pack(r,e.typedArray,t)}_initializeBinaryProperties(){let e=null;for(const t in this._properties){const r=this._properties[t],n=this._initializeBinaryProperty(t,r);n&&(e=e||{},e[t]=n)}return e}_initializeBinaryProperty(e,t){if("byteOffset"in t){const r=t;(0,a.v)(this.binary,`Property ${e} requires a batch table binary.`),(0,a.v)(r.type,`Property ${e} requires a type.`);const n=function(e,t,r,n){const{componentType:s}=e;(0,a.v)(e.componentType);const i="string"==typeof s?p.fromName(s):s,o=C[e.type],c=y[e.type],u=g[e.type];return r+=e.byteOffset,{values:p.createTypedArray(i,t,r,o*n),type:i,size:o,unpacker:c,packer:u}}(r,this.binary.buffer,0|this.binary.byteOffset,this.featureCount);return{typedArray:n.values,componentCount:n.size,unpack:n.unpacker,pack:n.packer}}return null}_hasPropertyInHierarchy(e,t){if(!this._hierarchy)return!1;const r=E(this._hierarchy,e,((e,r)=>{const n=e.classIds[r];return R(e.classes[n].instances[t])}));return R(r)}_getPropertyNamesInHierarchy(e,t){E(this._hierarchy,e,((e,r)=>{const n=e.classIds[r],s=e.classes[n].instances;for(const i in s)s.hasOwnProperty(i)&&-1===t.indexOf(i)&&t.push(i)}))}_getHierarchyProperty(e,t){return E(this._hierarchy,e,((e,r)=>{const n=e.classIds[r],s=e.classes[n],i=e.classIndexes[r],o=s.instances[t];return R(o)?R(o.typedArray)?this._getBinaryProperty(o,i):D(o[i]):null}))}_setHierarchyProperty(e,t,r,n){const s=E(this._hierarchy,t,((e,s)=>{const i=e.classIds[s],o=e.classes[i],c=e.classIndexes[s],u=o.instances[r];return!!R(u)&&((0,a.v)(s===t,`Inherited property "${r}" is read-only.`),R(u.typedArray)?this._setBinaryProperty(u,c,n):u[c]=D(n),!0)}));return R(s)}}function I(e,t,r){void 0===r&&(r=0);const n=new DataView(t);if(e.magic=n.getUint32(r,!0),r+=4,e.version=n.getUint32(r,!0),r+=4,e.byteLength=n.getUint32(r,!0),r+=4,1!==e.version)throw new Error(`3D Tile Version ${e.version} not supported`);return r}var G=r(80247);const v="b3dm tile in legacy format.";function O(e,t,r){const n=new DataView(t);let s;e.header=e.header||{};let i=n.getUint32(r,!0);r+=4;let o=n.getUint32(r,!0);r+=4;let a=n.getUint32(r,!0);r+=4;let c=n.getUint32(r,!0);return r+=4,a>=570425344?(r-=8,s=i,a=o,c=0,i=0,o=0,G.warn(v)):c>=570425344&&(r-=4,s=a,a=i,c=o,i=0,o=0,G.warn(v)),e.header.featureTableJsonByteLength=i,e.header.featureTableBinaryByteLength=o,e.header.batchTableJsonByteLength=a,e.header.batchTableBinaryByteLength=c,e.header.batchLength=s,r}function F(e,t,r,n){return r=function(e,t,r){const{featureTableJsonByteLength:n,featureTableBinaryByteLength:s,batchLength:i}=e.header||{};if(e.featureTableJson={BATCH_LENGTH:i||0},n&&n>0){const s=c(t,r,n);e.featureTableJson=JSON.parse(s)}return r+=n||0,e.featureTableBinary=new Uint8Array(t,r,s),r+=s||0,r}(e,t,r),r=function(e,t,r){const{batchTableJsonByteLength:n,batchTableBinaryByteLength:s}=e.header||{};if(n&&n>0){const i=c(t,r,n);e.batchTableJson=JSON.parse(i),r+=n,s&&s>0&&(e.batchTableBinary=new Uint8Array(t,r,s),e.batchTableBinary=new Uint8Array(e.batchTableBinary),r+=s)}return r}(e,t,r),r}function x(e,t){void 0===t&&(t=[0,0,0]);const r=e>>11&31,n=e>>5&63,s=31&e;return t[0]=r<<3,t[1]=n<<2,t[2]=s<<3,t}function P(e,t,r){if(!(t||e&&e.batchIds&&r))return null;const{batchIds:n,isRGB565:s,pointCount:i=0}=e;if(n&&r){const e=new Uint8ClampedArray(3*i);for(let t=0;t<i;t++){const s=n[t],i=r.getProperty(s,"dimensions").map((e=>255*e));e[3*t]=i[0],e[3*t+1]=i[1],e[3*t+2]=i[2]}return{type:d.GL.UNSIGNED_BYTE,value:e,size:3,normalized:!0}}if(t&&s){const e=new Uint8ClampedArray(3*i);for(let r=0;r<i;r++){const n=x(t[r]);e[3*r]=n[0],e[3*r+1]=n[1],e[3*r+2]=n[2]}return{type:d.GL.UNSIGNED_BYTE,value:e,size:3,normalized:!0}}return t&&t.length===3*i?{type:d.GL.UNSIGNED_BYTE,value:t,size:3,normalized:!0}:{type:d.GL.UNSIGNED_BYTE,value:t||new Uint8ClampedArray,size:4,normalized:!0}}var U=r(77422),H=r(54901);new U.I,new f.P,new U.I,new U.I,new Uint8Array(1);function L(e,t){return void 0===t&&(t=255),(0,H.qE)(e,0,t)/t*2-1}function N(e){return e<0?-1:1}function J(e,t,r,n){if(function(e,t){if(!e)throw new Error(`math.gl assertion failed. ${t}`)}(n),e<0||e>r||t<0||t>r)throw new Error(`x and y must be unsigned normalized integers between 0 and ${r}`);if(n.x=L(e,r),n.y=L(t,r),n.z=1-(Math.abs(n.x)+Math.abs(n.y)),n.z<0){const e=n.x;n.x=(1-Math.abs(n.y))*N(e),n.y=(1-Math.abs(e))*N(n.y)}return n.normalize()}function j(e,t,r){return J(e,t,255,r)}const K=new f.P;function V(e,t,r){return e.isQuantized?r["3d-tiles"]&&r["3d-tiles"].decodeQuantizedPositions?(e.isQuantized=!1,function(e,t){const r=new f.P,n=new Float32Array(3*e.pointCount);for(let s=0;s<e.pointCount;s++)r.set(t[3*s],t[3*s+1],t[3*s+2]).scale(1/e.quantizedRange).multiply(e.quantizedVolumeScale).add(e.quantizedVolumeOffset).toArray(n,3*s);return n}(e,t)):{type:d.GL.UNSIGNED_SHORT,value:t,size:3,normalized:!0}:t}async function k(e,t,r,n,s){r=F(e,t,r=O(e,t,r=I(e,t,r))),function(e){e.attributes={positions:null,colors:null,normals:null,batchIds:null},e.isQuantized=!1,e.isTranslucent=!1,e.isRGB565=!1,e.isOctEncoded16P=!1}(e);const{featureTable:i,batchTable:o}=function(e){const t=new B(e.featureTableJson,e.featureTableBinary),r=t.getGlobalProperty("POINTS_LENGTH");if(!Number.isFinite(r))throw new Error("POINTS_LENGTH must be defined");t.featuresLength=r,e.featuresLength=r,e.pointsLength=r,e.pointCount=r,e.rtcCenter=t.getGlobalProperty("RTC_CENTER",d.GL.FLOAT,3);const n=function(e,t){let r=null;if(!e.batchIds&&t.hasProperty("BATCH_ID")&&(e.batchIds=t.getPropertyArray("BATCH_ID",d.GL.UNSIGNED_SHORT,1),e.batchIds)){const n=t.getGlobalProperty("BATCH_LENGTH");if(!n)throw new Error("Global property: BATCH_LENGTH must be defined when BATCH_ID is defined.");const{batchTableJson:s,batchTableBinary:i}=e;r=new w(s,i,n)}return r}(e,t);return{featureTable:t,batchTable:n}}(e);return await async function(e,t,r,n,s){let i,o,a;const c=e.batchTableJson&&e.batchTableJson.extensions&&e.batchTableJson.extensions["3DTILES_draco_point_compression"];c&&(a=c.properties);const d=t.getExtension("3DTILES_draco_point_compression");if(d){o=d.properties;const t=d.byteOffset,r=d.byteLength;if(!o||!Number.isFinite(t)||!r)throw new Error("Draco properties, byteOffset, and byteLength must be defined");i=(e.featureTableBinary||[]).slice(t,t+r),e.hasPositions=Number.isFinite(o.POSITION),e.hasColors=Number.isFinite(o.RGB)||Number.isFinite(o.RGBA),e.hasNormals=Number.isFinite(o.NORMAL),e.hasBatchIds=Number.isFinite(o.BATCH_ID),e.isTranslucent=Number.isFinite(o.RGBA)}if(!i)return!0;const h={buffer:i,properties:{...o,...a},featureTableProperties:o,batchTableProperties:a,dequantizeInShader:!1};return await async function(e,t,r,n){if(!n)return;const s={...r,draco:{...r?.draco,extraAttributes:t.batchTableProperties||{}}};delete s["3d-tiles"];const i=await(0,l.N9)(t.buffer,u.Vl,s,n),o=i.attributes.POSITION&&i.attributes.POSITION.value,a=i.attributes.COLOR_0&&i.attributes.COLOR_0.value,c=i.attributes.NORMAL&&i.attributes.NORMAL.value,d=i.attributes.BATCH_ID&&i.attributes.BATCH_ID.value,h=o&&i.attributes.POSITION.value.quantization,A=c&&i.attributes.NORMAL.value.quantization;if(h){const t=i.POSITION.data.quantization,r=t.range;e.quantizedVolumeScale=new f.P(r,r,r),e.quantizedVolumeOffset=new f.P(t.minValues),e.quantizedRange=(1<<t.quantizationBits)-1,e.isQuantizedDraco=!0}A&&(e.octEncodedRange=(1<<i.NORMAL.data.quantization.quantizationBits)-1,e.isOctEncodedDraco=!0);const m={};if(t.batchTableProperties)for(const u of Object.keys(t.batchTableProperties))i.attributes[u]&&i.attributes[u].value&&(m[u.toLowerCase()]=i.attributes[u].value);e.attributes={positions:o,colors:P(e,a,void 0),normals:c,batchIds:d,...m}}(e,h,n,s)}(e,i,0,n,s),function(e,t,r){if(e.attributes=e.attributes||{positions:null,colors:null,normals:null,batchIds:null},!e.attributes.positions)if(t.hasProperty("POSITION"))e.attributes.positions=t.getPropertyArray("POSITION",d.GL.FLOAT,3);else if(t.hasProperty("POSITION_QUANTIZED")){const n=t.getPropertyArray("POSITION_QUANTIZED",d.GL.UNSIGNED_SHORT,3);if(e.isQuantized=!0,e.quantizedRange=65535,e.quantizedVolumeScale=t.getGlobalProperty("QUANTIZED_VOLUME_SCALE",d.GL.FLOAT,3),!e.quantizedVolumeScale)throw new Error("QUANTIZED_VOLUME_SCALE must be defined for quantized positions.");if(e.quantizedVolumeOffset=t.getGlobalProperty("QUANTIZED_VOLUME_OFFSET",d.GL.FLOAT,3),!e.quantizedVolumeOffset)throw new Error("QUANTIZED_VOLUME_OFFSET must be defined for quantized positions.");e.attributes.positions=V(e,n,r)}if(!e.attributes.positions)throw new Error("Either POSITION or POSITION_QUANTIZED must be defined.")}(e,i,n),function(e,t,r){if(e.attributes=e.attributes||{positions:null,colors:null,normals:null,batchIds:null},!e.attributes.colors){let n=null;t.hasProperty("RGBA")?(n=t.getPropertyArray("RGBA",d.GL.UNSIGNED_BYTE,4),e.isTranslucent=!0):t.hasProperty("RGB")?n=t.getPropertyArray("RGB",d.GL.UNSIGNED_BYTE,3):t.hasProperty("RGB565")&&(n=t.getPropertyArray("RGB565",d.GL.UNSIGNED_SHORT,1),e.isRGB565=!0),e.attributes.colors=P(e,n,r)}t.hasProperty("CONSTANT_RGBA")&&(e.constantRGBA=t.getGlobalProperty("CONSTANT_RGBA",d.GL.UNSIGNED_BYTE,4))}(e,i,o),function(e,t){if(e.attributes=e.attributes||{positions:null,colors:null,normals:null,batchIds:null},!e.attributes.normals){let r=null;t.hasProperty("NORMAL")?r=t.getPropertyArray("NORMAL",d.GL.FLOAT,3):t.hasProperty("NORMAL_OCT16P")&&(r=t.getPropertyArray("NORMAL_OCT16P",d.GL.UNSIGNED_BYTE,2),e.isOctEncoded16P=!0),e.attributes.normals=function(e,t){if(!t)return null;if(e.isOctEncoded16P){const r=new Float32Array(3*(e.pointsLength||0));for(let n=0;n<(e.pointsLength||0);n++)j(t[2*n],t[2*n+1],K),K.toArray(r,3*n);return{type:d.GL.FLOAT,size:2,value:r}}return{type:d.GL.FLOAT,size:2,value:t}}(e,r)}}(e,i),r}var X=r(44818),Q=r(24714),z=r(45782),Y=r(95247),W=r(80247);const q=0,Z=1;function $(e,t,r,n){e.rotateYtoZ=!0;const s=(e.byteOffset||0)+(e.byteLength||0)-r;if(0===s)throw new Error("glTF byte length must be greater than 0.");return e.gltfUpAxis=n?.["3d-tiles"]&&n["3d-tiles"].assetGltfUpAxis?n["3d-tiles"].assetGltfUpAxis:"Y",e.gltfArrayBuffer=(0,Y._m)(t,r,s),e.gltfByteOffset=0,e.gltfByteLength=s,r%4==0||W.warn(`${e.type}: embedded glb is not aligned to a 4-byte boundary.`),(e.byteOffset||0)+(e.byteLength||0)}async function ee(e,t,r,n){const s=r?.["3d-tiles"]||{};if(function(e,t){switch(t){case q:if(e.gltfArrayBuffer){const t=new Uint8Array(e.gltfArrayBuffer,e.gltfByteOffset),r=(new TextDecoder).decode(t);e.gltfUrl=r.replace(/[\s\0]+$/,"")}delete e.gltfArrayBuffer,delete e.gltfByteOffset,delete e.gltfByteLength;break;case Z:break;default:throw new Error("b3dm: Illegal glTF format field")}}(e,t),s.loadGLTF){if(!n)return;if(e.gltfUrl){const{fetch:t}=n,s=await t(e.gltfUrl,r);e.gltfArrayBuffer=await s.arrayBuffer(),e.gltfByteOffset=0}if(e.gltfArrayBuffer){const t=await(0,l.N9)(e.gltfArrayBuffer,X.B,r,n);e.gltf=(0,Q.R)(t),e.gpuMemoryUsageInBytes=(0,z.S3)(e.gltf),delete e.gltfArrayBuffer,delete e.gltfByteOffset,delete e.gltfByteLength}}}async function te(e,t,r,n,s){r=function(e,t,r,n){r=I(e,t,r),r=O(e,t,r),r=F(e,t,r),r=$(e,t,r,n);const s=new B(e.featureTableJson,e.featureTableBinary);return e.rtcCenter=s.getGlobalProperty("RTC_CENTER",d.GL.FLOAT,3),r}(e,t,r,n),await ee(e,Z,n,s);const i=e?.gltf?.extensions;return i&&i.CESIUM_RTC&&(e.rtcCenter=i.CESIUM_RTC.center),r}var re=r(35567),ne=r(11633),se=r(31886),ie=r(4912);async function oe(e,t,r,n,s){return r=function(e,t,r,n){if(r=I(e,t,r),1!==e.version)throw new Error(`Instanced 3D Model version ${e.version} is not supported`);r=O(e,t,r);const s=new DataView(t);if(e.gltfFormat=s.getUint32(r,!0),r+=4,r=F(e,t,r),r=$(e,t,r,n),!e?.header?.featureTableJsonByteLength||0===e.header.featureTableJsonByteLength)throw new Error("i3dm parser: featureTableJsonByteLength is zero.");const i=new B(e.featureTableJson,e.featureTableBinary),o=i.getGlobalProperty("INSTANCES_LENGTH");if(i.featuresLength=o,!Number.isFinite(o))throw new Error("i3dm parser: INSTANCES_LENGTH must be defined");e.eastNorthUp=i.getGlobalProperty("EAST_NORTH_UP"),e.rtcCenter=i.getGlobalProperty("RTC_CENTER",d.GL.FLOAT,3);new w(e.batchTableJson,e.batchTableBinary,o);return function(e,t,r,n){const s=new Array(n),i=new f.P,o=new f.P,a=new f.P,c=new f.P,u=new re.d,l=new ne.P,h=new f.P,A={},m=new se.k,p=[],B=[],C=[],y=[];for(let f=0;f<n;f++){let r;if(t.hasProperty("POSITION"))r=t.getProperty("POSITION",d.GL.FLOAT,3,f,i);else if(t.hasProperty("POSITION_QUANTIZED")){r=t.getProperty("POSITION_QUANTIZED",d.GL.UNSIGNED_SHORT,3,f,i);const e=t.getGlobalProperty("QUANTIZED_VOLUME_OFFSET",d.GL.FLOAT,3);if(!e)throw new Error("i3dm parser: QUANTIZED_VOLUME_OFFSET must be defined for quantized positions.");const n=t.getGlobalProperty("QUANTIZED_VOLUME_SCALE",d.GL.FLOAT,3);if(!n)throw new Error("i3dm parser: QUANTIZED_VOLUME_SCALE must be defined for quantized positions.");const s=65535;for(let t=0;t<3;t++)r[t]=r[t]/s*n[t]+e[t]}if(!r)throw new Error("i3dm: POSITION or POSITION_QUANTIZED must be defined for each instance.");i.copy(r),A.translation=i,e.normalUp=t.getProperty("NORMAL_UP",d.GL.FLOAT,3,f,p),e.normalRight=t.getProperty("NORMAL_RIGHT",d.GL.FLOAT,3,f,B);const n=!1;if(e.normalUp){if(!e.normalRight)throw new Error("i3dm: Custom orientation requires both NORMAL_UP and NORMAL_RIGHT.");e.hasCustomOrientation=!0}else{if(e.octNormalUp=t.getProperty("NORMAL_UP_OCT32P",d.GL.UNSIGNED_SHORT,2,f,p),e.octNormalRight=t.getProperty("NORMAL_RIGHT_OCT32P",d.GL.UNSIGNED_SHORT,2,f,B),e.octNormalUp){if(!e.octNormalRight)throw new Error("i3dm: oct-encoded orientation requires NORMAL_UP_OCT32P and NORMAL_RIGHT_OCT32P");throw new Error("i3dm: oct-encoded orientation not implemented")}e.eastNorthUp?(ie.C.WGS84.eastNorthUpToFixedFrame(i,m),m.getRotationMatrix3(u)):u.identity()}n&&(c.copy(o).cross(a).normalize(),u.setColumn(0,o),u.setColumn(1,a),u.setColumn(2,c)),l.fromMatrix3(u),A.rotation=l,h.set(1,1,1);const g=t.getProperty("SCALE",d.GL.FLOAT,1,f,C);Number.isFinite(g)&&h.multiplyByScalar(g);const b=t.getProperty("SCALE_NON_UNIFORM",d.GL.FLOAT,3,f,p);b&&h.scale(b),A.scale=h;let _=t.getProperty("BATCH_ID",d.GL.UNSIGNED_SHORT,1,f,y);void 0===_&&(_=f);const T=(new se.k).fromQuaternion(A.rotation);m.identity(),m.translate(A.translation),m.multiplyRight(T),m.scale(A.scale);const E=m.clone();s[f]={modelMatrix:E,batchId:_}}e.instances=s}(e,i,0,o),r}(e,t,r,n),await ee(e,e.gltfFormat||0,n,s),r}async function ae(e,t,r,n,s){switch(void 0===t&&(t=0),void 0===s&&(s={shape:"tile3d"}),s.byteOffset=t,s.type=function(e,t){void 0===t&&(t=0);const r=new DataView(e);return`${String.fromCharCode(r.getUint8(t+0))}${String.fromCharCode(r.getUint8(t+1))}${String.fromCharCode(r.getUint8(t+2))}${String.fromCharCode(r.getUint8(t+3))}`}(e,t),s.type){case o.COMPOSITE:return await async function(e,t,r,n,s,i){r=I(e,t,r);const o=new DataView(t);for(e.tilesLength=o.getUint32(r,!0),r+=4,e.tiles=[];e.tiles.length<e.tilesLength&&(e.byteLength||0)-r>12;){const o={shape:"tile3d"};e.tiles.push(o),r=await i(t,r,n,s,o)}return r}(s,e,t,r,n,ae);case o.BATCHED_3D_MODEL:return await te(s,e,t,r,n);case o.GLTF:return await async function(e,t,r,n){if(e.rotateYtoZ=!0,e.gltfUpAxis=r?.["3d-tiles"]?.assetGltfUpAxis?r["3d-tiles"].assetGltfUpAxis:"Y",r?.["3d-tiles"]?.loadGLTF){if(!n)return t.byteLength;const s=await(0,l.N9)(t,X.B,r,n);e.gltf=(0,Q.R)(s),e.gpuMemoryUsageInBytes=(0,z.S3)(e.gltf)}else e.gltfArrayBuffer=t;return t.byteLength}(s,e,r,n);case o.INSTANCED_3D_MODEL:return await oe(s,e,t,r,n);case o.POINT_CLOUD:return await k(s,e,t,r,n);default:throw new Error(`3DTileLoader: unknown type ${s.type}`)}}async function ce(e,t,r,n){const s=Number.isFinite(t.bitstream)?t.bitstream:t.bufferView;if("number"!=typeof s)return;const i=e.bufferViews[s],o=e.buffers[i.buffer];if(!n?.baseUrl)throw new Error("Url is not provided");if(!n.fetch)throw new Error("fetch is not provided");if(o.uri){const e=`${n?.baseUrl||""}/${o.uri}`,r=await n.fetch(e),s=await r.arrayBuffer();return void(t.explicitBitstream=new Uint8Array(s,i.byteOffset,i.byteLength))}const a=e.buffers.slice(0,i.buffer).reduce(((e,t)=>e+t.byteLength),0);t.explicitBitstream=new Uint8Array(r.slice(a,a+o.byteLength),i.byteOffset,i.byteLength)}function ue(e){const t=new DataView(e);return t.getUint32(0,!0)+2**32*t.getUint32(4,!0)}const le={dataType:null,batchType:null,id:"3d-tiles-subtree",name:"3D Tiles Subtree",module:"3d-tiles",version:i,extensions:["subtree"],mimeTypes:["application/octet-stream"],tests:["subtree"],parse:async function(e,t,r){if(1952609651!==new Uint32Array(e.slice(0,4))[0])throw new Error("Wrong subtree file magic number");if(1!==new Uint32Array(e.slice(4,8))[0])throw new Error("Wrong subtree file verson, must be 1");const n=ue(e.slice(8,16)),s=new Uint8Array(e,24,n),i=new TextDecoder("utf8").decode(s),o=JSON.parse(i),a=ue(e.slice(16,24));let c=new ArrayBuffer(0);if(a&&(c=e.slice(24+n)),await ce(o,o.tileAvailability,c,r),Array.isArray(o.contentAvailability))for(const u of o.contentAvailability)await ce(o,u,c,r);else await ce(o,o.contentAvailability,c,r);return await ce(o,o.childSubtreeAvailability,c,r),o},options:{}};var de=r(85930),fe=r(48831),he=r(37976);function Ae(e){"X"===e&&(e="");const t=e.padEnd(16,"0");return he.A.fromString(t,!0,16)}var me=r(67733);const pe=180/Math.PI;function Be(e,t,r){const n=1<<t;return[(e[0]+r[0])/n,(e[1]+r[1])/n]}function Ce(e){return e>=.5?1/3*(4*e*e-1):1/3*(1-4*(1-e)*(1-e))}function ye(e){return[Ce(e[0]),Ce(e[1])]}function ge(e,t){let[r,n]=t;switch(e){case 0:return[1,r,n];case 1:return[-r,1,n];case 2:return[-r,-n,1];case 3:return[-1,-n,-r];case 4:return[n,-1,-r];case 5:return[n,r,-1];default:throw new Error("Invalid face")}}function be(e){let[t,r,n]=e;const s=Math.atan2(n,Math.sqrt(t*t+r*r));return[Math.atan2(r,t)*pe,s*pe]}function _e(e,t,r,n){if(0===n){1===r&&(t[0]=e-1-t[0],t[1]=e-1-t[1]);const n=t[0];t[0]=t[1],t[1]=n}}function Te(e){const t=function(e){if(e.indexOf("/")>0)return e;const t=Ae(e);return function(e){if(e.isZero())return"";let t=e.toString(2);for(;t.length<64;)t="0"+t;const r=t.lastIndexOf("1"),n=t.substring(0,3),s=t.substring(3,r),i=s.length/2,o=he.A.fromString(n,!0,2).toString(10);let a="";if(0!==i)for(a=he.A.fromString(s,!0,2).toString(4);a.length<i;)a="0"+a;return`${o}/${a}`}(t)}(e);return function(e){if(0===e.length)throw new Error(`Invalid Hilbert quad key ${e}`);const t=e.split("/"),r=parseInt(t[0],10),n=t[1],s=n.length;let i=0;const o=[0,0];for(let a=s-1;a>=0;a--){i=s-a;const e=n[a];let t=0,r=0;"1"===e?r=1:"2"===e?(t=1,r=1):"3"===e&&(t=1);const c=Math.pow(2,i-1);_e(c,o,t,r),o[0]+=c*t,o[1]+=c*r}if(r%2==1){const e=o[0];o[0]=o[1],o[1]=e}return{face:r,ij:o,level:i}}(t)}function Ee(e){const{face:t,ij:r,level:n}=e,s=[[0,0],[0,1],[1,1],[1,0],[0,0]],i=Math.max(1,Math.ceil(100*Math.pow(2,-n))),o=new Float64Array(4*i*2+2);let a=0,c=0;for(let u=0;u<4;u++){const e=s[u].slice(0),l=s[u+1],d=(l[0]-e[0])/i,f=(l[1]-e[1])/i;for(let s=0;s<i;s++){e[0]+=d,e[1]+=f;const s=be(ge(t,ye(Be(r,n,e))));Math.abs(s[1])>89.999&&(s[0]=c);const i=s[0]-c;s[0]+=i>180?-360:i<-180?360:0,o[a++]=s[0],o[a++]=s[1],c=s[0]}}return o[a++]=o[0],o[a++]=o[1],o}function Se(e){if(e.length%2!=0)throw new Error("Invalid corners");const t=[],r=[];for(let n=0;n<e.length;n+=2)t.push(e[n]),r.push(e[n+1]);return t.sort(((e,t)=>e-t)),r.sort(((e,t)=>e-t)),{west:t[0],east:t[t.length-1],north:r[r.length-1],south:r[0]}}function Re(e,t){const r=t?.minimumHeight||0,n=t?.maximumHeight||0,s=function(e){let t;if(2===e.face||5===e.face){let r=null,n=0;for(let t=0;t<4;t++){const s=Ee(Te(`${e.face}/${t}`));null==r&&(r=new Float64Array(4*s.length)),r.set(s,n),n+=s.length}t=Se(r)}else t=Se(Ee(e));return t}(Te(e)),i=s.west,o=s.south,a=s.east,c=s.north,u=[];return u.push(new f.P(i,c,r)),u.push(new f.P(a,c,r)),u.push(new f.P(a,o,r)),u.push(new f.P(i,o,r)),u.push(new f.P(i,c,n)),u.push(new f.P(a,c,n)),u.push(new f.P(a,o,n)),u.push(new f.P(i,o,n)),u}function De(e){return function(e){const t=ye(Be(e.ij,e.level,[.5,.5]));return be(ge(e.face,t))}(Te(e))}function Me(e){const t=e.token,r={minimumHeight:e.minimumHeight,maximumHeight:e.maximumHeight},n=Re(t,r),s=De(t),i=s[0],o=s[1],a=ie.C.WGS84.cartographicToCartesian([i,o,r.maximumHeight]),c=new f.P(a[0],a[1],a[2]);n.push(c);const u=(0,me.ZZ)(n);return[...u.center,...u.halfAxes]}const we={QUADTREE:4,OCTREE:8};function Ie(e,t,r){if(e?.box){const n=function(e,t){const r=function(e){return e.and(e.not().add(1))}(e).shiftRightUnsigned(2);return e.add(he.A.fromNumber(2*t+1-4).multiply(r))}(Ae(e.s2VolumeInfo.token),t),s=function(e){if(e.isZero())return"X";let t=e.countTrailingZeros();t=(t-t%4)/4;const r=t;t*=4;const n=e.shiftRightUnsigned(t).toString(16).replace(/0+$/,"");return Array(17-r-n.length).join("0")+n}(n),i={...e.s2VolumeInfo};if(i.token=s,"OCTREE"===r){const t=e.s2VolumeInfo,r=t.maximumHeight-t.minimumHeight,n=r/2,s=t.minimumHeight+r/2;t.minimumHeight=s-n,t.maximumHeight=s+n}return{box:Me(i),s2VolumeInfo:i}}}async function Ge(e){const{subtree:t,subtreeData:r={level:0,x:0,y:0,z:0},parentData:n={mortonIndex:0,localLevel:-1,localX:0,localY:0,localZ:0},childIndex:s=0,implicitOptions:i,loaderOptions:o,s2VolumeBox:a}=e,{subdivisionScheme:c,subtreeLevels:u,maximumLevel:l,contentUrlTemplate:d,subtreesUriTemplate:f,basePath:h}=i,A={children:[],lodMetricValue:0,contentUrl:""};if(!l)return fe.Ay.once(`Missing 'maximumLevel' or 'availableLevels' property. The subtree ${d} won't be loaded...`),A;const m=n.localLevel+1,p=r.level+m;if(p>l)return A;const B=we[c],C=Math.log2(B),y=1&s,g=s>>1&1,b=s>>2&1,_=Oe(n.localX,y,1),T=Oe(n.localY,g,1),E=Oe(n.localZ,b,1),S=Oe(r.x,_,m),R=Oe(r.y,T,m),D=Oe(r.z,E,m),M=Oe(n.mortonIndex,s,C);let w,I,G,v;if(m===u&&ve(t.childSubtreeAvailability,M)){const e=Fe(`${h}/${f}`,p,S,R,D);w=await(0,de.H)(e,le,o),v=0,I={level:p,x:S,y:R,z:D},G={mortonIndex:0,localLevel:0,localX:0,localY:0,localZ:0}}else{w=t;v=(B**m-1)/(B-1)+M,I=r,G={mortonIndex:M,localLevel:m,localX:_,localY:T,localZ:E}}if(!ve(w.tileAvailability,v))return A;ve(w.contentAvailability,v)&&(A.contentUrl=Fe(d,p,S,R,D));for(let O=0;O<B;O++){const e=Ie(a,O,c),t=await Ge({subtree:w,subtreeData:I,parentData:G,childIndex:O,implicitOptions:i,loaderOptions:o,s2VolumeBox:e});(t.contentUrl||t.children.length)&&A.children.push(t)}if(A.contentUrl||A.children.length){const e=function(e,t,r,n){const{basePath:s,refine:i,getRefine:o,lodMetricType:a,getTileType:c,rootLodMetricValue:u,rootBoundingVolume:l}=r,d=e.contentUrl&&e.contentUrl.replace(`${s}/`,""),f=u/2**t.level,h=n?.box?{box:n.box}:l,A=function(e,t,r){if(e.region){const{level:n,x:s,y:i,z:o}=t,[a,c,u,l,d,f]=e.region,h=2**n,A=(u-a)/h,[m,p]=[a+A*s,a+A*(s+1)],B=(l-c)/h,[C,y]=[c+B*i,c+B*(i+1)];let g,b;if("OCTREE"===r){const e=(f-d)/h;[g,b]=[d+e*o,d+e*(o+1)]}else[g,b]=[d,f];return{region:[m,C,p,y,g,b]}}if(e.box)return e;throw new Error(`Unsupported bounding volume type ${JSON.stringify(e)}`)}(h,t,r.subdivisionScheme);return{children:e.children,contentUrl:e.contentUrl,content:{uri:d},id:e.contentUrl,refine:o(i),type:c(e),lodMetricType:a,lodMetricValue:f,geometricError:f,transform:e.transform,boundingVolume:A}}(A,{level:p,x:S,y:R,z:D},i,a);return e}return A}function ve(e,t){let r;return Array.isArray(e)?(r=e[0],e.length>1&&fe.Ay.once('Not supported extension "3DTILES_multiple_contents" has been detected')):r=e,"constant"in r?Boolean(r.constant):!!r.explicitBitstream&&function(e,t){const r=Math.floor(e/8),n=e%8;return 1==(t[r]>>n&1)}(t,r.explicitBitstream)}function Oe(e,t,r){return(e<<r)+t}function Fe(e,t,r,n,s){const i=function(e){const t={};for(const r in e)t[`{${r}}`]=e[r];return t}({level:t,x:r,y:n,z:s});return e.replace(/{level}|{x}|{y}|{z}/gi,(e=>i[e]))}function xe(e,t){if(void 0===t&&(t=""),!t)return s.WH.EMPTY;const r=t.split("?")[0].split(".").pop();switch(r){case"pnts":return s.WH.POINTCLOUD;case"i3dm":case"b3dm":case"glb":case"gltf":return s.WH.SCENEGRAPH;default:return r||s.WH.EMPTY}}function Pe(e){switch(e){case"REPLACE":case"replace":return s.lH.REPLACE;case"ADD":case"add":return s.lH.ADD;default:return e}}function Ue(e,t){if(/^[a-z][0-9a-z+.-]*:/i.test(t)){const r=new URL(e,`${t}/`);return decodeURI(r.toString())}return e.startsWith("/")?e:n.hd(t,e)}function He(e,t){if(!e)return null;let r;if(e.content){const n=e.content.uri||e.content?.url;void 0!==n&&(r=Ue(n,t))}return{...e,id:r,contentUrl:r,lodMetricType:s.ir.GEOMETRIC_ERROR,lodMetricValue:e.geometricError,transformMatrix:e.transform,type:xe(0,r),refine:Pe(e.refine)}}async function Le(e,t,r,n,i){const{subdivisionScheme:o,maximumLevel:a,availableLevels:c,subtreeLevels:u,subtrees:{uri:l}}=n,d=Ue(Fe(l,0,0,0,0),r),f=await(0,de.H)(d,le,i),h=e.content?.uri,A=h?Ue(h,r):"",m=t?.root?.refine,p=e.geometricError,B=e.boundingVolume.extensions?.["3DTILES_bounding_volume_S2"];if(B){const t={box:Me(B),s2VolumeInfo:B};e.boundingVolume=t}const C=e.boundingVolume,y={contentUrlTemplate:A,subtreesUriTemplate:l,subdivisionScheme:o,subtreeLevels:u,maximumLevel:Number.isFinite(c)?c-1:a,refine:m,basePath:r,lodMetricType:s.ir.GEOMETRIC_ERROR,rootLodMetricValue:p,rootBoundingVolume:C,getTileType:xe,getRefine:Pe};return await async function(e,t,r,n,i){if(!e)return null;const{children:o,contentUrl:a}=await Ge({subtree:r,implicitOptions:n,loaderOptions:i});let c,u=null;a&&(c=a,u={uri:a.replace(`${t}/`,"")});const l={...e,id:c,contentUrl:c,lodMetricType:s.ir.GEOMETRIC_ERROR,lodMetricValue:e.geometricError,transformMatrix:e.transform,type:xe(0,c),refine:Pe(e.refine),content:u||e.content,children:o};return l}(e,r,f,y,i)}function Ne(e){return e?.extensions?.["3DTILES_implicit_tiling"]||e?.implicitTiling}const Je={dataType:null,batchType:null,id:"3d-tiles",name:"3D Tiles",module:"3d-tiles",version:i,extensions:["cmpt","pnts","b3dm","i3dm"],mimeTypes:["application/octet-stream"],tests:["cmpt","pnts","b3dm","i3dm"],parse:async function(e,t,r){void 0===t&&(t={});const i=t["3d-tiles"]||{};let o;o="auto"===i.isTileset?r?.url&&-1!==r.url.indexOf(".json"):i.isTileset;return o?async function(e,t,r){const i=JSON.parse((new TextDecoder).decode(e)),o=r?.url||"",a=function(e){return n.pD(e)}(o),c=await async function(e,t,r){let n=null;const s=Ne(e.root);n=s&&e.root?await Le(e.root,e,t,s,r):He(e.root,t);const i=[];for(i.push(n);i.length>0;){const n=i.pop()||{},s=n.children||[],o=[];for(const a of s){const n=Ne(a);let s;s=n?await Le(a,e,t,n,r):He(a,t),s&&(o.push(s),i.push(s))}n.children=o}return n}(i,a,t||{}),u={...i,shape:"tileset3d",loader:Je,url:o,queryString:r?.queryString||"",basePath:a,root:c||i.root,type:s.yy.TILES3D,lodMetricType:s.ir.GEOMETRIC_ERROR,lodMetricValue:i.root?.geometricError||0};return u}(e,t,r):async function(e,t,r){const n={content:{shape:"tile3d",featureIds:null}},s=0;return await ae(e,s,t,r,n.content),n.content}(e,t,r)},options:{"3d-tiles":{loadGLTF:!0,decodeQuantizedPositions:!1,isTileset:"auto",assetGltfUpAxis:null}}}},88480:(e,t,r)=>{r.d(t,{Gv:()=>i,H1:()=>f,Pe:()=>d,Sv:()=>u,Td:()=>c,aC:()=>o,qf:()=>l,xZ:()=>a});const n=e=>"boolean"==typeof e,s=e=>"function"==typeof e,i=e=>null!==e&&"object"==typeof e,o=e=>i(e)&&e.constructor==={}.constructor,a=e=>Boolean(e)&&"function"==typeof e[Symbol.iterator],c=e=>e&&"function"==typeof e[Symbol.asyncIterator],u=e=>"undefined"!=typeof Response&&e instanceof Response||e&&e.arrayBuffer&&e.text&&e.json,l=e=>"undefined"!=typeof Blob&&e instanceof Blob,d=e=>e&&"object"==typeof e&&e.isBuffer,f=e=>(e=>"undefined"!=typeof ReadableStream&&e instanceof ReadableStream||i(e)&&s(e.tee)&&s(e.cancel)&&s(e.getReader))(e)||(e=>i(e)&&s(e.read)&&s(e.pipe)&&n(e.readable))(e)},85930:(e,t,r)=>{r.d(t,{H:()=>a});var n=r(88480),s=r(22858),i=r(92263),o=r(69681);async function a(e,t,r,a){let c,u;Array.isArray(t)||(0,s.l)(t)?(c=t,u=r):(c=[],u=t);const l=(0,i.z)(u);let d=e;return"string"==typeof e&&(d=await l(e)),(0,n.qf)(e)&&(d=await l(e)),Array.isArray(c),await(0,o.q)(d,c,u)}},69681:(e,t,r)=>{r.d(t,{q:()=>V});var n=r(97354),s=r(99222);class i{terminate(){}}var o=r(46410);const a=new Map;function c(e){(0,o.v)(e.source&&!e.url||!e.source&&e.url);let t=a.get(e.source||e.url);return t||(e.url&&(t=function(e){if(!e.startsWith("http"))return e;return u((t=e,`try {\n  importScripts('${t}');\n} catch (error) {\n  console.error(error);\n  throw error;\n}`));var t}(e.url),a.set(e.url,t)),e.source&&(t=u(e.source),a.set(e.source,t))),(0,o.v)(t),t}function u(e){const t=new Blob([e],{type:"application/javascript"});return URL.createObjectURL(t)}function l(e,t,r){void 0===t&&(t=!0);const n=r||new Set;if(e){if(d(e))n.add(e);else if(d(e.buffer))n.add(e.buffer);else if(ArrayBuffer.isView(e));else if(t&&"object"==typeof e)for(const s in e)l(e[s],t,n)}else;return void 0===r?Array.from(n):[]}function d(e){return!!e&&(e instanceof ArrayBuffer||("undefined"!=typeof MessagePort&&e instanceof MessagePort||("undefined"!=typeof ImageBitmap&&e instanceof ImageBitmap||"undefined"!=typeof OffscreenCanvas&&e instanceof OffscreenCanvas)))}var f=r(80247);const h=()=>{};class A{terminated=!1;_loadableURL="";static isSupported(){return"undefined"!=typeof Worker&&s.Bd||void 0!==i&&!s.Bd}constructor(e){const{name:t,source:r,url:n}=e;(0,o.v)(r||n),this.name=t,this.source=r,this.url=n,this.onMessage=h,this.onError=e=>f.log(e),this.worker=s.Bd?this._createBrowserWorker():this._createNodeWorker()}destroy(){this.onMessage=h,this.onError=h,this.worker.terminate(),this.terminated=!0}get isRunning(){return Boolean(this.onMessage)}postMessage(e,t){t=t||l(e),this.worker.postMessage(e,t)}_getErrorFromErrorEvent(e){let t="Failed to load ";return t+=`worker ${this.name} from ${this.url}. `,e.message&&(t+=`${e.message} in `),e.lineno&&(t+=`:${e.lineno}:${e.colno}`),new Error(t)}_createBrowserWorker(){this._loadableURL=c({source:this.source,url:this.url});const e=new Worker(this._loadableURL,{name:this.name});return e.onmessage=e=>{e.data?this.onMessage(e.data):this.onError(new Error("No data received"))},e.onerror=e=>{this.onError(this._getErrorFromErrorEvent(e)),this.terminated=!0},e.onmessageerror=e=>f.error(e),e}_createNodeWorker(){let e;if(this.url){const t=this.url.includes(":/")||this.url.startsWith("/")?this.url:`./${this.url}`;e=new i(t,{eval:!1})}else{if(!this.source)throw new Error("no worker");e=new i(this.source,{eval:!0})}return e.on("message",(e=>{this.onMessage(e)})),e.on("error",(e=>{this.onError(e)})),e.on("exit",(e=>{})),e}}class m{isRunning=!0;_resolve=()=>{};_reject=()=>{};constructor(e,t){this.name=e,this.workerThread=t,this.result=new Promise(((e,t)=>{this._resolve=e,this._reject=t}))}postMessage(e,t){this.workerThread.postMessage({source:"loaders.gl",type:e,payload:t})}done(e){(0,o.v)(this.isRunning),this.isRunning=!1,this._resolve(e)}error(e){(0,o.v)(this.isRunning),this.isRunning=!1,this._reject(e)}}var p=r(80247);class B{name="unnamed";maxConcurrency=1;maxMobileConcurrency=1;onDebug=()=>{};reuseWorkers=!0;props={};jobQueue=[];idleQueue=[];count=0;isDestroyed=!1;static isSupported(){return A.isSupported()}constructor(e){this.source=e.source,this.url=e.url,this.setProps(e)}destroy(){this.idleQueue.forEach((e=>e.destroy())),this.isDestroyed=!0}setProps(e){this.props={...this.props,...e},void 0!==e.name&&(this.name=e.name),void 0!==e.maxConcurrency&&(this.maxConcurrency=e.maxConcurrency),void 0!==e.maxMobileConcurrency&&(this.maxMobileConcurrency=e.maxMobileConcurrency),void 0!==e.reuseWorkers&&(this.reuseWorkers=e.reuseWorkers),void 0!==e.onDebug&&(this.onDebug=e.onDebug)}async startJob(e,t,r){void 0===t&&(t=(e,t,r)=>e.done(r)),void 0===r&&(r=(e,t)=>e.error(t));const n=new Promise((n=>(this.jobQueue.push({name:e,onMessage:t,onError:r,onStart:n}),this)));return this._startQueuedJob(),await n}async _startQueuedJob(){if(!this.jobQueue.length)return;const e=this._getAvailableWorker();if(!e)return;const t=this.jobQueue.shift();if(t){this.onDebug({message:"Starting job",name:t.name,workerThread:e,backlog:this.jobQueue.length});const n=new m(t.name,e);e.onMessage=e=>t.onMessage(n,e.type,e.payload),e.onError=e=>t.onError(n,e),t.onStart(n);try{await n.result}catch(r){p.error(`Worker exception: ${r}`)}finally{this.returnWorkerToQueue(e)}}}returnWorkerToQueue(e){!s.Bd||this.isDestroyed||!this.reuseWorkers||this.count>this._getMaxConcurrency()?(e.destroy(),this.count--):this.idleQueue.push(e),this.isDestroyed||this._startQueuedJob()}_getAvailableWorker(){if(this.idleQueue.length>0)return this.idleQueue.shift()||null;if(this.count<this._getMaxConcurrency()){this.count++;const e=`${this.name.toLowerCase()} (#${this.count} of ${this.maxConcurrency})`;return new A({name:e,source:this.source,url:this.url})}return null}_getMaxConcurrency(){return s.Fr?this.maxMobileConcurrency:this.maxConcurrency}}const C={maxConcurrency:3,maxMobileConcurrency:1,reuseWorkers:!0,onDebug:()=>{}};class y{workerPools=(()=>new Map)();static isSupported(){return A.isSupported()}static getWorkerFarm(e){return void 0===e&&(e={}),y._workerFarm=y._workerFarm||new y({}),y._workerFarm.setProps(e),y._workerFarm}constructor(e){this.props={...C},this.setProps(e),this.workerPools=new Map}destroy(){for(const e of this.workerPools.values())e.destroy();this.workerPools=new Map}setProps(e){this.props={...this.props,...e};for(const t of this.workerPools.values())t.setProps(this._getWorkerPoolProps())}getWorkerPool(e){const{name:t,source:r,url:n}=e;let s=this.workerPools.get(t);return s||(s=new B({name:t,source:r,url:n}),s.setProps(this._getWorkerPoolProps()),this.workerPools.set(t,s)),s}_getWorkerPoolProps(){return{maxConcurrency:this.props.maxConcurrency,maxMobileConcurrency:this.props.maxMobileConcurrency,reuseWorkers:this.props.reuseWorkers,onDebug:this.props.onDebug}}}var g=r(11654);var b=r(80247);async function _(e,t,r,n,i){const a=e.id,c=function(e,t){void 0===t&&(t={});const r=t[e.id]||{},n=s.Bd?`${e.id}-worker.js`:`${e.id}-worker-node.js`;let i=r.workerUrl;if(i||"compression"!==e.id||(i=t.workerUrl),"test"===t._workerType&&(i=s.Bd?`modules/${e.module}/dist/${n}`:`modules/${e.module}/src/workers/${e.id}-worker-node.ts`),!i){let t=e.version;"latest"===t&&(t=g.x);const r=t?`@${t}`:"";i=`https://unpkg.com/@loaders.gl/${e.module}${r}/dist/${n}`}return(0,o.v)(i),i}(e,r),u=y.getWorkerFarm(r).getWorkerPool({name:a,url:c});r=JSON.parse(JSON.stringify(r)),n=JSON.parse(JSON.stringify(n||{}));const l=await u.startJob("process-on-worker",T.bind(null,i));l.postMessage("process",{input:t,options:r,context:n});const d=await l.result;return await d.result}async function T(e,t,r,n){switch(r){case"done":t.done(n);break;case"error":t.error(new Error(n.error));break;case"process":const{id:i,input:o,options:a}=n;try{const r=await e(o,a);t.postMessage("done",{id:i,result:r})}catch(s){const e=s instanceof Error?s.message:"unknown error";t.postMessage("error",{id:i,error:e})}break;default:b.warn(`parse-with-worker unknown message ${r}`)}}var E=r(9894);var S=r(22858),R=r(88480),D=r(91400),M=r(8001);const w=262144;const I=262144;const G=1048576;var v=r(26951),O=r(53024);function F(e,t){return v.Bd?async function*(e,t){const r=e.getReader();let n;try{for(;;){const e=n||r.read();t?._streamReadAhead&&(n=r.read());const{done:s,value:i}=await e;if(s)return;yield(0,O.XA)(i)}}catch(s){r.releaseLock()}}(e,t):async function*(e){for await(const t of e)yield(0,O.XA)(t)}(e)}function x(e,t){if("string"==typeof e)return function*(e,t){const r=t?.chunkSize||w;let n=0;const s=new TextEncoder;for(;n<e.length;){const t=Math.min(e.length-n,r),i=e.slice(n,n+t);n+=t,yield s.encode(i)}}(e,t);if(e instanceof ArrayBuffer)return function(e,t){return void 0===t&&(t={}),function*(){const{chunkSize:r=I}=t;let n=0;for(;n<e.byteLength;){const t=Math.min(e.byteLength-n,r),s=new ArrayBuffer(t),i=new Uint8Array(e,n,t);new Uint8Array(s).set(i),n+=t,yield s}}()}(e,t);if((0,R.qf)(e))return async function*(e,t){const r=t?.chunkSize||G;let n=0;for(;n<e.size;){const t=n+r,s=await e.slice(n,t).arrayBuffer();n=t,yield s}}(e,t);if((0,R.H1)(e))return F(e,t);if((0,R.Sv)(e)){return F(e.body,t)}throw new Error("makeIterator")}var P=r(45653);const U="Cannot convert supplied data type";async function H(e,t,r){const n=e instanceof ArrayBuffer||ArrayBuffer.isView(e);if("string"==typeof e||n)return function(e,t){if(t.text&&"string"==typeof e)return e;if((0,R.Pe)(e)&&(e=e.buffer),e instanceof ArrayBuffer){const r=e;return t.text&&!t.binary?new TextDecoder("utf8").decode(r):r}if(ArrayBuffer.isView(e)){if(t.text&&!t.binary)return new TextDecoder("utf8").decode(e);let r=e.buffer;const n=e.byteLength||e.length;return 0===e.byteOffset&&n===r.byteLength||(r=r.slice(e.byteOffset,e.byteOffset+n)),r}throw new Error(U)}(e,t);if((0,R.qf)(e)&&(e=await(0,P.wv)(e)),(0,R.Sv)(e)){const r=e;return await(0,P.Mz)(r),t.binary?await r.arrayBuffer():await r.text()}if((0,R.H1)(e)&&(e=x(e,r)),(0,R.xZ)(e)||(0,R.Td)(e))return(0,M.cy)(e);throw new Error(U)}var L=r(92263),N=r(3680),J=r(36970);var j=r(44029),K=r(188);async function V(e,t,r,i){!t||Array.isArray(t)||(0,S.l)(t)||(i=void 0,r=t,t=void 0),e=await e,r=r||{};const a=(0,j.Al)(e),c=function(e,t){if(e&&!Array.isArray(e))return e;let r;if(e&&(r=Array.isArray(e)?e:[e]),t&&t.loaders){const e=Array.isArray(t.loaders)?t.loaders:[t.loaders];r=r?[...r,...e]:e}return r&&r.length?r:void 0}(t,i),u=await(0,K.M)(e,c,r);return u?(i=function(e,t,r){if(r)return r;const n={fetch:(0,L.z)(t,e),...e};if(n.url){const e=(0,N.S3)(n.url);n.baseUrl=e,n.queryString=(0,N.by)(n.url),n.filename=J.iW(e),n.baseUrl=J.pD(e)}return Array.isArray(n.loaders)||(n.loaders=null),n}({url:a,_parse:V,loaders:c},r=(0,D.a5)(r,u,c,a),i||null),await async function(e,t,r,i){if(function(e,t){void 0===t&&(t=E.x),(0,o.v)(e,"no worker provided");const r=e.version}(e),r=(0,n.l)(e.options,r),(0,R.Sv)(t)){const e=t,{ok:r,redirected:n,status:s,statusText:o,type:a,url:c}=e,u=Object.fromEntries(e.headers.entries());i.response={headers:u,ok:r,redirected:n,status:s,statusText:o,type:a,url:c}}t=await H(t,e,r);const a=e;if(a.parseTextSync&&"string"==typeof t)return a.parseTextSync(t,r,i);if(function(e,t){return!!y.isSupported()&&!(!s.Bd&&!t?._nodeWorkers)&&e.worker&&t?.worker}(e,r))return await _(e,t,r,i,V);if(a.parseText&&"string"==typeof t)return await a.parseText(t,r,i);if(a.parse)return await a.parse(t,r,i);throw(0,o.v)(!a.parseSync),new Error(`${e.id} loader - no parser found and worker is disabled`)}(u,e,r,i)):null}},76702:(e,t,r)=>{r.d(t,{Ph:()=>a,mk:()=>o});var n=r(22858),s=r(91400);const i=()=>{const e=(0,s.K2)();return e.loaderRegistry=e.loaderRegistry||[],e.loaderRegistry};function o(e){const t=i();e=Array.isArray(e)?e:[e];for(const r of e){const e=(0,n.D)(r);t.find((t=>e===t))||t.unshift(e)}}function a(){return i()}},188:(e,t,r)=>{r.d(t,{M:()=>h});var n=r(55256),s=r(36970),i=r(95247),o=r(22858),a=r(44029),c=r(95410),u=r(76702),l=r(88480),d=r(3680);const f=/\.([^.]+)$/;async function h(e,t,r,n){if(void 0===t&&(t=[]),!m(e))return null;let s=A(e,t,{...r,nothrow:!0},n);if(s)return s;if((0,l.qf)(e)&&(s=A(e=await e.slice(0,10).arrayBuffer(),t,r,n)),!s&&!r?.nothrow)throw new Error(p(e));return s}function A(e,t,r,s){if(void 0===t&&(t=[]),!m(e))return null;if(t&&!Array.isArray(t))return(0,o.D)(t);let i=[];t&&(i=i.concat(t)),r?.ignoreRegisteredLoaders||i.push(...(0,u.Ph)()),function(e){for(const t of e)(0,o.D)(t)}(i);const c=function(e,t,r,s){const i=(0,a.Al)(e),o=(0,a.z4)(e),c=(0,d.S3)(i)||s?.url;let u=null,l="";r?.mimeType&&(u=B(t,r?.mimeType),l=`match forced by supplied MIME type ${r?.mimeType}`);u=u||function(e,t){const r=t&&f.exec(t),n=r&&r[1];return n?function(e,t){t=t.toLowerCase();for(const r of e)for(const e of r.extensions)if(e.toLowerCase()===t)return r;return null}(e,n):null}(t,c),l=l||(u?`matched url ${c}`:""),u=u||B(t,o),l=l||(u?`matched MIME type ${o}`:""),u=u||function(e,t){if(!t)return null;for(const r of e)if("string"==typeof t){if(C(t,r))return r}else if(ArrayBuffer.isView(t)){if(y(t.buffer,t.byteOffset,r))return r}else if(t instanceof ArrayBuffer){if(y(t,0,r))return r}return null}(t,e),l=l||(u?`matched initial data ${g(e)}`:""),r?.fallbackMimeType&&(u=u||B(t,r?.fallbackMimeType),l=l||(u?`matched fallback MIME type ${o}`:""));l&&n.R.log(1,`selectLoader selected ${u?.name}: ${l}.`);return u}(e,i,r,s);if(!c&&!r?.nothrow)throw new Error(p(e));return c}function m(e){return!(e instanceof Response&&204===e.status)}function p(e){const t=(0,a.Al)(e),r=(0,a.z4)(e);let n="No valid loader found (";n+=t?`${s.iW(t)}, `:"no url provided, ",n+=`MIME type: ${r?`"${r}"`:"not provided"}, `;const i=e?g(e):"";return n+=i?` first bytes: "${i}"`:"first bytes: not available",n+=")",n}function B(e,t){for(const r of e){if(r.mimeTypes?.some((e=>(0,c.JQ)(t,e))))return r;if((0,c.JQ)(t,`application/x.${r.id}`))return r}return null}function C(e,t){if(t.testText)return t.testText(e);return(Array.isArray(t.tests)?t.tests:[t.tests]).some((t=>e.startsWith(t)))}function y(e,t,r){return(Array.isArray(r.tests)?r.tests:[r.tests]).some((r=>function(e,t,r,n){if(n instanceof ArrayBuffer)return(0,i.YV)(n,e,n.byteLength);switch(typeof n){case"function":return n(e);case"string":return n===b(e,t,n.length);default:return!1}}(e,t,0,r)))}function g(e,t){if(void 0===t&&(t=5),"string"==typeof e)return e.slice(0,t);if(ArrayBuffer.isView(e))return b(e.buffer,e.byteOffset,t);if(e instanceof ArrayBuffer){return b(e,0,t)}return""}function b(e,t,r){if(e.byteLength<t+r)return"";const n=new DataView(e);let s="";for(let i=0;i<r;i++)s+=String.fromCharCode(n.getUint8(t+i));return s}},44207:(e,t,r)=>{r.d(t,{t2:()=>i});var n=r(29512),s=r(45653);async function i(e,t){if("string"==typeof e){const r=(0,n.o1)(e);return function(e){return!function(e){return e.startsWith("http:")||e.startsWith("https:")}(e)&&!function(e){return e.startsWith("data:")}(e)}(r)&&globalThis.loaders?.fetchNode?globalThis.loaders?.fetchNode(r,t):await fetch(r,t)}return await(0,s.wv)(e)}},92263:(e,t,r)=>{r.d(t,{z:()=>o});var n=r(88480),s=r(44207),i=r(91400);function o(e,t){const r=(0,i.pp)(),o=e||r;return"function"==typeof o.fetch?o.fetch:(0,n.Gv)(o.fetch)?e=>(0,s.t2)(e,o.fetch):t?.fetch?t?.fetch:s.t2}},22858:(e,t,r)=>{r.d(t,{D:()=>i,l:()=>s});var n=r(10981);function s(e){if(!e)return!1;Array.isArray(e)&&(e=e[0]);return Array.isArray(e?.extensions)}function i(e){let t;return(0,n.v)(e,"null loader"),(0,n.v)(s(e),"invalid loader"),Array.isArray(e)&&(t=e[1],e=e[0],e={...e,options:{...e.options,...t}}),(e?.parseTextSync||e?.parseText)&&(e.text=!0),e.text||(e.binary=!0),e}},91400:(e,t,r)=>{r.d(t,{pp:()=>f,K2:()=>d,a5:()=>h});var n=r(88480),s=r(35593),i=r(80247);const o=new s.t({id:"loaders.gl"});class a{log(){return()=>{}}info(){return()=>{}}warn(){return()=>{}}error(){return()=>{}}}var c=r(26951);const u={fetch:null,mimeType:void 0,nothrow:!1,log:new class{constructor(){this.console=i}log(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];return this.console.log.bind(this.console,...t)}info(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];return this.console.info.bind(this.console,...t)}warn(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];return this.console.warn.bind(this.console,...t)}error(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];return this.console.error.bind(this.console,...t)}},useLocalLibraries:!1,CDN:"https://unpkg.com/@loaders.gl",worker:!0,maxConcurrency:3,maxMobileConcurrency:1,reuseWorkers:c.Bd,_nodeWorkers:!1,_workerType:"",limit:0,_limitMB:0,batchSize:"auto",batchDebounceMs:0,metadata:!1,transforms:[]},l={throws:"nothrow",dataType:"(no longer used)",uri:"baseUri",method:"fetch.method",headers:"fetch.headers",body:"fetch.body",mode:"fetch.mode",credentials:"fetch.credentials",cache:"fetch.cache",redirect:"fetch.redirect",referrer:"fetch.referrer",referrerPolicy:"fetch.referrerPolicy",integrity:"fetch.integrity",keepalive:"fetch.keepalive",signal:"fetch.signal"};function d(){globalThis.loaders=globalThis.loaders||{};const{loaders:e}=globalThis;return e._state||(e._state={}),e._state}function f(){const e=d();return e.globalOptions=e.globalOptions||{...u},e.globalOptions}function h(e,t,r,n){return r=r||[],function(e,t){A(e,null,u,l,t);for(const r of t){const n=e&&e[r.id]||{},s=r.options&&r.options[r.id]||{},i=r.deprecatedOptions&&r.deprecatedOptions[r.id]||{};A(n,r.id,s,i,t)}}(e,r=Array.isArray(r)?r:[r]),p(t,e,n)}function A(e,t,r,s,i){const a=t||"Top level",c=t?`${t}.`:"";for(const u in e){const l=!t&&(0,n.Gv)(e[u]);if(!(u in r)&&!("baseUri"===u&&!t)&&!("workerUrl"===u&&t))if(u in s)o.warn(`${a} loader option '${c}${u}' no longer supported, use '${s[u]}'`)();else if(!l){const e=m(u,i);o.warn(`${a} loader option '${c}${u}' not recognized. ${e}`)()}}}function m(e,t){const r=e.toLowerCase();let n="";for(const s of t)for(const t in s.options){if(e===t)return`Did you mean '${s.id}.${t}'?`;const i=t.toLowerCase();(r.startsWith(i)||i.startsWith(r))&&(n=n||`Did you mean '${s.id}.${t}'?`)}return n}function p(e,t,r){const n={...e.options||{}};return function(e,t){t&&!("baseUri"in e)&&(e.baseUri=t)}(n,r),null===n.log&&(n.log=new a),B(n,f()),B(n,t),n}function B(e,t){for(const r in t)if(r in t){const s=t[r];(0,n.aC)(s)&&(0,n.aC)(e[r])?e[r]={...e[r],...t[r]}:e[r]=t[r]}}},95410:(e,t,r)=>{r.d(t,{JQ:()=>i,OA:()=>o,d_:()=>a});const n=/^data:([-\w.]+\/[-\w.+]+)(;|,)/,s=/^([-\w.]+\/[-\w.+]+)/;function i(e,t){return e.toLowerCase()===t.toLowerCase()}function o(e){const t=s.exec(e);return t?t[1]:e}function a(e){const t=n.exec(e);return t?t[1]:""}},44029:(e,t,r)=>{r.d(t,{Al:()=>o,_E:()=>c,z4:()=>a});var n=r(88480),s=r(95410),i=r(3680);function o(e){if((0,n.Sv)(e)){return e.url}if((0,n.qf)(e)){return e.name||""}return"string"==typeof e?e:""}function a(e){if((0,n.Sv)(e)){const t=e,r=t.headers.get("content-type")||"",n=(0,i.S3)(t.url);return(0,s.OA)(r)||(0,s.d_)(n)}if((0,n.qf)(e)){return e.type||""}return"string"==typeof e?(0,s.d_)(e):""}function c(e){if((0,n.Sv)(e)){return e.headers["content-length"]||-1}if((0,n.qf)(e)){return e.size}return"string"==typeof e?e.length:e instanceof ArrayBuffer||ArrayBuffer.isView(e)?e.byteLength:-1}},45653:(e,t,r)=>{r.d(t,{Mz:()=>c,wv:()=>a});var n=r(88480);class s extends Error{constructor(e,t){super(e),this.reason=t.reason,this.url=t.url,this.response=t.response}}var i=r(44029),o=r(3680);async function a(e){if((0,n.Sv)(e))return e;const t={},r=(0,i._E)(e);r>=0&&(t["content-length"]=String(r));const s=(0,i.Al)(e),o=(0,i.z4)(e);o&&(t["content-type"]=o);const a=await async function(e){const t=5;if("string"==typeof e)return`data:,${e.slice(0,t)}`;if(e instanceof Blob){const t=e.slice(0,5);return await new Promise((e=>{const r=new FileReader;r.onload=t=>e(t?.target?.result),r.readAsDataURL(t)}))}if(e instanceof ArrayBuffer){return`data:base64,${function(e){let t="";const r=new Uint8Array(e);for(let n=0;n<r.byteLength;n++)t+=String.fromCharCode(r[n]);return btoa(t)}(e.slice(0,t))}`}return null}(e);a&&(t["x-first-bytes"]=a),"string"==typeof e&&(e=(new TextEncoder).encode(e));const c=new Response(e,{headers:t});return Object.defineProperty(c,"url",{value:s}),c}async function c(e){if(!e.ok){const t=await async function(e){const r=(0,o.E1)(e.url);let n=`Failed to fetch resource (${e.status}) ${e.statusText}: ${r}`;n=n.length>100?`${n.slice(0,100)}...`:n;const i={reason:e.statusText,url:e.url,response:e};try{const t=e.headers.get("Content-Type");i.reason=!e.bodyUsed&&t?.includes("application/json")?await e.json():await e.text()}catch(t){}return new s(n,i)}(e);throw t}}},3680:(e,t,r)=>{r.d(t,{E1:()=>o,S3:()=>i,by:()=>s});const n=/\?.*/;function s(e){const t=e.match(n);return t&&t[0]}function i(e){return e.replace(n,"")}function o(e){if(e.length<50)return e;const t=e.slice(e.length-15);return`${e.substr(0,32)}...${t}`}},73719:(e,t,r)=>{r.d(t,{Vl:()=>_});const n="undefined"!=typeof __VERSION__?__VERSION__:"latest",s={dataType:null,batchType:null,name:"Draco",id:"draco",module:"draco",version:n,worker:!0,extensions:["drc"],mimeTypes:["application/octet-stream"],binary:!0,tests:["DRACO"],options:{draco:{decoderType:"object"==typeof WebAssembly?"wasm":"js",libraryPath:"libs/",extraAttributes:{},attributeNameEntry:void 0}}};var i=r(95220),o=r(71747);function a(e,t,r){const n=r?c(r.metadata):void 0;return(0,o.ol)(e,t,n)}function c(e){Object.entries(e);const t={};for(const r in e)t[`${r}.string`]=JSON.stringify(e[r]);return t}var u=r(80247);const l={POSITION:"POSITION",NORMAL:"NORMAL",COLOR:"COLOR_0",TEX_COORD:"TEXCOORD_0"},d={1:Int8Array,2:Uint8Array,3:Int16Array,4:Uint16Array,5:Int32Array,6:Uint32Array,9:Float32Array};class f{constructor(e){this.draco=e,this.decoder=new this.draco.Decoder,this.metadataQuerier=new this.draco.MetadataQuerier}destroy(){this.draco.destroy(this.decoder),this.draco.destroy(this.metadataQuerier)}parseSync(e,t){void 0===t&&(t={});const r=new this.draco.DecoderBuffer;r.Init(new Int8Array(e),e.byteLength),this._disableAttributeTransforms(t);const n=this.decoder.GetEncodedGeometryType(r),s=n===this.draco.TRIANGULAR_MESH?new this.draco.Mesh:new this.draco.PointCloud;try{let e;switch(n){case this.draco.TRIANGULAR_MESH:e=this.decoder.DecodeBufferToMesh(r,s);break;case this.draco.POINT_CLOUD:e=this.decoder.DecodeBufferToPointCloud(r,s);break;default:throw new Error("DRACO: Unknown geometry type.")}if(!e.ok()||!s.ptr){const t=`DRACO decompression failed: ${e.error_msg()}`;throw new Error(t)}const o=this._getDracoLoaderData(s,n,t),u=this._getMeshData(s,o,t),l=(0,i.l)(u.attributes),d=function(e,t,r){const n=c(t.metadata),s=[],i=function(e){const t={};for(const r in e){const n=e[r];t[n.name||"undefined"]=n}return t}(t.attributes);for(const o in e){const t=a(o,e[o],i[o]);s.push(t)}if(r){const e=a("indices",r);s.push(e)}return{fields:s,metadata:n}}(u.attributes,o,u.indices);return{loader:"draco",loaderData:o,header:{vertexCount:s.num_points(),boundingBox:l},...u,schema:d}}finally{this.draco.destroy(r),s&&this.draco.destroy(s)}}_getDracoLoaderData(e,t,r){const n=this._getTopLevelMetadata(e),s=this._getDracoAttributes(e,r);return{geometry_type:t,num_attributes:e.num_attributes(),num_points:e.num_points(),num_faces:e instanceof this.draco.Mesh?e.num_faces():0,metadata:n,attributes:s}}_getDracoAttributes(e,t){const r={};for(let n=0;n<e.num_attributes();n++){const s=this.decoder.GetAttribute(e,n),i=this._getAttributeMetadata(e,n);r[s.unique_id()]={unique_id:s.unique_id(),attribute_type:s.attribute_type(),data_type:s.data_type(),num_components:s.num_components(),byte_offset:s.byte_offset(),byte_stride:s.byte_stride(),normalized:s.normalized(),attribute_index:n,metadata:i};const o=this._getQuantizationTransform(s,t);o&&(r[s.unique_id()].quantization_transform=o);const a=this._getOctahedronTransform(s,t);a&&(r[s.unique_id()].octahedron_transform=a)}return r}_getMeshData(e,t,r){const n=this._getMeshAttributes(t,e,r);if(!n.POSITION)throw new Error("DRACO: No position attribute found.");return e instanceof this.draco.Mesh?"triangle-strip"===r.topology?{topology:"triangle-strip",mode:4,attributes:n,indices:{value:this._getTriangleStripIndices(e),size:1}}:{topology:"triangle-list",mode:5,attributes:n,indices:{value:this._getTriangleListIndices(e),size:1}}:{topology:"point-list",mode:0,attributes:n}}_getMeshAttributes(e,t,r){const n={};for(const s of Object.values(e.attributes)){const e=this._deduceAttributeName(s,r);s.name=e;const i=this._getAttributeValues(t,s);if(i){const{value:t,size:r}=i;n[e]={value:t,size:r,byteOffset:s.byte_offset,byteStride:s.byte_stride,normalized:s.normalized}}}return n}_getTriangleListIndices(e){const t=3*e.num_faces(),r=4*t,n=this.draco._malloc(r);try{return this.decoder.GetTrianglesUInt32Array(e,r,n),new Uint32Array(this.draco.HEAPF32.buffer,n,t).slice()}finally{this.draco._free(n)}}_getTriangleStripIndices(e){const t=new this.draco.DracoInt32Array;try{return this.decoder.GetTriangleStripsFromMesh(e,t),function(e){const t=e.size(),r=new Int32Array(t);for(let n=0;n<t;n++)r[n]=e.GetValue(n);return r}(t)}finally{this.draco.destroy(t)}}_getAttributeValues(e,t){const r=d[t.data_type];if(!r)return u.warn(`DRACO: Unsupported attribute type ${t.data_type}`),null;const n=t.num_components,s=e.num_points()*n,i=s*r.BYTES_PER_ELEMENT,o=function(e,t){switch(t){case Float32Array:return e.DT_FLOAT32;case Int8Array:return e.DT_INT8;case Int16Array:return e.DT_INT16;case Int32Array:return e.DT_INT32;case Uint8Array:return e.DT_UINT8;case Uint16Array:return e.DT_UINT16;case Uint32Array:return e.DT_UINT32;default:return e.DT_INVALID}}(this.draco,r);let a;const c=this.draco._malloc(i);try{const n=this.decoder.GetAttribute(e,t.attribute_index);this.decoder.GetAttributeDataArrayForAllPoints(e,n,o,i,c),a=new r(this.draco.HEAPF32.buffer,c,s).slice()}finally{this.draco._free(c)}return{value:a,size:n}}_deduceAttributeName(e,t){const r=e.unique_id;for(const[i,o]of Object.entries(t.extraAttributes||{}))if(o===r)return i;const n=e.attribute_type;for(const i in l){if(this.draco[i]===n)return l[i]}const s=t.attributeNameEntry||"name";return e.metadata[s]?e.metadata[s].string:`CUSTOM_ATTRIBUTE_${r}`}_getTopLevelMetadata(e){const t=this.decoder.GetMetadata(e);return this._getDracoMetadata(t)}_getAttributeMetadata(e,t){const r=this.decoder.GetAttributeMetadata(e,t);return this._getDracoMetadata(r)}_getDracoMetadata(e){if(!e||!e.ptr)return{};const t={},r=this.metadataQuerier.NumEntries(e);for(let n=0;n<r;n++){const r=this.metadataQuerier.GetEntryName(e,n);t[r]=this._getDracoMetadataField(e,r)}return t}_getDracoMetadataField(e,t){const r=new this.draco.DracoInt32Array;try{this.metadataQuerier.GetIntEntryArray(e,t,r);const n=function(e){const t=e.size(),r=new Int32Array(t);for(let n=0;n<t;n++)r[n]=e.GetValue(n);return r}(r);return{int:this.metadataQuerier.GetIntEntry(e,t),string:this.metadataQuerier.GetStringEntry(e,t),double:this.metadataQuerier.GetDoubleEntry(e,t),intArray:n}}finally{this.draco.destroy(r)}}_disableAttributeTransforms(e){const{quantizedAttributes:t=[],octahedronAttributes:r=[]}=e,n=[...t,...r];for(const s of n)this.decoder.SkipAttributeTransform(this.draco[s])}_getQuantizationTransform(e,t){const{quantizedAttributes:r=[]}=t,n=e.attribute_type();if(r.map((e=>this.decoder[e])).includes(n)){const t=new this.draco.AttributeQuantizationTransform;try{if(t.InitFromAttribute(e))return{quantization_bits:t.quantization_bits(),range:t.range(),min_values:new Float32Array([1,2,3]).map((e=>t.min_value(e)))}}finally{this.draco.destroy(t)}}return null}_getOctahedronTransform(e,t){const{octahedronAttributes:r=[]}=t,n=e.attribute_type();if(r.map((e=>this.decoder[e])).includes(n)){const t=new this.draco.AttributeQuantizationTransform;try{if(t.InitFromAttribute(e))return{quantization_bits:t.quantization_bits()}}finally{this.draco.destroy(t)}}return null}}var h=r(8821);const A="https://www.gstatic.com/draco/versioned/decoders/1.5.6",m="draco_wasm_wrapper.js",p="draco_decoder.wasm",B="draco_decoder.js",C="draco_encoder.js",y={[m]:`${A}/${m}`,[p]:`${A}/${p}`,[B]:`${A}/${B}`,[C]:`https://raw.githubusercontent.com/google/draco/1.4.1/javascript/${C}`};let g;async function b(e){const t=e.modules||{};return t.draco3d?g||=t.draco3d.createDecoderModule({}).then((e=>({draco:e}))):g||=async function(e){let t,r;if("js"===(e.draco&&e.draco.decoderType))t=await(0,h._)(y[B],"draco",e,B);else[t,r]=await Promise.all([await(0,h._)(y[m],"draco",e,m),await(0,h._)(y[p],"draco",e,p)]);return t=t||globalThis.DracoDecoderModule,await function(e,t){const r={};t&&(r.wasmBinary=t);return new Promise((t=>{e({...r,onModuleLoaded:e=>t({draco:e})})}))}(t,r)}(e),await g}const _={...s,parse:async function(e,t){const{draco:r}=await b(t),n=new f(r);try{return n.parseSync(e,t?.draco)}finally{n.destroy()}}}},44818:(e,t,r)=>{r.d(t,{B:()=>Xt});var n={};r.r(n),r.d(n,{createExtMeshFeatures:()=>ne,decode:()=>ee,encode:()=>te,name:()=>$});var s={};r.r(s),r.d(s,{createExtStructuralMetadata:()=>Ce,decode:()=>ae,encode:()=>ce,name:()=>oe});var i={};r.r(i),r.d(i,{decode:()=>Fe,name:()=>Oe});var o={};r.r(o),r.d(o,{name:()=>Je,preprocess:()=>je});var a={};r.r(a),r.d(a,{name:()=>Ve,preprocess:()=>ke});var c={};r.r(c),r.d(c,{decode:()=>qe,encode:()=>Ze,name:()=>Ye,preprocess:()=>We});var u={};r.r(u),r.d(u,{decode:()=>lt,name:()=>ot});var l={};r.r(l),r.d(l,{decode:()=>pt,encode:()=>Bt,name:()=>mt});var d={};r.r(d),r.d(d,{decode:()=>gt,encode:()=>bt,name:()=>yt});var f={};r.r(f),r.d(f,{decode:()=>Et,encode:()=>St,name:()=>Tt});var h={};r.r(h),r.d(h,{decode:()=>wt,name:()=>Mt});const A="undefined"!=typeof __VERSION__?__VERSION__:"latest";function m(e,t,r){if(e.byteLength<=t+r)return"";const n=new DataView(e);let s="";for(let i=0;i<r;i++)s+=String.fromCharCode(n.getUint8(t+i));return s}function p(e){try{return JSON.parse(e)}catch(t){throw new Error(`Failed to parse JSON from data starting with "${function(e,t){if(void 0===t&&(t=5),"string"==typeof e)return e.slice(0,t);if(ArrayBuffer.isView(e))return m(e.buffer,e.byteOffset,t);if(e instanceof ArrayBuffer)return m(e,0,t);return""}(e)}"`)}}var B=r(95247),C=r(66160),y=r(83073),g=r(22120),b=r(61594),_=r(80349),T=r(10981);function E(e,t){return(0,T.v)(e>=0),(0,T.v)(t>0),e+(t-1)&~(t-1)}function S(e,t,r){let n;if(e instanceof ArrayBuffer)n=new Uint8Array(e);else{const t=e.byteOffset,r=e.byteLength;n=new Uint8Array(e.buffer||e.arrayBuffer,t,r)}return t.set(n,r),r+E(n.byteLength,4)}const R=!0,D=1735152710,M=1313821514,w=5130562;function I(e,t,r,n){void 0===r&&(r=0),void 0===n&&(n={});const s=new DataView(t),i=function(e,t){return void 0===t&&(t=0),`${String.fromCharCode(e.getUint8(t+0))}${String.fromCharCode(e.getUint8(t+1))}${String.fromCharCode(e.getUint8(t+2))}${String.fromCharCode(e.getUint8(t+3))}`}(s,r+0),o=s.getUint32(r+4,R),a=s.getUint32(r+8,R);switch(Object.assign(e,{header:{byteOffset:r,byteLength:a,hasBinChunk:!1},type:i,version:o,json:{},binChunks:[]}),r+=12,e.version){case 1:return function(e,t,r){(0,T.v)(e.header.byteLength>20);const n=t.getUint32(r+0,R),s=t.getUint32(r+4,R);return r+=8,(0,T.v)(0===s),G(e,t,r,n),r+=n,r+=v(e,t,r,e.header.byteLength),r}(e,s,r);case 2:return function(e,t,r,n){return(0,T.v)(e.header.byteLength>20),function(e,t,r,n){for(;r+8<=e.header.byteLength;){const s=t.getUint32(r+0,R),i=t.getUint32(r+4,R);switch(r+=8,i){case M:G(e,t,r,s);break;case w:v(e,t,r,s);break;case 0:n.strict||G(e,t,r,s);break;case 1:n.strict||v(e,t,r,s)}r+=E(s,4)}}(e,t,r,n),r+e.header.byteLength}(e,s,r,n={});default:throw new Error(`Invalid GLB version ${e.version}. Only supports version 1 and 2.`)}}function G(e,t,r,n){const s=new Uint8Array(t.buffer,r,n),i=new TextDecoder("utf8").decode(s);return e.json=JSON.parse(i),E(n,4)}function v(e,t,r,n){return e.header.hasBinChunk=!0,e.binChunks.push({byteOffset:r,byteLength:n,arrayBuffer:t.buffer}),E(n,4)}function O(e,t){if(e.startsWith("data:")||e.startsWith("http:")||e.startsWith("https:"))return e;const r=t.baseUri||t.uri;if(!r)throw new Error(`'baseUri' must be provided to resolve relative url ${e}`);return r.substr(0,r.lastIndexOf("/")+1)+e}var F=r(45782);function x(e,t,r){const n=e.bufferViews[r];(0,_.v)(n);const s=t[n.buffer];(0,_.v)(s);const i=(n.byteOffset||0)+s.byteOffset;return new Uint8Array(s.arrayBuffer,i,n.byteLength)}var P=r(69186);class U{constructor(e){this.gltf={json:e?.json||{asset:{version:"2.0",generator:"loaders.gl"},buffers:[],extensions:{},extensionsRequired:[],extensionsUsed:[]},buffers:e?.buffers||[],images:e?.images||[]},this.sourceBuffers=[],this.byteLength=0,this.gltf.buffers&&this.gltf.buffers[0]&&(this.byteLength=this.gltf.buffers[0].byteLength,this.sourceBuffers=[this.gltf.buffers[0]])}get json(){return this.gltf.json}getApplicationData(e){return this.json[e]}getExtraData(e){return(this.json.extras||{})[e]}hasExtension(e){const t=this.getUsedExtensions().find((t=>t===e)),r=this.getRequiredExtensions().find((t=>t===e));return"string"==typeof t||"string"==typeof r}getExtension(e){const t=this.getUsedExtensions().find((t=>t===e)),r=this.json.extensions||{};return t?r[e]:null}getRequiredExtension(e){return this.getRequiredExtensions().find((t=>t===e))?this.getExtension(e):null}getRequiredExtensions(){return this.json.extensionsRequired||[]}getUsedExtensions(){return this.json.extensionsUsed||[]}getRemovedExtensions(){return this.json.extensionsRemoved||[]}getObjectExtension(e,t){return(e.extensions||{})[t]}getScene(e){return this.getObject("scenes",e)}getNode(e){return this.getObject("nodes",e)}getSkin(e){return this.getObject("skins",e)}getMesh(e){return this.getObject("meshes",e)}getMaterial(e){return this.getObject("materials",e)}getAccessor(e){return this.getObject("accessors",e)}getTexture(e){return this.getObject("textures",e)}getSampler(e){return this.getObject("samplers",e)}getImage(e){return this.getObject("images",e)}getBufferView(e){return this.getObject("bufferViews",e)}getBuffer(e){return this.getObject("buffers",e)}getObject(e,t){if("object"==typeof t)return t;const r=this.json[e]&&this.json[e][t];if(!r)throw new Error(`glTF file error: Could not find ${e}[${t}]`);return r}getTypedArrayForBufferView(e){const t=(e=this.getBufferView(e)).buffer,r=this.gltf.buffers[t];(0,_.v)(r);const n=(e.byteOffset||0)+r.byteOffset;return new Uint8Array(r.arrayBuffer,n,e.byteLength)}getTypedArrayForAccessor(e){const t=this.getAccessor(e);return function(e,t,r){const n="number"==typeof r?e.accessors?.[r]:r;if(!n)throw new Error(`No gltf accessor ${JSON.stringify(r)}`);const s=e.bufferViews?.[n.bufferView||0];if(!s)throw new Error(`No gltf buffer view for accessor ${s}`);const{arrayBuffer:i,byteOffset:o}=t[s.buffer],a=(o||0)+(n.byteOffset||0)+(s.byteOffset||0),{ArrayType:c,length:u,componentByteSize:l,numberOfComponentsInElement:d}=(0,F.aF)(n,s),f=l*d,h=s.byteStride||f;if(void 0===s.byteStride||s.byteStride===f)return new c(i,a,u);const A=new c(u);for(let m=0;m<n.count;m++){const e=new c(i,a+m*h,d);A.set(e,m*d)}return A}(this.gltf.json,this.gltf.buffers,t)}getTypedArrayForImageData(e){e=this.getAccessor(e);const t=this.getBufferView(e.bufferView),r=this.getBuffer(t.buffer).data,n=t.byteOffset||0;return new Uint8Array(r,n,t.byteLength)}addApplicationData(e,t){return this.json[e]=t,this}addExtraData(e,t){return this.json.extras=this.json.extras||{},this.json.extras[e]=t,this}addObjectExtension(e,t,r){return e.extensions=e.extensions||{},e.extensions[t]=r,this.registerUsedExtension(t),this}setObjectExtension(e,t,r){(e.extensions||{})[t]=r}removeObjectExtension(e,t){const r=e?.extensions||{};if(r[t]){this.json.extensionsRemoved=this.json.extensionsRemoved||[];const e=this.json.extensionsRemoved;e.includes(t)||e.push(t)}delete r[t]}addExtension(e,t){return void 0===t&&(t={}),(0,_.v)(t),this.json.extensions=this.json.extensions||{},this.json.extensions[e]=t,this.registerUsedExtension(e),t}addRequiredExtension(e,t){return void 0===t&&(t={}),(0,_.v)(t),this.addExtension(e,t),this.registerRequiredExtension(e),t}registerUsedExtension(e){this.json.extensionsUsed=this.json.extensionsUsed||[],this.json.extensionsUsed.find((t=>t===e))||this.json.extensionsUsed.push(e)}registerRequiredExtension(e){this.registerUsedExtension(e),this.json.extensionsRequired=this.json.extensionsRequired||[],this.json.extensionsRequired.find((t=>t===e))||this.json.extensionsRequired.push(e)}removeExtension(e){if(this.json.extensions?.[e]){this.json.extensionsRemoved=this.json.extensionsRemoved||[];const t=this.json.extensionsRemoved;t.includes(e)||t.push(e)}this.json.extensions&&delete this.json.extensions[e],this.json.extensionsRequired&&this._removeStringFromArray(this.json.extensionsRequired,e),this.json.extensionsUsed&&this._removeStringFromArray(this.json.extensionsUsed,e)}setDefaultScene(e){this.json.scene=e}addScene(e){const{nodeIndices:t}=e;return this.json.scenes=this.json.scenes||[],this.json.scenes.push({nodes:t}),this.json.scenes.length-1}addNode(e){const{meshIndex:t,matrix:r}=e;this.json.nodes=this.json.nodes||[];const n={mesh:t};return r&&(n.matrix=r),this.json.nodes.push(n),this.json.nodes.length-1}addMesh(e){const{attributes:t,indices:r,material:n,mode:s=4}=e,i={primitives:[{attributes:this._addAttributes(t),mode:s}]};if(r){const e=this._addIndices(r);i.primitives[0].indices=e}return Number.isFinite(n)&&(i.primitives[0].material=n),this.json.meshes=this.json.meshes||[],this.json.meshes.push(i),this.json.meshes.length-1}addPointCloud(e){const t={primitives:[{attributes:this._addAttributes(e),mode:0}]};return this.json.meshes=this.json.meshes||[],this.json.meshes.push(t),this.json.meshes.length-1}addImage(e,t){const r=(0,P.m)(e),n=t||r?.mimeType,s={bufferView:this.addBufferView(e),mimeType:n};return this.json.images=this.json.images||[],this.json.images.push(s),this.json.images.length-1}addBufferView(e,t,r){void 0===t&&(t=0),void 0===r&&(r=this.byteLength);const n=e.byteLength;(0,_.v)(Number.isFinite(n)),this.sourceBuffers=this.sourceBuffers||[],this.sourceBuffers.push(e);const s={buffer:t,byteOffset:r,byteLength:n};return this.byteLength+=E(n,4),this.json.bufferViews=this.json.bufferViews||[],this.json.bufferViews.push(s),this.json.bufferViews.length-1}addAccessor(e,t){const r={bufferView:e,type:(0,F.v7)(t.size),componentType:t.componentType,count:t.count,max:t.max,min:t.min};return this.json.accessors=this.json.accessors||[],this.json.accessors.push(r),this.json.accessors.length-1}addBinaryBuffer(e,t){void 0===t&&(t={size:3});const r=this.addBufferView(e);let n={min:t.min,max:t.max};n.min&&n.max||(n=this._getAccessorMinMax(e,t.size));const s={size:t.size,componentType:(0,F.rA)(e),count:Math.round(e.length/t.size),min:n.min,max:n.max};return this.addAccessor(r,Object.assign(s,t))}addTexture(e){const{imageIndex:t}=e,r={source:t};return this.json.textures=this.json.textures||[],this.json.textures.push(r),this.json.textures.length-1}addMaterial(e){return this.json.materials=this.json.materials||[],this.json.materials.push(e),this.json.materials.length-1}createBinaryChunk(){const e=this.byteLength,t=new ArrayBuffer(e),r=new Uint8Array(t);let n=0;for(const s of this.sourceBuffers||[])n=S(s,r,n);this.json?.buffers?.[0]?this.json.buffers[0].byteLength=e:this.json.buffers=[{byteLength:e}],this.gltf.binary=t,this.sourceBuffers=[t],this.gltf.buffers=[{arrayBuffer:t,byteOffset:0,byteLength:t.byteLength}]}_removeStringFromArray(e,t){let r=!0;for(;r;){const n=e.indexOf(t);n>-1?e.splice(n,1):r=!1}}_addAttributes(e){void 0===e&&(e={});const t={};for(const r in e){const n=e[r],s=this._getGltfAttributeName(r),i=this.addBinaryBuffer(n.value,n);t[s]=i}return t}_addIndices(e){return this.addBinaryBuffer(e,{size:1})}_getGltfAttributeName(e){switch(e.toLowerCase()){case"position":case"positions":case"vertices":return"POSITION";case"normal":case"normals":return"NORMAL";case"color":case"colors":return"COLOR_0";case"texcoord":case"texcoords":return"TEXCOORD_0";default:return e}}_getAccessorMinMax(e,t){const r={min:null,max:null};if(e.length<t)return r;r.min=[],r.max=[];const n=e.subarray(0,t);for(const s of n)r.min.push(s),r.max.push(s);for(let s=t;s<e.length;s+=t)for(let n=0;n<t;n++)r.min[0+n]=Math.min(r.min[0+n],e[s+n]),r.max[0+n]=Math.max(r.max[0+n],e[s+n]);return r}}var H=r(47216);function L(e){return(e%1+1)%1}const N={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16,BOOLEAN:1,STRING:1,ENUM:1},J={INT8:Int8Array,UINT8:Uint8Array,INT16:Int16Array,UINT16:Uint16Array,INT32:Int32Array,UINT32:Uint32Array,INT64:BigInt64Array,UINT64:BigUint64Array,FLOAT32:Float32Array,FLOAT64:Float64Array},j={INT8:1,UINT8:1,INT16:2,UINT16:2,INT32:4,UINT32:4,INT64:8,UINT64:8,FLOAT32:4,FLOAT64:8};function K(e,t){return j[t]*N[e]}function V(e,t,r,n){if("UINT8"!==r&&"UINT16"!==r&&"UINT32"!==r&&"UINT64"!==r)return null;const s=k(e.getTypedArrayForBufferView(t),"SCALAR",r,n+1);return s instanceof BigInt64Array||s instanceof BigUint64Array?null:s}function k(e,t,r,n){void 0===n&&(n=1);const s=N[t],i=J[r],o=j[r],a=n*s,c=a*o;let u=e.buffer,l=e.byteOffset;if(l%o!=0){u=new Uint8Array(u).slice(l,l+c).buffer,l=0}return new i(u,l,a)}function X(e,t,r){const n=`TEXCOORD_${t.texCoord||0}`,s=r.attributes[n],i=e.getTypedArrayForAccessor(s),o=e.gltf.json,a=t.index,c=o.textures?.[a]?.source;if(void 0!==c){const r=o.images?.[c]?.mimeType,n=e.gltf.images?.[c];if(n&&void 0!==n.width){const e=[];for(let s=0;s<i.length;s+=2){const o=z(n,r,i,s,t.channels);e.push(o)}return e}}return[]}function Q(e,t,r,n,s){if(!r?.length)return;const i=[];for(const l of r){let e=n.findIndex((e=>e===l));-1===e&&(e=n.push(l)-1),i.push(e)}const o=new Uint32Array(i),a=e.gltf.buffers.push({arrayBuffer:o.buffer,byteOffset:o.byteOffset,byteLength:o.byteLength})-1,c=e.addBufferView(o,a,0),u=e.addAccessor(c,{size:1,componentType:(0,F.rA)(o),count:o.length});s.attributes[t]=u}function z(e,t,r,n,s){void 0===s&&(s=[0]);const i={r:{offset:0,shift:0},g:{offset:1,shift:8},b:{offset:2,shift:16},a:{offset:3,shift:24}},o=r[n],a=r[n+1];let c=1;!t||-1===t.indexOf("image/jpeg")&&-1===t.indexOf("image/png")||(c=4);const u=function(e,t,r,n){void 0===n&&(n=1);const s=r.width,i=L(e)*(s-1),o=Math.round(i),a=r.height,c=L(t)*(a-1),u=Math.round(c),l=r.components?r.components:n,d=(u*s+o)*l;return d}(o,a,e,c);let l=0;for(const d of s){const t="number"==typeof d?Object.values(i)[d]:i[d],r=u+t.offset,n=(0,H.M5)(e);if(n.data.length<=r)throw new Error(`${n.data.length} <= ${r}`);l|=n.data[r]<<t.shift}return l}function Y(e,t,r,n,s){const i=[];for(let o=0;o<t;o++){const t=r[o],a=r[o+1]-r[o];if(a+t>n)break;const c=t/s,u=a/s;i.push(e.slice(c,c+u))}return i}function W(e,t,r){const n=[];for(let s=0;s<t;s++){const t=s*r;n.push(e.slice(t,t+r))}return n}function q(e,t,r,n){if(r)throw new Error("Not implemented - arrayOffsets for strings is specified");if(n){const r=[],s=new TextDecoder("utf8");let i=0;for(let o=0;o<e;o++){const e=n[o+1]-n[o];if(e+i<=t.length){const n=t.subarray(i,e+i),o=s.decode(n);r.push(o),i+=e}}return r}return[]}const Z="EXT_mesh_features",$=Z;async function ee(e,t){!function(e,t){const r=e.gltf.json;if(!r.meshes)return;for(const n of r.meshes)for(const r of n.primitives)re(e,r,t)}(new U(e),t)}function te(e,t){const r=new U(e);return function(e){const t=e.gltf.json.meshes;if(!t)return;for(const r of t)for(const t of r.primitives)se(e,t)}(r),r.createBinaryChunk(),r.gltf}function re(e,t,r){if(!r?.gltf?.loadBuffers)return;const n=t.extensions?.[Z],s=n?.featureIds;if(s)for(const i of s){let n;if(void 0!==i.attribute){const r=`_FEATURE_ID_${i.attribute}`,s=t.attributes[r];n=e.getTypedArrayForAccessor(s)}else n=void 0!==i.texture&&r?.gltf?.loadImages?X(e,i.texture,t):[];i.data=n}}function ne(e,t,r,n){t.extensions||(t.extensions={});let s=t.extensions[Z];s||(s={featureIds:[]},t.extensions[Z]=s);const{featureIds:i}=s,o={featureCount:r.length,propertyTable:n,data:r};i.push(o),e.addObjectExtension(t,Z,s)}function se(e,t){const r=t.extensions?.[Z];if(!r)return;const n=r.featureIds;n.forEach(((r,s)=>{if(r.data){const{accessorKey:i,index:o}=function(e){const t="_FEATURE_ID_",r=Object.keys(e).filter((e=>0===e.indexOf(t)));let n=-1;for(const i of r){const e=Number(i.substring(t.length));e>n&&(n=e)}n++;const s=`${t}${n}`;return{accessorKey:s,index:n}}(t.attributes),a=new Uint32Array(r.data);n[s]={featureCount:a.length,propertyTable:r.propertyTable,attribute:o},e.gltf.buffers.push({arrayBuffer:a.buffer,byteOffset:a.byteOffset,byteLength:a.byteLength});const c=e.addBufferView(a),u=e.addAccessor(c,{size:1,componentType:(0,F.rA)(a),count:a.length});t.attributes[i]=u}}))}const ie="EXT_structural_metadata",oe=ie;async function ae(e,t){!function(e,t){if(!t.gltf?.loadBuffers)return;const r=e.getExtension(ie);if(!r)return;t.gltf?.loadImages&&function(e,t){const r=t.propertyTextures,n=e.gltf.json;if(r&&n.meshes)for(const s of n.meshes)for(const n of s.primitives)le(e,r,n,t)}(e,r);!function(e,t){const r=t.schema;if(!r)return;const n=r.classes,s=t.propertyTables;if(n&&s)for(const i in n){const t=ue(s,i);t&&fe(e,r,t)}}(e,r)}(new U(e),t)}function ce(e,t){const r=new U(e);return function(e){const t=e.getExtension(ie);if(!t)return;if(t.propertyTables)for(const r of t.propertyTables){const n=r.class,s=t.schema?.classes?.[n];r.properties&&s&&Be(r,s,e)}}(r),r.createBinaryChunk(),r.gltf}function ue(e,t){for(const r of e)if(r.class===t)return r;return null}function le(e,t,r,n){if(!t)return;const s=r.extensions?.[ie],i=s?.propertyTextures;if(i)for(const o of i){de(e,t[o],r,n)}}function de(e,t,r,n){if(!t.properties)return;n.dataAttributeNames||(n.dataAttributeNames=[]);const s=t.class;for(const i in t.properties){const o=`${s}_${i}`,a=t.properties?.[i];if(!a)continue;a.data||(a.data=[]);const c=a.data,u=X(e,a,r);null!==u&&(Q(e,o,u,c,r),a.data=c,n.dataAttributeNames.push(o))}}function fe(e,t,r){const n=t.classes?.[r.class];if(!n)throw new Error(`Incorrect data in the EXT_structural_metadata extension: no schema class with name ${r.class}`);const s=r.count;for(const i in n.properties){const o=n.properties[i],a=r.properties?.[i];if(a){const r=he(e,t,o,s,a);a.data=r}}}function he(e,t,r,n,s){let i=[];const o=s.values,a=e.getTypedArrayForBufferView(o),c=function(e,t,r,n){if(t.array&&void 0===t.count&&void 0!==r.arrayOffsets)return V(e,r.arrayOffsets,r.arrayOffsetType||"UINT32",n);return null}(e,r,s,n),u=function(e,t,r){if(void 0!==t.stringOffsets)return V(e,t.stringOffsets,t.stringOffsetType||"UINT32",r);return null}(e,s,n);switch(r.type){case"SCALAR":case"VEC2":case"VEC3":case"VEC4":case"MAT2":case"MAT3":case"MAT4":i=function(e,t,r,n){const s=e.array,i=e.count,o=K(e.type,e.componentType),a=r.byteLength/o;let c;c=e.componentType?k(r,e.type,e.componentType,a):r;if(s)return n?Y(c,t,n,r.length,o):i?W(c,t,i):[];return c}(r,n,a,c);break;case"BOOLEAN":throw new Error(`Not implemented - classProperty.type=${r.type}`);case"STRING":i=q(n,a,c,u);break;case"ENUM":i=function(e,t,r,n,s){const i=t.enumType;if(!i)throw new Error("Incorrect data in the EXT_structural_metadata extension: classProperty.enumType is not set for type ENUM");const o=e.enums?.[i];if(!o)throw new Error(`Incorrect data in the EXT_structural_metadata extension: schema.enums does't contain ${i}`);const a=o.valueType||"UINT16",c=K(t.type,a),u=n.byteLength/c;let l=k(n,t.type,a,u);l||(l=n);if(t.array){if(s)return function(e){const{valuesData:t,numberOfElements:r,arrayOffsets:n,valuesDataBytesLength:s,elementSize:i,enumEntry:o}=e,a=[];for(let c=0;c<r;c++){const e=n[c],r=n[c+1]-n[c];if(r+e>s)break;const u=Ae(t,e/i,r/i,o);a.push(u)}return a}({valuesData:l,numberOfElements:r,arrayOffsets:s,valuesDataBytesLength:n.length,elementSize:c,enumEntry:o});const e=t.count;return e?function(e,t,r,n){const s=[];for(let i=0;i<t;i++){const t=Ae(e,r*i,r,n);s.push(t)}return s}(l,r,e,o):[]}return Ae(l,0,r,o)}(t,r,n,a,c);break;default:throw new Error(`Unknown classProperty type ${r.type}`)}return i}function Ae(e,t,r,n){const s=[];for(let i=0;i<r;i++)if(e instanceof BigInt64Array||e instanceof BigUint64Array)s.push("");else{const r=me(n,e[t+i]);r?s.push(r.name):s.push("")}return s}function me(e,t){for(const r of e.values)if(r.value===t)return r;return null}const pe="schemaClassId";function Be(e,t,r){for(const n in e.properties){const s=e.properties[n].data;if(s){const i=t.properties[n];if(i){const t=ye(s,i,r);e.properties[n]=t}}}}function Ce(e,t,r){void 0===r&&(r=pe);let n=e.getExtension(ie);n||(n=e.addExtension(ie)),n.schema=function(e,t,r){const n=r??{id:"schema_id"},s={properties:{}};for(const i of e){const e={type:i.elementType,componentType:i.componentType};s.properties[i.name]=e}return n.classes={},n.classes[t]=s,n}(t,r,n.schema);const s=function(e,t,r){const n={class:t,count:0};let s=0;const i=r.classes?.[t];for(const o of e){if(0===s&&(s=o.values.length),s!==o.values.length&&o.values.length)throw new Error("Illegal values in attributes");const e=i?.properties[o.name];e&&(n.properties||(n.properties={}),n.properties[o.name]={values:0,data:o.values})}return n.count=s,n}(t,r,n.schema);return n.propertyTables||(n.propertyTables=[]),n.propertyTables.push(s)-1}function ye(e,t,r){const n={values:0};if("STRING"===t.type){const{stringData:t,stringOffsets:s}=function(e){const t=new TextEncoder,r=[];let n=0;for(const c of e){const e=t.encode(c);n+=e.length,r.push(e)}const s=new Uint8Array(n),i=[];let o=0;for(const c of r)s.set(c,o),i.push(o),o+=c.length;i.push(o);const a=new Uint32Array(i);return{stringData:s,stringOffsets:a}}(e);n.stringOffsets=be(s,r),n.values=be(t,r)}else if("SCALAR"===t.type&&t.componentType){const s=function(e,t){const r=[];for(const s of e)r.push(Number(s));const n=ge[t];if(!n)throw new Error("Illegal component type");return new n(r)}(e,t.componentType);n.values=be(s,r)}return n}const ge={INT8:Int8Array,UINT8:Uint8Array,INT16:Int16Array,UINT16:Uint16Array,INT32:Int32Array,UINT32:Uint32Array,INT64:Int32Array,UINT64:Uint32Array,FLOAT32:Float32Array,FLOAT64:Float64Array};function be(e,t){return t.gltf.buffers.push({arrayBuffer:e.buffer,byteOffset:e.byteOffset,byteLength:e.byteLength}),t.addBufferView(e)}var _e=r(80247);const Te="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",Ee="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",Se=new Uint8Array([0,97,115,109,1,0,0,0,1,4,1,96,0,0,3,3,2,0,0,5,3,1,0,1,12,1,0,10,22,2,12,0,65,0,65,0,65,0,252,10,0,0,11,7,0,65,0,253,15,26,11]),Re=new Uint8Array([32,0,65,253,3,1,2,34,4,106,6,5,11,8,7,20,13,33,12,16,128,9,116,64,19,113,127,15,10,21,22,14,255,66,24,54,136,107,18,23,192,26,114,118,132,17,77,101,130,144,27,87,131,44,45,74,156,154,70,167]),De={0:"",1:"meshopt_decodeFilterOct",2:"meshopt_decodeFilterQuat",3:"meshopt_decodeFilterExp",NONE:"",OCTAHEDRAL:"meshopt_decodeFilterOct",QUATERNION:"meshopt_decodeFilterQuat",EXPONENTIAL:"meshopt_decodeFilterExp"},Me={0:"meshopt_decodeVertexBuffer",1:"meshopt_decodeIndexBuffer",2:"meshopt_decodeIndexSequence",ATTRIBUTES:"meshopt_decodeVertexBuffer",TRIANGLES:"meshopt_decodeIndexBuffer",INDICES:"meshopt_decodeIndexSequence"};let we;async function Ie(){return we||(we=async function(){let e=Te;WebAssembly.validate(Se)&&(e=Ee,_e.log("Warning: meshopt_decoder is using experimental SIMD support"));const t=await WebAssembly.instantiate(function(e){const t=new Uint8Array(e.length);for(let n=0;n<e.length;++n){const r=e.charCodeAt(n);t[n]=r>96?r-71:r>64?r-65:r>47?r+4:r>46?63:62}let r=0;for(let n=0;n<e.length;++n)t[r++]=t[n]<60?Re[t[n]]:64*(t[n]-60)+t[++n];return t.buffer.slice(0,r)}(e),{});return await t.instance.exports.__wasm_call_ctors(),t.instance}()),we}function Ge(e,t,r,n,s,i,o){const a=e.exports.sbrk,c=n+3&-4,u=a(c*s),l=a(i.length),d=new Uint8Array(e.exports.memory.buffer);d.set(i,l);const f=t(u,n,s,l,i.length);if(0===f&&o&&o(u,c,s),r.set(d.subarray(u,u+n*s)),a(u-a(0)),0!==f)throw new Error(`Malformed buffer data: ${f}`)}const ve="EXT_meshopt_compression",Oe=ve;async function Fe(e,t){const r=new U(e);if(!t?.gltf?.decompressMeshes||!t.gltf?.loadBuffers)return;const n=[];for(const s of e.json.bufferViews||[])n.push(xe(r,s));await Promise.all(n),r.removeExtension(ve)}async function xe(e,t){const r=e.getObjectExtension(t,ve);if(r){const{byteOffset:n=0,byteLength:s=0,byteStride:i,count:o,mode:a,filter:c="NONE",buffer:u}=r,l=e.gltf.buffers[u],d=new Uint8Array(l.arrayBuffer,l.byteOffset+n,s),f=new Uint8Array(e.gltf.buffers[t.buffer].arrayBuffer,t.byteOffset,t.byteLength);await async function(e,t,r,n,s,i){void 0===i&&(i="NONE");const o=await Ie();Ge(o,o.exports[Me[s]],e,t,r,n,o.exports[De[i||"NONE"]])}(f,o,i,d,a,c),e.removeObjectExtension(t,ve)}}var Pe=r(26951);const Ue={};function He(e){if(void 0===Ue[e]){const t=Pe.Bd?function(e){switch(e){case"image/avif":case"image/webp":return function(e){try{const t=document.createElement("canvas");return 0===t.toDataURL(e).indexOf(`data:${e}`)}catch{return!1}}(e);default:return!0}}(e):Le(e);Ue[e]=t}return Ue[e]}function Le(e){const t=globalThis.loaders?.imageFormatsNode||["image/png","image/jpeg","image/gif"],r=globalThis.loaders?.parseImageNode;return Boolean(r)&&t.includes(e)}const Ne="EXT_texture_webp",Je=Ne;function je(e,t){const r=new U(e);if(!He("image/webp")){if(r.getRequiredExtensions().includes(Ne))throw new Error(`gltf: Required extension ${Ne} not supported by browser`);return}const{json:n}=r;for(const s of n.textures||[]){const e=r.getObjectExtension(s,Ne);e&&(s.source=e.source),r.removeObjectExtension(s,Ne)}r.removeExtension(Ne)}const Ke="KHR_texture_basisu",Ve=Ke;function ke(e,t){const r=new U(e),{json:n}=r;for(const s of n.textures||[]){const e=r.getObjectExtension(s,Ke);e&&(s.source=e.source,r.removeObjectExtension(s,Ke))}r.removeExtension(Ke)}var Xe=r(73719);function Qe(e){const{buffer:t,size:r,count:n}=function(e){let t=e,r=1,n=0;e&&e.value&&(t=e.value,r=e.size||1);t&&(ArrayBuffer.isView(t)||(t=function(e,t,r){void 0===r&&(r=!1);if(!e)return null;if(Array.isArray(e))return new t(e);if(r&&!(e instanceof t))return new t(e);return e}(t,Float32Array)),n=t.length/r);return{buffer:t,size:r,count:n}}(e);return{value:t,size:r,byteOffset:0,count:n,type:(0,F.v7)(r),componentType:(0,F.rA)(t)}}const ze="KHR_draco_mesh_compression",Ye=ze;function We(e,t,r){const n=new U(e);for(const s of tt(n))n.getObjectExtension(s,ze)}async function qe(e,t,r){if(!t?.gltf?.decompressMeshes)return;const n=new U(e),s=[];for(const i of tt(n))n.getObjectExtension(i,ze)&&s.push($e(n,i,t,r));await Promise.all(s),n.removeExtension(ze)}function Ze(e,t){void 0===t&&(t={});const r=new U(e);for(const n of r.json.meshes||[])et(n,t),r.addRequiredExtension(ze)}async function $e(e,t,r,n){const s=e.getObjectExtension(t,ze);if(!s)return;const i=e.getTypedArrayForBufferView(s.bufferView),o=(0,B._m)(i.buffer,i.byteOffset),a={...r};delete a["3d-tiles"];const c=await(0,C.N9)(o,Xe.Vl,a,n),u=function(e){const t={};for(const r in e){const n=e[r];if("indices"!==r){const e=Qe(n);t[r]=e}}return t}(c.attributes);for(const[l,d]of Object.entries(u))if(l in t.attributes){const r=t.attributes[l],n=e.getAccessor(r);n?.min&&n?.max&&(d.min=n.min,d.max=n.max)}t.attributes=u,c.indices&&(t.indices=Qe(c.indices)),e.removeObjectExtension(t,ze),function(e){if(!e.attributes&&Object.keys(e.attributes).length>0)throw new Error("glTF: Empty primitive detected: Draco decompression failure?")}(t)}function et(e,t,r,n,s){if(void 0===r&&(r=4),!n.DracoWriter)throw new Error("options.gltf.DracoWriter not provided");const i=n.DracoWriter.encodeSync({attributes:e}),o=s?.parseSync?.({attributes:e}),a=n._addFauxAttributes(o.attributes),c=n.addBufferView(i);return{primitives:[{attributes:a,mode:r,extensions:{[ze]:{bufferView:c,attributes:a}}}]}}function*tt(e){for(const t of e.json.meshes||[])for(const e of t.primitives)yield e}var rt=r(87597),nt=r(35567),st=r(31946);const it="KHR_texture_transform",ot=it,at=new rt.P,ct=new nt.d,ut=new nt.d;async function lt(e,t){if(!new U(e).hasExtension(it)||!t.gltf?.loadBuffers)return;const r=e.json.materials||[];for(let n=0;n<r.length;n++)dt(n,e)}function dt(e,t){const r=t.json.materials?.[e],n=[r?.pbrMetallicRoughness?.baseColorTexture,r?.emissiveTexture,r?.normalTexture,r?.occlusionTexture,r?.pbrMetallicRoughness?.metallicRoughnessTexture],s=[];for(const i of n)i&&i?.extensions?.[it]&&ft(t,e,i,s)}function ft(e,t,r,n){const s=function(e,t){const r=e.extensions?.[it],{texCoord:n=0}=e,{texCoord:s=n}=r,i=-1!==t.findIndex((e=>{let[t,r]=e;return t===n&&r===s}));if(!i){const i=function(e){const{offset:t=[0,0],rotation:r=0,scale:n=[1,1]}=e,s=(new nt.d).set(1,0,0,0,1,0,t[0],t[1],1),i=ct.set(Math.cos(r),Math.sin(r),0,-Math.sin(r),Math.cos(r),0,0,0,1),o=ut.set(n[0],0,0,0,n[1],0,0,0,1);return s.multiplyRight(i).multiplyRight(o)}(r);return n!==s&&(e.texCoord=s),t.push([n,s]),{originalTexCoord:n,texCoord:s,matrix:i}}return null}(r,n);if(!s)return;const i=e.json.meshes||[];for(const o of i)for(const r of o.primitives){const n=r.material;Number.isFinite(n)&&t===n&&ht(e,r,s)}}function ht(e,t,r){const{originalTexCoord:n,texCoord:s,matrix:i}=r,o=t.attributes[`TEXCOORD_${n}`];if(Number.isFinite(o)){const r=e.json.accessors?.[o];if(r&&r.bufferView){const o=e.json.bufferViews?.[r.bufferView];if(o){const{arrayBuffer:a,byteOffset:c}=e.buffers[o.buffer],u=(c||0)+(r.byteOffset||0)+(o.byteOffset||0),{ArrayType:l,length:d}=(0,F.aF)(r,o),f=st.E9[r.componentType],h=st.$j[r.type],A=o.byteStride||f*h,m=new Float32Array(d);for(let e=0;e<r.count;e++){const t=new l(a,u+e*A,2);at.set(t[0],t[1],1),at.transformByMatrix3(i),m.set([at[0],at[1]],e*h)}n===s?function(e,t,r,n){e.componentType=5126,r.push({arrayBuffer:n.buffer,byteOffset:0,byteLength:n.buffer.byteLength}),t.buffer=r.length-1,t.byteLength=n.buffer.byteLength,t.byteOffset=0,delete t.byteStride}(r,o,e.buffers,m):function(e,t,r,n,s){n.buffers.push({arrayBuffer:s.buffer,byteOffset:0,byteLength:s.buffer.byteLength});const i=n.json.bufferViews;if(!i)return;i.push({buffer:n.buffers.length-1,byteLength:s.buffer.byteLength,byteOffset:0});const o=n.json.accessors;if(!o)return;o.push({bufferView:i?.length-1,byteOffset:0,componentType:5126,count:t.count,type:"VEC2"}),r.attributes[`TEXCOORD_${e}`]=o.length-1}(s,r,t,e,m)}}}}const At="KHR_lights_punctual",mt=At;async function pt(e){const t=new U(e),{json:r}=t,n=t.getExtension(At);n&&(t.json.lights=n.lights,t.removeExtension(At));for(const s of r.nodes||[]){const e=t.getObjectExtension(s,At);e&&(s.light=e.light),t.removeObjectExtension(s,At)}}async function Bt(e){const t=new U(e),{json:r}=t;if(r.lights){const e=t.addExtension(At);(0,_.v)(!e.lights),e.lights=r.lights,delete r.lights}if(t.json.lights){for(const e of t.json.lights){const r=e.node;t.addObjectExtension(r,At,e)}delete t.json.lights}}const Ct="KHR_materials_unlit",yt=Ct;async function gt(e){const t=new U(e),{json:r}=t;for(const n of r.materials||[]){n.extensions&&n.extensions.KHR_materials_unlit&&(n.unlit=!0),t.removeObjectExtension(n,Ct)}t.removeExtension(Ct)}function bt(e){const t=new U(e),{json:r}=t;if(t.materials)for(const n of r.materials||[])n.unlit&&(delete n.unlit,t.addObjectExtension(n,Ct,{}),t.addExtension(Ct))}const _t="KHR_techniques_webgl",Tt=_t;async function Et(e){const t=new U(e),{json:r}=t,n=t.getExtension(_t);if(n){const e=function(e,t){const{programs:r=[],shaders:n=[],techniques:s=[]}=e,i=new TextDecoder;return n.forEach((e=>{if(!Number.isFinite(e.bufferView))throw new Error("KHR_techniques_webgl: no shader code");e.code=i.decode(t.getTypedArrayForBufferView(e.bufferView))})),r.forEach((e=>{e.fragmentShader=n[e.fragmentShader],e.vertexShader=n[e.vertexShader]})),s.forEach((e=>{e.program=r[e.program]})),s}(n,t);for(const n of r.materials||[]){const r=t.getObjectExtension(n,_t);r&&(n.technique=Object.assign({},r,e[r.technique]),n.technique.values=Rt(n.technique,t)),t.removeObjectExtension(n,_t)}t.removeExtension(_t)}}async function St(e,t){}function Rt(e,t){const r=Object.assign({},e.values);return Object.keys(e.uniforms||{}).forEach((t=>{e.uniforms[t].value&&!(t in r)&&(r[t]=e.uniforms[t].value)})),Object.keys(r).forEach((e=>{"object"==typeof r[e]&&void 0!==r[e].index&&(r[e].texture=t.getTexture(r[e].index))})),r}const Dt="EXT_feature_metadata",Mt=Dt;async function wt(e,t){!function(e,t){if(!t.gltf?.loadBuffers)return;const r=e.getExtension(Dt);if(!r)return;t.gltf?.loadImages&&function(e,t){const r=t.schema;if(!r)return;const n=r.classes,{featureTextures:s}=t;if(n&&s)for(const i in n){const t=n[i],r=Gt(s,i);r&&Ot(e,r,t)}}(e,r);!function(e,t){const r=t.schema;if(!r)return;const n=r.classes,s=t.featureTables;if(n&&s)for(const i in n){const t=It(s,i);t&&vt(e,r,t)}}(e,r)}(new U(e),t)}function It(e,t){for(const r in e){const n=e[r];if(n.class===t)return n}return null}function Gt(e,t){for(const r in e){const n=e[r];if(n.class===t)return n}return null}function vt(e,t,r){if(!r.class)return;const n=t.classes?.[r.class];if(!n)throw new Error(`Incorrect data in the EXT_structural_metadata extension: no schema class with name ${r.class}`);const s=r.count;for(const i in n.properties){const o=n.properties[i],a=r.properties?.[i];if(a){const r=Ft(e,t,o,s,a);a.data=r}}}function Ot(e,t,r){const n=t.class;for(const s in r.properties){const r=t?.properties?.[s];if(r){const t=xt(e,r,n);r.data=t}}}function Ft(e,t,r,n,s){let i=[];const o=s.bufferView,a=e.getTypedArrayForBufferView(o),c=function(e,t,r,n){if("ARRAY"===t.type&&void 0===t.componentCount&&void 0!==r.arrayOffsetBufferView)return V(e,r.arrayOffsetBufferView,r.offsetType||"UINT32",n);return null}(e,r,s,n),u=function(e,t,r,n){if(void 0!==r.stringOffsetBufferView)return V(e,r.stringOffsetBufferView,r.offsetType||"UINT32",n);return null}(e,0,s,n);return"STRING"===r.type||"STRING"===r.componentType?i=q(n,a,c,u):function(e){const t=["UINT8","INT16","UINT16","INT32","UINT32","INT64","UINT64","FLOAT32","FLOAT64"];return t.includes(e.type)||void 0!==e.componentType&&t.includes(e.componentType)}(r)&&(i=function(e,t,r,n){const s="ARRAY"===e.type,i=e.componentCount,o="SCALAR",a=e.componentType||e.type,c=K(o,a),u=r.byteLength/c,l=k(r,o,a,u);if(s)return n?Y(l,t,n,r.length,c):i?W(l,t,i):[];return l}(r,n,a,c)),i}function xt(e,t,r){const n=e.gltf.json;if(!n.meshes)return[];const s=[];for(const i of n.meshes)for(const n of i.primitives)Pt(e,r,t,s,n);return s}function Pt(e,t,r,n,s){const i=X(e,{channels:r.channels,...r.texture},s);i&&Q(e,t,i,n,s)}const Ut=[s,n,i,o,a,c,l,d,f,u,h];function Ht(e,t){const r=t?.gltf?.excludeExtensions||{};return!(e in r&&!r[e])}const Lt="KHR_binary_glTF";var Nt=r(80247);const Jt={accessors:"accessor",animations:"animation",buffers:"buffer",bufferViews:"bufferView",images:"image",materials:"material",meshes:"mesh",nodes:"node",samplers:"sampler",scenes:"scene",skins:"skin",textures:"texture"},jt={accessor:"accessors",animations:"animation",buffer:"buffers",bufferView:"bufferViews",image:"images",material:"materials",mesh:"meshes",node:"nodes",sampler:"samplers",scene:"scenes",skin:"skins",texture:"textures"};class Kt{idToIndexMap={animations:{},accessors:{},buffers:{},bufferViews:{},images:{},materials:{},meshes:{},nodes:{},samplers:{},scenes:{},skins:{},textures:{}};normalize(e,t){this.json=e.json;const r=e.json;switch(r.asset&&r.asset.version){case"2.0":return;case void 0:case"1.0":break;default:return void Nt.warn(`glTF: Unknown version ${r.asset.version}`)}if(!t.normalize)throw new Error("glTF v1 is not supported.");Nt.warn("Converting glTF v1 to glTF v2 format. This is experimental and may fail."),this._addAsset(r),this._convertTopLevelObjectsToArrays(r),function(e){const t=new U(e),{json:r}=t;for(const n of r.images||[]){const e=t.getObjectExtension(n,Lt);e&&Object.assign(n,e),t.removeObjectExtension(n,Lt)}r.buffers&&r.buffers[0]&&delete r.buffers[0].uri,t.removeExtension(Lt)}(e),this._convertObjectIdsToArrayIndices(r),this._updateObjects(r),this._updateMaterial(r)}_addAsset(e){e.asset=e.asset||{},e.asset.version="2.0",e.asset.generator=e.asset.generator||"Normalized to glTF 2.0 by loaders.gl"}_convertTopLevelObjectsToArrays(e){for(const t in Jt)this._convertTopLevelObjectToArray(e,t)}_convertTopLevelObjectToArray(e,t){const r=e[t];if(r&&!Array.isArray(r)){e[t]=[];for(const n in r){const s=r[n];s.id=s.id||n;const i=e[t].length;e[t].push(s),this.idToIndexMap[t][n]=i}}}_convertObjectIdsToArrayIndices(e){for(const t in Jt)this._convertIdsToIndices(e,t);"scene"in e&&(e.scene=this._convertIdToIndex(e.scene,"scene"));for(const t of e.textures)this._convertTextureIds(t);for(const t of e.meshes)this._convertMeshIds(t);for(const t of e.nodes)this._convertNodeIds(t);for(const t of e.scenes)this._convertSceneIds(t)}_convertTextureIds(e){e.source&&(e.source=this._convertIdToIndex(e.source,"image"))}_convertMeshIds(e){for(const t of e.primitives){const{attributes:e,indices:r,material:n}=t;for(const t in e)e[t]=this._convertIdToIndex(e[t],"accessor");r&&(t.indices=this._convertIdToIndex(r,"accessor")),n&&(t.material=this._convertIdToIndex(n,"material"))}}_convertNodeIds(e){e.children&&(e.children=e.children.map((e=>this._convertIdToIndex(e,"node")))),e.meshes&&(e.meshes=e.meshes.map((e=>this._convertIdToIndex(e,"mesh"))))}_convertSceneIds(e){e.nodes&&(e.nodes=e.nodes.map((e=>this._convertIdToIndex(e,"node"))))}_convertIdsToIndices(e,t){e[t]||(Nt.warn(`gltf v1: json doesn't contain attribute ${t}`),e[t]=[]);for(const r of e[t])for(const e in r){const t=r[e],n=this._convertIdToIndex(t,e);r[e]=n}}_convertIdToIndex(e,t){const r=jt[t];if(r in this.idToIndexMap){const n=this.idToIndexMap[r][e];if(!Number.isFinite(n))throw new Error(`gltf v1: failed to resolve ${t} with id ${e}`);return n}return e}_updateObjects(e){for(const t of this.json.buffers)delete t.type}_updateMaterial(e){for(const t of e.materials){t.pbrMetallicRoughness={baseColorFactor:[1,1,1,1],metallicFactor:1,roughnessFactor:1};const r=t.values?.tex||t.values?.texture2d_0||t.values?.diffuseTex,n=e.textures.findIndex((e=>e.id===r));-1!==n&&(t.pbrMetallicRoughness.baseColorTexture={index:n})}}}async function Vt(e,t,r,n,s){return void 0===r&&(r=0),function(e,t,r,n){n.uri&&(e.baseUri=n.uri);if(t instanceof ArrayBuffer&&!function(e,t,r){void 0===t&&(t=0),void 0===r&&(r={});const n=new DataView(e),{magic:s=D}=r,i=n.getUint32(t,!1);return i===s||i===D}(t,r,n)){t=(new TextDecoder).decode(t)}if("string"==typeof t)e.json=p(t);else if(t instanceof ArrayBuffer){const s={};r=I(s,t,r,n.glb),(0,_.v)("glTF"===s.type,`Invalid GLB magic string ${s.type}`),e._glb=s,e.json=s.json}else(0,_.v)(!1,"GLTF: must be ArrayBuffer or string");const s=e.json.buffers||[];if(e.buffers=new Array(s.length).fill(null),e._glb&&e._glb.header.hasBinChunk){const{binChunks:t}=e._glb;e.buffers[0]={arrayBuffer:t[0].arrayBuffer,byteOffset:t[0].byteOffset,byteLength:t[0].byteLength}}const i=e.json.images||[];e.images=new Array(i.length).fill({})}(e,t,r,n),function(e,t){void 0===t&&(t={}),(new Kt).normalize(e,t)}(e,{normalize:n?.gltf?.normalize}),function(e,t,r){void 0===t&&(t={});const n=Ut.filter((e=>Ht(e.name,t)));for(const s of n)s.preprocess?.(e,t,r)}(e,n,s),n?.gltf?.loadBuffers&&e.json.buffers&&await async function(e,t,r){const n=e.json.buffers||[];for(let s=0;s<n.length;++s){const i=n[s];if(i.uri){const{fetch:n}=r;(0,_.v)(n);const o=O(i.uri,t),a=await(r?.fetch?.(o)),c=await(a?.arrayBuffer?.());e.buffers[s]={arrayBuffer:c,byteOffset:0,byteLength:c.byteLength},delete i.uri}else null===e.buffers[s]&&(e.buffers[s]={arrayBuffer:new ArrayBuffer(i.byteLength),byteOffset:0,byteLength:i.byteLength})}}(e,n,s),n?.gltf?.loadImages&&await async function(e,t,r){const n=function(e){const t=new Set,r=e.json.textures||[];for(const n of r)void 0!==n.source&&t.add(n.source);return Array.from(t).sort()}(e),s=e.json.images||[],i=[];for(const o of n)i.push(kt(e,s[o],o,t,r));return await Promise.all(i)}(e,n,s),await async function(e,t,r){void 0===t&&(t={});const n=Ut.filter((e=>Ht(e.name,t)));for(const s of n)await(s.decode?.(e,t,r))}(e,n,s),e}async function kt(e,t,r,n,s){let i;if(t.uri&&!t.hasOwnProperty("bufferView")){const e=O(t.uri,n),{fetch:r}=s,o=await r(e);i=await o.arrayBuffer(),t.bufferView={data:i}}if(Number.isFinite(t.bufferView)){const r=x(e.json,e.buffers,t.bufferView);i=(0,B._m)(r.buffer,r.byteOffset,r.byteLength)}(0,_.v)(i,"glTF image has no data");let o=await(0,C.N9)(i,[y.$,g.E],{...n,mimeType:t.mimeType,basis:n.basis||{format:(0,b.J)()}},s);o&&o[0]&&(o={compressed:!0,mipmaps:!1,width:o[0].width,height:o[0].height,data:o[0]}),e.images=e.images||[],e.images[r]=o}const Xt={dataType:null,batchType:null,name:"glTF",id:"gltf",module:"gltf",version:A,extensions:["gltf","glb"],mimeTypes:["model/gltf+json","model/gltf-binary"],text:!0,binary:!0,tests:["glTF"],parse:async function(e,t,r){void 0===t&&(t={});(t={...Xt.options,...t}).gltf={...Xt.options.gltf,...t.gltf};const{byteOffset:n=0}=t;return await Vt({},e,n,t,r)},options:{gltf:{normalize:!0,loadBuffers:!0,loadImages:!0,decompressMeshes:!0},log:r(80247)}}},24714:(e,t,r)=>{r.d(t,{R:()=>C});var n=r(80349),s=r(45782),i=r(80247);const o={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},a={5120:1,5121:1,5122:2,5123:2,5125:4,5126:4},c=10240,u=10241,l=10242,d=10243,f=10497,h=9729,A=9986,m={magFilter:c,minFilter:u,wrapS:l,wrapT:d},p={[c]:h,[u]:A,[l]:f,[d]:f};class B{baseUri="";buffers=[];images=[];postProcess(e,t){void 0===t&&(t={});const{json:r,buffers:s=[],images:i=[]}=e,{baseUri:o=""}=e;return(0,n.v)(r),this.baseUri=o,this.buffers=s,this.images=i,this.jsonUnprocessed=r,this.json=this._resolveTree(e.json,t),this.json}_resolveTree(e,t){void 0===t&&(t={});const r={...e};return this.json=r,e.bufferViews&&(r.bufferViews=e.bufferViews.map(((e,t)=>this._resolveBufferView(e,t)))),e.images&&(r.images=e.images.map(((e,t)=>this._resolveImage(e,t)))),e.samplers&&(r.samplers=e.samplers.map(((e,t)=>this._resolveSampler(e,t)))),e.textures&&(r.textures=e.textures.map(((e,t)=>this._resolveTexture(e,t)))),e.accessors&&(r.accessors=e.accessors.map(((e,t)=>this._resolveAccessor(e,t)))),e.materials&&(r.materials=e.materials.map(((e,t)=>this._resolveMaterial(e,t)))),e.meshes&&(r.meshes=e.meshes.map(((e,t)=>this._resolveMesh(e,t)))),e.nodes&&(r.nodes=e.nodes.map(((e,t)=>this._resolveNode(e,t))),r.nodes=r.nodes.map(((e,t)=>this._resolveNodeChildren(e)))),e.skins&&(r.skins=e.skins.map(((e,t)=>this._resolveSkin(e,t)))),e.scenes&&(r.scenes=e.scenes.map(((e,t)=>this._resolveScene(e,t)))),"number"==typeof this.json.scene&&r.scenes&&(r.scene=r.scenes[this.json.scene]),r}getScene(e){return this._get(this.json.scenes,e)}getNode(e){return this._get(this.json.nodes,e)}getSkin(e){return this._get(this.json.skins,e)}getMesh(e){return this._get(this.json.meshes,e)}getMaterial(e){return this._get(this.json.materials,e)}getAccessor(e){return this._get(this.json.accessors,e)}getCamera(e){return this._get(this.json.cameras,e)}getTexture(e){return this._get(this.json.textures,e)}getSampler(e){return this._get(this.json.samplers,e)}getImage(e){return this._get(this.json.images,e)}getBufferView(e){return this._get(this.json.bufferViews,e)}getBuffer(e){return this._get(this.json.buffers,e)}_get(e,t){if("object"==typeof t)return t;const r=e&&e[t];return r||i.warn(`glTF file error: Could not find ${e}[${t}]`),r}_resolveScene(e,t){return{...e,id:e.id||`scene-${t}`,nodes:(e.nodes||[]).map((e=>this.getNode(e)))}}_resolveNode(e,t){const r={...e,id:e?.id||`node-${t}`};return void 0!==e.mesh&&(r.mesh=this.getMesh(e.mesh)),void 0!==e.camera&&(r.camera=this.getCamera(e.camera)),void 0!==e.skin&&(r.skin=this.getSkin(e.skin)),void 0!==e.meshes&&e.meshes.length&&(r.mesh=e.meshes.reduce(((e,t)=>{const r=this.getMesh(t);return e.id=r.id,e.primitives=e.primitives.concat(r.primitives),e}),{primitives:[]})),r}_resolveNodeChildren(e){return e.children&&(e.children=e.children.map((e=>this.getNode(e)))),e}_resolveSkin(e,t){const r="number"==typeof e.inverseBindMatrices?this.getAccessor(e.inverseBindMatrices):void 0;return{...e,id:e.id||`skin-${t}`,inverseBindMatrices:r}}_resolveMesh(e,t){const r={...e,id:e.id||`mesh-${t}`,primitives:[]};return e.primitives&&(r.primitives=e.primitives.map((e=>{const t={...e,attributes:{},indices:void 0,material:void 0},r=e.attributes;for(const n in r)t.attributes[n]=this.getAccessor(r[n]);return void 0!==e.indices&&(t.indices=this.getAccessor(e.indices)),void 0!==e.material&&(t.material=this.getMaterial(e.material)),t}))),r}_resolveMaterial(e,t){const r={...e,id:e.id||`material-${t}`};if(r.normalTexture&&(r.normalTexture={...r.normalTexture},r.normalTexture.texture=this.getTexture(r.normalTexture.index)),r.occlusionTexture&&(r.occlusionTexture={...r.occlusionTexture},r.occlusionTexture.texture=this.getTexture(r.occlusionTexture.index)),r.emissiveTexture&&(r.emissiveTexture={...r.emissiveTexture},r.emissiveTexture.texture=this.getTexture(r.emissiveTexture.index)),r.emissiveFactor||(r.emissiveFactor=r.emissiveTexture?[1,1,1]:[0,0,0]),r.pbrMetallicRoughness){r.pbrMetallicRoughness={...r.pbrMetallicRoughness};const e=r.pbrMetallicRoughness;e.baseColorTexture&&(e.baseColorTexture={...e.baseColorTexture},e.baseColorTexture.texture=this.getTexture(e.baseColorTexture.index)),e.metallicRoughnessTexture&&(e.metallicRoughnessTexture={...e.metallicRoughnessTexture},e.metallicRoughnessTexture.texture=this.getTexture(e.metallicRoughnessTexture.index))}return r}_resolveAccessor(e,t){const r=(n=e.componentType,a[n]);var n;const i=(c=e.type,o[c]);var c;const u=r*i,l={...e,id:e.id||`accessor-${t}`,bytesPerComponent:r,components:i,bytesPerElement:u,value:void 0,bufferView:void 0,sparse:void 0};if(void 0!==e.bufferView&&(l.bufferView=this.getBufferView(e.bufferView)),l.bufferView){const e=l.bufferView.buffer,{ArrayType:t,byteLength:r}=(0,s.aF)(l,l.bufferView),n=(l.bufferView.byteOffset||0)+(l.byteOffset||0)+e.byteOffset;let i=e.arrayBuffer.slice(n,n+r);l.bufferView.byteStride&&(i=this._getValueFromInterleavedBuffer(e,n,l.bufferView.byteStride,l.bytesPerElement,l.count)),l.value=new t(i)}return l}_getValueFromInterleavedBuffer(e,t,r,n,s){const i=new Uint8Array(s*n);for(let o=0;o<s;o++){const s=t+o*r;i.set(new Uint8Array(e.arrayBuffer.slice(s,s+n)),o*n)}return i.buffer}_resolveTexture(e,t){return{...e,id:e.id||`texture-${t}`,sampler:"number"==typeof e.sampler?this.getSampler(e.sampler):{id:"default-sampler",parameters:p},source:"number"==typeof e.source?this.getImage(e.source):void 0}}_resolveSampler(e,t){const r={id:e.id||`sampler-${t}`,...e,parameters:{}};for(const n in r){const e=this._enumSamplerParameter(n);void 0!==e&&(r.parameters[e]=r[n])}return r}_enumSamplerParameter(e){return m[e]}_resolveImage(e,t){const r={...e,id:e.id||`image-${t}`,image:null,bufferView:void 0!==e.bufferView?this.getBufferView(e.bufferView):void 0},n=this.images[t];return n&&(r.image=n),r}_resolveBufferView(e,t){const r=e.buffer,n=this.buffers[r].arrayBuffer;let s=this.buffers[r].byteOffset||0;e.byteOffset&&(s+=e.byteOffset);return{id:`bufferView-${t}`,...e,buffer:this.buffers[r],data:new Uint8Array(n,s,e.byteLength)}}_resolveCamera(e,t){const r={...e,id:e.id||`camera-${t}`};return r.perspective,r.orthographic,r}}function C(e,t){return(new B).postProcess(e,t)}},31946:(e,t,r)=>{r.d(t,{$j:()=>n,E9:()=>s});const n={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},s={5120:1,5121:1,5122:2,5123:2,5125:4,5126:4}},45782:(e,t,r)=>{r.d(t,{S3:()=>m,aF:()=>A,rA:()=>h,v7:()=>f});var n=r(80349),s=r(31946);const i=1.33,o=["SCALAR","VEC2","VEC3","VEC4"],a=[[Int8Array,5120],[Uint8Array,5121],[Int16Array,5122],[Uint16Array,5123],[Uint32Array,5125],[Float32Array,5126],[Float64Array,5130]],c=new Map(a),u={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},l={5120:1,5121:1,5122:2,5123:2,5125:4,5126:4},d={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array};function f(e){return o[e-1]||o[0]}function h(e){const t=c.get(e.constructor);if(!t)throw new Error("Illegal typed array");return t}function A(e,t){const r=d[e.componentType],i=u[e.type],o=l[e.componentType],a=e.count*i,c=e.count*i*o;(0,n.v)(c>=0&&c<=t.byteLength);return{ArrayType:r,length:a,byteLength:c,componentByteSize:s.E9[e.componentType],numberOfComponentsInElement:s.$j[e.type]}}function m(e){let{images:t,bufferViews:r}=e;t=t||[],r=r||[];const n=t.map((e=>e.bufferView));r=r.filter((e=>!n.includes(e)));const s=r.reduce(((e,t)=>e+t.byteLength),0),o=t.reduce(((e,t)=>{const{width:r,height:n}=t.image;return e+r*n}),0);return s+Math.ceil(4*o*i)}},80349:(e,t,r)=>{function n(e,t){if(!e)throw new Error(t||"assert failed: gltf")}r.d(t,{v:()=>n})},33183:(e,t,r)=>{r.d(t,{Tv:()=>f,kI:()=>A,gd:()=>h});var n=r(85930),s=r(72117),i=r(80247);function o(e,t){switch(e){case s.yW:return function(e){const t=0,r=8,n=4,s=[];try{const i=new DataView(e,t,n).getUint32(t,!0),o=new Uint32Array(e,r,i);let a=r+i*n;for(const t of o){const r=new TextDecoder("utf-8"),n=new Uint8Array(e,a,t);s.push(r.decode(n)),a+=t}}catch(o){i.error("Parse string attribute error: ",o.message)}return s}(t);case s.GJ:return a(t);case s.d8:return function(e){return new Float64Array(e,8)}(t);case s.sT:return function(e){return new Int16Array(e,4)}(t);default:return a(t)}}function a(e){return new Uint32Array(e,4)}var c=r(51060);const u="undefined"!=typeof __VERSION__?__VERSION__:"latest",l="",d="rejected",f={dataType:null,batchType:null,name:"I3S Attribute",id:"i3s-attribute",module:"i3s",version:u,mimeTypes:["application/binary"],parse:async(e,t)=>function(e,t){const{attributeName:r,attributeType:n}=t;return r?{[r]:n?o(n,e):null}:{}}(e,t),extensions:["bin"],options:{},binary:!0};async function h(e,t,r){void 0===r&&(r={});const{attributeStorageInfo:s,attributeUrls:i,tilesetFields:o}=function(e){const t=e.tileset?.tileset?.attributeStorageInfo,r=e.header?.attributeUrls,n=e.tileset?.tileset?.fields||[];return{attributeStorageInfo:t,attributeUrls:r,tilesetFields:n}}(e);if(!s||!i||t<0)return null;let a=[];const u=[];for(let d=0;d<s.length;d++){const e=(0,c.vd)(i[d],r.i3s?.token),t=s[d].name,o=A(s[d]),a={...r,attributeName:t,attributeType:o},l=(0,n.H)(e,f,a);u.push(l)}try{a=await Promise.allSettled(u)}catch(l){}return a.length?function(e,t,r,n){const s=function(e){const t=e.find((e=>e.name.includes("OBJECTID")));return t?.name}(t),i=e.find((e=>e.value[s]));if(!i)return null;const o=i.value[s].indexOf(r);if(o<0)return null;return function(e,t,r,n){const s={};for(let i=0;i<r.length;i++){const o=r[i].name,a=m(o,n),c=p(e,i,o);s[o]=B(c,t,a)}return s}(e,o,t,n)}(a,s,t,o):null}function A(e){return e.hasOwnProperty("objectIds")?"Oid32":e.hasOwnProperty("attributeValues")?e.attributeValues.valueType:""}function m(e,t){const r=t.find((t=>t.name===e||t.alias===e));return r?.domain?.codedValues||[]}function p(e,t,r){const n=e[t];return n.status===d?null:n.value[r]}function B(e,t,r){let n=l;if(e&&t in e&&(n=String(e[t]).replace(/\u0000|NaN/g,"").trim()),r.length){const e=r.find((e=>e.code===Number(n)));n=e?.name||l}return n}},4825:(e,t,r)=>{r.d(t,{R:()=>P});var n=r(69681),s=r(85930),i=r(87597),o=r(31886),a=r(4912),c=r(66160),u=r(83073),l=r(73719),d=r(96366),f=r(22120);let h=function(e){return e.vertexCount="vertexCount",e.featureCount="featureCount",e}({});var A=r(51060),m=r(72117);const p=new i.P([0,0,0]);const B="i3s-attribute-type";async function C(e,t,r,C,b){const T={attributes:{},indices:null,featureIds:[],vertexCount:0,modelMatrix:new o.k,coordinateSystem:0,byteLength:0,texture:null};if(t.textureUrl){const e=(0,A.vd)(t.textureUrl,C?.i3s?.token),r=function(e){switch(e){case"ktx-etc2":case"dds":return d.Y;case"ktx2":return f.E;default:return u.$}}(t.textureFormat),i=b?.fetch||fetch,o=await i(e),a=await o.arrayBuffer();if(C?.i3s.decodeTextures){if(r===u.$){const e={...t.textureLoaderOptions,image:{type:"data"}};try{const t=await(0,c.N9)(a,[],e,b);T.texture=t}catch(E){const t=await(0,n.q)(a,r,e,b);T.texture=t}}else if(r===d.Y||r===f.E){let e=await(0,s.H)(a,r,t.textureLoaderOptions);r===f.E&&(e=e[0]),T.texture={compressed:!0,mipmaps:!1,width:e[0].width,height:e[0].height,data:e}}}else T.texture=a}return T.material=function(e,t){let r;e?r={...e,pbrMetallicRoughness:e.pbrMetallicRoughness?{...e.pbrMetallicRoughness}:{baseColorFactor:[255,255,255,255]}}:(r={pbrMetallicRoughness:{}},t?r.pbrMetallicRoughness.baseColorTexture={texCoord:0}:r.pbrMetallicRoughness.baseColorFactor=[255,255,255,255]);r.alphaCutoff=r.alphaCutoff||.25,r.alphaMode&&(r.alphaMode=r.alphaMode.toUpperCase());r.emissiveFactor&&(r.emissiveFactor=_(r.emissiveFactor));r.pbrMetallicRoughness&&r.pbrMetallicRoughness.baseColorFactor&&(r.pbrMetallicRoughness.baseColorFactor=_(r.pbrMetallicRoughness.baseColorFactor));t&&function(e,t){const r={source:{image:t}};e.pbrMetallicRoughness&&e.pbrMetallicRoughness.baseColorTexture?e.pbrMetallicRoughness.baseColorTexture={...e.pbrMetallicRoughness.baseColorTexture,texture:r}:e.emissiveTexture?e.emissiveTexture={...e.emissiveTexture,texture:r}:e.pbrMetallicRoughness&&e.pbrMetallicRoughness.metallicRoughnessTexture?e.pbrMetallicRoughness.metallicRoughnessTexture={...e.pbrMetallicRoughness.metallicRoughnessTexture,texture:r}:e.normalTexture?e.normalTexture={...e.normalTexture,texture:r}:e.occlusionTexture&&(e.occlusionTexture={...e.occlusionTexture,texture:r})}(r,t);return r}(t.materialDefinition,T.texture),T.material&&(T.texture=null),await async function(e,t,r,s,c){const u=e.byteLength;let d,f,A,C=0,b=0;if(r.isDracoGeometry){const t=await(0,n.q)(e,l.Vl,{draco:{attributeNameEntry:B}});f=t.header.vertexCount,A=t.indices?.value;const{POSITION:r,NORMAL:s,COLOR_0:i,TEXCOORD_0:o,"feature-index":a,"uv-region":c}=t.attributes;d={position:r,normal:s,color:i,uv0:o,uvRegion:c,id:a},function(e,t){for(const r in t.loaderData.attributes){const n=t.loaderData.attributes[r];switch(n.name){case"POSITION":e.position.metadata=n.metadata;break;case"feature-index":e.id.metadata=n.metadata}}}(d,t);const u=function(e){return e?.metadata?.["i3s-feature-ids"]?.intArray}(a);u&&function(e,t){const r=e.id.value,n=new Float32Array(r.length);for(let s=0;s<r.length;s++)n[s]=t[r[s]];e.id.value=n}(d,u)}else{const{vertexAttributes:t,ordering:r,featureAttributes:n,featureAttributeOrder:i}=s.store.defaultGeometrySchema,o=function(e,t){let r=0,n=0,s=0;for(const{property:i,type:o}of t.store.defaultGeometrySchema.header){const t=(0,m.pF)(o);switch(i){case h.vertexCount.toString():n=new t(e,0,4)[0],r+=(0,m.$d)(o);break;case h.featureCount.toString():s=new t(e,4,4)[0],r+=(0,m.$d)(o)}}return{vertexCount:n,featureCount:s,byteOffset:r}}(e,s);C=o.byteOffset,f=o.vertexCount,b=o.featureCount;const{attributes:a,byteOffset:c}=g(e,C,t,f,r),{attributes:u}=g(e,c,n,b,i);!function(e){const{id:t,faceRange:r}=e;if(!t||!r)return;const n=t.value,s=r.value,i=s[s.length-1]+1,o=new Uint32Array(3*i);let a=0,c=0;for(let u=1;u<s.length;u+=2){const e=Number(n[a]),t=c+3*(s[u]-s[u-1]+1);o.fill(e,c,t),a++,c=t}e.id.value=o}(u),d=function(e,t){return{...e,...t}}(a,u)}if(c?.i3s?.coordinateSystem&&c.i3s.coordinateSystem!==m.rf.METER_OFFSETS)t.modelMatrix=function(e){const t=e.metadata,r=t?.["i3s-scale_x"]?.double||1,n=t?.["i3s-scale_y"]?.double||1,s=new o.k;return s[0]=r,s[5]=n,s}(d.position),t.coordinateSystem=m.rf.LNGLAT_OFFSETS;else{const e=function(e,t){const r=t.mbs,n=e.value,s=e.metadata,c=new o.k,u=new i.P(r[0],r[1],r[2]),l=new i.P;return a.C.WGS84.cartographicToCartesian(u,l),a.C.WGS84.eastNorthUpToFixedFrame(l,c),e.value=function(e,t,r){void 0===t&&(t={});const n=new Float64Array(e.length),s=t["i3s-scale_x"]&&t["i3s-scale_x"].double||1,i=t["i3s-scale_y"]&&t["i3s-scale_y"].double||1;for(let o=0;o<n.length;o+=3)n[o]=e[o]*s+r.x,n[o+1]=e[o+1]*i+r.y,n[o+2]=e[o+2]+r.z;for(let o=0;o<n.length;o+=3)a.C.WGS84.cartographicToCartesian(n.subarray(o,o+3),p),n[o]=p.x,n[o+1]=p.y,n[o+2]=p.z;return n}(n,s,u),c}(d.position,r);t.modelMatrix=e.invert(),t.coordinateSystem=m.rf.METER_OFFSETS}t.attributes={positions:d.position,normals:d.normal,colors:y(d.color),texCoords:d.uv0,uvRegions:y(d.uvRegion||d.region)},t.indices=A||null,d.id&&d.id.value&&(t.featureIds=d.id.value);for(const n in t.attributes)t.attributes[n]||delete t.attributes[n];return t.vertexCount=f,t.byteLength=u,t}(e,T,t,r,C)}function y(e){return e?(e.normalized=!0,e):e}function g(e,t,r,n,s){const i={};for(const o of s)if(r[o]){const{valueType:s,valuesPerElement:a}=r[o];if(t+n*a*(0,m.$d)(s)<=e.byteLength){const r=e.slice(t);let c;if("UInt64"===s)c=b(r,n*a,(0,m.$d)(s));else{c=new((0,m.pF)(s))(r,0,n*a)}if(i[o]={value:c,type:m.AQ[s],size:a},"color"===o)i.color.normalized=!0;t+=n*a*(0,m.$d)(s)}else if("uv0"!==o)break}return{attributes:i,byteOffset:t}}function b(e,t,r){const n=[],s=new DataView(e);let i=0;for(let o=0;o<t;o++){const e=s.getUint32(i,!0)+2**32*s.getUint32(i+4,!0);n.push(e),i+=r}return new Uint32Array(n)}function _(e){const t=[...e];for(let r=0;r<e.length;r++)t[r]=e[r]/255;return t}const T={dataType:null,batchType:null,name:"I3S Content (Indexed Scene Layers)",id:"i3s-content",module:"i3s",worker:!0,version:"undefined"!=typeof __VERSION__?__VERSION__:"latest",mimeTypes:["application/octet-stream"],parse:async function(e,t,r){const{tile:n,_tileOptions:s,tileset:i,_tilesetOptions:o}=t?.i3s||{},a=s||n,c=o||i;if(!a||!c)return null;return await C(e,a,c,t,r)},extensions:["bin"],options:{"i3s-content":{}}};var E=r(67733),S=r(68118),R=r(61594),D=r(78312);const M={dataType:null,batchType:null,name:"I3S Node Page",id:"i3s-node-page",module:"i3s",version:"undefined"!=typeof __VERSION__?__VERSION__:"latest",mimeTypes:["application/json"],parse:async function(e,t){return JSON.parse((new TextDecoder).decode(e))},extensions:["json"],options:{i3s:{}}};class w{nodePages=[];pendingNodePages=[];textureDefinitionsSelectedFormats=[];textureLoaderOptions={};constructor(e,t,r){void 0===t&&(t=""),this.tileset={...e},this.url=t,this.nodesPerPage=e.nodePages?.nodesPerPage||64,this.lodSelectionMetricType=e.nodePages?.lodSelectionMetricType,this.options=r,this.nodesInNodePages=0,this.initSelectedFormatsForTextureDefinitions(e)}async getNodeById(e){const t=Math.floor(e/this.nodesPerPage);if(!this.nodePages[t]&&!this.pendingNodePages[t]){const e=(0,A.vd)(`${this.url}/nodepages/${t}`,this.options.i3s?.token);this.pendingNodePages[t]={status:"Pending",promise:(0,s.H)(e,M,this.options)},this.nodePages[t]=await this.pendingNodePages[t].promise,this.nodesInNodePages+=this.nodePages[t].nodes.length,this.pendingNodePages[t].status="Done"}"Pending"===this.pendingNodePages[t].status&&(this.nodePages[t]=await this.pendingNodePages[t].promise);const r=e%this.nodesPerPage;return this.nodePages[t].nodes[r]}async formTileFromNodePages(e){const t=await this.getNodeById(e),r=[],n=[];for(const f of t.children||[])n.push(this.getNodeById(f));const s=await Promise.all(n);for(const f of s)r.push({id:f.index.toString(),obb:f.obb});let i,o,a,c="jpg",u=[],l=!1;if(t&&t.mesh){const{url:e,isDracoGeometry:r}=t.mesh.geometry&&this.getContentUrl(t.mesh.geometry)||{isDracoGeometry:!1};i=e,l=r;const{textureData:n,materialDefinition:s}=this.getInformationFromMaterial(t.mesh.material);a=s,c=n.format||c,n.name&&(o=`${this.url}/nodes/${t.mesh.material.resource}/textures/${n.name}`),this.tileset.attributeStorageInfo&&(u=(0,A.Yv)(this.tileset,this.url,t.mesh.attribute.resource))}const d=this.getLodSelection(t);return I({id:e.toString(),lodSelection:d,obb:t.obb,contentUrl:i,textureUrl:o,attributeUrls:u,materialDefinition:a,textureFormat:c,textureLoaderOptions:this.textureLoaderOptions,children:r,isDracoGeometry:l})}getContentUrl(e){let t=null;const r=this.tileset.geometryDefinitions[e.definition];let n=-1;if(this.options.i3s&&this.options.i3s.useDracoGeometry&&(n=r.geometryBuffers.findIndex((e=>e.compressedAttributes&&"draco"===e.compressedAttributes.encoding))),-1===n&&(n=r.geometryBuffers.findIndex((e=>!e.compressedAttributes))),-1!==n){const s=Boolean(r.geometryBuffers[n].compressedAttributes);t={url:`${this.url}/nodes/${e.resource}/geometries/${n}`,isDracoGeometry:s}}return t}getLodSelection(e){const t=[];return"maxScreenThresholdSQ"===this.lodSelectionMetricType&&t.push({metricType:"maxScreenThreshold",maxError:Math.sqrt(e.lodThreshold/(.25*Math.PI))}),t.push({metricType:this.lodSelectionMetricType,maxError:e.lodThreshold}),t}getInformationFromMaterial(e){const t={textureData:{name:null}};if(e){const r=this.tileset.materialDefinitions?.[e.definition];if(r){t.materialDefinition=r;const e=r?.pbrMetallicRoughness?.baseColorTexture?.textureSetDefinitionId;"number"==typeof e&&(t.textureData=this.textureDefinitionsSelectedFormats[e]||t.textureData)}}return t}initSelectedFormatsForTextureDefinitions(e){this.textureDefinitionsSelectedFormats=[];const t=this.getSupportedTextureFormats(),r=e.textureSetDefinitions||[];for(const n of r){const e=n&&n.formats||[];let r=null;for(const n of t){const t=e.find((e=>e.format===n));if(t){r=t;break}}r&&"ktx2"===r.format&&(this.textureLoaderOptions.basis={format:(0,R.J)(),containerFormat:"ktx2",module:"encoder"}),this.textureDefinitionsSelectedFormats.push(r)}}getSupportedTextureFormats(){const e=[];if(!this.options.i3s||this.options.i3s.useCompressedTextures){const t=(0,D.E)();t.has("etc2")&&e.push("ktx-etc2"),t.has("dxt")&&e.push("dds"),e.push("ktx2")}return e.push("jpg"),e.push("png"),e}}function I(e){const t={};let r=[0,0,0,1];if(e.mbs)r=e.mbs,t.sphere=[...a.C.WGS84.cartographicToCartesian(e.mbs.slice(0,3)),e.mbs[3]];else if(e.obb){t.box=[...a.C.WGS84.cartographicToCartesian(e.obb.center),...e.obb.halfSize,...e.obb.quaternion];const n=(new E.CB).fromCenterHalfSizeQuaternion(t.box.slice(0,3),e.obb.halfSize,e.obb.quaternion).getBoundingSphere();t.sphere=[...n.center,n.radius],r=[...e.obb.center,n.radius]}const n=e.lodSelection?.[0].metricType,s=e.lodSelection?.[0].maxError,i=S.WH.MESH,o=S.lH.REPLACE;return{...e,mbs:r,boundingVolume:t,lodMetricType:n,lodMetricValue:s,type:i,refine:o}}const G="undefined"!=typeof __VERSION__?__VERSION__:"latest",v=/layers\/[0-9]+$/,O=/\.slpk$/,F=/nodes\/([0-9-]+|root)$/,x="PointCloud",P={dataType:null,batchType:null,name:"I3S (Indexed Scene Layers)",id:"i3s",module:"i3s",version:G,mimeTypes:["application/octet-stream"],parse:async function(e,t,r){void 0===t&&(t={});const i=r.url;t.i3s=t.i3s||{};if("504b0304"===function(e){if(e instanceof ArrayBuffer)return[...new Uint8Array(e,0,4)].map((e=>e.toString(16).padStart(2,"0"))).join("");return null}(e))throw new Error("Files with .slpk extention currently are not supported by I3SLoader");const o=(0,A.y5)(i);let a,c;a="auto"===t.i3s.isTileset?v.test(o)||O.test(o):t.i3s.isTileset;c="auto"===t.isTileHeader?F.test(o):t.i3s.isTileHeader;e=a?await async function(e,t,r){const n=JSON.parse((new TextDecoder).decode(e));if(n?.layerType===x)throw new Error("Point Cloud layers currently are not supported by I3SLoader");const i=await async function(e,t,r){const n=(0,A.y5)(r.url||"");let i,o;if(e.nodePages)i=new w(e,n,t),o=await i.formTileFromNodePages(0);else{const e=t.i3s,r=(0,A.vd)(`${n}/nodes/root`,e.token);o=await(0,s.H)(r,P,{...t,i3s:{...t.i3s,loadContent:!1,isTileHeader:!0,isTileset:!1}})}return{...e,loader:P,url:n,basePath:n,type:S.yy.I3S,nodePagesTile:i,root:o,lodMetricType:o.lodMetricType,lodMetricValue:o.lodMetricValue}}(n,t,r);return i}(e,t,r):c?await async function(e,t){return e=JSON.parse((new TextDecoder).decode(e)),function(e,t){const r=t.url||"";let n,s,i;e.geometryData&&(n=`${r}/${e.geometryData[0].href}`),e.textureData&&(s=`${r}/${e.textureData[0].href}`),e.attributeData&&(i=(0,A.am)(r,e));const o=e.children||[];return I({...e,children:o,url:r,contentUrl:n,textureUrl:s,textureFormat:"jpg",attributeUrls:i,isDracoGeometry:!1})}(e,t)}(e,r):await async function(e,t){return await(0,n.q)(e,T,t)}(e,t);return e},extensions:["bin"],options:{i3s:{token:null,isTileset:"auto",isTileHeader:"auto",tile:null,tileset:null,_tileOptions:null,_tilesetOptions:null,useDracoGeometry:!0,useCompressedTextures:!0,decodeTextures:!0,coordinateSystem:m.rf.METER_OFFSETS}}}},72117:(e,t,r)=>{r.d(t,{$d:()=>o,AQ:()=>i,GJ:()=>c,d8:()=>u,pF:()=>s,rf:()=>d,sT:()=>l,yW:()=>a});var n=r(94510);function s(e){switch(e){case"UInt8":return Uint8Array;case"UInt16":return Uint16Array;case"UInt32":return Uint32Array;case"Float32":return Float32Array;case"UInt64":return Float64Array;default:throw new Error(`parse i3s tile content: unknown type of data: ${e}`)}}const i={UInt8:n.GL.UNSIGNED_BYTE,UInt16:n.GL.UNSIGNED_SHORT,Float32:n.GL.FLOAT,UInt32:n.GL.UNSIGNED_INT,UInt64:n.GL.DOUBLE};function o(e){switch(e){case"UInt8":return 1;case"UInt16":case"Int16":return 2;case"UInt32":case"Int32":case"Float32":return 4;case"UInt64":case"Int64":case"Float64":return 8;default:throw new Error(`parse i3s tile content: unknown size of data: ${e}`)}}const a="String",c="Oid32",u="Float64",l="Int16";let d=function(e){return e[e.DEFAULT=-1]="DEFAULT",e[e.LNGLAT=1]="LNGLAT",e[e.METER_OFFSETS=2]="METER_OFFSETS",e[e.LNGLAT_OFFSETS=3]="LNGLAT_OFFSETS",e[e.CARTESIAN=0]="CARTESIAN",e}({})},51060:(e,t,r)=>{function n(e){let t;try{const r=new URL(e);t=`${r.origin}${r.pathname}`,t.startsWith("null")&&(t=null)}catch(r){t=null}return t||e}function s(e,t){return void 0===t&&(t=null),t?`${e}?token=${t}`:e}function i(e,t){const{attributeData:r=[]}=t,n=[];for(let s=0;s<r.length;s++){const t=r[s].href.replace("./","");n.push(`${e}/${t}`)}return n}function o(e,t,r){const n=[],{attributeStorageInfo:s=[]}=e;for(let i=0;i<s.length;i++){const e=s[i].key;n.push(`${t}/nodes/${r}/attributes/${e}/0`)}return n}r.d(t,{Yv:()=>o,am:()=>i,vd:()=>s,y5:()=>n})},83073:(e,t,r)=>{r.d(t,{$:()=>_});const n="undefined"!=typeof __VERSION__?__VERSION__:"latest";var s=r(10981),i=r(26951);const o=globalThis.loaders?.parseImageNode,a="undefined"!=typeof Image,c="undefined"!=typeof ImageBitmap,u=Boolean(o),l=!!i.Bd||u;var d=r(47216);const f=/^data:image\/svg\+xml/,h=/\.svg((\?|#).*)?$/;function A(e){return e&&(f.test(e)||h.test(e))}function m(e,t){if(A(t))throw new Error("SVG cannot be parsed directly to imagebitmap");return new Blob([new Uint8Array(e)])}async function p(e,t,r){const n=function(e,t){if(A(t)){let t=(new TextDecoder).decode(e);try{"function"==typeof unescape&&"function"==typeof encodeURIComponent&&(t=unescape(encodeURIComponent(t)))}catch(r){throw new Error(r.message)}return`data:image/svg+xml;base64,${btoa(t)}`}return m(e,t)}(e,r),s=self.URL||self.webkitURL,i="string"!=typeof n&&s.createObjectURL(n);try{return await async function(e,t){const r=new Image;if(r.src=e,t.image&&t.image.decode&&r.decode)return await r.decode(),r;return await new Promise(((e,t)=>{try{r.onload=()=>e(r),r.onerror=e=>{const r=e instanceof Error?e.message:"error";t(new Error(r))}}catch(n){t(n)}}))}(i||n,t)}finally{i&&s.revokeObjectURL(i)}}var B=r(80247);const C={};let y=!0;async function g(e,t,r){let n;if(A(r)){n=await p(e,t,r)}else n=m(e,r);const s=t&&t.imagebitmap;return await async function(e,t){void 0===t&&(t=null);!function(e){for(const t in e||C)return!1;return!0}(t)&&y||(t=null);if(t)try{return await createImageBitmap(e,t)}catch(r){B.warn(r),y=!1}return await createImageBitmap(e)}(n,s)}var b=r(69186);const _={dataType:null,batchType:null,id:"image",module:"images",name:"Images",version:n,mimeTypes:["image/png","image/jpeg","image/gif","image/webp","image/avif","image/bmp","image/vnd.microsoft.icon","image/svg+xml"],extensions:["png","jpg","jpeg","gif","webp","bmp","ico","svg","avif"],parse:async function(e,t,r){const n=((t=t||{}).image||{}).type||"auto",{url:i}=r||{};let o;switch(function(e){switch(e){case"auto":case"data":return function(){if(c)return"imagebitmap";if(a)return"image";if(l)return"data";throw new Error("Install '@loaders.gl/polyfills' to parse images under Node.js")}();default:return function(e){switch(e){case"auto":return c||a||l;case"imagebitmap":return c;case"image":return a;case"data":return l;default:throw new Error(`@loaders.gl/images: image ${e} not supported in this environment`)}}(e),e}}(n)){case"imagebitmap":o=await g(e,t,i);break;case"image":o=await p(e,t,i);break;case"data":o=await async function(e){const{mimeType:t}=(0,b.m)(e)||{},r=globalThis.loaders?.parseImageNode;return(0,s.v)(r),await r(e,t)}(e);break;default:(0,s.v)(!1)}return"data"===n&&(o=(0,d.M5)(o)),o},tests:[e=>Boolean((0,b.m)(new DataView(e)))],options:{image:{type:"auto",decode:!0}}}},69186:(e,t,r)=>{function n(e){return function(e,t,r){void 0===r&&(r=0);const n=(s=t,[...s].map((e=>e.charCodeAt(0))));var s;for(let i=0;i<n.length;++i)if(n[i]!==e[i+r])return!1;return!0}(e,"ftyp",4)&&96&e[8]?function(e){switch((t=e,r=8,n=12,String.fromCharCode(...t.slice(r,n))).replace("\0"," ").trim()){case"avif":case"avis":return{extension:"avif",mimeType:"image/avif"};default:return null}var t,r,n}(e):null}r.d(t,{m:()=>o});const s=!1,i=!0;function o(e){const t=a(e);return function(e){const t=a(e),r=t.byteLength>=24&&2303741511===t.getUint32(0,s);if(!r)return null;return{mimeType:"image/png",width:t.getUint32(16,s),height:t.getUint32(20,s)}}(t)||function(e){const t=a(e),r=t.byteLength>=3&&65496===t.getUint16(0,s)&&255===t.getUint8(2);if(!r)return null;const{tableMarkers:n,sofMarkers:i}=function(){const e=new Set([65499,65476,65484,65501,65534]);for(let r=65504;r<65520;++r)e.add(r);const t=new Set([65472,65473,65474,65475,65477,65478,65479,65481,65482,65483,65485,65486,65487,65502]);return{tableMarkers:e,sofMarkers:t}}();let o=2;for(;o+9<t.byteLength;){const e=t.getUint16(o,s);if(i.has(e))return{mimeType:"image/jpeg",height:t.getUint16(o+5,s),width:t.getUint16(o+7,s)};if(!n.has(e))return null;o+=2,o+=t.getUint16(o,s)}return null}(t)||function(e){const t=a(e),r=t.byteLength>=10&&1195984440===t.getUint32(0,s);if(!r)return null;return{mimeType:"image/gif",width:t.getUint16(6,i),height:t.getUint16(8,i)}}(t)||function(e){const t=a(e),r=t.byteLength>=14&&16973===t.getUint16(0,s)&&t.getUint32(2,i)===t.byteLength;if(!r)return null;return{mimeType:"image/bmp",width:t.getUint32(18,i),height:t.getUint32(22,i)}}(t)||function(e){const t=new Uint8Array(e instanceof DataView?e.buffer:e),r=n(t);if(!r)return null;return{mimeType:r.mimeType,width:0,height:0}}(t)}function a(e){if(e instanceof DataView)return e;if(ArrayBuffer.isView(e))return new DataView(e.buffer);if(e instanceof ArrayBuffer)return new DataView(e);throw new Error("toDataView")}},47216:(e,t,r)=>{function n(e){const t=i(e);if(!t)throw new Error("Not an image");return t}function s(e){switch(n(e)){case"data":return e;case"image":case"imagebitmap":const t=document.createElement("canvas"),r=t.getContext("2d");if(!r)throw new Error("getImageData");return t.width=e.width,t.height=e.height,r.drawImage(e,0,0),r.getImageData(0,0,e.width,e.height);default:throw new Error("getImageData")}}function i(e){return"undefined"!=typeof ImageBitmap&&e instanceof ImageBitmap?"imagebitmap":"undefined"!=typeof Image&&e instanceof Image?"image":e&&"object"==typeof e&&e.data&&e.width&&e.height?"data":null}r.d(t,{M5:()=>s})},95247:(e,t,r)=>{function n(e,t,r){if(r=r||e.byteLength,e.byteLength<r||t.byteLength<r)return!1;const n=new Uint8Array(e),s=new Uint8Array(t);for(let i=0;i<n.length;++i)if(n[i]!==s[i])return!1;return!0}function s(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];return function(e){const t=e.map((e=>e instanceof ArrayBuffer?new Uint8Array(e):e)),r=t.reduce(((e,t)=>e+t.byteLength),0),n=new Uint8Array(r);let s=0;for(const i of t)n.set(i,s),s+=i.byteLength;return n.buffer}(t)}function i(e,t,r){const n=void 0!==r?new Uint8Array(e).subarray(t,t+r):new Uint8Array(e).subarray(t);return new Uint8Array(n).buffer}r.d(t,{AQ:()=>s,YV:()=>n,_m:()=>i})},53024:(e,t,r)=>{function n(e){if((t=e)&&"object"==typeof t&&t.isBuffer)return e;var t;if(e instanceof ArrayBuffer)return e;if(ArrayBuffer.isView(e))return 0===e.byteOffset&&e.byteLength===e.buffer.byteLength?e.buffer:e.buffer.slice(e.byteOffset,e.byteOffset+e.byteLength);if("string"==typeof e){const t=e;return(new TextEncoder).encode(t).buffer}if(e&&"object"==typeof e&&e._toArrayBuffer)return e._toArrayBuffer();throw new Error("toArrayBuffer")}r.d(t,{XA:()=>n})},10981:(e,t,r)=>{function n(e,t){if(!e)throw new Error(t||"loader assertion failed.")}r.d(t,{v:()=>n})},26951:(e,t,r)=>{r.d(t,{Bd:()=>s});var n=r(88538);"undefined"!=typeof self&&self,"undefined"!=typeof window&&window,void 0!==r.g&&r.g,"undefined"!=typeof document&&document;const s=Boolean("object"!=typeof n||"[object process]"!==String(n)||n.browser),i=void 0!==n&&n.version&&/v([0-9]*)/.exec(n.version);i&&parseFloat(i[1])},8001:(e,t,r)=>{r.d(t,{cy:()=>i,jJ:()=>s});var n=r(95247);async function s(e,t){for(;;){const{done:r,value:n}=await e.next();if(r)return void e.return();if(t(n))return}}async function i(e){const t=[];for await(const r of e)t.push(r);return(0,n.AQ)(...t)}},55256:(e,t,r)=>{r.d(t,{R:()=>o});var n=r(35593);const s="undefined"!=typeof __VERSION__?__VERSION__:"latest",i=s[0]>="0"&&s[0]<="9"?`v${s}`:"";const o=function(){const e=new n.t({id:"loaders.gl"});return globalThis.loaders=globalThis.loaders||{},globalThis.loaders.log=e,globalThis.loaders.version=i,globalThis.probe=globalThis.probe||{},globalThis.probe.loaders=e,e}()},21098:(e,t,r)=>{r.d(t,{Qd:()=>o,Qz:()=>s,mi:()=>i,w7:()=>a});var n=r(55256);function s(e){globalThis.loaders||={},globalThis.loaders.modules||={},Object.assign(globalThis.loaders.modules,e)}function i(e,t){const r=globalThis.loaders?.modules?.[e];r||n.R.warn(`${t}: ${e} library not installed`)()}function o(e,t){const r=globalThis.loaders?.modules?.[e];if(!r)throw new Error(`${t}: ${e} library not installed`);return r}function a(e){const t=globalThis.loaders?.modules?.[e];return t||null}},97354:(e,t,r)=>{function n(e){return e}function s(e,t){return i(e||{},t)}function i(e,t,r){if(void 0===r&&(r=0),r>3)return t;const n={...e};for(const[s,o]of Object.entries(t))o&&"object"==typeof o&&!Array.isArray(o)?n[s]=i(n[s]||{},t[s],r+1):n[s]=t[s];return n}r.d(t,{E:()=>n,l:()=>s})},29512:(e,t,r)=>{r.d(t,{o1:()=>i});let n="";const s={};function i(e){for(const t in s)if(e.startsWith(t)){const r=s[t];e=e.replace(t,r)}return e.startsWith("http://")||e.startsWith("https://")||(e=`${n}${e}`),e}},36970:(e,t,r)=>{r.d(t,{pD:()=>o,iW:()=>i,hd:()=>a});var n=r(88538);function s(){if(void 0!==n&&void 0!==n.cwd)return n.cwd();const e=window.location?.pathname;return e?.slice(0,e.lastIndexOf("/")+1)||""}function i(e){const t=e?e.lastIndexOf("/"):-1;return t>=0?e.substr(t+1):""}function o(e){const t=e?e.lastIndexOf("/"):-1;return t>=0?e.substr(0,t):""}function a(){const e=[];for(let s=0;s<arguments.length;s++)e[s]=s<0||arguments.length<=s?void 0:arguments[s];let t,r="",n=!1;for(let i=e.length-1;i>=-1&&!n;i--){let o;i>=0?o=e[i]:(void 0===t&&(t=s()),o=t),0!==o.length&&(r=`${o}/${r}`,n=o.charCodeAt(0)===c)}return r=function(e,t){let r,n="",s=-1,i=0,o=!1;for(let a=0;a<=e.length;++a){if(a<e.length)r=e.charCodeAt(a);else{if(r===c)break;r=c}if(r===c){if(s===a-1||1===i);else if(s!==a-1&&2===i){if(n.length<2||!o||n.charCodeAt(n.length-1)!==u||n.charCodeAt(n.length-2)!==u)if(n.length>2){const e=n.length-1;let t=e;for(;t>=0&&n.charCodeAt(t)!==c;--t);if(t!==e){n=-1===t?"":n.slice(0,t),s=a,i=0,o=!1;continue}}else if(2===n.length||1===n.length){n="",s=a,i=0,o=!1;continue}t&&(n.length>0?n+="/..":n="..",o=!0)}else{const t=e.slice(s+1,a);n.length>0?n+=`/${t}`:n=t,o=!1}s=a,i=0}else r===u&&-1!==i?++i:i=-1}return n}(r,!n),n?`/${r}`:r.length>0?r:"."}const c=47,u=46},85796:(e,t,r)=>{r.d(t,{A:()=>i});var n=r(21143);const s={id:"request-scheduler",throttleRequests:!0,maxRequests:6,debounceTime:0};class i{activeRequestCount=0;requestQueue=[];requestMap=(()=>new Map)();updateTimer=null;constructor(e){void 0===e&&(e={}),this.props={...s,...e},this.stats=new n.Uz({id:this.props.id}),this.stats.get("Queued Requests"),this.stats.get("Active Requests"),this.stats.get("Cancelled Requests"),this.stats.get("Queued Requests Ever"),this.stats.get("Active Requests Ever")}scheduleRequest(e,t){if(void 0===t&&(t=()=>0),!this.props.throttleRequests)return Promise.resolve({done:()=>{}});if(this.requestMap.has(e))return this.requestMap.get(e);const r={handle:e,priority:0,getPriority:t},n=new Promise((e=>(r.resolve=e,r)));return this.requestQueue.push(r),this.requestMap.set(e,n),this._issueNewRequests(),n}_issueRequest(e){const{handle:t,resolve:r}=e;let n=!1;const s=()=>{n||(n=!0,this.requestMap.delete(t),this.activeRequestCount--,this._issueNewRequests())};return this.activeRequestCount++,r?r({done:s}):Promise.resolve({done:s})}_issueNewRequests(){null!==this.updateTimer&&clearTimeout(this.updateTimer),this.updateTimer=setTimeout((()=>this._issueNewRequestsAsync()),this.props.debounceTime)}_issueNewRequestsAsync(){null!==this.updateTimer&&clearTimeout(this.updateTimer),this.updateTimer=null;const e=Math.max(this.props.maxRequests-this.activeRequestCount,0);if(0!==e){this._updateAllRequests();for(let t=0;t<e;++t){const e=this.requestQueue.shift();e&&this._issueRequest(e)}}}_updateAllRequests(){const e=this.requestQueue;for(let t=0;t<e.length;++t){const r=e[t];this._updateRequest(r)||(e.splice(t,1),this.requestMap.delete(r.handle),t--)}e.sort(((e,t)=>e.priority-t.priority))}_updateRequest(e){return e.priority=e.getPriority(e.handle),!(e.priority<0)||(e.resolve(null),!1)}}},66160:(e,t,r)=>{async function n(e,t,r,n){return n._parse(e,t,r,n)}async function s(e,t,r,n){if(!n._parseInBatches)throw new Error("parseInBatches");return n._parseInBatches(e,t,r,n)}r.d(t,{N9:()=>n,WC:()=>s})},94510:(e,t,r)=>{r.d(t,{GL:()=>s,Zf:()=>n});const n={BYTE:5120,UNSIGNED_BYTE:5121,SHORT:5122,UNSIGNED_SHORT:5123,INT:5124,UNSIGNED_INT:5125,FLOAT:5126,DOUBLE:5130},s={POINTS:0,LINES:1,LINE_LOOP:2,LINE_STRIP:3,TRIANGLES:4,TRIANGLE_STRIP:5,TRIANGLE_FAN:6,...n}},71747:(e,t,r)=>{r.d(t,{Zt:()=>s,ol:()=>i});var n=r(83500);function s(e,t){void 0===t&&(t={});const r=function(e){const t=[];for(const r in e){const n=e[r];t.push(i(r,n))}return t}(e);return{fields:r,metadata:t}}function i(e,t,r){const s=(0,n.UE)(t.value),i=r||function(e){const t={};"byteOffset"in e&&(t.byteOffset=e.byteOffset.toString(10));"byteStride"in e&&(t.byteStride=e.byteStride.toString(10));"normalized"in e&&(t.normalized=e.normalized.toString());return t}(t);return{name:e,type:{type:"fixed-size-list",listSize:t.size,children:[{name:"value",type:s}]},nullable:!1,metadata:i}}},95220:(e,t,r)=>{function n(e){let t=1/0,r=1/0,n=1/0,s=-1/0,i=-1/0,o=-1/0;const a=e.POSITION?e.POSITION.value:[],c=a&&a.length;for(let u=0;u<c;u+=3){const e=a[u],c=a[u+1],l=a[u+2];t=e<t?e:t,r=c<r?c:r,n=l<n?l:n,s=e>s?e:s,i=c>i?c:i,o=l>o?l:o}return[[t,r,n],[s,i,o]]}r.d(t,{l:()=>n})},83500:(e,t,r)=>{function n(e,t){return void 0===t&&(t="float32"),e instanceof Date?"date-millisecond":e instanceof Number?t:"string"==typeof e?"utf8":"null"}function s(e){let t=i(e);return"null"!==t?{type:t,nullable:!1}:e.length>0?(t=n(e[0]),{type:t,nullable:!0}):{type:"null",nullable:!0}}function i(e){switch(e.constructor){case Int8Array:return"int8";case Uint8Array:case Uint8ClampedArray:return"uint8";case Int16Array:return"int16";case Uint16Array:return"uint16";case Int32Array:return"int32";case Uint32Array:return"uint32";case Float32Array:return"float32";case Float64Array:return"float64";default:return"null"}}function o(e,t){if(!t)switch(e){case"int8":return Int8Array;case"uint8":return Uint8Array;case"int16":return Int16Array;case"uint16":return Uint16Array;case"int32":return Int32Array;case"uint32":return Uint32Array;case"float32":return Float32Array;case"float64":return Float64Array}return Array}r.d(t,{IT:()=>s,UE:()=>i,k1:()=>n,my:()=>o})},35644:(e,t,r)=>{function n(e){let t=1/0,r=1/0,n=1/0,s=-1/0,i=-1/0,o=-1/0;const a=e.POSITION?e.POSITION.value:[],c=a&&a.length;for(let u=0;u<c;u+=3){const e=a[u],c=a[u+1],l=a[u+2];t=e<t?e:t,r=c<r?c:r,n=l<n?l:n,s=e>s?e:s,i=c>i?c:i,o=l>o?l:o}return[[t,r,n],[s,i,o]]}r.d(t,{l:()=>n})},22120:(e,t,r)=>{r.d(t,{E:()=>i});var n=r(2602),s=r(61594);const i={...{dataType:null,batchType:null,name:"Basis",id:"basis",module:"textures",version:n.x,worker:!0,extensions:["basis","ktx2"],mimeTypes:["application/octet-stream","image/ktx2"],tests:["sB"],binary:!0,options:{basis:{format:"auto",libraryPath:"libs/",containerFormat:"auto",module:"transcoder"}}},parse:s.a}},96366:(e,t,r)=>{r.d(t,{Y:()=>V});var n=r(2602),s=r(1405),i=r(10981),o=r(22704),a=r(20243);const c=542327876,u=31,l=0,d=1,f=2,h=3,A=4,m=7,p=20,B=21,C=131072,y=4,g={DXT1:o.b.COMPRESSED_RGB_S3TC_DXT1_EXT,DXT3:o.b.COMPRESSED_RGBA_S3TC_DXT3_EXT,DXT5:o.b.COMPRESSED_RGBA_S3TC_DXT5_EXT,"ATC ":o.b.COMPRESSED_RGB_ATC_WEBGL,ATCA:o.b.COMPRESSED_RGBA_ATC_EXPLICIT_ALPHA_WEBGL,ATCI:o.b.COMPRESSED_RGBA_ATC_INTERPOLATED_ALPHA_WEBGL},b={DXT1:T,DXT3:E,DXT5:E,"ATC ":T,ATCA:E,ATCI:E};function _(e){const t=new Int32Array(e,0,u),r=t[B];(0,i.v)(Boolean(t[p]&y),"DDS: Unsupported format, must contain a FourCC code");const n=(s=r,String.fromCharCode(255&s,s>>8&255,s>>16&255,s>>24&255));var s;const o=g[n],c=b[n];(0,i.v)(o&&c,`DDS: Unknown pixel format ${r}`);let l=1;t[f]&C&&(l=Math.max(1,t[m]));const _=t[A],T=t[h],E=t[d]+4,S=new Uint8Array(e,E);return(0,a.C)(S,{mipMapLevels:l,width:_,height:T,sizeFunction:c,internalFormat:o})}function T(e,t){return(e+3>>2)*(t+3>>2)*8}function E(e,t){return(e+3>>2)*(t+3>>2)*16}const S=55727696,R=1347834371,D=13,M=52,w=0,I=2,G=4,v=6,O=7,F=11,x=12,P={0:[o.b.COMPRESSED_RGB_PVRTC_2BPPV1_IMG],1:[o.b.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG],2:[o.b.COMPRESSED_RGB_PVRTC_4BPPV1_IMG],3:[o.b.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG],6:[o.b.COMPRESSED_RGB_ETC1_WEBGL],7:[o.b.COMPRESSED_RGB_S3TC_DXT1_EXT],9:[o.b.COMPRESSED_RGBA_S3TC_DXT3_EXT],11:[o.b.COMPRESSED_RGBA_S3TC_DXT5_EXT],22:[o.b.COMPRESSED_RGB8_ETC2],23:[o.b.COMPRESSED_RGBA8_ETC2_EAC],24:[o.b.COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2],25:[o.b.COMPRESSED_R11_EAC],26:[o.b.COMPRESSED_RG11_EAC],27:[o.b.COMPRESSED_RGBA_ASTC_4X4_KHR,o.b.COMPRESSED_SRGB8_ALPHA8_ASTC_4X4_KHR],28:[o.b.COMPRESSED_RGBA_ASTC_5X4_KHR,o.b.COMPRESSED_SRGB8_ALPHA8_ASTC_5X4_KHR],29:[o.b.COMPRESSED_RGBA_ASTC_5X5_KHR,o.b.COMPRESSED_SRGB8_ALPHA8_ASTC_5X5_KHR],30:[o.b.COMPRESSED_RGBA_ASTC_6X5_KHR,o.b.COMPRESSED_SRGB8_ALPHA8_ASTC_6X5_KHR],31:[o.b.COMPRESSED_RGBA_ASTC_6X6_KHR,o.b.COMPRESSED_SRGB8_ALPHA8_ASTC_6X6_KHR],32:[o.b.COMPRESSED_RGBA_ASTC_8X5_KHR,o.b.COMPRESSED_SRGB8_ALPHA8_ASTC_8X5_KHR],33:[o.b.COMPRESSED_RGBA_ASTC_8X6_KHR,o.b.COMPRESSED_SRGB8_ALPHA8_ASTC_8X6_KHR],34:[o.b.COMPRESSED_RGBA_ASTC_8X8_KHR,o.b.COMPRESSED_SRGB8_ALPHA8_ASTC_8X8_KHR],35:[o.b.COMPRESSED_RGBA_ASTC_10X5_KHR,o.b.COMPRESSED_SRGB8_ALPHA8_ASTC_10X5_KHR],36:[o.b.COMPRESSED_RGBA_ASTC_10X6_KHR,o.b.COMPRESSED_SRGB8_ALPHA8_ASTC_10X6_KHR],37:[o.b.COMPRESSED_RGBA_ASTC_10X8_KHR,o.b.COMPRESSED_SRGB8_ALPHA8_ASTC_10X8_KHR],38:[o.b.COMPRESSED_RGBA_ASTC_10X10_KHR,o.b.COMPRESSED_SRGB8_ALPHA8_ASTC_10X10_KHR],39:[o.b.COMPRESSED_RGBA_ASTC_12X10_KHR,o.b.COMPRESSED_SRGB8_ALPHA8_ASTC_12X10_KHR],40:[o.b.COMPRESSED_RGBA_ASTC_12X12_KHR,o.b.COMPRESSED_SRGB8_ALPHA8_ASTC_12X12_KHR]},U={0:H,1:H,2:L,3:L,6:N,7:N,9:J,11:J,22:N,23:J,24:N,25:N,26:J,27:J,28:function(e,t){return Math.floor((e+4)/5)*Math.floor((t+3)/4)*16},29:function(e,t){return Math.floor((e+4)/5)*Math.floor((t+4)/5)*16},30:function(e,t){return Math.floor((e+5)/6)*Math.floor((t+4)/5)*16},31:function(e,t){return Math.floor((e+5)/6)*Math.floor((t+5)/6)*16},32:function(e,t){return Math.floor((e+7)/8)*Math.floor((t+4)/5)*16},33:function(e,t){return Math.floor((e+7)/8)*Math.floor((t+5)/6)*16},34:function(e,t){return Math.floor((e+7)/8)*Math.floor((t+7)/8)*16},35:function(e,t){return Math.floor((e+9)/10)*Math.floor((t+4)/5)*16},36:function(e,t){return Math.floor((e+9)/10)*Math.floor((t+5)/6)*16},37:function(e,t){return Math.floor((e+9)/10)*Math.floor((t+7)/8)*16},38:function(e,t){return Math.floor((e+9)/10)*Math.floor((t+9)/10)*16},39:function(e,t){return Math.floor((e+11)/12)*Math.floor((t+9)/10)*16},40:function(e,t){return Math.floor((e+11)/12)*Math.floor((t+11)/12)*16}};function H(e,t){return(e=Math.max(e,16))*(t=Math.max(t,8))/4}function L(e,t){return(e=Math.max(e,8))*(t=Math.max(t,8))/2}function N(e,t){return Math.floor((e+3)/4)*Math.floor((t+3)/4)*8}function J(e,t){return Math.floor((e+3)/4)*Math.floor((t+3)/4)*16}function j(e){if((0,s.e)(e))return(0,s.V)(e);if(function(e){return new Uint32Array(e,0,u)[l]===c}(e))return _(e);if(function(e){const t=new Uint32Array(e,0,D)[w];return t===S||t===R}(e))return function(e){const t=new Uint32Array(e,0,D),r=t[I],n=t[G],s=P[r]||[],i=s.length>1&&n?s[1]:s[0],o=U[r],c=t[F],u=t[O],l=t[v],d=M+t[x],f=new Uint8Array(e,d);return(0,a.C)(f,{mipMapLevels:c,width:u,height:l,sizeFunction:o,internalFormat:i})}(e);throw new Error("Texture container format not recognized")}var K=r(61594);const V={...{dataType:null,batchType:null,name:"Texture Containers",id:"compressed-texture",module:"textures",version:n.x,worker:!0,extensions:["ktx","ktx2","dds","pvr"],mimeTypes:["image/ktx2","image/ktx","image/vnd-ms.dds","image/x-dds","application/octet-stream"],binary:!0,options:{"compressed-texture":{libraryPath:"libs/",useBasis:!1}}},parse:async(e,t)=>{if(t?.["compressed-texture"]?.useBasis){t.basis={format:{alpha:"BC3",noAlpha:"BC1"},...t.basis,containerFormat:"ktx2",module:"encoder"};return(await(0,K.a)(e,t))[0]}return j(e)}}},22704:(e,t,r)=>{r.d(t,{b:()=>n});const n={COMPRESSED_RGB_S3TC_DXT1_EXT:33776,COMPRESSED_RGBA_S3TC_DXT1_EXT:33777,COMPRESSED_RGBA_S3TC_DXT3_EXT:33778,COMPRESSED_RGBA_S3TC_DXT5_EXT:33779,COMPRESSED_R11_EAC:37488,COMPRESSED_SIGNED_R11_EAC:37489,COMPRESSED_RG11_EAC:37490,COMPRESSED_SIGNED_RG11_EAC:37491,COMPRESSED_RGB8_ETC2:37492,COMPRESSED_RGBA8_ETC2_EAC:37493,COMPRESSED_SRGB8_ETC2:37494,COMPRESSED_SRGB8_ALPHA8_ETC2_EAC:37495,COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2:37496,COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2:37497,COMPRESSED_RGB_PVRTC_4BPPV1_IMG:35840,COMPRESSED_RGBA_PVRTC_4BPPV1_IMG:35842,COMPRESSED_RGB_PVRTC_2BPPV1_IMG:35841,COMPRESSED_RGBA_PVRTC_2BPPV1_IMG:35843,COMPRESSED_RGB_ETC1_WEBGL:36196,COMPRESSED_RGB_ATC_WEBGL:35986,COMPRESSED_RGBA_ATC_EXPLICIT_ALPHA_WEBGL:35987,COMPRESSED_RGBA_ATC_INTERPOLATED_ALPHA_WEBGL:34798,COMPRESSED_RGBA_ASTC_4X4_KHR:37808,COMPRESSED_RGBA_ASTC_5X4_KHR:37809,COMPRESSED_RGBA_ASTC_5X5_KHR:37810,COMPRESSED_RGBA_ASTC_6X5_KHR:37811,COMPRESSED_RGBA_ASTC_6X6_KHR:37812,COMPRESSED_RGBA_ASTC_8X5_KHR:37813,COMPRESSED_RGBA_ASTC_8X6_KHR:37814,COMPRESSED_RGBA_ASTC_8X8_KHR:37815,COMPRESSED_RGBA_ASTC_10X5_KHR:37816,COMPRESSED_RGBA_ASTC_10X6_KHR:37817,COMPRESSED_RGBA_ASTC_10X8_KHR:37818,COMPRESSED_RGBA_ASTC_10X10_KHR:37819,COMPRESSED_RGBA_ASTC_12X10_KHR:37820,COMPRESSED_RGBA_ASTC_12X12_KHR:37821,COMPRESSED_SRGB8_ALPHA8_ASTC_4X4_KHR:37840,COMPRESSED_SRGB8_ALPHA8_ASTC_5X4_KHR:37841,COMPRESSED_SRGB8_ALPHA8_ASTC_5X5_KHR:37842,COMPRESSED_SRGB8_ALPHA8_ASTC_6X5_KHR:37843,COMPRESSED_SRGB8_ALPHA8_ASTC_6X6_KHR:37844,COMPRESSED_SRGB8_ALPHA8_ASTC_8X5_KHR:37845,COMPRESSED_SRGB8_ALPHA8_ASTC_8X6_KHR:37846,COMPRESSED_SRGB8_ALPHA8_ASTC_8X8_KHR:37847,COMPRESSED_SRGB8_ALPHA8_ASTC_10X5_KHR:37848,COMPRESSED_SRGB8_ALPHA8_ASTC_10X6_KHR:37849,COMPRESSED_SRGB8_ALPHA8_ASTC_10X8_KHR:37850,COMPRESSED_SRGB8_ALPHA8_ASTC_10X10_KHR:37851,COMPRESSED_SRGB8_ALPHA8_ASTC_12X10_KHR:37852,COMPRESSED_SRGB8_ALPHA8_ASTC_12X12_KHR:37853,COMPRESSED_RED_RGTC1_EXT:36283,COMPRESSED_SIGNED_RED_RGTC1_EXT:36284,COMPRESSED_RED_GREEN_RGTC2_EXT:36285,COMPRESSED_SIGNED_RED_GREEN_RGTC2_EXT:36286,COMPRESSED_SRGB_S3TC_DXT1_EXT:35916,COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT:35917,COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT:35918,COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT:35919}},61594:(e,t,r)=>{r.d(t,{a:()=>A,J:()=>g});var n=r(21098),s=r(8821);const i={TRANSCODER:"basis_transcoder.js",TRANSCODER_WASM:"basis_transcoder.wasm",ENCODER:"basis_encoder.js",ENCODER_WASM:"basis_encoder.wasm"};let o,a;async function c(e){(0,n.Qz)(e.modules);const t=(0,n.w7)("basis");return t||(o||=async function(e){let t=null,r=null;return[t,r]=await Promise.all([await(0,s._)(i.TRANSCODER,"textures",e),await(0,s._)(i.TRANSCODER_WASM,"textures",e)]),t=t||globalThis.BASIS,await function(e,t){const r={};t&&(r.wasmBinary=t);return new Promise((t=>{e(r).then((e=>{const{BasisFile:r,initializeBasis:n}=e;n(),t({BasisFile:r})}))}))}(t,r)}(e),await o)}async function u(e){const t=e.modules||{};return t.basisEncoder?t.basisEncoder:(a=a||async function(e){let t=null,r=null;return[t,r]=await Promise.all([await(0,s._)(i.ENCODER,"textures",e),await(0,s._)(i.ENCODER_WASM,"textures",e)]),t=t||globalThis.BASIS,await function(e,t){const r={};t&&(r.wasmBinary=t);return new Promise((t=>{e(r).then((e=>{const{BasisFile:r,KTX2File:n,initializeBasis:s,BasisEncoder:i}=e;s(),t({BasisFile:r,KTX2File:n,BasisEncoder:i})}))}))}(t,r)}(e),await a)}var l=r(22704),d=r(78312),f=r(1405);const h={etc1:{basisFormat:0,compressed:!0,format:l.b.COMPRESSED_RGB_ETC1_WEBGL},etc2:{basisFormat:1,compressed:!0},bc1:{basisFormat:2,compressed:!0,format:l.b.COMPRESSED_RGB_S3TC_DXT1_EXT},bc3:{basisFormat:3,compressed:!0,format:l.b.COMPRESSED_RGBA_S3TC_DXT5_EXT},bc4:{basisFormat:4,compressed:!0},bc5:{basisFormat:5,compressed:!0},"bc7-m6-opaque-only":{basisFormat:6,compressed:!0},"bc7-m5":{basisFormat:7,compressed:!0},"pvrtc1-4-rgb":{basisFormat:8,compressed:!0,format:l.b.COMPRESSED_RGB_PVRTC_4BPPV1_IMG},"pvrtc1-4-rgba":{basisFormat:9,compressed:!0,format:l.b.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG},"astc-4x4":{basisFormat:10,compressed:!0,format:l.b.COMPRESSED_RGBA_ASTC_4X4_KHR},"atc-rgb":{basisFormat:11,compressed:!0},"atc-rgba-interpolated-alpha":{basisFormat:12,compressed:!0},rgba32:{basisFormat:13,compressed:!1},rgb565:{basisFormat:14,compressed:!1},bgr565:{basisFormat:15,compressed:!1},rgba4444:{basisFormat:16,compressed:!1}};async function A(e,t){if("auto"===t.basis.containerFormat){if((0,f.e)(e)){return B((await u(t)).KTX2File,e,t)}const{BasisFile:r}=await c(t);return m(r,e,t)}if("encoder"===t.basis.module){const r=await u(t);return"ktx2"===t.basis.containerFormat?B(r.KTX2File,e,t):m(r.BasisFile,e,t)}{const{BasisFile:r}=await c(t);return m(r,e,t)}}function m(e,t,r){const n=new e(new Uint8Array(t));try{if(!n.startTranscoding())throw new Error("Failed to start basis transcoding");const e=n.getNumImages(),t=[];for(let s=0;s<e;s++){const e=n.getNumLevels(s),i=[];for(let t=0;t<e;t++)i.push(p(n,s,t,r));t.push(i)}return t}finally{n.close(),n.delete()}}function p(e,t,r,n){const s=e.getImageWidth(t,r),i=e.getImageHeight(t,r),o=e.getHasAlpha(),{compressed:a,format:c,basisFormat:u}=y(n,o),l=e.getImageTranscodedSizeInBytes(t,r,u),d=new Uint8Array(l);if(!e.transcodeImage(d,t,r,u,0,0))throw new Error("failed to start Basis transcoding");return{width:s,height:i,data:d,compressed:a,format:c,hasAlpha:o}}function B(e,t,r){const n=new e(new Uint8Array(t));try{if(!n.startTranscoding())throw new Error("failed to start KTX2 transcoding");const e=n.getLevels(),t=[];for(let s=0;s<e;s++)t.push(C(n,s,r));return[t]}finally{n.close(),n.delete()}}function C(e,t,r){const{alphaFlag:n,height:s,width:i}=e.getImageLevelInfo(t,0,0),{compressed:o,format:a,basisFormat:c}=y(r,n),u=e.getImageTranscodedSizeInBytes(t,0,0,c),l=new Uint8Array(u);if(!e.transcodeImage(l,t,0,0,c,0,-1,-1))throw new Error("Failed to transcode KTX2 image");return{width:i,height:s,data:l,compressed:o,levelSize:u,hasAlpha:n,format:a}}function y(e,t){let r=e&&e.basis&&e.basis.format;return"auto"===r&&(r=g()),"object"==typeof r&&(r=t?r.alpha:r.noAlpha),r=r.toLowerCase(),h[r]}function g(){const e=(0,d.E)();return e.has("astc")?"astc-4x4":e.has("dxt")?{alpha:"bc3",noAlpha:"bc1"}:e.has("pvrtc")?{alpha:"pvrtc1-4-rgba",noAlpha:"pvrtc1-4-rgb"}:e.has("etc1")?"etc1":e.has("etc2")?"etc2":"rgb565"}},1405:(e,t,r)=>{r.d(t,{e:()=>c,V:()=>u});var n=r(10456),s=r(20243),i=r(22704);const o={131:i.b.COMPRESSED_RGB_S3TC_DXT1_EXT,132:i.b.COMPRESSED_SRGB_S3TC_DXT1_EXT,133:i.b.COMPRESSED_RGBA_S3TC_DXT1_EXT,134:i.b.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT,135:i.b.COMPRESSED_RGBA_S3TC_DXT3_EXT,136:i.b.COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT,137:i.b.COMPRESSED_RGBA_S3TC_DXT5_EXT,138:i.b.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT,139:i.b.COMPRESSED_RED_RGTC1_EXT,140:i.b.COMPRESSED_SIGNED_RED_RGTC1_EXT,141:i.b.COMPRESSED_RED_GREEN_RGTC2_EXT,142:i.b.COMPRESSED_SIGNED_RED_GREEN_RGTC2_EXT,147:i.b.COMPRESSED_RGB8_ETC2,148:i.b.COMPRESSED_SRGB8_ETC2,149:i.b.COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2,150:i.b.COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2,151:i.b.COMPRESSED_RGBA8_ETC2_EAC,152:i.b.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC,153:i.b.COMPRESSED_R11_EAC,154:i.b.COMPRESSED_SIGNED_R11_EAC,155:i.b.COMPRESSED_RG11_EAC,156:i.b.COMPRESSED_SIGNED_RG11_EAC,157:i.b.COMPRESSED_RGBA_ASTC_4x4_KHR,158:i.b.COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR,159:i.b.COMPRESSED_RGBA_ASTC_5x4_KHR,160:i.b.COMPRESSED_SRGB8_ALPHA8_ASTC_5X4_KHR,161:i.b.COMPRESSED_RGBA_ASTC_5x5_KHR,162:i.b.COMPRESSED_SRGB8_ALPHA8_ASTC_5x5_KHR,163:i.b.COMPRESSED_RGBA_ASTC_6x5_KHR,164:i.b.COMPRESSED_SRGB8_ALPHA8_ASTC_6x5_KHR,165:i.b.COMPRESSED_RGBA_ASTC_6x6_KHR,166:i.b.COMPRESSED_SRGB8_ALPHA8_ASTC_6x6_KHR,167:i.b.COMPRESSED_RGBA_ASTC_8x5_KHR,168:i.b.COMPRESSED_SRGB8_ALPHA8_ASTC_8x5_KHR,169:i.b.COMPRESSED_RGBA_ASTC_8x6_KHR,170:i.b.COMPRESSED_SRGB8_ALPHA8_ASTC_8x6_KHR,171:i.b.COMPRESSED_RGBA_ASTC_8x8_KHR,172:i.b.COMPRESSED_SRGB8_ALPHA8_ASTC_8x8_KHR,173:i.b.COMPRESSED_RGBA_ASTC_10x5_KHR,174:i.b.COMPRESSED_SRGB8_ALPHA8_ASTC_10x5_KHR,175:i.b.COMPRESSED_RGBA_ASTC_10x6_KHR,176:i.b.COMPRESSED_SRGB8_ALPHA8_ASTC_10x6_KHR,177:i.b.COMPRESSED_RGBA_ASTC_10x8_KHR,178:i.b.COMPRESSED_SRGB8_ALPHA8_ASTC_10x8_KHR,179:i.b.COMPRESSED_RGBA_ASTC_10x10_KHR,180:i.b.COMPRESSED_SRGB8_ALPHA8_ASTC_10x10_KHR,181:i.b.COMPRESSED_RGBA_ASTC_12x10_KHR,182:i.b.COMPRESSED_SRGB8_ALPHA8_ASTC_12x10_KHR,183:i.b.COMPRESSED_RGBA_ASTC_12x12_KHR,184:i.b.COMPRESSED_SRGB8_ALPHA8_ASTC_12x12_KHR,1000054e3:i.b.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG,1000054001:i.b.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG,1000066e3:i.b.COMPRESSED_RGBA_ASTC_4x4_KHR,1000066001:i.b.COMPRESSED_RGBA_ASTC_5x4_KHR,1000066002:i.b.COMPRESSED_RGBA_ASTC_5x5_KHR,1000066003:i.b.COMPRESSED_RGBA_ASTC_6x5_KHR,1000066004:i.b.COMPRESSED_RGBA_ASTC_6x6_KHR,1000066005:i.b.COMPRESSED_RGBA_ASTC_8x5_KHR,1000066006:i.b.COMPRESSED_RGBA_ASTC_8x6_KHR,1000066007:i.b.COMPRESSED_RGBA_ASTC_8x8_KHR,1000066008:i.b.COMPRESSED_RGBA_ASTC_10x5_KHR,1000066009:i.b.COMPRESSED_RGBA_ASTC_10x6_KHR,1000066010:i.b.COMPRESSED_RGBA_ASTC_10x8_KHR,1000066011:i.b.COMPRESSED_RGBA_ASTC_10x10_KHR,1000066012:i.b.COMPRESSED_RGBA_ASTC_12x10_KHR,1000066013:i.b.COMPRESSED_RGBA_ASTC_12x12_KHR};const a=[171,75,84,88,32,50,48,187,13,10,26,10];function c(e){const t=new Uint8Array(e);return!(t.byteLength<a.length||t[0]!==a[0]||t[1]!==a[1]||t[2]!==a[2]||t[3]!==a[3]||t[4]!==a[4]||t[5]!==a[5]||t[6]!==a[6]||t[7]!==a[7]||t[8]!==a[8]||t[9]!==a[9]||t[10]!==a[10]||t[11]!==a[11])}function u(e){const t=new Uint8Array(e),r=(0,n.LF4)(t),i=Math.max(1,r.levels.length),a=r.pixelWidth,c=r.pixelHeight,u=(l=r.vkFormat,o[l]);var l;return(0,s.C)(r.levels,{mipMapLevels:i,width:a,height:c,sizeFunction:e=>e.uncompressedByteLength,internalFormat:u})}},20243:(e,t,r)=>{function n(e,t){const r=new Array(t.mipMapLevels);let n=t.width,o=t.height,a=0;for(let c=0;c<t.mipMapLevels;++c){const u=i(t,n,o,e,c),l=s(e,c,a,u);r[c]={compressed:!0,format:t.internalFormat,data:l,width:n,height:o,levelSize:u},n=Math.max(1,n>>1),o=Math.max(1,o>>1),a+=u}return r}function s(e,t,r,n){return Array.isArray(e)?e[t].levelData:new Uint8Array(e.buffer,e.byteOffset+r,n)}function i(e,t,r,n,s){return Array.isArray(n)?e.sizeFunction(n[s]):e.sizeFunction(t,r)}r.d(t,{C:()=>n})},78312:(e,t,r)=>{r.d(t,{E:()=>o});const n=["","WEBKIT_","MOZ_"],s={WEBGL_compressed_texture_s3tc:"dxt",WEBGL_compressed_texture_s3tc_srgb:"dxt-srgb",WEBGL_compressed_texture_etc1:"etc1",WEBGL_compressed_texture_etc:"etc2",WEBGL_compressed_texture_pvrtc:"pvrtc",WEBGL_compressed_texture_atc:"atc",WEBGL_compressed_texture_astc:"astc",EXT_texture_compression_rgtc:"rgtc"};let i=null;function o(e){if(!i){e=e||function(){try{return document.createElement("canvas").getContext("webgl")}catch(e){return null}}()||void 0,i=new Set;for(const t of n)for(const r in s)if(e&&e.getExtension(`${t}${r}`)){const e=s[r];i.add(e)}}return i}},2602:(e,t,r)=>{r.d(t,{x:()=>n});const n="undefined"!=typeof __VERSION__?__VERSION__:"latest"},68118:(e,t,r)=>{r.d(t,{MY:()=>c,TP:()=>n,WH:()=>i,ir:()=>a,lH:()=>s,yy:()=>o});const n={UNLOADED:0,LOADING:1,PROCESSING:2,READY:3,EXPIRED:4,FAILED:5};let s=function(e){return e[e.ADD=1]="ADD",e[e.REPLACE=2]="REPLACE",e}({}),i=function(e){return e.EMPTY="empty",e.SCENEGRAPH="scenegraph",e.POINTCLOUD="pointcloud",e.MESH="mesh",e}({}),o=function(e){return e.I3S="I3S",e.TILES3D="TILES3D",e}({}),a=function(e){return e.GEOMETRIC_ERROR="geometricError",e.MAX_SCREEN_THRESHOLD="maxScreenThreshold",e}({});const c={NOT_COMPUTED:-1,USE_OPTIMIZATION:1,SKIP_OPTIMIZATION:0}},40830:(e,t,r)=>{r.d(t,{Q:()=>Ee});var n=r(31886),s=r(87597),i=r(4912),o=r(21143),a=r(36970),c=r(85796);class u{constructor(e,t,r){this.item=e,this.previous=t,this.next=r}}class l{head=null;tail=null;_length=0;get length(){return this._length}add(e){const t=new u(e,this.tail,null);return this.tail?(this.tail.next=t,this.tail=t):(this.head=t,this.tail=t),++this._length,t}remove(e){e&&(e.previous&&e.next?(e.previous.next=e.next,e.next.previous=e.previous):e.previous?(e.previous.next=null,this.tail=e.previous):e.next?(e.next.previous=null,this.head=e.next):(this.head=null,this.tail=null),e.next=null,e.previous=null,--this._length)}splice(e,t){e!==t&&(this.remove(t),this._insert(e,t))}_insert(e,t){const r=e.next;e.next=t,this.tail===e?this.tail=t:r.previous=t,t.next=r,t.previous=e,++this._length}}class d{constructor(){this._list=new l,this._sentinel=this._list.add("sentinel"),this._trimTiles=!1}reset(){this._list.splice(this._list.tail,this._sentinel)}touch(e){const t=e._cacheNode;t&&this._list.splice(this._sentinel,t)}add(e,t,r){t._cacheNode||(t._cacheNode=this._list.add(t),r&&r(e,t))}unloadTile(e,t,r){const n=t._cacheNode;n&&(this._list.remove(n),t._cacheNode=null,r&&r(e,t))}unloadTiles(e,t){const r=this._trimTiles;this._trimTiles=!1;const n=this._list,s=1024*e.maximumMemoryUsage*1024,i=this._sentinel;let o=n.head;for(;o!==i&&(e.gpuMemoryUsageInBytes>s||r);){const r=o.item;o=o.next,this.unloadTile(e,r,t)}}trim(){this._trimTiles=!0}}var f=r(10981);var h=r(67733);const A=new s.P,m=new s.P,p=new h.R2([new h.Zc,new h.Zc,new h.Zc,new h.Zc,new h.Zc,new h.Zc]);function B(e,t){const{cameraDirection:r,cameraUp:n,height:o}=e,{metersPerUnit:a}=e.distanceScales,c=y(e,e.center),u=i.C.WGS84.eastNorthUpToFixedFrame(c),l=e.unprojectPosition(e.cameraPosition),d=i.C.WGS84.cartographicToCartesian(l,new s.P),f=new s.P(u.transformAsVector(new s.P(r).scale(a))).normalize(),h=new s.P(u.transformAsVector(new s.P(n).scale(a))).normalize();!function(e){const t=e.getFrustumPlanes(),r=C(t.near,e.cameraPosition),n=y(e,r),s=y(e,e.cameraPosition,m);let i=0;p.planes[i++].fromPointNormal(n,A.copy(n).subtract(s));for(const o in t){if("near"===o)continue;const s=y(e,C(t[o],r,m),m);p.planes[i++].fromPointNormal(s,A.copy(n).subtract(s))}}(e);const B=e.constructor,{longitude:g,latitude:b,width:_,bearing:T,zoom:E}=e;return{camera:{position:d,direction:f,up:h},viewport:e,topDownViewport:new B({longitude:g,latitude:b,height:o,width:_,bearing:T,zoom:E,pitch:0}),height:o,cullingVolume:p,frameNumber:t,sseDenominator:1.15}}function C(e,t,r){void 0===r&&(r=new s.P);const n=e.normal.dot(t);return r.copy(e.normal).scale(e.distance-n).add(t),r}function y(e,t,r){void 0===r&&(r=new s.P);const n=e.unprojectPosition(t);return i.C.WGS84.cartographicToCartesian(n,r)}const g=6356752.314245179,b=new s.P;function _(e,t){if(e instanceof h.CB){const{halfAxes:r}=e,n=function(e){e.getColumn(0,b);const t=e.getColumn(1),r=e.getColumn(2),n=b.add(t).add(r);return n.len()}(r);return Math.log2(g/(n+t[2]))}if(e instanceof h.ie){const{radius:r}=e;return Math.log2(g/(r+t[2]))}if(e.width&&e.height){const{width:t,height:r}=e;return(Math.log2(6378137/t)+Math.log2(6378137/r))/2}return 1}function T(e,t,r){i.C.WGS84.cartographicToCartesian([e.xmax,e.ymax,e.zmax],b);const n=Math.sqrt(Math.pow(b[0]-r[0],2)+Math.pow(b[1]-r[1],2)+Math.pow(b[2]-r[2],2));return Math.log2(g/(n+t[2]))}var E=r(85930),S=r(68118),R=r(54901),D=r(11633),M=r(35567);function w(e){return null!=e}const I=new s.P,G=new s.P,v=new s.P,O=new s.P,F=new s.P,x=new s.P,P=new s.P,U=new s.P;function H(e,t,r){if((0,f.v)(e,"3D Tile: boundingVolume must be defined"),e.box)return N(e.box,t,r);if(e.region)return function(e){const[t,r,o,a,c,u]=e,l=i.C.WGS84.cartographicToCartesian([(0,R.uj)(t),(0,R.uj)(a),c],v),d=i.C.WGS84.cartographicToCartesian([(0,R.uj)(o),(0,R.uj)(r),u],O),f=(new s.P).addVectors(l,d).multiplyByScalar(.5);return i.C.WGS84.cartesianToCartographic(f,F),i.C.WGS84.cartographicToCartesian([(0,R.uj)(o),F[1],F[2]],x),i.C.WGS84.cartographicToCartesian([F[0],(0,R.uj)(a),F[2]],P),i.C.WGS84.cartographicToCartesian([F[0],F[1],u],U),N([...f,...x.subtract(f),...P.subtract(f),...U.subtract(f)],new n.k)}(e.region);if(e.sphere)return function(e,t,r){const n=new s.P(e[0],e[1],e[2]);t.transform(n,n);const i=t.getScale(G),o=Math.max(Math.max(i[0],i[1]),i[2]),a=e[3]*o;if(w(r))return r.center=n,r.radius=a,r;return new h.ie(n,a)}(e.sphere,t,r);throw new Error("3D Tile: boundingVolume must contain a sphere, region, or box")}function L(e,t){if(e.box)return function(e){const t=J(),{halfAxes:r}=e,n=new s.P(r.getColumn(0)),i=new s.P(r.getColumn(1)),o=new s.P(r.getColumn(2));for(let s=0;s<2;s++){for(let r=0;r<2;r++){for(let r=0;r<2;r++)I.copy(e.center),I.add(n),I.add(i),I.add(o),j(t,I),o.negate();i.negate()}n.negate()}return t}(t);if(e.region){const[t,r,n,s,i,o]=e.region;return[[(0,R.uj)(t),(0,R.uj)(r),i],[(0,R.uj)(n),(0,R.uj)(s),o]]}if(e.sphere)return function(e){const t=J(),{center:r,radius:n}=e,o=i.C.WGS84.scaleToGeodeticSurface(r,I);let a;a=o?i.C.WGS84.geodeticSurfaceNormal(o):new s.P(0,0,1);let c=new s.P(a[2],-a[1],0);c.len()>0?c.normalize():c=new s.P(0,1,0);const u=c.clone().cross(a);for(const s of[c,u,a]){G.copy(s).scale(n);for(let e=0;e<2;e++)I.copy(r),I.add(G),j(t,I),G.negate()}return t}(t);throw new Error("Unkown boundingVolume type")}function N(e,t,r){const n=new s.P(e[0],e[1],e[2]);t.transform(n,n);let i=[];if(10===e.length){const t=e.slice(3,6),r=new D.P;r.fromArray(e,6);const n=new s.P([1,0,0]),o=new s.P([0,1,0]),a=new s.P([0,0,1]);n.transformByQuaternion(r),n.scale(t[0]),o.transformByQuaternion(r),o.scale(t[1]),a.transformByQuaternion(r),a.scale(t[2]),i=[...n.toArray(),...o.toArray(),...a.toArray()]}else i=[...e.slice(3,6),...e.slice(6,9),...e.slice(9,12)];const o=t.transformAsVector(i.slice(0,3)),a=t.transformAsVector(i.slice(3,6)),c=t.transformAsVector(i.slice(6,9)),u=new M.d([o[0],o[1],o[2],a[0],a[1],a[2],c[0],c[1],c[2]]);return w(r)?(r.center=n,r.halfAxes=u,r):new h.CB(n,u)}function J(){return[[1/0,1/0,1/0],[-1/0,-1/0,-1/0]]}function j(e,t){i.C.WGS84.cartesianToCartographic(t,I),e[0][0]=Math.min(e[0][0],I[0]),e[0][1]=Math.min(e[0][1],I[1]),e[0][2]=Math.min(e[0][2],I[2]),e[1][0]=Math.max(e[1][0],I[0]),e[1][1]=Math.max(e[1][1],I[1]),e[1][2]=Math.max(e[1][2],I[2])}new s.P,new s.P,new n.k,new s.P,new s.P,new s.P;function K(e,t){if(e.dynamicScreenSpaceError&&e.dynamicScreenSpaceErrorComputedDensity){const r=e.dynamicScreenSpaceErrorComputedDensity,n=e.dynamicScreenSpaceErrorFactor,s=function(e,t){const r=e*t;return 1-Math.exp(-r*r)}(t,r)*n;return s}return 0}const V=new s.P,k=new s.P,X=new s.P,Q=new s.P,z=new s.P,Y=new n.k,W=new n.k;function q(e,t){const{topDownViewport:r}=t,n=e.header.mbs[1],s=e.header.mbs[0],o=e.header.mbs[2],a=e.header.mbs[3],c=[...e.boundingVolume.center],u=r.unprojectPosition(r.cameraPosition);i.C.WGS84.cartographicToCartesian(u,V),k.copy(V).subtract(c).normalize(),i.C.WGS84.eastNorthUpToFixedFrame(c,Y),W.copy(Y).invert(),X.copy(V).transform(W);const l=Math.sqrt(X[0]*X[0]+X[1]*X[1]),d=l*l/X[2];Q.copy([X[0],X[1],d]);const f=Q.transform(Y).subtract(c).normalize(),h=k.cross(f).normalize().scale(a).add(c),A=i.C.WGS84.cartesianToCartographic(h),m=r.project([s,n,o]),p=r.project(A);return z.copy(m).subtract(p).magnitude()}class Z{_map=(()=>new Map)();constructor(e){void 0===e&&(e=0),this._array=new Array(e),this._length=e}get length(){return this._length}set length(e){this._length=e,e>this._array.length&&(this._array.length=e)}get values(){return this._array}get(e){return(0,f.v)(e<this._array.length),this._array[e]}set(e,t){(0,f.v)(e>=0),e>=this.length&&(this.length=e+1),this._map.has(this._array[e])&&this._map.delete(this._array[e]),this._array[e]=t,this._map.set(t,e)}delete(e){const t=this._map.get(e);t>=0&&(this._array.splice(t,1),this._map.delete(e),this.length--)}peek(){return this._array[this._length-1]}push(e){if(!this._map.has(e)){const t=this.length++;this._array[t]=e,this._map.set(e,t)}}pop(){const e=this._array[--this.length];return this._map.delete(e),e}reserve(e){(0,f.v)(e>=0),e>this._array.length&&(this._array.length=e)}resize(e){(0,f.v)(e>=0),this.length=e}trim(e){null==e&&(e=this.length),this._array.length=e}reset(){this._array=[],this._map=new Map,this._length=0}find(e){return this._map.has(e)}}const $={loadSiblings:!1,skipLevelOfDetail:!1,updateTransforms:!0,onTraversalEnd:()=>{},viewportTraversersMap:{},basePath:""};class ee{root=null;selectedTiles={};requestedTiles={};emptyTiles={};lastUpdate=(()=>(new Date).getTime())();updateDebounceTime=1e3;_traversalStack=(()=>new Z)();_emptyTraversalStack=(()=>new Z)();_frameNumber=null;traversalFinished(e){return!0}constructor(e){this.options={...$,...e}}traverse(e,t,r){this.root=e,this.options={...this.options,...r},this.reset(),this.updateTile(e,t),this._frameNumber=t.frameNumber,this.executeTraversal(e,t)}reset(){this.requestedTiles={},this.selectedTiles={},this.emptyTiles={},this._traversalStack.reset(),this._emptyTraversalStack.reset()}executeTraversal(e,t){const r=this._traversalStack;for(e._selectionDepth=1,r.push(e);r.length>0;){const e=r.pop();let n=!1;this.canTraverse(e,t)&&(this.updateChildTiles(e,t),n=this.updateAndPushChildren(e,t,r,e.hasRenderContent?e._selectionDepth+1:e._selectionDepth));const s=e.parent,i=Boolean(!s||s._shouldRefine),o=!n;e.hasRenderContent?e.refine===S.lH.ADD?(this.loadTile(e,t),this.selectTile(e,t)):e.refine===S.lH.REPLACE&&(this.loadTile(e,t),o&&this.selectTile(e,t)):(this.emptyTiles[e.id]=e,this.loadTile(e,t),o&&this.selectTile(e,t)),this.touchTile(e,t),e._shouldRefine=n&&i}const n=(new Date).getTime();(this.traversalFinished(t)||n-this.lastUpdate>this.updateDebounceTime)&&(this.lastUpdate=n,this.options.onTraversalEnd(t))}updateChildTiles(e,t){const r=e.children;for(const n of r)this.updateTile(n,t)}updateAndPushChildren(e,t,r,n){const{loadSiblings:s,skipLevelOfDetail:i}=this.options,o=e.children;o.sort(this.compareDistanceToCamera.bind(this));const a=e.refine===S.lH.REPLACE&&e.hasRenderContent&&!i;let c=!1,u=!0;for(const l of o)if(l._selectionDepth=n,l.isVisibleAndInRequestVolume?(r.find(l)&&r.delete(l),r.push(l),c=!0):(a||s)&&(this.loadTile(l,t),this.touchTile(l,t)),a){let e;if(e=!!l._inRequestVolume&&(l.hasRenderContent?l.contentAvailable:this.executeEmptyTraversal(l,t)),u=u&&e,!u)return!1}return c||(u=!1),u}updateTile(e,t){this.updateTileVisibility(e,t)}selectTile(e,t){this.shouldSelectTile(e)&&(e._selectedFrame=t.frameNumber,this.selectedTiles[e.id]=e)}loadTile(e,t){this.shouldLoadTile(e)&&(e._requestedFrame=t.frameNumber,e._priority=e._getPriority(),this.requestedTiles[e.id]=e)}touchTile(e,t){e.tileset._cache.touch(e),e._touchedFrame=t.frameNumber}canTraverse(e,t){return!!e.hasChildren&&(e.hasTilesetContent?!e.contentExpired:this.shouldRefine(e,t))}shouldLoadTile(e){return e.hasUnloadedContent||e.contentExpired}shouldSelectTile(e){return e.contentAvailable&&!this.options.skipLevelOfDetail}shouldRefine(e,t,r){void 0===r&&(r=!1);let n=e._screenSpaceError;return r&&(n=e.getScreenSpaceError(t,!0)),n>e.tileset.memoryAdjustedScreenSpaceError}updateTileVisibility(e,t){const r=[];if(this.options.viewportTraversersMap)for(const n in this.options.viewportTraversersMap){this.options.viewportTraversersMap[n]===t.viewport.id&&r.push(n)}else r.push(t.viewport.id);e.updateVisibility(t,r)}compareDistanceToCamera(e,t){return e._distanceToCamera-t._distanceToCamera}anyChildrenVisible(e,t){let r=!1;for(const n of e.children)n.updateVisibility(t),r=r||n.isVisibleAndInRequestVolume;return r}executeEmptyTraversal(e,t){let r=!0;const n=this._emptyTraversalStack;for(n.push(e);n.length>0;){const e=n.pop(),s=!e.hasRenderContent&&this.canTraverse(e,t),i=!e.hasRenderContent&&0===e.children.length;if(s||e.contentAvailable||i||(r=!1),this.updateTile(e,t),e.isVisibleAndInRequestVolume||(this.loadTile(e,t),this.touchTile(e,t)),s){const t=e.children;for(const e of t)n.push(e)}}return r}}var te=r(80247);const re=new s.P;class ne{lodMetricType="geometricError";lodMetricValue=0;boundingVolume=null;content=null;contentState=(()=>S.TP.UNLOADED)();gpuMemoryUsageInBytes=0;children=[];depth=0;viewportIds=[];transform=(()=>new n.k)();extensions=null;implicitTiling=null;userData={};hasEmptyContent=!1;hasTilesetContent=!1;traverser=(()=>new ee({}))();_cacheNode=null;_frameNumber=null;_expireDate=null;_expiredContent=null;_boundingBox=void 0;_distanceToCamera=0;_screenSpaceError=0;_visible=void 0;_initialTransform=(()=>new n.k)();_priority=0;_selectedFrame=0;_requestedFrame=0;_selectionDepth=0;_touchedFrame=0;_centerZDepth=0;_shouldRefine=!1;_stackLength=0;_visitedFrame=0;_inRequestVolume=!1;_lodJudge=null;constructor(e,t,r,n){void 0===n&&(n=""),this.header=t,this.tileset=e,this.id=n||t.id,this.url=t.url,this.parent=r,this.refine=this._getRefine(t.refine),this.type=t.type,this.contentUrl=t.contentUrl,this._initializeLodMetric(t),this._initializeTransforms(t),this._initializeBoundingVolumes(t),this._initializeContent(t),this._initializeRenderingState(t),Object.seal(this)}destroy(){this.header=null}isDestroyed(){return null===this.header}get selected(){return this._selectedFrame===this.tileset._frameNumber}get isVisible(){return this._visible}get isVisibleAndInRequestVolume(){return this._visible&&this._inRequestVolume}get hasRenderContent(){return!this.hasEmptyContent&&!this.hasTilesetContent}get hasChildren(){return this.children.length>0||this.header.children&&this.header.children.length>0}get contentReady(){return this.contentState===S.TP.READY||this.hasEmptyContent}get contentAvailable(){return Boolean(this.contentReady&&this.hasRenderContent||this._expiredContent&&!this.contentFailed)}get hasUnloadedContent(){return this.hasRenderContent&&this.contentUnloaded}get contentUnloaded(){return this.contentState===S.TP.UNLOADED}get contentExpired(){return this.contentState===S.TP.EXPIRED}get contentFailed(){return this.contentState===S.TP.FAILED}get distanceToCamera(){return this._distanceToCamera}get screenSpaceError(){return this._screenSpaceError}get boundingBox(){return this._boundingBox||(this._boundingBox=L(this.header.boundingVolume,this.boundingVolume)),this._boundingBox}getScreenSpaceError(e,t){switch(this.tileset.type){case S.yy.I3S:return q(this,e);case S.yy.TILES3D:return function(e,t,r){const n=e.tileset,s=e.parent&&e.parent.lodMetricValue||e.lodMetricValue,i=r?s:e.lodMetricValue;if(0===i)return 0;const o=Math.max(e._distanceToCamera,1e-7),{height:a,sseDenominator:c}=t,{viewDistanceScale:u}=n.options;let l=i*a*(u||1)/(o*c);return l-=K(n,o),l}(this,e,t);default:throw new Error("Unsupported tileset type")}}unselect(){this._selectedFrame=0}_getGpuMemoryUsageInBytes(){return this.content.gpuMemoryUsageInBytes||this.content.byteLength||0}_getPriority(){const e=this.tileset._traverser,{skipLevelOfDetail:t}=e.options,r=this.refine===S.lH.ADD||t;if(r&&!this.isVisible&&void 0!==this._visible)return-1;if(this.tileset._frameNumber-this._touchedFrame>=1)return-1;if(this.contentState===S.TP.UNLOADED)return-1;const n=this.parent,s=n&&(!r||0===this._screenSpaceError||n.hasTilesetContent)?n._screenSpaceError:this._screenSpaceError,i=e.root?e.root._screenSpaceError:0;return Math.max(i-s,0)}async loadContent(){if(this.hasEmptyContent)return!1;if(this.content)return!0;this.contentExpired&&(this._expireDate=null),this.contentState=S.TP.LOADING;const e=await this.tileset._requestScheduler.scheduleRequest(this.id,this._getPriority.bind(this));if(!e)return this.contentState=S.TP.UNLOADED,!1;try{const e=this.tileset.getTileUrl(this.contentUrl),t=this.tileset.loader,r={...this.tileset.loadOptions,[t.id]:{...this.tileset.loadOptions[t.id],isTileset:"json"===this.type,...this._getLoaderSpecificOptions(t.id)}};return this.content=await(0,E.H)(e,t,r),this.tileset.options.contentLoader&&await this.tileset.options.contentLoader(this),this._isTileset()&&this.tileset._initializeTileHeaders(this.content,this),this.contentState=S.TP.READY,this._onContentLoaded(),!0}catch(t){throw this.contentState=S.TP.FAILED,t}finally{e.done()}}unloadContent(){return this.content&&this.content.destroy&&this.content.destroy(),this.content=null,this.header.content&&this.header.content.destroy&&this.header.content.destroy(),this.header.content=null,this.contentState=S.TP.UNLOADED,!0}updateVisibility(e,t){if(this._frameNumber===e.frameNumber)return;const r=this.parent,n=r?r._visibilityPlaneMask:h.R2.MASK_INDETERMINATE;if(this.tileset._traverser.options.updateTransforms){const e=r?r.computedTransform:this.tileset.modelMatrix;this._updateTransform(e)}this._distanceToCamera=this.distanceToTile(e),this._screenSpaceError=this.getScreenSpaceError(e,!1),this._visibilityPlaneMask=this.visibility(e,n),this._visible=this._visibilityPlaneMask!==h.R2.MASK_OUTSIDE,this._inRequestVolume=this.insideViewerRequestVolume(e),this._frameNumber=e.frameNumber,this.viewportIds=t}visibility(e,t){const{cullingVolume:r}=e,{boundingVolume:n}=this;return r.computeVisibilityWithPlaneMask(n,t)}contentVisibility(){return!0}distanceToTile(e){const t=this.boundingVolume;return Math.sqrt(Math.max(t.distanceSquaredTo(e.camera.position),0))}cameraSpaceZDepth(e){let{camera:t}=e;const r=this.boundingVolume;return re.subVectors(r.center,t.position),t.direction.dot(re)}insideViewerRequestVolume(e){const t=this._viewerRequestVolume;return!t||t.distanceSquaredTo(e.camera.position)<=0}updateExpiration(){if(null!=this._expireDate&&this.contentReady&&!this.hasEmptyContent){const e=Date.now();Date.lessThan(this._expireDate,e)&&(this.contentState=S.TP.EXPIRED,this._expiredContent=this.content)}}get extras(){return this.header.extras}_initializeLodMetric(e){"lodMetricType"in e?this.lodMetricType=e.lodMetricType:(this.lodMetricType=this.parent&&this.parent.lodMetricType||this.tileset.lodMetricType,te.warn("3D Tile: Required prop lodMetricType is undefined. Using parent lodMetricType")),"lodMetricValue"in e?this.lodMetricValue=e.lodMetricValue:(this.lodMetricValue=this.parent&&this.parent.lodMetricValue||this.tileset.lodMetricValue,te.warn("3D Tile: Required prop lodMetricValue is undefined. Using parent lodMetricValue"))}_initializeTransforms(e){this.transform=e.transform?new n.k(e.transform):new n.k;const t=this.parent,r=this.tileset,s=t&&t.computedTransform?t.computedTransform.clone():r.modelMatrix.clone();this.computedTransform=new n.k(s).multiplyRight(this.transform);const i=t&&t._initialTransform?t._initialTransform.clone():new n.k;this._initialTransform=new n.k(i).multiplyRight(this.transform)}_initializeBoundingVolumes(e){this._contentBoundingVolume=null,this._viewerRequestVolume=null,this._updateBoundingVolume(e)}_initializeContent(e){this.content={_tileset:this.tileset,_tile:this},this.hasEmptyContent=!0,this.contentState=S.TP.UNLOADED,this.hasTilesetContent=!1,e.contentUrl&&(this.content=null,this.hasEmptyContent=!1)}_initializeRenderingState(e){this.depth=e.level||(this.parent?this.parent.depth+1:0),this._shouldRefine=!1,this._distanceToCamera=0,this._centerZDepth=0,this._screenSpaceError=0,this._visibilityPlaneMask=h.R2.MASK_INDETERMINATE,this._visible=void 0,this._inRequestVolume=!1,this._stackLength=0,this._selectionDepth=0,this._frameNumber=0,this._touchedFrame=0,this._visitedFrame=0,this._selectedFrame=0,this._requestedFrame=0,this._priority=0}_getRefine(e){return e||this.parent&&this.parent.refine||S.lH.REPLACE}_isTileset(){return-1!==this.contentUrl.indexOf(".json")}_onContentLoaded(){switch(this.content&&this.content.type){case"vctr":case"geom":this.tileset._traverser.disableSkipLevelOfDetail=!0}this._isTileset()?this.hasTilesetContent=!0:this.gpuMemoryUsageInBytes=this._getGpuMemoryUsageInBytes()}_updateBoundingVolume(e){this.boundingVolume=H(e.boundingVolume,this.computedTransform,this.boundingVolume);const t=e.content;t&&(t.boundingVolume&&(this._contentBoundingVolume=H(t.boundingVolume,this.computedTransform,this._contentBoundingVolume)),e.viewerRequestVolume&&(this._viewerRequestVolume=H(e.viewerRequestVolume,this.computedTransform,this._viewerRequestVolume)))}_updateTransform(e){void 0===e&&(e=new n.k);const t=e.clone().multiplyRight(this.transform);!t.equals(this.computedTransform)&&(this.computedTransform=t,this._updateBoundingVolume(this.header))}_getLoaderSpecificOptions(e){return"i3s"===e?{...this.tileset.options.i3s,_tileOptions:{attributeUrls:this.header.attributeUrls,textureUrl:this.header.textureUrl,textureFormat:this.header.textureFormat,textureLoaderOptions:this.header.textureLoaderOptions,materialDefinition:this.header.materialDefinition,isDracoGeometry:this.header.isDracoGeometry,mbs:this.header.mbs},_tilesetOptions:{store:this.tileset.tileset.store,attributeStorageInfo:this.tileset.tileset.attributeStorageInfo,fields:this.tileset.tileset.fields},isTileHeader:!1}:{assetGltfUpAxis:(t=this.tileset.tileset).asset&&t.asset.gltfUpAxis||"Y"};var t}}class se extends ee{compareDistanceToCamera(e,t){return 0===t._distanceToCamera&&0===e._distanceToCamera?t._centerZDepth-e._centerZDepth:t._distanceToCamera-e._distanceToCamera}updateTileVisibility(e,t){if(super.updateTileVisibility(e,t),!e.isVisibleAndInRequestVolume)return;const r=e.children.length>0;if(e.hasTilesetContent&&r){const r=e.children[0];return this.updateTileVisibility(r,t),void(e._visible=r._visible)}if(this.meetsScreenSpaceErrorEarly(e,t))return void(e._visible=!1);const n=e.refine===S.lH.REPLACE,s=e._optimChildrenWithinParent===S.MY.USE_OPTIMIZATION;n&&s&&r&&!this.anyChildrenVisible(e,t)&&(e._visible=!1)}meetsScreenSpaceErrorEarly(e,t){const{parent:r}=e;return!(!r||r.hasTilesetContent||r.refine!==S.lH.ADD)&&!this.shouldRefine(e,t,!0)}}class ie{frameNumberMap=(()=>new Map)();register(e,t){const r=this.frameNumberMap.get(e)||new Map,n=r.get(t)||0;r.set(t,n+1),this.frameNumberMap.set(e,r)}deregister(e,t){const r=this.frameNumberMap.get(e);if(!r)return;const n=r.get(t)||1;r.set(t,n-1)}isZero(e,t){return 0===(this.frameNumberMap.get(e)?.get(t)||0)}}const oe="REQUESTED",ae="COMPLETED",ce="ERROR";class ue{pendingTilesRegister=(()=>new ie)();constructor(){this._statusMap={}}add(e,t,r,n){if(!this._statusMap[t]){const{frameNumber:s,viewport:{id:i}}=n;this._statusMap[t]={request:e,callback:r,key:t,frameState:n,status:oe},this.pendingTilesRegister.register(i,s),e().then((e=>{this._statusMap[t].status=ae;const{frameNumber:r,viewport:{id:s}}=this._statusMap[t].frameState;this.pendingTilesRegister.deregister(s,r),this._statusMap[t].callback(e,n)})).catch((e=>{this._statusMap[t].status=ce;const{frameNumber:n,viewport:{id:s}}=this._statusMap[t].frameState;this.pendingTilesRegister.deregister(s,n),r(e)}))}}update(e,t){if(this._statusMap[e]){const{frameNumber:r,viewport:{id:n}}=this._statusMap[e].frameState;this.pendingTilesRegister.deregister(n,r);const{frameNumber:s,viewport:{id:i}}=t;this.pendingTilesRegister.register(i,s),this._statusMap[e].frameState=t}}find(e){return this._statusMap[e]}hasPendingTiles(e,t){return!this.pendingTilesRegister.isZero(e,t)}}class le extends ee{constructor(e){super(e),this._tileManager=new ue}traversalFinished(e){return!this._tileManager.hasPendingTiles(e.viewport.id,this._frameNumber||0)}shouldRefine(e,t){return e._lodJudge=function(e,t){if(0===e.lodMetricValue||isNaN(e.lodMetricValue))return"DIG";const r=2*q(e,t);return r<2?"OUT":!e.header.children||r<=e.lodMetricValue?"DRAW":e.header.children?"DIG":"OUT"}(e,t),"DIG"===e._lodJudge}updateChildTiles(e,t){const r=e.header.children||[],n=e.children,s=e.tileset;for(const i of r){const r=`${i.id}-${t.viewport.id}`,o=n&&n.find((e=>e.id===r));if(o)o&&this.updateTile(o,t);else{let n=()=>this._loadTile(i.id,s);this._tileManager.find(r)?this._tileManager.update(r,t):(s.tileset.nodePages&&(n=()=>s.tileset.nodePagesTile.formTileFromNodePages(i.id)),this._tileManager.add(n,r,(t=>this._onTileLoad(t,e,r)),t))}}return!1}async _loadTile(e,t){const{loader:r}=t,n=t.getTileUrl(`${t.url}/nodes/${e}`),s={...t.loadOptions,i3s:{...t.loadOptions.i3s,isTileHeader:!0}};return await(0,E.H)(n,r,s)}_onTileLoad(e,t,r){const n=new ne(t.tileset,e,t,r);t.children.push(n);const s=this._tileManager.find(n.id).frameState;this.updateTile(n,s),this._frameNumber===s.frameNumber&&(this.traversalFinished(s)||(new Date).getTime()-this.lastUpdate>this.updateDebounceTime)&&this.executeTraversal(n,s)}}var de=r(80247);const fe={description:"",ellipsoid:i.C.WGS84,modelMatrix:new n.k,throttleRequests:!0,maxRequests:64,maximumMemoryUsage:32,memoryCacheOverflow:1,maximumTilesSelected:0,debounceTime:0,onTileLoad:()=>{},onTileUnload:()=>{},onTileError:()=>{},onTraversalComplete:e=>e,contentLoader:void 0,viewDistanceScale:1,maximumScreenSpaceError:8,memoryAdjustedScreenSpaceError:!1,loadTiles:!0,updateTransforms:!0,viewportTraversersMap:null,loadOptions:{fetch:{}},attributions:[],basePath:"",i3s:{}},he="Tiles In Tileset(s)",Ae="Tiles In Memory",me="Tiles In View",pe="Tiles To Render",Be="Tiles Loaded",Ce="Tiles Loading",ye="Tiles Unloaded",ge="Failed Tile Loads",be="Points/Vertices",_e="Tile Memory Use",Te="Maximum Screen Space Error";class Ee{root=null;roots={};asset={};description="";extras=null;attributions={};credits={};contentFormats={draco:!1,meshopt:!1,dds:!1,ktx2:!1};cartographicCenter=null;cartesianCenter=null;zoom=1;boundingVolume=null;dynamicScreenSpaceErrorComputedDensity=0;maximumMemoryUsage=32;gpuMemoryUsageInBytes=0;memoryAdjustedScreenSpaceError=0;_cacheBytes=0;_cacheOverflowBytes=0;_frameNumber=0;_queryParams={};_extensionsUsed=[];_tiles={};_pendingCount=0;selectedTiles=[];traverseCounter=0;geometricError=0;lastUpdatedVieports=null;_requestedTiles=[];_emptyTiles=[];frameStateData={};_cache=(()=>new d)();updatePromise=null;constructor(e,t){this.options={...fe,...t},this.tileset=e,this.loader=e.loader,this.type=e.type,this.url=e.url,this.basePath=e.basePath||a.pD(this.url),this.modelMatrix=this.options.modelMatrix,this.ellipsoid=this.options.ellipsoid,this.lodMetricType=e.lodMetricType,this.lodMetricValue=e.lodMetricValue,this.refine=e.root.refine,this.loadOptions=this.options.loadOptions||{},this._traverser=this._initializeTraverser(),this._requestScheduler=new c.A({throttleRequests:this.options.throttleRequests,maxRequests:this.options.maxRequests}),this.memoryAdjustedScreenSpaceError=this.options.maximumScreenSpaceError,this._cacheBytes=1024*this.options.maximumMemoryUsage*1024,this._cacheOverflowBytes=1024*this.options.memoryCacheOverflow*1024,this.stats=new o.Uz({id:this.url}),this._initializeStats(),this.tilesetInitializationPromise=this._initializeTileSet(e)}destroy(){this._destroy()}isLoaded(){return 0===this._pendingCount&&0!==this._frameNumber&&0===this._requestedTiles.length}get tiles(){return Object.values(this._tiles)}get frameNumber(){return this._frameNumber}get queryParams(){return new URLSearchParams(this._queryParams).toString()}setProps(e){this.options={...this.options,...e}}getTileUrl(e){if(e.startsWith("data:"))return e;let t=e;return this.queryParams.length&&(t=`${e}${e.includes("?")?"&":"?"}${this.queryParams}`),t}hasExtension(e){return Boolean(this._extensionsUsed.indexOf(e)>-1)}update(e){void 0===e&&(e=null),this.tilesetInitializationPromise.then((()=>{!e&&this.lastUpdatedVieports?e=this.lastUpdatedVieports:this.lastUpdatedVieports=e,e&&this.doUpdate(e)}))}async selectTiles(e){return void 0===e&&(e=null),await this.tilesetInitializationPromise,e&&(this.lastUpdatedVieports=e),this.updatePromise||(this.updatePromise=new Promise((e=>{setTimeout((()=>{this.lastUpdatedVieports&&this.doUpdate(this.lastUpdatedVieports),e(this._frameNumber),this.updatePromise=null}),this.options.debounceTime)}))),this.updatePromise}adjustScreenSpaceError(){this.gpuMemoryUsageInBytes<this._cacheBytes?this.memoryAdjustedScreenSpaceError=Math.max(this.memoryAdjustedScreenSpaceError/1.02,this.options.maximumScreenSpaceError):this.gpuMemoryUsageInBytes>this._cacheBytes+this._cacheOverflowBytes&&(this.memoryAdjustedScreenSpaceError*=1.02)}doUpdate(e){if("loadTiles"in this.options&&!this.options.loadTiles)return;if(this.traverseCounter>0)return;const t=e instanceof Array?e:[e];this._cache.reset(),this._frameNumber++,this.traverseCounter=t.length;const r=[];for(const n of t){const e=n.id;this._needTraverse(e)?r.push(e):this.traverseCounter--}for(const n of t){const e=n.id;if(this.roots[e]||(this.roots[e]=this._initializeTileHeaders(this.tileset,null)),!r.includes(e))continue;const t=B(n,this._frameNumber);this._traverser.traverse(this.roots[e],t,this.options)}}_needTraverse(e){let t=e;return this.options.viewportTraversersMap&&(t=this.options.viewportTraversersMap[e]),t===e}_onTraversalEnd(e){const t=e.viewport.id;this.frameStateData[t]||(this.frameStateData[t]={selectedTiles:[],_requestedTiles:[],_emptyTiles:[]});const r=this.frameStateData[t],n=Object.values(this._traverser.selectedTiles),[s,i]=function(e,t,r){if(0===r||e.length<=r)return[e,[]];const n=[],{longitude:s,latitude:i}=t.viewport;for(const[u,l]of e.entries()){const[e,t]=l.header.mbs,r=Math.abs(s-e),o=Math.abs(i-t),a=Math.sqrt(o*o+r*r);n.push([u,a])}const o=n.sort(((e,t)=>e[1]-t[1])),a=[];for(let u=0;u<r;u++)a.push(e[o[u][0]]);const c=[];for(let u=r;u<o.length;u++)c.push(e[o[u][0]]);return[a,c]}(n,e,this.options.maximumTilesSelected);r.selectedTiles=s;for(const o of i)o.unselect();r._requestedTiles=Object.values(this._traverser.requestedTiles),r._emptyTiles=Object.values(this._traverser.emptyTiles),this.traverseCounter--,this.traverseCounter>0||this._updateTiles()}_updateTiles(){this.selectedTiles=[],this._requestedTiles=[],this._emptyTiles=[];for(const e in this.frameStateData){const t=this.frameStateData[e];this.selectedTiles=this.selectedTiles.concat(t.selectedTiles),this._requestedTiles=this._requestedTiles.concat(t._requestedTiles),this._emptyTiles=this._emptyTiles.concat(t._emptyTiles)}this.selectedTiles=this.options.onTraversalComplete(this.selectedTiles);for(const e of this.selectedTiles)this._tiles[e.id]=e;this._loadTiles(),this._unloadTiles(),this._updateStats()}_tilesChanged(e,t){if(e.length!==t.length)return!0;const r=new Set(e.map((e=>e.id))),n=new Set(t.map((e=>e.id)));let s=e.filter((e=>!n.has(e.id))).length>0;return s=s||t.filter((e=>!r.has(e.id))).length>0,s}_loadTiles(){for(const e of this._requestedTiles)e.contentUnloaded&&this._loadTile(e)}_unloadTiles(){this._cache.unloadTiles(this,((e,t)=>e._unloadTile(t)))}_updateStats(){let e=0,t=0;for(const r of this.selectedTiles)r.contentAvailable&&r.content&&(e++,r.content.pointCount?t+=r.content.pointCount:t+=r.content.vertexCount);this.stats.get(me).count=this.selectedTiles.length,this.stats.get(pe).count=e,this.stats.get(be).count=t,this.stats.get(Te).count=this.memoryAdjustedScreenSpaceError}async _initializeTileSet(e){this.type===S.yy.I3S&&(this.calculateViewPropsI3S(),e.root=await e.root),this.root=this._initializeTileHeaders(e,null),this.type===S.yy.TILES3D&&(this._initializeTiles3DTileset(e),this.calculateViewPropsTiles3D()),this.type===S.yy.I3S&&this._initializeI3STileset()}calculateViewPropsI3S(){const e=this.tileset.fullExtent;if(e){const{xmin:t,xmax:r,ymin:n,ymax:o,zmin:a,zmax:c}=e;return this.cartographicCenter=new s.P(t+(r-t)/2,n+(o-n)/2,a+(c-a)/2),this.cartesianCenter=new s.P,i.C.WGS84.cartographicToCartesian(this.cartographicCenter,this.cartesianCenter),void(this.zoom=T(e,this.cartographicCenter,this.cartesianCenter))}const t=this.tileset.store?.extent;if(t){const[e,r,n,o]=t;return this.cartographicCenter=new s.P(e+(n-e)/2,r+(o-r)/2,0),this.cartesianCenter=new s.P,i.C.WGS84.cartographicToCartesian(this.cartographicCenter,this.cartesianCenter),void(this.zoom=function(e,t,r){const[n,s,i,o]=e;return T({xmin:n,xmax:i,ymin:s,ymax:o,zmin:0,zmax:0},t,r)}(t,this.cartographicCenter,this.cartesianCenter))}de.warn("Extent is not defined in the tileset header"),this.cartographicCenter=new s.P,this.zoom=1}calculateViewPropsTiles3D(){const e=this.root,{center:t}=e.boundingVolume;if(!t)return de.warn("center was not pre-calculated for the root tile"),this.cartographicCenter=new s.P,void(this.zoom=1);0!==t[0]||0!==t[1]||0!==t[2]?(this.cartographicCenter=new s.P,i.C.WGS84.cartesianToCartographic(t,this.cartographicCenter)):this.cartographicCenter=new s.P(0,0,-i.C.WGS84.radii[0]),this.cartesianCenter=t,this.zoom=_(e.boundingVolume,this.cartographicCenter)}_initializeStats(){this.stats.get(he),this.stats.get(Ce),this.stats.get(Ae),this.stats.get(me),this.stats.get(pe),this.stats.get(Be),this.stats.get(ye),this.stats.get(ge),this.stats.get(be),this.stats.get(_e,"memory"),this.stats.get(Te)}_initializeTileHeaders(e,t){const r=new ne(this,e.root,t);if(t&&(t.children.push(r),r.depth=t.depth+1),this.type===S.yy.TILES3D){const e=[];for(e.push(r);e.length>0;){const t=e.pop();this.stats.get(he).incrementCount();const r=t.header.children||[];for(const n of r){const r=new ne(this,n,t);if(r.contentUrl?.includes("?session=")){const e=new URL(r.contentUrl).searchParams.get("session");e&&(this._queryParams.session=e)}t.children.push(r),r.depth=t.depth+1,e.push(r)}}}return r}_initializeTraverser(){let e;switch(this.type){case S.yy.TILES3D:e=se;break;case S.yy.I3S:e=le;break;default:e=ee}return new e({basePath:this.basePath,onTraversalEnd:this._onTraversalEnd.bind(this)})}_destroyTileHeaders(e){this._destroySubtree(e)}async _loadTile(e){let t;try{this._onStartTileLoading(),t=await e.loadContent()}catch(r){this._onTileLoadError(e,r instanceof Error?r:new Error("load failed"))}finally{this._onEndTileLoading(),this._onTileLoad(e,t)}}_onTileLoadError(e,t){this.stats.get(ge).incrementCount();const r=t.message||t.toString(),n=e.url;de.error(`A 3D tile failed to load: ${e.url} ${r}`),this.options.onTileError(e,r,n)}_onTileLoad(e,t){if(t){if(this.type===S.yy.I3S){const e=this.tileset?.nodePagesTile?.nodesInNodePages||0;this.stats.get(he).reset(),this.stats.get(he).addCount(e)}e&&e.content&&function(e,t){(0,f.v)(e),(0,f.v)(t);const{rtcCenter:r,gltfUpAxis:o}=t,{computedTransform:a,boundingVolume:{center:c}}=e;let u=new n.k(a);switch(r&&u.translate(r),o){case"Z":default:break;case"Y":const e=(new n.k).rotateX(Math.PI/2);u=u.multiplyRight(e);break;case"X":const t=(new n.k).rotateY(-Math.PI/2);u=u.multiplyRight(t)}t.isQuantized&&u.translate(t.quantizedVolumeOffset).scale(t.quantizedVolumeScale);const l=new s.P(c);t.cartesianModelMatrix=u,t.cartesianOrigin=l;const d=i.C.WGS84.cartesianToCartographic(l,new s.P),h=i.C.WGS84.eastNorthUpToFixedFrame(l).invert();t.cartographicModelMatrix=h.multiplyRight(u),t.cartographicOrigin=d,t.coordinateSystem||(t.modelMatrix=t.cartographicModelMatrix)}(e,e.content),this.updateContentTypes(e),this._addTileToCache(e),this.options.onTileLoad(e)}}updateContentTypes(e){if(this.type===S.yy.I3S)switch(e.header.isDracoGeometry&&(this.contentFormats.draco=!0),e.header.textureFormat){case"dds":this.contentFormats.dds=!0;break;case"ktx2":this.contentFormats.ktx2=!0}else if(this.type===S.yy.TILES3D){const{extensionsRemoved:t=[]}=e.content?.gltf||{};t.includes("KHR_draco_mesh_compression")&&(this.contentFormats.draco=!0),t.includes("EXT_meshopt_compression")&&(this.contentFormats.meshopt=!0),t.includes("KHR_texture_basisu")&&(this.contentFormats.ktx2=!0)}}_onStartTileLoading(){this._pendingCount++,this.stats.get(Ce).incrementCount()}_onEndTileLoading(){this._pendingCount--,this.stats.get(Ce).decrementCount()}_addTileToCache(e){this._cache.add(this,e,(t=>t._updateCacheStats(e)))}_updateCacheStats(e){this.stats.get(Be).incrementCount(),this.stats.get(Ae).incrementCount(),this.gpuMemoryUsageInBytes+=e.gpuMemoryUsageInBytes||0,this.stats.get(_e).count=this.gpuMemoryUsageInBytes,this.options.memoryAdjustedScreenSpaceError&&this.adjustScreenSpaceError()}_unloadTile(e){this.gpuMemoryUsageInBytes-=e.gpuMemoryUsageInBytes||0,this.stats.get(Ae).decrementCount(),this.stats.get(ye).incrementCount(),this.stats.get(_e).count=this.gpuMemoryUsageInBytes,this.options.onTileUnload(e),e.unloadContent()}_destroy(){const e=[];for(this.root&&e.push(this.root);e.length>0;){const t=e.pop();for(const r of t.children)e.push(r);this._destroyTile(t)}this.root=null}_destroySubtree(e){const t=e,r=[];for(r.push(t);r.length>0;){e=r.pop();for(const t of e.children)r.push(t);e!==t&&this._destroyTile(e)}t.children=[]}_destroyTile(e){this._cache.unloadTile(this,e),this._unloadTile(e),e.destroy()}_initializeTiles3DTileset(e){if(e.queryString){const t=new URLSearchParams(e.queryString),r=Object.fromEntries(t.entries());this._queryParams={...this._queryParams,...r}}if(this.asset=e.asset,!this.asset)throw new Error("Tileset must have an asset property.");if("0.0"!==this.asset.version&&"1.0"!==this.asset.version&&"1.1"!==this.asset.version)throw new Error("The tileset must be 3D Tiles version either 0.0 or 1.0 or 1.1.");"tilesetVersion"in this.asset&&(this._queryParams.v=this.asset.tilesetVersion),this.credits={attributions:this.options.attributions||[]},this.description=this.options.description||"",this.properties=e.properties,this.geometricError=e.geometricError,this._extensionsUsed=e.extensionsUsed||[],this.extras=e.extras}_initializeI3STileset(){this.loadOptions.i3s&&"token"in this.loadOptions.i3s&&(this._queryParams.token=this.loadOptions.i3s.token)}}},46410:(e,t,r)=>{function n(e,t){if(!e)throw new Error(t||"loaders.gl assertion failed.")}r.d(t,{v:()=>n})},99222:(e,t,r)=>{r.d(t,{Bd:()=>s,Fr:()=>o,xD:()=>i});var n=r(88538);"undefined"!=typeof self&&self,"undefined"!=typeof window&&window,void 0!==r.g&&r.g,"undefined"!=typeof document&&document;const s="object"!=typeof n||"[object process]"!==String(n)||n.browser,i="function"==typeof importScripts,o="undefined"!=typeof window&&void 0!==window.orientation,a=void 0!==n&&n.version&&/v([0-9]*)/.exec(n.version);a&&parseFloat(a[1])},9894:(e,t,r)=>{r.d(t,{x:()=>i});var n=r(11654),s=r(80247);const i=(globalThis._loadersgl_?.version||(globalThis._loadersgl_=globalThis._loadersgl_||{},"undefined"==typeof __VERSION__?(s.warn("loaders.gl: The __VERSION__ variable is not injected using babel plugin. Latest unstable workers would be fetched from the CDN."),globalThis._loadersgl_.version=n.x):globalThis._loadersgl_.version=__VERSION__),globalThis._loadersgl_.version)},8821:(e,t,r)=>{r.d(t,{_:()=>c});var n=r(99222),s=r(46410),i=r(9894),o=r(80247);const a={};async function c(e,t,r,c){return void 0===t&&(t=null),void 0===r&&(r={}),void 0===c&&(c=null),t&&(e=function(e,t,r,o){void 0===r&&(r={});void 0===o&&(o=null);if(!r.useLocalLibraries&&e.startsWith("http"))return e;o=o||e;const a=r.modules||{};if(a[o])return a[o];if(!n.Bd)return`modules/${t}/dist/libs/${o}`;if(r.CDN)return(0,s.v)(r.CDN.startsWith("http")),`${r.CDN}/${t}@${i.x}/dist/libs/${o}`;if(n.xD)return`../src/libs/${o}`;return`modules/${t}/src/libs/${o}`}(e,t,r,c)),a[e]=a[e]||async function(e){if(e.endsWith("wasm"))return await async function(e){const{readFileAsArrayBuffer:t}=globalThis.loaders||{};if(n.Bd||!t||e.startsWith("http")){const t=await fetch(e);return await t.arrayBuffer()}return await t(e)}(e);if(!n.Bd)try{const{requireFromFile:t}=globalThis.loaders||{};return await(t?.(e))}catch(r){return o.error(r),null}if(n.xD)return importScripts(e);const t=await async function(e){const{readFileAsText:t}=globalThis.loaders||{};if(n.Bd||!t||e.startsWith("http")){const t=await fetch(e);return await t.text()}return await t(e)}(e);return function(e,t){if(!n.Bd){const{requireFromString:r}=globalThis.loaders||{};return r?.(e,t)}if(n.xD)return eval.call(globalThis,e),null;const r=document.createElement("script");r.id=t;try{r.appendChild(document.createTextNode(e))}catch(s){r.text=e}return document.body.appendChild(r),null}(t,e)}(e),await a[e]}},11654:(e,t,r)=>{r.d(t,{x:()=>n});const n="beta"},81200:(e,t,r)=>{r.r(t),r.d(t,{assets:()=>u,contentTitle:()=>a,default:()=>f,frontMatter:()=>o,metadata:()=>c,toc:()=>l});var n=r(62540),s=r(43023),i=r(12591);const o={},a="Attribute-driven colorization",c={id:"modules/i3s/recipes/attribute-driven-colorization",title:"Attribute-driven colorization",description:"Please find source code of the example here",source:"@site/../docs/modules/i3s/recipes/attribute-driven-colorization.mdx",sourceDirName:"modules/i3s/recipes",slug:"/modules/i3s/recipes/attribute-driven-colorization",permalink:"/docs/modules/i3s/recipes/attribute-driven-colorization",draft:!1,unlisted:!1,editUrl:"https://github.com/visgl/loaders.gl/tree/master/website/../docs/modules/i3s/recipes/attribute-driven-colorization.mdx",tags:[],version:"current",frontMatter:{},sidebar:"tutorialSidebar",previous:{title:"I3S Building Scene Layer (BSL)",permalink:"/docs/modules/i3s/recipes/building-scene-layer"},next:{title:"I3S Picking",permalink:"/docs/modules/i3s/recipes/picking"}},u={},l=[{value:"Find out layer&#39;s attributes",id:"find-out-layers-attributes",level:2},{value:"Setup colorization scale",id:"setup-colorization-scale",level:2},{value:"Use DataDrivenTile3DLayer",id:"use-datadriventile3dlayer",level:2},{value:"Colorization mode",id:"colorization-mode",level:2}];function d(e){const t={a:"a",code:"code",h1:"h1",h2:"h2",header:"header",img:"img",p:"p",pre:"pre",...(0,s.R)(),...e.components};return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(t.header,{children:(0,n.jsx)(t.h1,{id:"attribute-driven-colorization",children:"Attribute-driven colorization"})}),"\n","\n",(0,n.jsx)("div",{style:{height:"50vh"},children:(0,n.jsx)(i.A,{})}),"\n",(0,n.jsxs)(t.p,{children:["Please find source code of the example ",(0,n.jsx)(t.a,{href:"https://github.com/visgl/loaders.gl/tree/master/examples/website/i3s-colorization-by-attributes",children:"here"})]}),"\n",(0,n.jsx)(t.p,{children:"In I3S, a feature represents a real-world object within a node. For example, a building within a 3D object scene layer. Node resources such as geometry buffer and attributes can belong to a feature and can be accessed by an object-ID."}),"\n",(0,n.jsxs)(t.p,{children:["In terms of geometry, every vertex of a mesh is associated with some feature. At the same time, every feature is associated with feature attribute values. For example, there might be ",(0,n.jsx)(t.code,{children:"HEIGHT"})," attribute that stores roof height information about every building."]}),"\n",(0,n.jsx)(t.p,{children:"All that means that it is possible to make some visual effects related to attribute value. It might be text labels, colors, opacity etc."}),"\n",(0,n.jsxs)(t.p,{children:["The complete case of attributes colorization is done in ",(0,n.jsx)(t.a,{href:"https://i3s.loaders.gl/viewer?tileset=new-york",children:"I3S Explorer"}),". It is an open source ReactJS application. See source code on ",(0,n.jsx)(t.a,{href:"https://github.com/visgl/loaders.gl-showcases",children:"GitHub"}),"."]}),"\n",(0,n.jsx)(t.p,{children:(0,n.jsx)(t.img,{alt:"I3S New York dataset colorized by height roof",src:r(18289).A+"",width:"1975",height:"740"})}),"\n",(0,n.jsx)(t.h2,{id:"find-out-layers-attributes",children:"Find out layer's attributes"}),"\n",(0,n.jsx)(t.p,{children:"It is necessary to pick some attribute to colorize a layer by. So it is necessary to load the layer JSON:"}),"\n",(0,n.jsx)(t.pre,{children:(0,n.jsx)(t.code,{className:"language-javascript",children:"import {load} from '@loaders.gl/core';\r\nimport {I3SLoader} from '@loaders.gl/i3s';\r\n\r\nconst i3sLayer = await load(url, I3SBuildingSceneLayerLoader);\n"})}),"\n",(0,n.jsxs)(t.p,{children:["List and types of attributes might be taken from ",(0,n.jsx)(t.a,{href:"https://github.com/Esri/i3s-spec/blob/master/docs/1.9/field.cmn.md",children:(0,n.jsx)(t.code,{children:"i3sLayer.fields"})})," and ",(0,n.jsx)(t.a,{href:"https://github.com/Esri/i3s-spec/blob/master/docs/1.8/attributeStorageInfo.cmn.md",children:(0,n.jsx)(t.code,{children:"i3sLayer.attributeStorageInfo"})})," properties."]}),"\n",(0,n.jsx)(t.h2,{id:"setup-colorization-scale",children:"Setup colorization scale"}),"\n",(0,n.jsx)(t.p,{children:"Attributes colorization capability applies linear color gradient. To create this gradient attribute values range is required."}),"\n",(0,n.jsxs)(t.p,{children:["To get minimum and maximum attribute values ",(0,n.jsx)(t.a,{href:"https://github.com/Esri/i3s-spec/blob/master/docs/1.9/statisticsInfo.cmn.md",children:"statistics"})," can be used. The ",(0,n.jsx)(t.a,{href:"https://github.com/Esri/i3s-spec/blob/master/docs/1.9/statsInfo.cmn.md",children:"statistics info JSON"})," has min and max values. Usage of those values allows setting true attribute values range not clamping extremum values."]}),"\n",(0,n.jsx)(t.p,{children:"As soon as statistics info is stored in separate resources, it has to be loaded in a separate request. Statistics is just a JSON data and can be loaded the following way:"}),"\n",(0,n.jsx)(t.pre,{children:(0,n.jsx)(t.code,{className:"language-ts",children:"import {fetchFile} from '@loaders.gl/core';\r\nimport {StatsInfo} from '@loaders.gl/i3s';\r\n\r\nconst dataResponse = await fetchFile(`${url}/statistics/f_5/0`);\r\nconst data = JSON.parse(await dataResponse.text());\r\nconst stats: StatsInfo | null = (data?.stats as StatsInfo) || null;\n"})}),"\n",(0,n.jsx)(t.h2,{id:"use-datadriventile3dlayer",children:"Use DataDrivenTile3DLayer"}),"\n",(0,n.jsxs)(t.p,{children:["To colorize an I3S dataset on the fly you have to use ",(0,n.jsx)(t.code,{children:"DataDrivenTile3DLayer"})," from ",(0,n.jsx)(t.code,{children:"@deck.gl-community/layers"}),". First of all you need to add ",(0,n.jsx)(t.code,{children:"@deck.gl-community/layers"})," into the project:"]}),"\n",(0,n.jsx)(t.pre,{children:(0,n.jsx)(t.code,{className:"language-bash",children:"yarn add @deck.gl-community/layers\n"})}),"\n",(0,n.jsxs)(t.p,{children:["Then you can use ",(0,n.jsx)(t.code,{children:"DataDrivenTile3DLayer"}),", ",(0,n.jsx)(t.code,{children:"colorizeTile"})," util function as a prop ",(0,n.jsx)(t.code,{children:"customizeColors"})," of the layer and set prop ",(0,n.jsx)(t.code,{children:"colorsByAttribute"})," with required params (attribute name, min/max values, min/max colors, mode):"]}),"\n",(0,n.jsx)(t.pre,{children:(0,n.jsx)(t.code,{className:"language-ts",children:"import Map from 'react-map-gl';\r\nimport maplibregl from 'maplibre-gl';\r\nimport DeckGL from \"@deck.gl/react\";\r\nimport {DataDrivenTile3DLayer, colorizeTile} from '@deck.gl-community/layers';\r\nimport {I3SLoader} from \"@loaders.gl/i3s\";\r\n\r\nfunction renderLayers() {\r\n  const loadOptions = {i3s: {coordinateSystem: COORDINATE_SYSTEM.LNGLAT_OFFSETS}};\r\n  const colorsByAttribute = {\r\n    attributeName,\r\n    minValue: stats.min,\r\n    maxValue: stats.max,\r\n    minColor: [146, 146, 252, 255], // #9292FC\r\n    maxColor: [44, 44, 175, 255], // #2C2CAF\r\n    mode: 'replace'\r\n  }\r\n  const layers = new DataDrivenTile3DLayer({\r\n    data: url,\r\n    loader: I3SLoader,\r\n    onTilesetLoad: onTilesetLoadHandler,\r\n    loadOptions,\r\n    colorsByAttribute,\r\n    customizeColors: colorizeTile\r\n  });\r\n\r\n  return layers;\r\n}\r\n\r\n<DeckGL initialViewState={viewState} layers={renderLayers()} controller>\r\n  <Map\r\n    reuseMaps\r\n    mapLib={maplibregl}\r\n    mapStyle={style}\r\n  />\r\n</DeckGL>\n"})}),"\n",(0,n.jsx)(t.h2,{id:"colorization-mode",children:"Colorization mode"}),"\n",(0,n.jsx)(t.p,{children:"Attributes colorization capability can work in 2 modes: 'replace' and 'multiply'."}),"\n",(0,n.jsxs)(t.p,{children:[(0,n.jsx)(t.code,{children:"replace"})," mode. Attribute-based colors replace geometry vertex colors."]}),"\n",(0,n.jsxs)(t.p,{children:[(0,n.jsx)(t.code,{children:"multiply"})," mode. Attribute-based colors multiply with geometry vertex colors."]}),"\n",(0,n.jsx)(t.p,{children:"Usage example:"}),"\n",(0,n.jsx)(t.pre,{children:(0,n.jsx)(t.code,{className:"language-ts",children:"function renderLayers() {\r\n  const loadOptions = {i3s: {coordinateSystem: COORDINATE_SYSTEM.LNGLAT_OFFSETS}};\r\n  const colorsByAttribute = {\r\n    attributeName,\r\n    minValue: stats.min,\r\n    maxValue: stats.max,\r\n    minColor: [146, 146, 252, 255], // #9292FC\r\n    maxColor: [44, 44, 175, 255], // #2C2CAF\r\n    mode: 'multiply' // or 'replace'\r\n  };\r\n  const layers = new DataDrivenTile3DLayer({\r\n    data: url,\r\n    loader: I3SLoader,\r\n    onTilesetLoad: onTilesetLoadHandler,\r\n    loadOptions,\r\n    colorsByAttribute,\r\n    customizeColors: colorizeTile\r\n  });\r\n\r\n  return layers;\r\n}\n"})})]})}function f(e={}){const{wrapper:t}={...(0,s.R)(),...e.components};return t?(0,n.jsx)(t,{...e,children:(0,n.jsx)(d,{...e})}):d(e)}},18289:(e,t,r)=>{r.d(t,{A:()=>n});const n=r.p+"assets/images/i3s-new-york-colorize-by-heightroof-fc2b0f1402a6dce50445432ea713df1c.png"},67483:(e,t,r)=>{r.d(t,{n:()=>c});var n=r(79648),s=r(40830),i=r(68118),o=r(85930);const a={colorsByAttribute:null,filtersByAttribute:null};class c extends n.A{static layerName="DataDrivenTile3DLayer";static defaultProps=a;state=void 0;initializeState(){super.initializeState(),this.setState({colorsByAttribute:this.props.colorsByAttribute,filtersByAttribute:this.props.filtersByAttribute,loadingCounter:0})}updateState(e){const{props:t,oldProps:r,changeFlags:n}=e;if(t.data&&t.data!==r.data)this._loadTileset(t.data);else if(t.colorsByAttribute!==r.colorsByAttribute)this.setState({colorsByAttribute:t.colorsByAttribute}),this._colorizeTileset();else if(t.filtersByAttribute!==r.filtersByAttribute)this.setState({filtersByAttribute:t.filtersByAttribute}),this._filterTileset();else if(n.viewportChanged){const{activeViewports:e}=this.state;Object.keys(e).length&&(this.state.loadingCounter||super._updateTileset(e),this.state.lastUpdatedViewports=e,this.state.activeViewports={})}else super.updateState(e)}async _loadTileset(e){const{loadOptions:t={}}=this.props;let r=this.props.loader||this.props.loaders;Array.isArray(r)&&(r=r[0]);const n={loadOptions:{...t}};if(r.preload){const s=await r.preload(e,t);s.headers&&(n.loadOptions.fetch={...n.loadOptions.fetch,headers:s.headers}),Object.assign(n,s)}const i=await(0,o.H)(e,r,n.loadOptions),a=new s.Q(i,{onTileLoad:this._onTileLoad.bind(this),onTileUnload:super._onTileUnload.bind(this),onTileError:this.props.onTileError,onTraversalComplete:this._onTraversalComplete.bind(this),...n});this.setState({tileset3d:a,layerMap:{}}),super._updateTileset(this.state.activeViewports),this.props.onTilesetLoad(a)}_onTileLoad(e){const{lastUpdatedViewports:t}=this.state;this._colorizeTiles([e]),this._filterTiles([e]),this.props.onTileLoad(e),this.state.colorsByAttribute||this.state.filtersByAttribute||(super._updateTileset(t),this.setNeedsUpdate())}_onTraversalComplete(e){return this._colorizeTiles(e),this._filterTiles(e),this.props.onTraversalComplete?this.props.onTraversalComplete(e):e}_colorizeTiles(e){if(this.props.customizeColors&&e[0]?.type===i.WH.MESH){const{layerMap:t,colorsByAttribute:r}=this.state,n=[];for(const s of e)n.push(this.props.customizeColors(s,r));this.setState({loadingCounter:this.state.loadingCounter+1}),Promise.allSettled(n).then((e=>{this.setState({loadingCounter:this.state.loadingCounter-1});let r=!1;for(const n of e)"fulfilled"===n.status&&n.value.isColored&&(r=!0,delete t[n.value.id]);r&&!this.state.loadingCounter&&(super._updateTileset(this.state.activeViewports),this.setNeedsUpdate())}))}}_colorizeTileset(){const{tileset3d:e}=this.state;e&&this._colorizeTiles(e.selectedTiles)}_filterTiles(e){if(this.props.filterTile&&e[0]?.type===i.WH.MESH){const{layerMap:t,filtersByAttribute:r}=this.state,n=[];for(const s of e)n.push(this.props.filterTile(s,r));this.setState({loadingCounter:this.state.loadingCounter+1}),Promise.allSettled(n).then((e=>{this.setState({loadingCounter:this.state.loadingCounter-1});let r=!1;for(const n of e)"fulfilled"===n.status&&n.value.isFiltered&&(r=!0,delete t[n.value.id]);r&&!this.state.loadingCounter&&(super._updateTileset(this.state.activeViewports),this.setNeedsUpdate())}))}}_filterTileset(){const{tileset3d:e}=this.state;e&&this._filterTiles(e.selectedTiles)}}},73281:(e,t,r)=>{r.d(t,{A:()=>c});var n=r(78715),s=r(54901),i=r(24697);const o={bearing:0,pitch:0,position:[0,0,0]},a={speed:1.2,curve:1.414};class c extends n.A{constructor(e={}){super({compare:["longitude","latitude","zoom","bearing","pitch","position"],extract:["width","height","longitude","latitude","zoom","bearing","pitch","position"],required:["width","height","latitude","longitude","zoom"]}),this.opts={...a,...e}}interpolateProps(e,t,r){const n=(0,i.rj)(e,t,r,this.opts);for(const i in o)n[i]=(0,s.Cc)(e[i]||o[i],t[i]||o[i],r);return n}getDuration(e,t){let{transitionDuration:r}=t;return"auto"===r&&(r=(0,i.v7)(e,t,this.opts)),r}}},43023:(e,t,r)=>{r.d(t,{R:()=>o,x:()=>a});var n=r(63696);const s={},i=n.createContext(s);function o(e){const t=n.useContext(i);return n.useMemo((function(){return"function"==typeof e?e(t):{...t,...e}}),[t,e])}function a(e){let t;return t=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:o(e.components),n.createElement(i.Provider,{value:t},e.children)}}}]);