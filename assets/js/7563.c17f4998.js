"use strict";(self.webpackChunkproject_website=self.webpackChunkproject_website||[]).push([[7563],{90714:(t,o,e)=>{e.d(o,{A:()=>w});var i=e(51152),r=e(47345),s=e(31886),n=e(24697);const a=Math.PI/180;function p({height:t,focalDistance:o,orbitAxis:e,rotationX:i,rotationOrbit:r,zoom:n}){const p="Z"===e?[0,0,1]:[0,1,0],c="Z"===e?[0,-o,0]:[0,0,o],l=(new s.k).lookAt({eye:c,up:p});l.rotateX(i*a),"Z"===e?l.rotateZ(r*a):l.rotateY(r*a);const h=Math.pow(2,n)/t;return l.scale(h),l}class c extends r.A{constructor(t){const{height:o,projectionMatrix:e,fovy:i=50,orbitAxis:r="Z",target:s=[0,0,0],rotationX:a=0,rotationOrbit:c=0,zoom:l=0}=t,h=e?e[5]/2:(0,n.wZ)(i);super({...t,longitude:void 0,viewMatrix:p({height:o||1,focalDistance:h,orbitAxis:r,rotationX:a,rotationOrbit:c,zoom:l}),fovy:i,focalDistance:h,position:s,zoom:l}),this.projectedCenter=this.project(this.center)}unproject(t,{topLeft:o=!0}={}){const[e,i,r=this.projectedCenter[2]]=t,s=o?i:this.height-i,[a,p,c]=(0,n.xJ)([e,s,r],this.pixelUnprojectionMatrix);return[a,p,c]}panByPosition(t,o){const e=this.project(t),i=[this.width/2+e[0]-o[0],this.height/2+e[1]-o[1],this.projectedCenter[2]];return{target:this.unproject(i)}}}var l=e(54901),h=e(64027),u=e(60676),m=e(25667),g=e(70053);class d extends u.A{constructor(t){const{width:o,height:e,rotationX:i=0,rotationOrbit:r=0,target:s=[0,0,0],zoom:n=0,minRotationX:a=-90,maxRotationX:p=90,minZoom:c=-1/0,maxZoom:l=1/0,startPanPosition:h,startRotatePos:u,startRotationX:m,startRotationOrbit:g,startZoomPosition:d,startZoom:P}=t;super({width:o,height:e,rotationX:i,rotationOrbit:r,target:s,zoom:n,minRotationX:a,maxRotationX:p,minZoom:c,maxZoom:l},{startPanPosition:h,startRotatePos:u,startRotationX:m,startRotationOrbit:g,startZoomPosition:d,startZoom:P}),this.makeViewport=t.makeViewport}panStart({pos:t}){return this._getUpdatedState({startPanPosition:this._unproject(t)})}pan({pos:t,startPosition:o}){const e=this.getState().startPanPosition||o;if(!e)return this;const i=this.makeViewport(this.getViewportProps()).panByPosition(e,t);return this._getUpdatedState(i)}panEnd(){return this._getUpdatedState({startPanPosition:null})}rotateStart({pos:t}){return this._getUpdatedState({startRotatePos:t,startRotationX:this.getViewportProps().rotationX,startRotationOrbit:this.getViewportProps().rotationOrbit})}rotate({pos:t,deltaAngleX:o=0,deltaAngleY:e=0}){const{startRotatePos:i,startRotationX:r,startRotationOrbit:s}=this.getState(),{width:n,height:a}=this.getViewportProps();if(!i||void 0===r||void 0===s)return this;let p;if(t){let o=(t[0]-i[0])/n;(r<-90||r>90)&&(o*=-1),p={rotationX:r+180*((t[1]-i[1])/a),rotationOrbit:s+180*o}}else p={rotationX:r+e,rotationOrbit:s+o};return this._getUpdatedState(p)}rotateEnd(){return this._getUpdatedState({startRotationX:null,startRotationOrbit:null})}shortestPathFrom(t){const o=t.getViewportProps(),e={...this.getViewportProps()},{rotationOrbit:i}=e;return Math.abs(i-o.rotationOrbit)>180&&(e.rotationOrbit=i<0?i+360:i-360),e}zoomStart({pos:t}){return this._getUpdatedState({startZoomPosition:this._unproject(t),startZoom:this.getViewportProps().zoom})}zoom({pos:t,startPos:o,scale:e}){let{startZoom:i,startZoomPosition:r}=this.getState();if(r||(i=this.getViewportProps().zoom,r=this._unproject(o)||this._unproject(t)),!r)return this;const s=this._calculateNewZoom({scale:e,startZoom:i}),n=this.makeViewport({...this.getViewportProps(),zoom:s});return this._getUpdatedState({zoom:s,...n.panByPosition(r,t)})}zoomEnd(){return this._getUpdatedState({startZoomPosition:null,startZoom:null})}zoomIn(t=2){return this._getUpdatedState({zoom:this._calculateNewZoom({scale:t})})}zoomOut(t=2){return this._getUpdatedState({zoom:this._calculateNewZoom({scale:1/t})})}moveLeft(t=50){return this._panFromCenter([-t,0])}moveRight(t=50){return this._panFromCenter([t,0])}moveUp(t=50){return this._panFromCenter([0,-t])}moveDown(t=50){return this._panFromCenter([0,t])}rotateLeft(t=15){return this._getUpdatedState({rotationOrbit:this.getViewportProps().rotationOrbit-t})}rotateRight(t=15){return this._getUpdatedState({rotationOrbit:this.getViewportProps().rotationOrbit+t})}rotateUp(t=10){return this._getUpdatedState({rotationX:this.getViewportProps().rotationX-t})}rotateDown(t=10){return this._getUpdatedState({rotationX:this.getViewportProps().rotationX+t})}_unproject(t){const o=this.makeViewport(this.getViewportProps());return t&&o.unproject(t)}_calculateNewZoom({scale:t,startZoom:o}){const{maxZoom:e,minZoom:i}=this.getViewportProps();void 0===o&&(o=this.getViewportProps().zoom);const r=o+Math.log2(t);return(0,l.qE)(r,i,e)}_panFromCenter(t){const{width:o,height:e,target:i}=this.getViewportProps();return this.pan({startPosition:i,pos:[o/2+t[0],e/2+t[1]]})}_getUpdatedState(t){return new this.constructor({makeViewport:this.makeViewport,...this.getViewportProps(),...this.getState(),...t})}applyConstraints(t){const{maxZoom:o,minZoom:e,zoom:i,maxRotationX:r,minRotationX:s,rotationOrbit:n}=t;return t.zoom=Array.isArray(i)?[(0,l.qE)(i[0],e,o),(0,l.qE)(i[1],e,o)]:(0,l.qE)(i,e,o),t.rotationX=(0,l.qE)(t.rotationX,s,r),(n<-180||n>180)&&(t.rotationOrbit=(0,m.zi)(n+180,360)-180),t}}class P extends h.A{constructor(){super(...arguments),this.ControllerState=d,this.transition={transitionDuration:300,transitionInterpolator:new g.A({transitionProps:{compare:["target","zoom","rotationX","rotationOrbit"],required:["target","zoom"]}})}}}class _ extends i.A{constructor(t={}){super(t),this.props.orbitAxis=t.orbitAxis||"Z"}get ViewportType(){return c}get ControllerType(){return P}}_.displayName="OrbitView";const w=_},45800:(t,o,e)=>{e.d(o,{A:()=>g});var i=e(10688),r=e(84175),s=e(27586),n=e(43349),a=e(9350),p=e(12530),c=e(25337);const l=[0,0,0,255],h=[0,0,1],u={sizeUnits:"pixels",pointSize:{type:"number",min:0,value:10},getPosition:{type:"accessor",value:t=>t.position},getNormal:{type:"accessor",value:h},getColor:{type:"accessor",value:l},material:!0,radiusPixels:{deprecatedFor:"pointSize"}};class m extends i.A{getShaders(){return super.getShaders({vs:"#version 300 es\n#define SHADER_NAME point-cloud-layer-vertex-shader\nin vec3 positions;\nin vec3 instanceNormals;\nin vec4 instanceColors;\nin vec3 instancePositions;\nin vec3 instancePositions64Low;\nin vec3 instancePickingColors;\nuniform float opacity;\nuniform float radiusPixels;\nuniform int sizeUnits;\nout vec4 vColor;\nout vec2 unitPosition;\nvoid main(void) {\ngeometry.worldPosition = instancePositions;\ngeometry.normal = project_normal(instanceNormals);\nunitPosition = positions.xy;\ngeometry.uv = unitPosition;\ngeometry.pickingColor = instancePickingColors;\nvec3 offset = vec3(positions.xy * project_size_to_pixel(radiusPixels, sizeUnits), 0.0);\nDECKGL_FILTER_SIZE(offset, geometry);\ngl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, vec3(0.), geometry.position);\nDECKGL_FILTER_GL_POSITION(gl_Position, geometry);\ngl_Position.xy += project_pixel_size_to_clipspace(offset.xy);\nvec3 lightColor = lighting_getLightColor(instanceColors.rgb, project_uCameraPosition, geometry.position.xyz, geometry.normal);\nvColor = vec4(lightColor, instanceColors.a * opacity);\nDECKGL_FILTER_COLOR(vColor, geometry);\n}\n",fs:"#version 300 es\n#define SHADER_NAME point-cloud-layer-fragment-shader\nprecision highp float;\nin vec4 vColor;\nin vec2 unitPosition;\nout vec4 fragColor;\nvoid main(void) {\ngeometry.uv = unitPosition;\nfloat distToCenter = length(unitPosition);\nif (distToCenter > 1.0) {\ndiscard;\n}\nfragColor = vColor;\nDECKGL_FILTER_COLOR(fragColor, geometry);\n}\n",modules:[r.A,s.K,n.A]})}initializeState(){this.getAttributeManager().addInstanced({instancePositions:{size:3,type:"float64",fp64:this.use64bitPositions(),transition:!0,accessor:"getPosition"},instanceNormals:{size:3,transition:!0,accessor:"getNormal",defaultValue:h},instanceColors:{size:this.props.colorFormat.length,type:"unorm8",transition:!0,accessor:"getColor",defaultValue:l}})}updateState(t){const{changeFlags:o,props:e}=t;super.updateState(t),o.extensionsChanged&&(this.state.model?.destroy(),this.state.model=this._getModel(),this.getAttributeManager().invalidateAll()),o.dataChanged&&function(t){const{header:o,attributes:e}=t;if(o&&e&&(t.length=o.vertexCount,e.POSITION&&(e.instancePositions=e.POSITION),e.NORMAL&&(e.instanceNormals=e.NORMAL),e.COLOR_0)){const{size:t,value:o}=e.COLOR_0;e.instanceColors={size:t,type:"unorm8",value:o}}}(e.data)}draw({uniforms:t}){const{pointSize:o,sizeUnits:e}=this.props,i=this.state.model;i.setUniforms(t),i.setUniforms({sizeUnits:a.p5[e],radiusPixels:o}),i.draw(this.context.renderPass)}_getModel(){const t=[];for(let o=0;o<3;o++){const e=o/3*Math.PI*2;t.push(2*Math.cos(e),2*Math.sin(e),0)}return new p.K(this.context.device,{...this.getShaders(),id:this.props.id,bufferLayout:this.getAttributeManager().getBufferLayouts(),geometry:new c.V({topology:"triangle-list",attributes:{positions:new Float32Array(t)}}),isInstanced:!0})}}m.layerName="PointCloudLayer",m.defaultProps=u;const g=m}}]);